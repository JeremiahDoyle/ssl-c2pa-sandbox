"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[435],{4904:(e,t,a)=>{a.d(t,{BQ:()=>C,Tjk:()=>b,irx:()=>ub});var s,r,i,n=a(397),l=a(9169),u=a(5815),o=a(7338),c=a(9374),h=a(2288),m=a(1965),d=a(9509);let f=new ArrayBuffer(0);class g extends TypeError{constructor(){super(...arguments),this.name=g.NAME}static isType(e,t){if("string"==typeof t){if("Array"===t&&Array.isArray(e))return!0;if("ArrayBuffer"===t&&e instanceof ArrayBuffer)return!0;if("ArrayBufferView"===t&&ArrayBuffer.isView(e))return!0;else if(typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...a){for(let t of a)if(this.isType(e,t))return;let s=a.map(e=>e instanceof Function&&"name"in e?e.name:`${e}`);throw new g(`Parameter '${t}' is not of type ${s.length>1?`(${s.join(" or ")})`:s[0]}`)}}g.NAME="ArgumentError";class p extends TypeError{static assert(...e){let t,a,s=null;for(let r of("string"==typeof e[0]?(s=e[0],t=e[1],a=e.slice(2)):(t=e[0],a=e.slice(1)),g.assert(t,"parameters","object"),a))if(null==t[r])throw new p(r,s)}static assertEmpty(e,t,a){if(null==e)throw new p(t,a)}constructor(e,t=null,a){super(),this.name=p.NAME,this.field=e,t&&(this.target=t),a?this.message=a:this.message=`Absent mandatory parameter '${e}' ${t?` in '${t}'`:""}`}}p.NAME="ParameterError";class w extends Error{static assertSchema(e,t){if(!e.verified)throw Error(`Object's schema was not verified against input data for ${t}`)}static assert(e,t){if(-1===e.offset)throw new w(`Error during parsing of ASN.1 data. Data is not correct for '${t}'.`)}constructor(e){super(e),this.name="AsnError"}}class y{static blockName(){return this.CLASS_NAME}static fromBER(e){let t=n.mH(e);w.assert(t,this.name);try{return new this({schema:t.result})}catch(e){throw new w(`Cannot create '${this.CLASS_NAME}' from ASN.1 object`)}}static defaultValues(e){throw Error(`Invalid member name for ${this.CLASS_NAME} class: ${e}`)}static schema(e={}){throw Error(`Method '${this.CLASS_NAME}.schema' should be overridden`)}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch{t=this.toSchema(!0)}return l.U$.ToString(t.toBER(),e)}}function v(e){let t=!1,a="",s=e.trim();for(let e=0;e<s.length;e++)32===s.charCodeAt(e)?!1===t&&(t=!0):(t&&(a+=" ",t=!1),a+=s[e]);return a.toLowerCase()}y.CLASS_NAME="PkiObject";let k="type",S="value";class b extends y{constructor(e={}){super(),this.type=u.kd(e,k,b.defaultValues(k)),this.value=u.kd(e,S,b.defaultValues(S)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case k:return"";case S:return{};default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.type||""}),new n.FS({name:t.value||""})]})}fromSchema(e){u.gZ(e,[k,"typeValue"]);let t=n.FL(e,e,b.schema({names:{type:k,value:"typeValue"}}));w.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new n.gd({value:[new n.dS({value:this.type}),this.value]})}toJSON(){let e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){let t=[n.Jn.blockName(),n.TH.blockName(),n.n6.blockName(),n.Tz.blockName(),n.Hx.blockName(),n.Bp.blockName(),n.So.blockName(),n.hz.blockName(),n.aN.blockName(),n.AV.blockName(),n.i7.blockName(),n.Jm.blockName()];if(e instanceof ArrayBuffer)return l._H.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===b.blockName()){if(this.type!==e.type)return!1;let a=[!1,!1],s=this.value.constructor.blockName();for(let r of t)s===r&&(a[0]=!0),e.value.constructor.blockName()===r&&(a[1]=!0);if(a[0]!==a[1])return!1;if(a[0]&&a[1]){let t=v(this.value.valueBlock.value),a=v(e.value.valueBlock.value);if(0!==t.localeCompare(a))return!1}else if(!l._H.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}b.CLASS_NAME="AttributeTypeAndValue";let A="typesAndValues",N="valueBeforeDecode";class C extends y{constructor(e={}){super(),this.typesAndValues=u.kd(e,A,C.defaultValues(A)),this.valueBeforeDecode=u.kd(e,N,C.defaultValues(N)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case A:return[];case N:return f;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case A:return 0===t.length;case N:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.repeatedSequence||"",value:new n.NZ({value:[new n.Fl({name:t.repeatedSet||"",value:b.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){u.gZ(e,["RDN",A]);let t=n.FL(e,e,C.schema({names:{blockName:"RDN",repeatedSet:A}}));w.assertSchema(t,this.className),A in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,e=>new b({schema:e}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(0===this.valueBeforeDecode.byteLength)return new n.gd({value:[new n.NZ({value:Array.from(this.typesAndValues,e=>e.toSchema())})]});let e=n.mH(this.valueBeforeDecode);if(w.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof n.gd))throw Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof C){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(let[t,a]of this.typesAndValues.entries())if(!1===a.isEqual(e.typesAndValues[t]))return!1;return!0}return e instanceof ArrayBuffer&&u.JQ(this.valueBeforeDecode,e)}}C.CLASS_NAME="RelativeDistinguishedNames";let V="type",B="value";class I extends y{constructor(e={}){super(),this.type=u.kd(e,V,I.defaultValues(V)),this.value=u.kd(e,B,I.defaultValues(B)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case V:return 9;case B:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case V:return t===I.defaultValues(e);case B:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.GR({value:[new n.BL({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||"",value:[new n.dS,new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.FS]})]}),new n.sG({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:1}}),new n.sG({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:2}}),new n.BL({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||"",value:[function(e={},t=!1){let a=u.kd(e,"names",{});return new n.gd({optional:t,value:[new n.BL({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:a.country_name||"",value:[new n.GR({value:[new n.Tz,new n.Hx]})]}),new n.BL({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:a.administration_domain_name||"",value:[new n.GR({value:[new n.Tz,new n.Hx]})]}),new n.sG({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:a.network_address||"",isHexOnly:!0}),new n.sG({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:a.terminal_identifier||"",isHexOnly:!0}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:a.private_domain_name||"",value:[new n.GR({value:[new n.Tz,new n.Hx]})]}),new n.sG({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:a.organization_name||"",isHexOnly:!0}),new n.sG({optional:!0,name:a.numeric_user_identifier||"",idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new n.BL({optional:!0,name:a.personal_name||"",idBlock:{tagClass:3,tagNumber:5},value:[new n.sG({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new n.sG({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new n.sG({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new n.sG({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new n.BL({optional:!0,name:a.organizational_unit_names||"",idBlock:{tagClass:3,tagNumber:6},value:[new n.Fl({value:new n.Hx})]})]})}(t.builtInStandardAttributes||{},!1),function(e=!1){return new n.gd({optional:e,value:[new n.Hx,new n.Hx]})}(!0),function(e=!1){return new n.NZ({optional:e,value:[new n.sG({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new n.FS]})]})}(!0)]}),new n.BL({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||"",value:[C.schema(t.directoryName||{})]}),new n.BL({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||"",value:[new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.GR({value:[new n.Bp,new n.Hx,new n.n6,new n.Jn,new n.TH]})]}),new n.BL({idBlock:{tagClass:3,tagNumber:1},value:[new n.GR({value:[new n.Bp,new n.Hx,new n.n6,new n.Jn,new n.TH]})]})]}),new n.sG({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:6}}),new n.sG({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:7}}),new n.sG({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){u.gZ(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);let t=n.FL(e,e,I.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(w.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=t.result.blockName;break;case 1:case 2:case 6:{let e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=22;let a=e.toBER(!1),s=n.mH(a);w.assert(s,"GeneralName value"),this.value=s.result.valueBlock.value}break;case 4:this.value=new C({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new n.lW({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{let e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=6;let a=e.toBER(!1),s=n.mH(a);w.assert(s,"GeneralName registeredID"),this.value=s.result.valueBlock.toString()}}}toSchema(){switch(this.type){case 0:case 3:case 5:return new n.BL({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{let e=new n.hz({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new n.BL({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{let e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{let e=new n.dS({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return I.schema()}}toJSON(){let e={type:this.type,value:""};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch(e){}return e}}I.CLASS_NAME="GeneralName";let E="accessMethod",D="accessLocation",x=[E,D];class O extends y{constructor(e={}){super(),this.accessMethod=u.kd(e,E,O.defaultValues(E)),this.accessLocation=u.kd(e,D,O.defaultValues(D)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case E:return"";case D:return new I;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.accessMethod||""}),I.schema(t.accessLocation||{})]})}fromSchema(e){u.gZ(e,x);let t=n.FL(e,e,O.schema({names:{accessMethod:E,accessLocation:{names:{blockName:D}}}}));w.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new I({schema:t.result.accessLocation})}toSchema(){return new n.gd({value:[new n.dS({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}O.CLASS_NAME="AccessDescription";let P="seconds",L="millis",K="micros";class H extends y{constructor(e={}){super(),P in e&&(this.seconds=u.kd(e,P,H.defaultValues(P))),L in e&&(this.millis=u.kd(e,L,H.defaultValues(L))),K in e&&(this.micros=u.kd(e,K,H.defaultValues(K))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case P:case L:case K:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case P:case L:case K:return t===H.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",optional:!0,value:[new n.jz({optional:!0,name:t.seconds||""}),new n.sG({name:t.millis||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new n.sG({name:t.micros||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){u.gZ(e,[P,L,K]);let t=n.FL(e,e,H.schema({names:{seconds:P,millis:L,micros:K}}));if(w.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){let e=new n.jz({valueHex:t.result.millis.valueBlock.valueHex});this.millis=e.valueBlock.valueDec}if("micros"in t.result){let e=new n.jz({valueHex:t.result.micros.valueBlock.valueHex});this.micros=e.valueBlock.valueDec}}toSchema(){let e=[];if(void 0!==this.seconds&&e.push(new n.jz({value:this.seconds})),void 0!==this.millis){let t=new n.jz({value:this.millis});e.push(new n.sG({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(void 0!==this.micros){let t=new n.jz({value:this.micros});e.push(new n.sG({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new n.gd({value:e})}toJSON(){let e={};return void 0!==this.seconds&&(e.seconds=this.seconds),void 0!==this.millis&&(e.millis=this.millis),void 0!==this.micros&&(e.micros=this.micros),e}}H.CLASS_NAME="Accuracy";let R="algorithmId",j="algorithmParams",U="algorithm",J="params",T=[U,J];class F extends y{constructor(e={}){super(),this.algorithmId=u.kd(e,R,F.defaultValues(R)),j in e&&(this.algorithmParams=u.kd(e,j,F.defaultValues(j))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case R:return"";case j:return new n.FS;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case R:return""===t;case j:return t instanceof n.FS;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",optional:t.optional||!1,value:[new n.dS({name:t.algorithmIdentifier||""}),new n.FS({name:t.algorithmParams||"",optional:!0})]})}fromSchema(e){u.gZ(e,T);let t=n.FL(e,e,F.schema({names:{algorithmIdentifier:U,algorithmParams:J}}));w.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),J in t.result&&(this.algorithmParams=t.result.params)}toSchema(){let e=[];return e.push(new n.dS({value:this.algorithmId})),!this.algorithmParams||this.algorithmParams instanceof n.FS||e.push(this.algorithmParams),new n.gd({value:e})}toJSON(){let e={algorithmId:this.algorithmId};return!this.algorithmParams||this.algorithmParams instanceof n.FS||(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return e instanceof F&&this.algorithmId===e.algorithmId&&(this.algorithmParams?!!e.algorithmParams&&JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!e.algorithmParams)}}F.CLASS_NAME="AlgorithmIdentifier";let q="altNames",M=[q];class W extends y{constructor(e={}){super(),this.altNames=u.kd(e,q,W.defaultValues(q)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===q?[]:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.altNames||"",value:I.schema()})]})}fromSchema(e){u.gZ(e,M);let t=n.FL(e,e,W.schema({names:{altNames:q}}));w.assertSchema(t,this.className),q in t.result&&(this.altNames=Array.from(t.result.altNames,e=>new I({schema:e})))}toSchema(){return new n.gd({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}W.CLASS_NAME="AltName";let $="type",_="values",z=[$,_];class Z extends y{constructor(e={}){super(),this.type=u.kd(e,$,Z.defaultValues($)),this.values=u.kd(e,_,Z.defaultValues(_)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $:return"";case _:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $:return""===t;case _:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.type||""}),new n.NZ({name:t.setName||"",value:[new n.Fl({name:t.values||"",value:new n.FS})]})]})}fromSchema(e){u.gZ(e,z);let t=n.FL(e,e,Z.schema({names:{type:$,values:_}}));w.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new n.gd({value:[new n.dS({value:this.type}),new n.NZ({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}Z.CLASS_NAME="Attribute";let G="notBeforeTime",Q="notAfterTime",Y=[G,Q];class X extends y{constructor(e={}){super(),this.notBeforeTime=u.kd(e,G,X.defaultValues(G)),this.notAfterTime=u.kd(e,Q,X.defaultValues(Q)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case G:case Q:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.O_({name:t.notBeforeTime||""}),new n.O_({name:t.notAfterTime||""})]})}fromSchema(e){u.gZ(e,Y);let t=n.FL(e,e,X.schema({names:{notBeforeTime:G,notAfterTime:Q}}));w.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new n.gd({value:[new n.O_({valueDate:this.notBeforeTime}),new n.O_({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}X.CLASS_NAME="AttCertValidityPeriod";let ee="names",et="generalNames";class ea extends y{constructor(e={}){super(),this.names=u.kd(e,ee,ea.defaultValues(ee)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return"names"===e?[]:super.defaultValues(e)}static schema(e={},t=!1){let a=u.kd(e,ee,{});return new n.gd({optional:t,name:a.blockName||"",value:[new n.Fl({name:a.generalNames||"",value:I.schema()})]})}fromSchema(e){u.gZ(e,[ee,et]);let t=n.FL(e,e,ea.schema({names:{blockName:ee,generalNames:et}}));w.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,e=>new I({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}ea.CLASS_NAME="GeneralNames";let es="2.5.29.17",er="2.5.29.18",ei="2.5.29.19",en="2.5.29.28",el="2.5.29.29",eu="2.5.29.30",eo="2.5.29.31",ec="2.5.29.46",eh="2.5.29.32",em="2.5.29.32.0",ed="2.5.29.33",ef="2.5.29.35",eg="2.5.29.36",ep="1.3.6.1.5.5.7.1.1",ew="1.2.840.113549.1.7.1",ey="1.2.840.113549.1.7.2",ev="1.2.840.113549.1.7.3",ek="1.2.840.113549.1.7.6",eS="1.2.840.113549.1.9.22.1",eb="1.2.840.113549.1.9.22.3",eA="1.2.840.113549.1.9.23.1",eN="1.3.6.1.5.5.7.48.1.1",eC="keyIdentifier",eV="authorityCertIssuer",eB="authorityCertSerialNumber",eI=[eC,eV,eB];class eE extends y{constructor(e={}){super(),eC in e&&(this.keyIdentifier=u.kd(e,eC,eE.defaultValues(eC))),eV in e&&(this.authorityCertIssuer=u.kd(e,eV,eE.defaultValues(eV))),eB in e&&(this.authorityCertSerialNumber=u.kd(e,eB,eE.defaultValues(eB))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eC:return new n.lW;case eV:return[];case eB:return new n.jz;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.sG({name:t.keyIdentifier||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new n.Fl({name:t.authorityCertIssuer||"",value:I.schema()})]}),new n.sG({name:t.authorityCertSerialNumber||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){u.gZ(e,eI);let t=n.FL(e,e,eE.schema({names:{keyIdentifier:eC,authorityCertIssuer:eV,authorityCertSerialNumber:eB}}));w.assertSchema(t,this.className),eC in t.result&&(this.keyIdentifier=new n.lW({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),eV in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,e=>new I({schema:e}))),eB in t.result&&(this.authorityCertSerialNumber=new n.jz({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){let e=[];return this.keyIdentifier&&e.push(new n.sG({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,e=>e.toSchema())})),this.authorityCertSerialNumber&&e.push(new n.sG({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new n.gd({value:e})}toJSON(){let e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,e=>e.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}eE.CLASS_NAME="AuthorityKeyIdentifier";let eD="pathLenConstraint";class ex extends y{constructor(e={}){super(),this.cA=u.kd(e,"cA",!1),eD in e&&(this.pathLenConstraint=u.kd(e,eD,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return"cA"!==e&&super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.v8({optional:!0,name:t.cA||""}),new n.jz({optional:!0,name:t.pathLenConstraint||""})]})}fromSchema(e){u.gZ(e,["cA",eD]);let t=n.FL(e,e,ex.schema({names:{cA:"cA",pathLenConstraint:eD}}));w.assertSchema(t,this.className),"cA"in t.result&&(this.cA=t.result.cA.valueBlock.value),eD in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){let e=[];return this.cA!==ex.defaultValues("cA")&&e.push(new n.v8({value:this.cA})),eD in this&&(this.pathLenConstraint instanceof n.jz?e.push(this.pathLenConstraint):e.push(new n.jz({value:this.pathLenConstraint}))),new n.gd({value:e})}toJSON(){let e={};return this.cA!==ex.defaultValues("cA")&&(e.cA=this.cA),eD in this&&(this.pathLenConstraint instanceof n.jz?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}ex.CLASS_NAME="BasicConstraints";let eO="certificateIndex",eP="keyIndex";class eL extends y{constructor(e={}){super(),this.certificateIndex=u.kd(e,eO,eL.defaultValues(eO)),this.keyIndex=u.kd(e,eP,eL.defaultValues(eP)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eO:case eP:return 0;default:return super.defaultValues(e)}}static schema(){return new n.jz}fromSchema(e){if(e.constructor.blockName()!==n.jz.blockName())throw Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0),a=new Uint8Array(t);switch(!0){case t.byteLength<4:{let e=new ArrayBuffer(4);new Uint8Array(e).set(a,4-t.byteLength),t=e.slice(0)}break;case t.byteLength>4:{let e=new ArrayBuffer(4);new Uint8Array(e).set(a.slice(0,4)),t=e.slice(0)}}let s=t.slice(0,2),r=new Uint8Array(s),i=r[0];r[0]=r[1],r[1]=i;let l=new Uint16Array(s);this.keyIndex=l[0];let u=t.slice(2),o=new Uint8Array(u);i=o[0],o[0]=o[1],o[1]=i;let c=new Uint16Array(u);this.certificateIndex=c[0]}toSchema(){let e=new ArrayBuffer(2);new Uint16Array(e)[0]=this.certificateIndex;let t=new Uint8Array(e),a=t[0];t[0]=t[1],t[1]=a;let s=new ArrayBuffer(2);new Uint16Array(s)[0]=this.keyIndex;let r=new Uint8Array(s);return a=r[0],r[0]=r[1],r[1]=a,new n.jz({valueHex:u.SD(s,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}eL.CLASS_NAME="CAVersion";let eK="policyQualifierId",eH="qualifier",eR=[eK,eH];class ej extends y{constructor(e={}){super(),this.policyQualifierId=u.kd(e,eK,ej.defaultValues(eK)),this.qualifier=u.kd(e,eH,ej.defaultValues(eH)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eK:return"";case eH:return new n.FS;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.policyQualifierId||""}),new n.FS({name:t.qualifier||""})]})}fromSchema(e){u.gZ(e,eR);let t=n.FL(e,e,ej.schema({names:{policyQualifierId:eK,qualifier:eH}}));w.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new n.gd({value:[new n.dS({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}ej.CLASS_NAME="PolicyQualifierInfo";let eU="policyIdentifier",eJ="policyQualifiers",eT=[eU,eJ];class eF extends y{constructor(e={}){super(),this.policyIdentifier=u.kd(e,eU,eF.defaultValues(eU)),eJ in e&&(this.policyQualifiers=u.kd(e,eJ,eF.defaultValues(eJ))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eU:return"";case eJ:return[];default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.policyIdentifier||""}),new n.gd({optional:!0,value:[new n.Fl({name:t.policyQualifiers||"",value:ej.schema()})]})]})}fromSchema(e){u.gZ(e,eT);let t=n.FL(e,e,eF.schema({names:{policyIdentifier:eU,policyQualifiers:eJ}}));w.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),eJ in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,e=>new ej({schema:e})))}toSchema(){let e=[];return e.push(new n.dS({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new n.gd({value:Array.from(this.policyQualifiers,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){let e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,e=>e.toJSON())),e}}eF.CLASS_NAME="PolicyInformation";let eq="certificatePolicies",eM=[eq];class eW extends y{constructor(e={}){super(),this.certificatePolicies=u.kd(e,eq,eW.defaultValues(eq)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===eq?[]:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.certificatePolicies||"",value:eF.schema()})]})}fromSchema(e){u.gZ(e,eM);let t=n.FL(e,e,eW.schema({names:{certificatePolicies:eq}}));w.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,e=>new eF({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}eW.CLASS_NAME="CertificatePolicies";let e$="templateID",e_="templateMajorVersion",ez="templateMinorVersion",eZ=[e$,e_,ez];class eG extends y{constructor(e={}){super(),this.templateID=u.kd(e,e$,eG.defaultValues(e$)),e_ in e&&(this.templateMajorVersion=u.kd(e,e_,eG.defaultValues(e_))),ez in e&&(this.templateMinorVersion=u.kd(e,ez,eG.defaultValues(ez))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case e$:return"";case e_:case ez:return 0;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.templateID||""}),new n.jz({name:t.templateMajorVersion||"",optional:!0}),new n.jz({name:t.templateMinorVersion||"",optional:!0})]})}fromSchema(e){u.gZ(e,eZ);let t=n.FL(e,e,eG.schema({names:{templateID:e$,templateMajorVersion:e_,templateMinorVersion:ez}}));w.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),e_ in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),ez in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){let e=[];return e.push(new n.dS({value:this.templateID})),e_ in this&&e.push(new n.jz({value:this.templateMajorVersion})),ez in this&&e.push(new n.jz({value:this.templateMinorVersion})),new n.gd({value:e})}toJSON(){let e={templateID:this.templateID};return e_ in this&&(e.templateMajorVersion=this.templateMajorVersion),ez in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}let eQ="distributionPoint",eY="distributionPointNames",eX="reasons",e1="cRLIssuer",e0="cRLIssuerNames",e2=[eQ,eY,eX,e1,e0];class e3 extends y{constructor(e={}){super(),eQ in e&&(this.distributionPoint=u.kd(e,eQ,e3.defaultValues(eQ))),eX in e&&(this.reasons=u.kd(e,eX,e3.defaultValues(eX))),e1 in e&&(this.cRLIssuer=u.kd(e,e1,e3.defaultValues(e1))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eQ:return[];case eX:return new n.Rq;case e1:return[];default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.GR({value:[new n.BL({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.Fl({name:t.distributionPointNames||"",value:I.schema()})]}),new n.BL({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:C.schema().valueBlock.value})]})]}),new n.sG({name:t.reasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new n.BL({name:t.cRLIssuer||"",optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new n.Fl({name:t.cRLIssuerNames||"",value:I.schema()})]})]})}fromSchema(e){u.gZ(e,e2);let t=n.FL(e,e,e3.schema({names:{distributionPoint:eQ,distributionPointNames:eY,reasons:eX,cRLIssuer:e1,cRLIssuerNames:e0}}));w.assertSchema(t,this.className),eQ in t.result&&(0===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(t.result.distributionPointNames,e=>new I({schema:e}))),1===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new C({schema:new n.gd({value:t.result.distributionPoint.valueBlock.value})}))),eX in t.result&&(this.reasons=new n.Rq({valueHex:t.result.reasons.valueBlock.valueHex})),e1 in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,e=>new I({schema:e})))}toSchema(){let e=[];if(this.distributionPoint){let t;t=new n.BL(this.distributionPoint instanceof Array?{idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,e=>e.toSchema())}:{idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new n.sG({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){let e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,e=>e.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,e=>e.toJSON())),e}}e3.CLASS_NAME="DistributionPoint";let e4="distributionPoints",e8=[e4];class e5 extends y{constructor(e={}){super(),this.distributionPoints=u.kd(e,e4,e5.defaultValues(e4)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===e4?[]:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.distributionPoints||"",value:e3.schema()})]})}fromSchema(e){u.gZ(e,e8);let t=n.FL(e,e,e5.schema({names:{distributionPoints:e4}}));w.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,e=>new e3({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}e5.CLASS_NAME="CRLDistributionPoints";let e6="keyPurposes",e9=[e6];class e7 extends y{constructor(e={}){super(),this.keyPurposes=u.kd(e,e6,e7.defaultValues(e6)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===e6?[]:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.keyPurposes||"",value:new n.dS})]})}fromSchema(e){u.gZ(e,e9);let t=n.FL(e,e,e7.schema({names:{keyPurposes:e6}}));w.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,e=>e.valueBlock.toString())}toSchema(){return new n.gd({value:Array.from(this.keyPurposes,e=>new n.dS({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}e7.CLASS_NAME="ExtKeyUsage";let te="accessDescriptions";class tt extends y{constructor(e={}){super(),this.accessDescriptions=u.kd(e,te,tt.defaultValues(te)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===te?[]:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.accessDescriptions||"",value:O.schema()})]})}fromSchema(e){u.gZ(e,[te]);let t=n.FL(e,e,tt.schema({names:{accessDescriptions:te}}));w.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,e=>new O({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}tt.CLASS_NAME="InfoAccess";let ta="distributionPoint",ts="distributionPointNames",tr="onlyContainsUserCerts",ti="onlyContainsCACerts",tn="onlySomeReasons",tl="indirectCRL",tu="onlyContainsAttributeCerts",to=[ta,ts,tr,ti,tn,tl,tu];class tc extends y{constructor(e={}){super(),ta in e&&(this.distributionPoint=u.kd(e,ta,tc.defaultValues(ta))),this.onlyContainsUserCerts=u.kd(e,tr,tc.defaultValues(tr)),this.onlyContainsCACerts=u.kd(e,ti,tc.defaultValues(ti)),tn in e&&(this.onlySomeReasons=u.kd(e,tn,tc.defaultValues(tn))),this.indirectCRL=u.kd(e,tl,tc.defaultValues(tl)),this.onlyContainsAttributeCerts=u.kd(e,tu,tc.defaultValues(tu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ta:return[];case tr:case ti:return!1;case tn:return 0;case tl:case tu:return!1;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.GR({value:[new n.BL({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:0},value:[new n.Fl({name:t.distributionPointNames||"",value:I.schema()})]}),new n.BL({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:1},value:C.schema().valueBlock.value})]})]}),new n.sG({name:t.onlyContainsUserCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new n.sG({name:t.onlyContainsCACerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new n.sG({name:t.onlySomeReasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new n.sG({name:t.indirectCRL||"",optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new n.sG({name:t.onlyContainsAttributeCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){u.gZ(e,to);let t=n.FL(e,e,tc.schema({names:{distributionPoint:ta,distributionPointNames:ts,onlyContainsUserCerts:tr,onlyContainsCACerts:ti,onlySomeReasons:tn,indirectCRL:tl,onlyContainsAttributeCerts:tu}}));if(w.assertSchema(t,this.className),ta in t.result)switch(!0){case 0===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(t.result.distributionPointNames,e=>new I({schema:e}));break;case 1===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new C({schema:new n.gd({value:t.result.distributionPoint.valueBlock.value})});break;default:throw Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(tr in t.result){let e=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==e[0]}if(ti in t.result){let e=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==e[0]}if(tn in t.result){let e=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=e[0]}if(tl in t.result){let e=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==e[0]}if(tu in t.result){let e=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==e[0]}}toSchema(){let e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new n.BL({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,e=>e.toSchema())}):((t=this.distributionPoint.toSchema()).idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==tc.defaultValues(tr)&&e.push(new n.sG({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==tc.defaultValues(ti)&&e.push(new n.sG({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),void 0!==this.onlySomeReasons){let t=new ArrayBuffer(1);new Uint8Array(t)[0]=this.onlySomeReasons,e.push(new n.sG({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==tc.defaultValues(tl)&&e.push(new n.sG({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==tc.defaultValues(tu)&&e.push(new n.sG({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new n.gd({value:e})}toJSON(){let e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,e=>e.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==tc.defaultValues(tr)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==tc.defaultValues(ti)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),tn in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==tc.defaultValues(tl)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==tc.defaultValues(tu)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}tc.CLASS_NAME="IssuingDistributionPoint";let th="base",tm="minimum",td="maximum",tf=[th,tm,td];class tg extends y{constructor(e={}){super(),this.base=u.kd(e,th,tg.defaultValues(th)),this.minimum=u.kd(e,tm,tg.defaultValues(tm)),td in e&&(this.maximum=u.kd(e,td,tg.defaultValues(td))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case th:return new I;case tm:case td:return 0;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[I.schema(t.base||{}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.jz({name:t.minimum||""})]}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new n.jz({name:t.maximum||""})]})]})}fromSchema(e){u.gZ(e,tf);let t=n.FL(e,e,tg.schema({names:{base:{names:{blockName:th}},minimum:tm,maximum:td}}));w.assertSchema(t,this.className),this.base=new I({schema:t.result.base}),tm in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),td in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){let e=[];if(e.push(this.base.toSchema()),0!==this.minimum){let t=0;t=this.minimum instanceof n.jz?this.minimum:new n.jz({value:this.minimum}),e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(td in this){let t=0;t=this.maximum instanceof n.jz?this.maximum:new n.jz({value:this.maximum}),e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new n.gd({value:e})}toJSON(){let e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),void 0!==this.maximum&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}tg.CLASS_NAME="GeneralSubtree";let tp="permittedSubtrees",tw="excludedSubtrees",ty=[tp,tw];class tv extends y{constructor(e={}){super(),tp in e&&(this.permittedSubtrees=u.kd(e,tp,tv.defaultValues(tp))),tw in e&&(this.excludedSubtrees=u.kd(e,tw,tv.defaultValues(tw))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tp:case tw:return[];default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.Fl({name:t.permittedSubtrees||"",value:tg.schema()})]}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new n.Fl({name:t.excludedSubtrees||"",value:tg.schema()})]})]})}fromSchema(e){u.gZ(e,ty);let t=n.FL(e,e,tv.schema({names:{permittedSubtrees:tp,excludedSubtrees:tw}}));w.assertSchema(t,this.className),tp in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,e=>new tg({schema:e}))),tw in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,e=>new tg({schema:e})))}toSchema(){let e=[];return this.permittedSubtrees&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,e=>e.toSchema())})),this.excludedSubtrees&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){let e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,e=>e.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,e=>e.toJSON())),e}}tv.CLASS_NAME="NameConstraints";let tk="requireExplicitPolicy",tS="inhibitPolicyMapping",tb=[tk,tS];class tA extends y{constructor(e={}){super(),tk in e&&(this.requireExplicitPolicy=u.kd(e,tk,tA.defaultValues(tk))),tS in e&&(this.inhibitPolicyMapping=u.kd(e,tS,tA.defaultValues(tS))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tk:case tS:return 0;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.sG({name:t.requireExplicitPolicy||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new n.sG({name:t.inhibitPolicyMapping||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){u.gZ(e,tb);let t=n.FL(e,e,tA.schema({names:{requireExplicitPolicy:tk,inhibitPolicyMapping:tS}}));if(w.assertSchema(t,this.className),tk in t.result){let e=t.result.requireExplicitPolicy;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;let a=e.toBER(!1),s=n.mH(a);w.assert(s,"Integer"),this.requireExplicitPolicy=s.result.valueBlock.valueDec}if(tS in t.result){let e=t.result.inhibitPolicyMapping;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;let a=e.toBER(!1),s=n.mH(a);w.assert(s,"Integer"),this.inhibitPolicyMapping=s.result.valueBlock.valueDec}}toSchema(){let e=[];if(tk in this){let t=new n.jz({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(tS in this){let t=new n.jz({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new n.gd({value:e})}toJSON(){let e={};return tk in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),tS in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}tA.CLASS_NAME="PolicyConstraints";let tN="issuerDomainPolicy",tC="subjectDomainPolicy",tV=[tN,tC];class tB extends y{constructor(e={}){super(),this.issuerDomainPolicy=u.kd(e,tN,tB.defaultValues(tN)),this.subjectDomainPolicy=u.kd(e,tC,tB.defaultValues(tC)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tN:case tC:return"";default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.issuerDomainPolicy||""}),new n.dS({name:t.subjectDomainPolicy||""})]})}fromSchema(e){u.gZ(e,tV);let t=n.FL(e,e,tB.schema({names:{issuerDomainPolicy:tN,subjectDomainPolicy:tC}}));w.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new n.gd({value:[new n.dS({value:this.issuerDomainPolicy}),new n.dS({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}tB.CLASS_NAME="PolicyMapping";let tI="mappings",tE=[tI];class tD extends y{constructor(e={}){super(),this.mappings=u.kd(e,tI,tD.defaultValues(tI)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===tI?[]:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.mappings||"",value:tB.schema()})]})}fromSchema(e){u.gZ(e,tE);let t=n.FL(e,e,tD.schema({names:{mappings:tI}}));w.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,e=>new tB({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}tD.CLASS_NAME="PolicyMappings";let tx="notBefore",tO="notAfter",tP=[tx,tO];class tL extends y{constructor(e={}){super(),tx in e&&(this.notBefore=u.kd(e,tx,tL.defaultValues(tx))),tO in e&&(this.notAfter=u.kd(e,tO,tL.defaultValues(tO))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tx:case tO:return new Date;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.sG({name:t.notBefore||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new n.sG({name:t.notAfter||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){u.gZ(e,tP);let t=n.FL(e,e,tL.schema({names:{notBefore:tx,notAfter:tO}}));if(w.assertSchema(t,this.className),tx in t.result){let e=new n.O_;e.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=e.toDate()}if(tO in t.result){let e=new n.O_({valueHex:t.result.notAfter.valueBlock.valueHex});e.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=e.toDate()}}toSchema(){let e=[];return tx in this&&e.push(new n.sG({idBlock:{tagClass:3,tagNumber:0},valueHex:new n.O_({valueDate:this.notBefore}).valueBlock.valueHexView})),tO in this&&e.push(new n.sG({idBlock:{tagClass:3,tagNumber:1},valueHex:new n.O_({valueDate:this.notAfter}).valueBlock.valueHexView})),new n.gd({value:e})}toJSON(){let e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}tL.CLASS_NAME="PrivateKeyUsagePeriod";let tK="type",tH="values",tR=["id",tK],tj=[tH];class tU extends y{constructor(e={}){super(),this.id=u.kd(e,"id",tU.defaultValues("id")),tK in e&&(this.type=u.kd(e,tK,tU.defaultValues(tK))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"id":return"";case tK:return new n.Uv;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"id":return""===t;case tK:return t instanceof n.Uv;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.id||""}),new n.FS({name:t.type||"",optional:!0})]})}fromSchema(e){u.gZ(e,tR);let t=n.FL(e,e,tU.schema({names:{id:"id",type:tK}}));w.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),tK in t.result&&(this.type=t.result.type)}toSchema(){let e=[new n.dS({value:this.id})];return tK in this&&e.push(this.type),new n.gd({value:e})}toJSON(){let e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}tU.CLASS_NAME="QCStatement";class tJ extends y{constructor(e={}){super(),this.values=u.kd(e,tH,tJ.defaultValues(tH)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===tH?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===tH?0===t.length:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.values||"",value:tU.schema(t.value||{})})]})}fromSchema(e){u.gZ(e,tj);let t=n.FL(e,e,tJ.schema({names:{values:tH}}));w.assertSchema(t,this.className),this.values=Array.from(t.result.values,e=>new tU({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}tJ.CLASS_NAME="QCStatements";class tT{static register(e,t,a){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:a}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}tT.namedCurves={},tT.register("P-256","1.2.840.10045.3.1.7",32),tT.register("P-384","1.3.132.0.34",48),tT.register("P-521","1.3.132.0.35",66),tT.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),tT.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),tT.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);let tF="namedCurve";class tq extends y{constructor(e={}){super(),this.x=u.kd(e,"x",tq.defaultValues("x")),this.y=u.kd(e,"y",tq.defaultValues("y")),this.namedCurve=u.kd(e,tF,tq.defaultValues(tF)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"x":case"y":return f;case tF:return"";default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"x":case"y":return t instanceof ArrayBuffer&&u.JQ(t,tq.defaultValues(e));case tF:return"string"==typeof t&&t===tq.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new n.HZ}fromSchema(e){let t=l._H.toUint8Array(e);if(4!==t[0])throw Error("Object's schema was not verified against input data for ECPublicKey");let a=tT.find(this.namedCurve);if(!a)throw Error(`Incorrect curve OID: ${this.namedCurve}`);let s=a.size;if(t.byteLength!==2*s+1)throw Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=a.name,this.x=t.slice(1,s+1).buffer,this.y=t.slice(1+s,2*s+1).buffer}toSchema(){return new n.HZ({data:u.SD(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){let e=tT.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:u.nk(u.GY(this.x),!0,!0,!1),y:u.nk(u.GY(this.y),!0,!0,!1)}}fromJSON(e){p.assert("json",e,"crv","x","y");let t=0,a=tT.find(e.crv);a&&(this.namedCurve=a.id,t=a.size);let s=u.Yp(u.Ey(e.x,!0));if(s.byteLength<t){this.x=new ArrayBuffer(t);let e=new Uint8Array(this.x),a=new Uint8Array(s);e.set(a,1)}else this.x=s.slice(0,t);let r=u.Yp(u.Ey(e.y,!0));if(r.byteLength<t){this.y=new ArrayBuffer(t);let e=new Uint8Array(this.y),a=new Uint8Array(r);e.set(a,1)}else this.y=r.slice(0,t)}}tq.CLASS_NAME="ECPublicKey";let tM="modulus",tW="publicExponent",t$=[tM,tW];class t_ extends y{constructor(e={}){super(),this.modulus=u.kd(e,tM,t_.defaultValues(tM)),this.publicExponent=u.kd(e,tW,t_.defaultValues(tW)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tM:case tW:return new n.jz;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.modulus||""}),new n.jz({name:t.publicExponent||""})]})}fromSchema(e){u.gZ(e,t$);let t=n.FL(e,e,t_.schema({names:{modulus:tM,publicExponent:tW}}));w.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new n.gd({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:l.U$.ToBase64Url(this.modulus.valueBlock.valueHexView),e:l.U$.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){p.assert("json",e,"n","e");let t=u.Yp(u.Ey(e.n,!0));this.modulus=new n.jz({valueHex:t.slice(0,Math.pow(2,u.tn(t.byteLength)))}),this.publicExponent=new n.jz({valueHex:u.Yp(u.Ey(e.e,!0)).slice(0,3)})}}t_.CLASS_NAME="RSAPublicKey";let tz="algorithm",tZ="subjectPublicKey",tG=[tz,tZ];class tQ extends y{get parsedKey(){if(void 0===this._parsedKey){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===n.dS.blockName())try{this._parsedKey=new tq({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":{let e=n.mH(this.subjectPublicKey.valueBlock.valueHexView);if(-1!==e.offset)try{this._parsedKey=new t_({schema:e.result})}catch(e){}}}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=u.kd(e,tz,tQ.defaultValues(tz)),this.subjectPublicKey=u.kd(e,tZ,tQ.defaultValues(tZ));let t=u.kd(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tz:return new F;case tZ:return new n.Rq;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[F.schema(t.algorithm||{}),new n.Rq({name:t.subjectPublicKey||""})]})}fromSchema(e){u.gZ(e,tG);let t=n.FL(e,e,tQ.schema({names:{algorithm:{names:{blockName:tz}},subjectPublicKey:tZ}}));w.assertSchema(t,this.className),this.algorithm=new F({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new n.gd({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};let e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}return Object.assign(e,this.parsedKey.toJSON()),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new tq({json:e}),this.algorithm=new F({algorithmId:"1.2.840.10045.2.1",algorithmParams:new n.dS({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new t_({json:e}),this.algorithm=new F({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new n.Uv});break;default:throw Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new n.Rq({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=aM(!0)){try{if(!e)throw Error("Need to provide publicKey input parameter");let a=await t.exportKey("spki",e),s=n.mH(a);try{this.fromSchema(s.result)}catch(e){throw Error("Error during initializing object from schema")}}catch(t){let e=t instanceof Error?t.message:`${t}`;throw Error(`Error during exporting public key: ${e}`)}}}tQ.CLASS_NAME="PublicKeyInfo";let tY="version",tX="privateKey",t1="namedCurve",t0="publicKey",t2=[tY,tX,t1,t0];class t3 extends y{constructor(e={}){super(),this.version=u.kd(e,tY,t3.defaultValues(tY)),this.privateKey=u.kd(e,tX,t3.defaultValues(tX)),t1 in e&&(this.namedCurve=u.kd(e,t1,t3.defaultValues(t1))),t0 in e&&(this.publicKey=u.kd(e,t0,t3.defaultValues(t0))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tY:return 1;case tX:return new n.lW;case t1:return"";case t0:return new tq;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case tY:return t===t3.defaultValues(e);case tX:return t.isEqual(t3.defaultValues(e));case t1:return""===t;case t0:return tq.compareWithDefault(t1,t.namedCurve)&&tq.compareWithDefault("x",t.x)&&tq.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),new n.lW({name:t.privateKey||""}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.dS({name:t.namedCurve||""})]}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new n.Rq({name:t.publicKey||""})]})]})}fromSchema(e){u.gZ(e,t2);let t=n.FL(e,e,t3.schema({names:{version:tY,privateKey:tX,namedCurve:t1,publicKey:t0}}));if(w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,t1 in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),t0 in t.result){let e={schema:t.result.publicKey.valueBlock.valueHex};t1 in this&&(e.namedCurve=this.namedCurve),this.publicKey=new tq(e)}}toSchema(){let e=[new n.jz({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.dS({value:this.namedCurve})]})),this.publicKey&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:[new n.Rq({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new n.gd({value:e})}toJSON(){if(!this.namedCurve||t3.compareWithDefault(t1,this.namedCurve))throw Error('Not enough information for making JSON: absent "namedCurve" value');let e=tT.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:l.U$.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){let e=this.publicKey.toJSON();t.x=e.x,t.y=e.y}return t}fromJSON(e){p.assert("json",e,"crv","d");let t=0,a=tT.find(e.crv);a&&(this.namedCurve=a.id,t=a.size);let s=l.U$.FromBase64Url(e.d);if(s.byteLength<t){let e=new ArrayBuffer(t),a=new Uint8Array(e),r=new Uint8Array(s);a.set(r,1),this.privateKey=new n.lW({valueHex:e})}else this.privateKey=new n.lW({valueHex:s.slice(0,t)});e.x&&e.y&&(this.publicKey=new tq({json:e}))}}t3.CLASS_NAME="ECPrivateKey";let t4="prime",t8="exponent",t5="coefficient",t6=[t4,t8,t5];class t9 extends y{constructor(e={}){super(),this.prime=u.kd(e,t4,t9.defaultValues(t4)),this.exponent=u.kd(e,t8,t9.defaultValues(t8)),this.coefficient=u.kd(e,t5,t9.defaultValues(t5)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case t4:case t8:case t5:return new n.jz;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.prime||""}),new n.jz({name:t.exponent||""}),new n.jz({name:t.coefficient||""})]})}fromSchema(e){u.gZ(e,t6);let t=n.FL(e,e,t9.schema({names:{prime:t4,exponent:t8,coefficient:t5}}));w.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new n.gd({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:l.U$.ToBase64Url(this.prime.valueBlock.valueHexView),d:l.U$.ToBase64Url(this.exponent.valueBlock.valueHexView),t:l.U$.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){p.assert("json",e,"r","d","r"),this.prime=new n.jz({valueHex:l.U$.FromBase64Url(e.r)}),this.exponent=new n.jz({valueHex:l.U$.FromBase64Url(e.d)}),this.coefficient=new n.jz({valueHex:l.U$.FromBase64Url(e.t)})}}t9.CLASS_NAME="OtherPrimeInfo";let t7="version",ae="modulus",at="publicExponent",aa="privateExponent",as="prime1",ar="prime2",ai="exponent1",an="exponent2",al="coefficient",au="otherPrimeInfos",ao=[t7,ae,at,aa,as,ar,ai,an,al,au];class ac extends y{constructor(e={}){super(),this.version=u.kd(e,t7,ac.defaultValues(t7)),this.modulus=u.kd(e,ae,ac.defaultValues(ae)),this.publicExponent=u.kd(e,at,ac.defaultValues(at)),this.privateExponent=u.kd(e,aa,ac.defaultValues(aa)),this.prime1=u.kd(e,as,ac.defaultValues(as)),this.prime2=u.kd(e,ar,ac.defaultValues(ar)),this.exponent1=u.kd(e,ai,ac.defaultValues(ai)),this.exponent2=u.kd(e,an,ac.defaultValues(an)),this.coefficient=u.kd(e,al,ac.defaultValues(al)),au in e&&(this.otherPrimeInfos=u.kd(e,au,ac.defaultValues(au))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case t7:return 0;case ae:case at:case aa:case as:case ar:case ai:case an:case al:return new n.jz;case au:return[];default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),new n.jz({name:t.modulus||""}),new n.jz({name:t.publicExponent||""}),new n.jz({name:t.privateExponent||""}),new n.jz({name:t.prime1||""}),new n.jz({name:t.prime2||""}),new n.jz({name:t.exponent1||""}),new n.jz({name:t.exponent2||""}),new n.jz({name:t.coefficient||""}),new n.gd({optional:!0,value:[new n.Fl({name:t.otherPrimeInfosName||"",value:t9.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){u.gZ(e,ao);let t=n.FL(e,e,ac.schema({names:{version:t7,modulus:ae,publicExponent:at,privateExponent:aa,prime1:as,prime2:ar,exponent1:ai,exponent2:an,coefficient:al,otherPrimeInfo:{names:{blockName:au}}}}));w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),au in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,e=>new t9({schema:e})))}toSchema(){let e=[];return e.push(new n.jz({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new n.gd({value:Array.from(this.otherPrimeInfos,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){let e={n:l.U$.ToBase64Url(this.modulus.valueBlock.valueHexView),e:l.U$.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:l.U$.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:l.U$.ToBase64Url(this.prime1.valueBlock.valueHexView),q:l.U$.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:l.U$.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:l.U$.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:l.U$.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,e=>e.toJSON())),e}fromJSON(e){p.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new n.jz({valueHex:l.U$.FromBase64Url(e.n)}),this.publicExponent=new n.jz({valueHex:l.U$.FromBase64Url(e.e)}),this.privateExponent=new n.jz({valueHex:l.U$.FromBase64Url(e.d)}),this.prime1=new n.jz({valueHex:l.U$.FromBase64Url(e.p)}),this.prime2=new n.jz({valueHex:l.U$.FromBase64Url(e.q)}),this.exponent1=new n.jz({valueHex:l.U$.FromBase64Url(e.dp)}),this.exponent2=new n.jz({valueHex:l.U$.FromBase64Url(e.dq)}),this.coefficient=new n.jz({valueHex:l.U$.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,e=>new t9({json:e})))}}ac.CLASS_NAME="RSAPrivateKey";let ah="version",am="privateKeyAlgorithm",ad="privateKey",af="attributes",ag="parsedKey",ap=[ah,am,ad,af];class aw extends y{constructor(e={}){super(),this.version=u.kd(e,ah,aw.defaultValues(ah)),this.privateKeyAlgorithm=u.kd(e,am,aw.defaultValues(am)),this.privateKey=u.kd(e,ad,aw.defaultValues(ad)),af in e&&(this.attributes=u.kd(e,af,aw.defaultValues(af))),ag in e&&(this.parsedKey=u.kd(e,ag,aw.defaultValues(ag))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ah:return 0;case am:return new F;case ad:return new n.lW;case af:return[];case ag:return{};default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),F.schema(t.privateKeyAlgorithm||{}),new n.lW({name:t.privateKey||""}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.Fl({name:t.attributes||"",value:Z.schema()})]})]})}fromSchema(e){u.gZ(e,ap);let t=n.FL(e,e,aw.schema({names:{version:ah,privateKeyAlgorithm:{names:{blockName:am}},privateKey:ad,attributes:af}}));switch(w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new F({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,af in t.result&&(this.attributes=Array.from(t.result.attributes,e=>new Z({schema:e}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{let e=n.mH(this.privateKey.valueBlock.valueHexView);-1!==e.offset&&(this.parsedKey=new ac({schema:e.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof n.dS){let e=n.mH(this.privateKey.valueBlock.valueHexView);-1!==e.offset&&(this.parsedKey=new t3({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:e.result}))}}}toSchema(){let e=[new n.jz({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){if(!this.parsedKey){let e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(e.attributes=Array.from(this.attributes,e=>e.toJSON())),e}let e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}return Object.assign(e,this.parsedKey.toJSON()),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new t3({json:e}),this.privateKeyAlgorithm=new F({algorithmId:"1.2.840.10045.2.1",algorithmParams:new n.dS({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new ac({json:e}),this.privateKeyAlgorithm=new F({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new n.Uv});break;default:throw Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new n.lW({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}aw.CLASS_NAME="PrivateKeyInfo";let ay="contentType",av="contentEncryptionAlgorithm",ak="encryptedContent",aS=[ay,av,ak];class ab extends y{constructor(e={}){if(super(),this.contentType=u.kd(e,ay,ab.defaultValues(ay)),this.contentEncryptionAlgorithm=u.kd(e,av,ab.defaultValues(av)),ak in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,1===this.encryptedContent.idBlock.tagClass&&4===this.encryptedContent.idBlock.tagNumber&&!1===this.encryptedContent.idBlock.isConstructed&&!e.disableSplit)){let e=new n.lW({idBlock:{isConstructed:!0},isConstructed:!0}),t=0,a=this.encryptedContent.valueBlock.valueHexView.slice().buffer,s=a.byteLength;for(;s>0;){let r=new Uint8Array(a,t,t+1024>a.byteLength?a.byteLength-t:1024),i=new ArrayBuffer(r.length),l=new Uint8Array(i);for(let e=0;e<l.length;e++)l[e]=r[e];e.valueBlock.value.push(new n.lW({valueHex:i})),s-=r.length,t+=r.length}this.encryptedContent=e}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ay:return"";case av:return new F;case ak:return new n.lW;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ay:return""===t;case av:return""===t.algorithmId&&"algorithmParams"in t==!1;case ak:return t.isEqual(ab.defaultValues(ak));default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.contentType||""}),F.schema(t.contentEncryptionAlgorithm||{}),new n.GR({value:[new n.BL({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0},value:[new n.Fl({value:new n.lW})]}),new n.sG({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){u.gZ(e,aS);let t=n.FL(e,e,ab.schema({names:{contentType:ay,contentEncryptionAlgorithm:{names:{blockName:av}},encryptedContent:ak}}));w.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new F({schema:t.result.contentEncryptionAlgorithm}),ak in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){let e={isIndefiniteForm:!1},t=[];if(t.push(new n.dS({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;let a=this.encryptedContent;a.idBlock.tagClass=3,a.idBlock.tagNumber=0,a.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(a)}return new n.gd({lenBlock:e,value:t})}toJSON(){let e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw Error("Parameter 'encryptedContent' is undefined");return n.lW.prototype.getValue.call(this.encryptedContent)}}ab.CLASS_NAME="EncryptedContentInfo";let aA="hashAlgorithm",aN="maskGenAlgorithm",aC="saltLength",aV="trailerField",aB=[aA,aN,aC,aV];class aI extends y{constructor(e={}){super(),this.hashAlgorithm=u.kd(e,aA,aI.defaultValues(aA)),this.maskGenAlgorithm=u.kd(e,aN,aI.defaultValues(aN)),this.saltLength=u.kd(e,aC,aI.defaultValues(aC)),this.trailerField=u.kd(e,aV,aI.defaultValues(aV)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case aA:return new F({algorithmId:"1.3.14.3.2.26",algorithmParams:new n.Uv});case aN:return new F({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new F({algorithmId:"1.3.14.3.2.26",algorithmParams:new n.Uv}).toSchema()});case aC:return 20;case aV:return 1;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.BL({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[F.schema(t.hashAlgorithm||{})]}),new n.BL({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[F.schema(t.maskGenAlgorithm||{})]}),new n.BL({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new n.jz({name:t.saltLength||""})]}),new n.BL({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new n.jz({name:t.trailerField||""})]})]})}fromSchema(e){u.gZ(e,aB);let t=n.FL(e,e,aI.schema({names:{hashAlgorithm:{names:{blockName:aA}},maskGenAlgorithm:{names:{blockName:aN}},saltLength:aC,trailerField:aV}}));w.assertSchema(t,this.className),aA in t.result&&(this.hashAlgorithm=new F({schema:t.result.hashAlgorithm})),aN in t.result&&(this.maskGenAlgorithm=new F({schema:t.result.maskGenAlgorithm})),aC in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),aV in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){let e=[];return this.hashAlgorithm.isEqual(aI.defaultValues(aA))||e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(aI.defaultValues(aN))||e.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==aI.defaultValues(aC)&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:2},value:[new n.jz({value:this.saltLength})]})),this.trailerField!==aI.defaultValues(aV)&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:3},value:[new n.jz({value:this.trailerField})]})),new n.gd({value:e})}toJSON(){let e={};return this.hashAlgorithm.isEqual(aI.defaultValues(aA))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(aI.defaultValues(aN))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==aI.defaultValues(aC)&&(e.saltLength=this.saltLength),this.trailerField!==aI.defaultValues(aV)&&(e.trailerField=this.trailerField),e}}aI.CLASS_NAME="RSASSAPSSParams";let aE="salt",aD="iterationCount",ax="keyLength",aO=[aE,aD,ax,"prf"];class aP extends y{constructor(e={}){super(),this.salt=u.kd(e,aE,aP.defaultValues(aE)),this.iterationCount=u.kd(e,aD,aP.defaultValues(aD)),ax in e&&(this.keyLength=u.kd(e,ax,aP.defaultValues(ax))),"prf"in e&&(this.prf=u.kd(e,"prf",aP.defaultValues("prf"))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case aE:return{};case aD:return -1;case ax:return 0;case"prf":return new F({algorithmId:"1.3.14.3.2.26",algorithmParams:new n.Uv});default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.GR({value:[new n.lW({name:t.saltPrimitive||""}),F.schema(t.saltConstructed||{})]}),new n.jz({name:t.iterationCount||""}),new n.jz({name:t.keyLength||"",optional:!0}),F.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){u.gZ(e,aO);let t=n.FL(e,e,aP.schema({names:{saltPrimitive:aE,saltConstructed:{names:{blockName:aE}},iterationCount:aD,keyLength:ax,prf:{names:{blockName:"prf",optional:!0}}}}));w.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,ax in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),"prf"in t.result&&(this.prf=new F({schema:t.result.prf}))}toSchema(){let e=[];return e.push(this.salt),e.push(new n.jz({value:this.iterationCount})),ax in this&&aP.defaultValues(ax)!==this.keyLength&&e.push(new n.jz({value:this.keyLength})),this.prf&&!1===aP.defaultValues("prf").isEqual(this.prf)&&e.push(this.prf.toSchema()),new n.gd({value:e})}toJSON(){let e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return ax in this&&aP.defaultValues(ax)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&!1===aP.defaultValues("prf").isEqual(this.prf)&&(e.prf=this.prf.toJSON()),e}}aP.CLASS_NAME="PBKDF2Params";let aL="keyDerivationFunc",aK="encryptionScheme",aH=[aL,aK];class aR extends y{constructor(e={}){super(),this.keyDerivationFunc=u.kd(e,aL,aR.defaultValues(aL)),this.encryptionScheme=u.kd(e,aK,aR.defaultValues(aK)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case aL:case aK:return new F;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[F.schema(t.keyDerivationFunc||{}),F.schema(t.encryptionScheme||{})]})}fromSchema(e){u.gZ(e,aH);let t=n.FL(e,e,aR.schema({names:{keyDerivationFunc:{names:{blockName:aL}},encryptionScheme:{names:{blockName:aK}}}}));w.assertSchema(t,this.className),this.keyDerivationFunc=new F({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new F({schema:t.result.encryptionScheme})}toSchema(){return new n.gd({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}aR.CLASS_NAME="PBES2Params";class aj{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=u.kd(e,"name","")}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){return this.crypto.getRandomValues(e)}}async function aU(e,t,a,s,r){let i,n,l;switch(e.toUpperCase()){case"SHA-1":i=20,n=64,l=c.e;break;case"SHA-256":i=32,n=64,l=h.sc;break;case"SHA-384":i=48,n=128,l=m.qt;break;case"SHA-512":i=64,n=128,l=m.Zf;break;default:throw Error("Unsupported hashing algorithm")}let u=new Uint8Array(a),o=new TextDecoder().decode(a);new TextEncoder().encode(o).some((e,t)=>e!==u[t])&&(o=String.fromCharCode(...u));let d=new Uint8Array(2*o.length+2),f=new DataView(d.buffer);for(let e=0;e<o.length;e++)f.setUint16(2*e,o.charCodeAt(e),!1);f.setUint16(2*o.length,0,!1);let g=new Uint8Array(n).fill(3),p=new Uint8Array(s),w=new Uint8Array(n*Math.ceil(p.length/n)).map((e,t)=>p[t%p.length]),y=new Uint8Array(n*Math.ceil(d.length/n)).map((e,t)=>d[t%d.length]),v=new Uint8Array(w.length+y.length);v.set(w),v.set(y,w.length);let k=Math.ceil((t>>3)/i),S=[];for(let e=0;e<k;e++){let e=new Uint8Array(g.length+v.length);e.set(g),e.set(v,g.length);for(let t=0;t<r;t++)e=l(e);let t=new Uint8Array(n).map((t,a)=>e[a%e.length]),a=Math.ceil(p.length/n)+Math.ceil(d.length/n),s=[];for(let e=0;e<a;e++){let a=Array.from(v.slice(e*n,(e+1)*n)),r=511;for(let e=t.length-1;e>=0;e--)r>>=8,r+=t[e]+(a[e]||0),a[e]=255&r;s.push(...a)}v=new Uint8Array(s),S.push(...e)}return new Uint8Array(S.slice(0,t>>3)).buffer}class aJ extends aj{async importKey(e,t,a,s,r){var i,o,c,h,m,d;let f={},y=function e(t){let a="string"==typeof t?{name:t}:t;return"hash"in a?{...a,hash:e(a.hash)}:a}(a);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,a,s,r);case"spki":{let e=n.mH(l._H.toArrayBuffer(t));w.assert(e,"keyData");let a=new tQ;try{a.fromSchema(e.result)}catch{throw new g("Incorrect keyData")}switch(y.name.toUpperCase()){case"RSA-PSS":if(!y.hash)throw new p("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(y.hash.name.toUpperCase()){case"SHA-1":f.alg="PS1";break;case"SHA-256":f.alg="PS256";break;case"SHA-384":f.alg="PS384";break;case"SHA-512":f.alg="PS512";break;default:throw Error(`Incorrect hash algorithm: ${y.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":if(r=["verify"],f.kty="RSA",f.ext=s,f.key_ops=r,"1.2.840.113549.1.1.1"!==a.algorithm.algorithmId)throw Error(`Incorrect public key algorithm: ${a.algorithm.algorithmId}`);if(!f.alg){if(!y.hash)throw new p("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(y.hash.name.toUpperCase()){case"SHA-1":f.alg="RS1";break;case"SHA-256":f.alg="RS256";break;case"SHA-384":f.alg="RS384";break;case"SHA-512":f.alg="RS512";break;default:throw Error(`Incorrect hash algorithm: ${y.hash.name.toUpperCase()}`)}}Object.assign(f,a.toJSON());break;case"ECDSA":r=["verify"];case"ECDH":if(f={kty:"EC",ext:s,key_ops:r},"1.2.840.10045.2.1"!==a.algorithm.algorithmId)throw Error(`Incorrect public key algorithm: ${a.algorithm.algorithmId}`);Object.assign(f,a.toJSON());break;case"RSA-OAEP":if(f.kty="RSA",f.ext=s,f.key_ops=r,"safari"===this.name.toLowerCase())f.alg="RSA-OAEP";else{if(!y.hash)throw new p("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(y.hash.name.toUpperCase()){case"SHA-1":f.alg="RSA-OAEP";break;case"SHA-256":f.alg="RSA-OAEP-256";break;case"SHA-384":f.alg="RSA-OAEP-384";break;case"SHA-512":f.alg="RSA-OAEP-512";break;default:throw Error(`Incorrect hash algorithm: ${y.hash.name.toUpperCase()}`)}}Object.assign(f,a.toJSON());break;case"RSAES-PKCS1-V1_5":f.kty="RSA",f.ext=s,f.key_ops=r,f.alg="PS1",Object.assign(f,a.toJSON());break;default:throw Error(`Incorrect algorithm name: ${y.name.toUpperCase()}`)}}break;case"pkcs8":{let e=new aw,a=n.mH(l._H.toArrayBuffer(t));w.assert(a,"keyData");try{e.fromSchema(a.result)}catch(e){throw Error("Incorrect keyData")}if(!e.parsedKey)throw Error("Incorrect keyData");switch(y.name.toUpperCase()){case"RSA-PSS":switch(null===(i=y.hash)||void 0===i?void 0:i.name.toUpperCase()){case"SHA-1":f.alg="PS1";break;case"SHA-256":f.alg="PS256";break;case"SHA-384":f.alg="PS384";break;case"SHA-512":f.alg="PS512";break;default:throw Error(`Incorrect hash algorithm: ${null===(o=y.hash)||void 0===o?void 0:o.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":if(r=["sign"],f.kty="RSA",f.ext=s,f.key_ops=r,"1.2.840.113549.1.1.1"!==e.privateKeyAlgorithm.algorithmId)throw Error(`Incorrect private key algorithm: ${e.privateKeyAlgorithm.algorithmId}`);if("alg"in f==!1)switch(null===(c=y.hash)||void 0===c?void 0:c.name.toUpperCase()){case"SHA-1":f.alg="RS1";break;case"SHA-256":f.alg="RS256";break;case"SHA-384":f.alg="RS384";break;case"SHA-512":f.alg="RS512";break;default:throw Error(`Incorrect hash algorithm: ${null===(h=y.hash)||void 0===h?void 0:h.name.toUpperCase()}`)}Object.assign(f,e.toJSON());break;case"ECDSA":r=["sign"];case"ECDH":if(f={kty:"EC",ext:s,key_ops:r},"1.2.840.10045.2.1"!==e.privateKeyAlgorithm.algorithmId)throw Error(`Incorrect algorithm: ${e.privateKeyAlgorithm.algorithmId}`);Object.assign(f,e.toJSON());break;case"RSA-OAEP":if(f.kty="RSA",f.ext=s,f.key_ops=r,"safari"===this.name.toLowerCase())f.alg="RSA-OAEP";else switch(null===(m=y.hash)||void 0===m?void 0:m.name.toUpperCase()){case"SHA-1":f.alg="RSA-OAEP";break;case"SHA-256":f.alg="RSA-OAEP-256";break;case"SHA-384":f.alg="RSA-OAEP-384";break;case"SHA-512":f.alg="RSA-OAEP-512";break;default:throw Error(`Incorrect hash algorithm: ${null===(d=y.hash)||void 0===d?void 0:d.name.toUpperCase()}`)}Object.assign(f,e.toJSON());break;case"RSAES-PKCS1-V1_5":r=["decrypt"],f.kty="RSA",f.ext=s,f.key_ops=r,f.alg="PS1",Object.assign(f,e.toJSON());break;default:throw Error(`Incorrect algorithm name: ${y.name.toUpperCase()}`)}}break;case"jwk":f=t;break;default:throw Error(`Incorrect format: ${e}`)}if("safari"===this.name.toLowerCase())try{return this.subtle.importKey("jwk",u.Yp(JSON.stringify(f)),a,s,r)}catch{}return this.subtle.importKey("jwk",f,a,s,r)}async exportKey(e,t){let a=await this.subtle.exportKey("jwk",t);switch("safari"===this.name.toLowerCase()&&a instanceof ArrayBuffer&&(a=JSON.parse(u.GY(a))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{let e=new tQ;try{e.fromJSON(a)}catch(e){throw Error("Incorrect key data")}return e.toSchema().toBER(!1)}case"pkcs8":{let e=new aw;try{e.fromJSON(a)}catch(e){throw Error("Incorrect key data")}return e.toSchema().toBER(!1)}case"jwk":return a;default:throw Error(`Incorrect format: ${e}`)}}async convert(e,t,a,s,r,i){if(e.toLowerCase()===t.toLowerCase())return a;let n=await this.importKey(e,a,s,r,i);return this.exportKey(t,n)}getAlgorithmByOID(e,t=!1,a){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw Error(`Unsupported algorithm identifier ${a?`for ${a} `:""}: ${e}`);return{}}getOIDByAlgorithm(e,t=!1,a){let s="";switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":s="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":s="1.2.840.113549.1.1.5";break;case"SHA-256":s="1.2.840.113549.1.1.11";break;case"SHA-384":s="1.2.840.113549.1.1.12";break;case"SHA-512":s="1.2.840.113549.1.1.13"}break;case"RSA-PSS":s="1.2.840.113549.1.1.10";break;case"RSA-OAEP":s="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":s="1.2.840.10045.4.1";break;case"SHA-256":s="1.2.840.10045.4.3.2";break;case"SHA-384":s="1.2.840.10045.4.3.3";break;case"SHA-512":s="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":s="1.3.133.16.840.63.0.2";break;case"SHA-256":s="1.3.132.1.11.1";break;case"SHA-384":s="1.3.132.1.11.2";break;case"SHA-512":s="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(e.length){case 128:s="2.16.840.1.101.3.4.1.2";break;case 192:s="2.16.840.1.101.3.4.1.22";break;case 256:s="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(e.length){case 128:s="2.16.840.1.101.3.4.1.6";break;case 192:s="2.16.840.1.101.3.4.1.26";break;case 256:s="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:s="2.16.840.1.101.3.4.1.4";break;case 192:s="2.16.840.1.101.3.4.1.24";break;case 256:s="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:s="2.16.840.1.101.3.4.1.5";break;case 192:s="2.16.840.1.101.3.4.1.25";break;case 256:s="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":s="1.2.840.113549.2.7";break;case"SHA-256":s="1.2.840.113549.2.9";break;case"SHA-384":s="1.2.840.113549.2.10";break;case"SHA-512":s="1.2.840.113549.2.11"}break;case"DH":s="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":s="1.3.14.3.2.26";break;case"SHA-256":s="2.16.840.1.101.3.4.2.1";break;case"SHA-384":s="2.16.840.1.101.3.4.2.2";break;case"SHA-512":s="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":s="1.2.840.113549.1.5.12";break;case"P-256":s="1.2.840.10045.3.1.7";break;case"P-384":s="1.3.132.0.34";break;case"P-521":s="1.3.132.0.35"}if(!s&&t)throw Error(`Unsupported algorithm ${a?`for ${a} `:""}: ${e.name}`);return s}getAlgorithmParameters(e,t){let a={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":a={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":a={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":a={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":a={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":a={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":a={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":a={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":a={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":a={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":a={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":a={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":a={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":a={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":a={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":a={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":a={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":a={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":a={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":a={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":a={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":a={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":a={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};a={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};a={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return a}getHashAlgorithm(e){let t="";switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{let a=new aI({schema:e.algorithmParams});if(a.hashAlgorithm){let e=this.getAlgorithmByOID(a.hashAlgorithm.algorithmId);if(!("name"in e))return"";t=e.name}else t="SHA-1"}catch{}}return t}async encryptEncryptedContentInfo(e){p.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");let t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),a=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),s=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),r=new ArrayBuffer(16),i=new Uint8Array(r);this.getRandomValues(i);let l=new ArrayBuffer(64),u=new Uint8Array(l);this.getRandomValues(u);let o=new Uint8Array(e.contentToEncrypt),c=new aP({salt:new n.lW({valueHex:l}),iterationCount:e.iterationCount,prf:new F({algorithmId:s,algorithmParams:new n.Uv})}),h=new Uint8Array(e.password),m=await this.importKey("raw",h,"PBKDF2",!1,["deriveKey"]),d=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:u,iterations:e.iterationCount},m,e.contentEncryptionAlgorithm,!1,["encrypt"]),f=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:i},d,o),g=new aR({keyDerivationFunc:new F({algorithmId:a,algorithmParams:c.toSchema()}),encryptionScheme:new F({algorithmId:t,algorithmParams:new n.lW({valueHex:r})})});return new ab({contentType:e.contentType,contentEncryptionAlgorithm:new F({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:g.toSchema()}),encryptedContent:new n.lW({valueHex:f})})}async decryptEncryptedContentInfo(e){let t,a;if(p.assert(e,"password","encryptedContentInfo"),"1.2.840.113549.1.5.13"!==e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId)throw Error(`Unknown "contentEncryptionAlgorithm": ${e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);try{t=new aR({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(e){throw Error('Incorrectly encoded "pbes2Parameters"')}try{a=new aP({schema:t.keyDerivationFunc.algorithmParams})}catch(e){throw Error('Incorrectly encoded "pbkdf2Params"')}let s=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),r=new Uint8Array(t.encryptionScheme.algorithmParams.valueBlock.valueHex),i=new Uint8Array(a.salt.valueBlock.valueHex),n=a.iterationCount,l="SHA-1";a.prf&&(l=this.getAlgorithmByOID(a.prf.algorithmId,!0).hash.name);let u=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),o=await this.deriveKey({name:"PBKDF2",hash:{name:l},salt:i,iterations:n},u,s,!1,["decrypt"]),c=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:s.name,iv:r},o,c)}async stampDataWithPassword(e){let t;if(e instanceof Object==!1)throw Error('Parameters must have type "Object"');switch(p.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp"),e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let a={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},s=await aU(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),r=await this.importKey("raw",new Uint8Array(s),a,!1,["sign"]);return this.sign(a,r,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){p.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let a={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},s=await aU(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),r=await this.importKey("raw",new Uint8Array(s),a,!1,["verify"]);return this.verify(a,r,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");let a=new F,s=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(s.algorithm).length)throw Error("Parameter 'algorithm' is empty");let r=s.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?r.hash.name=e.algorithm.hash.name:r.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":a.algorithmId=this.getOIDByAlgorithm(r,!0);break;case"RSA-PSS":{switch(r.hash.name.toUpperCase()){case"SHA-256":r.saltLength=32;break;case"SHA-384":r.saltLength=48;break;case"SHA-512":r.saltLength=64}let e={};"SHA-1"!==r.hash.name.toUpperCase()&&(e.hashAlgorithm=new F({algorithmId:this.getOIDByAlgorithm({name:r.hash.name},!0,"hashAlgorithm"),algorithmParams:new n.Uv}),e.maskGenAlgorithm=new F({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:e.hashAlgorithm.toSchema()})),20!==r.saltLength&&(e.saltLength=r.saltLength);let t=new aI(e);a.algorithmId="1.2.840.113549.1.1.10",a.algorithmParams=t.toSchema()}break;default:throw Error(`Unsupported signature algorithm: ${e.algorithm.name}`)}return{signatureAlgorithm:a,parameters:s}}async signWithPrivateKey(e,t,a){let s=await this.sign(a.algorithm,t,e);return"ECDSA"===a.algorithm.name?function(e){if(e.byteLength%2!=0)return f;let t=e.byteLength/2,a=new ArrayBuffer(t);new Uint8Array(a).set(new Uint8Array(e,0,t));let s=new n.jz({valueHex:a}),r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,t,t));let i=new n.jz({valueHex:r});return new n.gd({value:[s.convertToDER(),i.convertToDER()]}).toBER(!1)}(s):s}fillPublicKeyParameters(e,t){let a;let s={},r=this.getHashAlgorithm(t);if(""===r)throw Error(`Unsupported signature algorithm: ${t.algorithmId}`);a="1.2.840.113549.1.1.10"===t.algorithmId?t.algorithmId:e.algorithm.algorithmId;let i=this.getAlgorithmByOID(a,!0);if(s.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in s.algorithm.algorithm&&(s.algorithm.algorithm.hash.name=r),"ECDSA"===i.name){let t=e.algorithm;if(!t.algorithmParams)throw Error("Algorithm parameters for ECDSA public key are missed");let a=t.algorithmParams;if("idBlock"in t.algorithmParams&&(1!==a.idBlock.tagClass||6!==a.idBlock.tagNumber))throw Error("Incorrect type for ECDSA public key parameters");let r=this.getAlgorithmByOID(a.valueBlock.toString(),!0);s.algorithm.algorithm.namedCurve=r.name}return s}async getPublicKey(e,t,a){a||(a=this.fillPublicKeyParameters(e,t));let s=e.toSchema().toBER(!1);return this.importKey("spki",s,a.algorithm.algorithm,!0,a.algorithm.usages)}async verifyWithPublicKey(e,t,a,s,r){let i;if(r){let e;let t={};e="1.2.840.113549.1.1.10"===s.algorithmId?s.algorithmId:a.algorithm.algorithmId;let n=this.getAlgorithmByOID(e,!0);if(t.algorithm=this.getAlgorithmParameters(n.name,"importKey"),"hash"in t.algorithm.algorithm&&(t.algorithm.algorithm.hash.name=r),"ECDSA"===n.name){let e=!1;if("algorithmParams"in a.algorithm==!0&&"idBlock"in a.algorithm.algorithmParams&&1===a.algorithm.algorithmParams.idBlock.tagClass&&6===a.algorithm.algorithmParams.idBlock.tagNumber&&(e=!0),!1===e)throw Error("Incorrect type for ECDSA public key parameters");let s=this.getAlgorithmByOID(a.algorithm.algorithmParams.valueBlock.toString(),!0);t.algorithm.algorithm.namedCurve=s.name}i=await this.getPublicKey(a,null,t)}else{if(!(r=this.getHashAlgorithm(s)))throw Error(`Unsupported signature algorithm: ${s.algorithmId}`);i=await this.getPublicKey(a,s)}let l=this.getAlgorithmParameters(i.algorithm.name,"verify");"hash"in l.algorithm&&(l.algorithm.hash.name=r);let u=t.valueBlock.valueHexView;if("ECDSA"===i.algorithm.name){let e=tT.find(i.algorithm.namedCurve);if(!e)throw Error("Unsupported named curve in use");let t=n.mH(u);w.assert(t,"Signature value"),u=function(e,t){if(!(e instanceof n.gd&&2===e.valueBlock.value.length&&e.valueBlock.value[0]instanceof n.jz&&e.valueBlock.value[1]instanceof n.jz))return f;let a=e.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,s=e.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,r=new Uint8Array(2*t);return r.set(a,t-a.byteLength),r.set(s,2*t-s.byteLength),r.buffer}(t.result,e.size)}if("RSA-PSS"===i.algorithm.name){let e=new aI({schema:s.algorithmParams});"saltLength"in e?l.algorithm.saltLength=e.saltLength:l.algorithm.saltLength=20;let t="SHA-1";"hashAlgorithm"in e&&(t=this.getAlgorithmByOID(e.hashAlgorithm.algorithmId,!0).name),l.algorithm.hash.name=t}return this.verify(l.algorithm,i,u,e)}}let aT={name:"none",crypto:null};function aF(e){return!!e&&"object"==typeof e&&"crypto"in e}function aq(e,...t){let s=null;if(t.length<2)s=t.length?t[0]:"undefined"!=typeof self&&self.crypto?new aJ({name:"browser",crypto:self.crypto}):null;else{let e=t[0],a=t[1];aF(a)?s=a:aF(e)?s=e:"subtle"in e&&"getRandomValues"in e&&(s=new aJ({crypto:e}))}if(void 0!==d&&"pid"in d&&void 0!==a.g&&"undefined"==typeof window){if(void 0===a.g[d.pid])a.g[d.pid]={};else if("object"!=typeof a.g[d.pid])throw Error(`Name global.${d.pid} already exists and it is not an object`);if(void 0===a.g[d.pid].pkijs)a.g[d.pid].pkijs={};else if("object"!=typeof a.g[d.pid].pkijs)throw Error(`Name global.${d.pid}.pkijs already exists and it is not an object`);a.g[d.pid].pkijs.engine={name:e,crypto:s}}else aT={name:e,crypto:s}}function aM(e=!1){let t=function(){if(void 0!==d&&"pid"in d&&void 0!==a.g&&"undefined"==typeof window){let e;try{e=a.g[d.pid].pkijs.engine}catch(e){throw Error("Please call 'setEngine' before call to 'getEngine'")}return e}return aT}();if(!t.crypto&&e)throw Error("Unable to create WebCrypto object");return t.crypto}async function aW(e,t,a,s,r){switch(e.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new g(`Unknown hash function: ${e}`)}if(g.assert(t,"zBuffer","ArrayBuffer"),0===t.byteLength)throw new g("'zBuffer' has zero length, error");if(g.assert(s,"SharedInfo","ArrayBuffer"),a>255)throw new g("Please set 'Counter' argument to value less or equal to 255");let i=new ArrayBuffer(4),n=new Uint8Array(i);n[0]=0,n[1]=0,n[2]=0,n[3]=a;let l=f;return l=u.SD(l,t),l=u.SD(l,i),l=u.SD(l,s),{counter:a,result:await r.digest({name:e},l)}}async function a$(e,t,a,s,r=aM(!0)){let i=0,n=1;switch(e.toUpperCase()){case"SHA-1":i=160;break;case"SHA-256":i=256;break;case"SHA-384":i=384;break;case"SHA-512":i=512;break;default:throw new g(`Unknown hash function: ${e}`)}if(g.assert(t,"Zbuffer","ArrayBuffer"),0===t.byteLength)throw new g("'Zbuffer' has zero length, error");g.assert(s,"SharedInfo","ArrayBuffer");let l=a/i;Math.floor(l)>0&&(n=Math.floor(l),l-n>0&&n++);let o=[];for(let a=1;a<=n;a++)o.push(await aW(e,t,a,s,r));let c=f,h=1,m=!0;for(;m;){for(let e of(m=!1,o))if(e.counter===h){c=u.SD(c,e.result),m=!0;break}h++}if(a>>=3,c.byteLength>a){let e=new ArrayBuffer(a),t=new Uint8Array(e),s=new Uint8Array(c);for(let e=0;e<a;e++)t[e]=s[e];return e}return c}let a_="version",az="logID",aZ="extensions",aG="timestamp",aQ="hashAlgorithm",aY="signatureAlgorithm",aX="signature",a1="none",a0="sha1",a2="sha224",a3="sha256",a4="sha384",a8="sha512",a5="anonymous",a6="ecdsa";class a9 extends y{constructor(e={}){super(),this.version=u.kd(e,a_,a9.defaultValues(a_)),this.logID=u.kd(e,az,a9.defaultValues(az)),this.timestamp=u.kd(e,aG,a9.defaultValues(aG)),this.extensions=u.kd(e,aZ,a9.defaultValues(aZ)),this.hashAlgorithm=u.kd(e,aQ,a9.defaultValues(aQ)),this.signatureAlgorithm=u.kd(e,aY,a9.defaultValues(aY)),this.signature=u.kd(e,aX,a9.defaultValues(aX)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case a_:return 0;case az:case aZ:return f;case aG:return new Date(0);case aQ:case aY:return"";case aX:return new n.FS;default:return super.defaultValues(e)}}fromSchema(e){if(e instanceof n.HZ==!1)throw Error("Object's schema was not verified against input data for SignedCertificateTimestamp");let t=new o._8({stream:new o.xj({buffer:e.data})});this.fromStream(t)}fromStream(e){let t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(u.Go(new Uint8Array(e.getBlock(8)),8));let a=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(a)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=a1;break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm=a0;break;case 3:this.hashAlgorithm=a2;break;case 4:this.hashAlgorithm=a3;break;case 5:this.hashAlgorithm=a4;break;case 6:this.hashAlgorithm=a8;break;default:throw Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=a5;break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm=a6;break;default:throw Error("Object's stream was not correct for SignedCertificateTimestamp")}let s=e.getUint16(),r=new Uint8Array(e.getBlock(s)).buffer.slice(0),i=n.mH(r);if(w.assert(i,"SignedCertificateTimestamp"),this.signature=i.result,t!==47+a+s)throw Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){let e=this.toStream();return new n.HZ({data:e.stream.buffer})}toStream(){let e,t;let a=new o._8;a.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),a.appendChar(this.version),a.appendView(new Uint8Array(this.logID));let s=new Uint8Array(new ArrayBuffer(8)),r=u.jf(this.timestamp.valueOf(),8);switch(s.set(new Uint8Array(r),8-r.byteLength),a.appendView(s),a.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&a.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case a1:e=0;break;case"md5":e=1;break;case a0:e=2;break;case a2:e=3;break;case a3:e=4;break;case a4:e=5;break;case a8:e=6;break;default:throw Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}switch(a.appendChar(e),this.signatureAlgorithm.toLowerCase()){case a5:t=0;break;case"rsa":t=1;break;case"dsa":t=2;break;case a6:t=3;break;default:throw Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}a.appendChar(t);let i=this.signature.toBER(!1);return a.appendUint16(i.byteLength),a.appendView(new Uint8Array(i)),a}toJSON(){return{version:this.version,logID:u.Z7(this.logID),timestamp:this.timestamp,extensions:u.Z7(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,a=0,s=aM(!0)){let r=u.nk(u.GY(this.logID)),i=null,l=new o._8;for(let t of e)if(t.log_id===r){i=t.key;break}if(!i)throw Error(`Public key not found for CT with logId: ${r}`);let c=u.Yp(u.Ey(i)),h=tQ.fromBER(c);l.appendChar(0),l.appendChar(0);let m=new Uint8Array(new ArrayBuffer(8)),d=u.jf(this.timestamp.valueOf(),8);return m.set(new Uint8Array(d),8-d.byteLength),l.appendView(m),l.appendUint16(a),0===a&&l.appendUint24(t.byteLength),l.appendView(new Uint8Array(t)),l.appendUint16(this.extensions.byteLength),0!==this.extensions.byteLength&&l.appendView(new Uint8Array(this.extensions)),s.verifyWithPublicKey(l.buffer.slice(0,l.length),new n.lW({valueHex:this.signature.toBER(!1)}),h,{algorithmId:""},"SHA-256")}}a9.CLASS_NAME="SignedCertificateTimestamp";let a7="timestamps";class se extends y{constructor(e={}){super(),this.timestamps=u.kd(e,a7,se.defaultValues(a7)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===a7?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===a7?0===t.length:super.defaultValues(e)}static schema(e={}){var t;let a=u.kd(e,"names",{});return null!==(t=a.optional)&&void 0!==t||(a.optional=!1),new n.lW({name:a.blockName||"SignedCertificateTimestampList",optional:a.optional})}fromSchema(e){if(e instanceof n.lW==!1)throw Error("Object's schema was not verified against input data for SignedCertificateTimestampList");let t=new o._8({stream:new o.xj({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new a9({stream:t}))}toSchema(){let e=new o._8,t=0,a=[];for(let e of this.timestamps){let s=e.toStream();a.push(s),t+=s.stream.buffer.byteLength}for(let s of(e.appendUint16(t),a))e.appendView(s.stream.view);return new n.lW({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}se.CLASS_NAME="SignedCertificateTimestampList";let st="attributes",sa=[st];class ss extends y{constructor(e={}){super(),this.attributes=u.kd(e,st,ss.defaultValues(st)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===st?[]:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.attributes||"",value:Z.schema()})]})}fromSchema(e){u.gZ(e,sa);let t=n.FL(e,e,ss.schema({names:{attributes:st}}));w.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,e=>new Z({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}ss.CLASS_NAME="SubjectDirectoryAttributes";class sr{static getItems(){return this.types||(this.types={},sr.register(es,"SubjectAltName",W),sr.register(er,"IssuerAltName",W),sr.register(ef,"AuthorityKeyIdentifier",eE),sr.register(ei,"BasicConstraints",ex),sr.register("1.3.6.1.4.1.311.21.1","MicrosoftCaVersion",eL),sr.register(eh,"CertificatePolicies",eW),sr.register("1.3.6.1.4.1.311.21.10","CertificatePoliciesMicrosoft",eW),sr.register("1.3.6.1.4.1.311.21.7","MicrosoftCertTemplateV2",eG),sr.register(eo,"CRLDistributionPoints",e5),sr.register(ec,"FreshestCRL",e5),sr.register("2.5.29.37","ExtKeyUsage",e7),sr.register(el,"CertificateIssuer",ea),sr.register(ep,"AuthorityInfoAccess",tt),sr.register("1.3.6.1.5.5.7.1.11","SubjectInfoAccess",tt),sr.register(en,"IssuingDistributionPoint",tc),sr.register(eu,"NameConstraints",tv),sr.register(eg,"PolicyConstraints",tA),sr.register(ed,"PolicyMappings",tD),sr.register("2.5.29.16","PrivateKeyUsagePeriod",tL),sr.register("1.3.6.1.5.5.7.1.3","QCStatements",tJ),sr.register("1.3.6.1.4.1.11129.2.4.2","SignedCertificateTimestampList",se),sr.register("2.5.29.9","SubjectDirectoryAttributes",ss)),this.types}static fromBER(e,t){let a=n.mH(t);if(-1===a.offset)return null;let s=this.find(e);if(s)try{return new s.type({schema:a.result})}catch(a){let t=new s.type;return t.parsingError=`Incorrectly formatted value of extension ${s.name} (${e})`,t}return a.result}static find(e){return this.getItems()[e]||null}static register(e,t,a){this.getItems()[e]={name:t,type:a}}}let si="extnID",sn="critical",sl="extnValue",su="parsedValue",so=[si,sn,sl];class sc extends y{get parsedValue(){if(void 0===this._parsedValue){let e=sr.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=u.kd(e,si,sc.defaultValues(si)),this.critical=u.kd(e,sn,sc.defaultValues(sn)),sl in e?this.extnValue=new n.lW({valueHex:e.extnValue}):this.extnValue=sc.defaultValues(sl),su in e&&(this.parsedValue=u.kd(e,su,sc.defaultValues(su))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case si:return"";case sn:return!1;case sl:return new n.lW;case su:return{};default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.extnID||""}),new n.v8({name:t.critical||"",optional:!0}),new n.lW({name:t.extnValue||""})]})}fromSchema(e){u.gZ(e,so);let t=n.FL(e,e,sc.schema({names:{extnID:si,critical:sn,extnValue:sl}}));w.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),sn in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){let e=[];return e.push(new n.dS({value:this.extnID})),this.critical!==sc.defaultValues(sn)&&e.push(new n.v8({value:this.critical})),e.push(this.extnValue),new n.gd({value:e})}toJSON(){let e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==sc.defaultValues(sn)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}sc.CLASS_NAME="Extension";let sh="extensions",sm=[sh];class sd extends y{constructor(e={}){super(),this.extensions=u.kd(e,sh,sd.defaultValues(sh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===sh?[]:super.defaultValues(e)}static schema(e={},t=!1){let a=u.kd(e,"names",{});return new n.gd({optional:t,name:a.blockName||"",value:[new n.Fl({name:a.extensions||"",value:sc.schema(a.extension||{})})]})}fromSchema(e){u.gZ(e,sm);let t=n.FL(e,e,sd.schema({names:{extensions:sh}}));w.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,e=>new sc({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}sd.CLASS_NAME="Extensions";let sf="issuer",sg="serialNumber",sp="issuerUID",sw=[sf,sg,sp];class sy extends y{constructor(e={}){super(),this.issuer=u.kd(e,sf,sy.defaultValues(sf)),this.serialNumber=u.kd(e,sg,sy.defaultValues(sg)),sp in e&&(this.issuerUID=u.kd(e,sp,sy.defaultValues(sp))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sf:return new ea;case sg:return new n.jz;case sp:return new n.Rq;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[ea.schema(t.issuer||{}),new n.jz({name:t.serialNumber||""}),new n.Rq({optional:!0,name:t.issuerUID||""})]})}fromSchema(e){u.gZ(e,sw);let t=n.FL(e,e,sy.schema({names:{issuer:{names:{blockName:sf}},serialNumber:sg,issuerUID:sp}}));w.assertSchema(t,this.className),this.issuer=new ea({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,sp in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){let e=new n.gd({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){let e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}sy.CLASS_NAME="IssuerSerial";let sv="version",sk="baseCertificateID",sS="subjectName",sb="issuer",sA="signature",sN="serialNumber",sC="attrCertValidityPeriod",sV="attributes",sB="issuerUniqueID",sI="extensions",sE=[sv,sk,sS,sb,sA,sN,sC,sV,sB,sI];class sD extends y{constructor(e={}){super(),this.version=u.kd(e,sv,sD.defaultValues(sv)),sk in e&&(this.baseCertificateID=u.kd(e,sk,sD.defaultValues(sk))),sS in e&&(this.subjectName=u.kd(e,sS,sD.defaultValues(sS))),this.issuer=u.kd(e,sb,sD.defaultValues(sb)),this.signature=u.kd(e,sA,sD.defaultValues(sA)),this.serialNumber=u.kd(e,sN,sD.defaultValues(sN)),this.attrCertValidityPeriod=u.kd(e,sC,sD.defaultValues(sC)),this.attributes=u.kd(e,sV,sD.defaultValues(sV)),sB in e&&(this.issuerUniqueID=u.kd(e,sB,sD.defaultValues(sB))),sI in e&&(this.extensions=u.kd(e,sI,sD.defaultValues(sI))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sv:return 0;case sk:return new sy;case sS:case sb:return new ea;case sA:return new F;case sN:return new n.jz;case sC:return new X;case sV:return[];case sB:return new n.Rq;case sI:return new sd;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),new n.GR({value:[new n.BL({name:t.baseCertificateID||"",idBlock:{tagClass:3,tagNumber:0},value:sy.schema().valueBlock.value}),new n.BL({name:t.subjectName||"",idBlock:{tagClass:3,tagNumber:1},value:ea.schema().valueBlock.value})]}),ea.schema({names:{blockName:t.issuer||""}}),F.schema(t.signature||{}),new n.jz({name:t.serialNumber||""}),X.schema(t.attrCertValidityPeriod||{}),new n.gd({name:t.attributes||"",value:[new n.Fl({value:Z.schema()})]}),new n.Rq({optional:!0,name:t.issuerUniqueID||""}),sd.schema(t.extensions||{},!0)]})}fromSchema(e){u.gZ(e,sE);let t=n.FL(e,e,sD.schema({names:{version:sv,baseCertificateID:sk,subjectName:sS,issuer:sb,signature:{names:{blockName:sA}},serialNumber:sN,attrCertValidityPeriod:{names:{blockName:sC}},attributes:sV,issuerUniqueID:sB,extensions:{names:{blockName:sI}}}}));w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,sk in t.result&&(this.baseCertificateID=new sy({schema:new n.gd({value:t.result.baseCertificateID.valueBlock.value})})),sS in t.result&&(this.subjectName=new ea({schema:new n.gd({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new F({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new X({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,e=>new Z({schema:e})),sB in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),sI in t.result&&(this.extensions=new sd({schema:t.result.extensions}))}toSchema(){let e=new n.gd({value:[new n.jz({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new n.gd({value:Array.from(this.attributes,e=>e.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){let e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,e=>e.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}sD.CLASS_NAME="AttributeCertificateInfoV1";let sx="acinfo",sO="signatureAlgorithm",sP="signatureValue",sL=[sx,sP,sO];class sK extends y{constructor(e={}){super(),this.acinfo=u.kd(e,sx,sK.defaultValues(sx)),this.signatureAlgorithm=u.kd(e,sO,sK.defaultValues(sO)),this.signatureValue=u.kd(e,sP,sK.defaultValues(sP)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sx:return new sD;case sO:return new F;case sP:return new n.Rq;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[sD.schema(t.acinfo||{}),F.schema(t.signatureAlgorithm||{}),new n.Rq({name:t.signatureValue||""})]})}fromSchema(e){u.gZ(e,sL);let t=n.FL(e,e,sK.schema({names:{acinfo:{names:{blockName:sx}},signatureAlgorithm:{names:{blockName:sO}},signatureValue:sP}}));w.assertSchema(t,this.className),this.acinfo=new sD({schema:t.result.acinfo}),this.signatureAlgorithm=new F({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new n.gd({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}sK.CLASS_NAME="AttributeCertificateV1";let sH="digestedObjectType",sR="otherObjectTypeID",sj="digestAlgorithm",sU="objectDigest",sJ=[sH,sR,sj,sU];class sT extends y{constructor(e={}){super(),this.digestedObjectType=u.kd(e,sH,sT.defaultValues(sH)),sR in e&&(this.otherObjectTypeID=u.kd(e,sR,sT.defaultValues(sR))),this.digestAlgorithm=u.kd(e,sj,sT.defaultValues(sj)),this.objectDigest=u.kd(e,sU,sT.defaultValues(sU)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sH:return new n.ns;case sR:return new n.dS;case sj:return new F;case sU:return new n.Rq;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.ns({name:t.digestedObjectType||""}),new n.dS({optional:!0,name:t.otherObjectTypeID||""}),F.schema(t.digestAlgorithm||{}),new n.Rq({name:t.objectDigest||""})]})}fromSchema(e){u.gZ(e,sJ);let t=n.FL(e,e,sT.schema({names:{digestedObjectType:sH,otherObjectTypeID:sR,digestAlgorithm:{names:{blockName:sj}},objectDigest:sU}}));w.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,sR in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new F({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){let e=new n.gd({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){let e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}sT.CLASS_NAME="ObjectDigestInfo";let sF="issuerName",sq="baseCertificateID",sM="objectDigestInfo",sW=[sF,sq,sM];class s$ extends y{constructor(e={}){super(),sF in e&&(this.issuerName=u.kd(e,sF,s$.defaultValues(sF))),sq in e&&(this.baseCertificateID=u.kd(e,sq,s$.defaultValues(sq))),sM in e&&(this.objectDigestInfo=u.kd(e,sM,s$.defaultValues(sM))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sF:return new ea;case sq:return new sy;case sM:return new sT;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[ea.schema({names:{blockName:t.issuerName}},!0),new n.BL({optional:!0,name:t.baseCertificateID||"",idBlock:{tagClass:3,tagNumber:0},value:sy.schema().valueBlock.value}),new n.BL({optional:!0,name:t.objectDigestInfo||"",idBlock:{tagClass:3,tagNumber:1},value:sT.schema().valueBlock.value})]})}fromSchema(e){u.gZ(e,sW);let t=n.FL(e,e,s$.schema({names:{issuerName:sF,baseCertificateID:sq,objectDigestInfo:sM}}));w.assertSchema(t,this.className),sF in t.result&&(this.issuerName=new ea({schema:t.result.issuerName})),sq in t.result&&(this.baseCertificateID=new sy({schema:new n.gd({value:t.result.baseCertificateID.valueBlock.value})})),sM in t.result&&(this.objectDigestInfo=new sT({schema:new n.gd({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){let e=new n.gd;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){let e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}s$.CLASS_NAME="V2Form";let s_="baseCertificateID",sz="entityName",sZ="objectDigestInfo",sG=[s_,sz,sZ];class sQ extends y{constructor(e={}){super(),s_ in e&&(this.baseCertificateID=u.kd(e,s_,sQ.defaultValues(s_))),sz in e&&(this.entityName=u.kd(e,sz,sQ.defaultValues(sz))),sZ in e&&(this.objectDigestInfo=u.kd(e,sZ,sQ.defaultValues(sZ))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case s_:return new sy;case sz:return new ea;case sZ:return new sT;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.BL({optional:!0,name:t.baseCertificateID||"",idBlock:{tagClass:3,tagNumber:0},value:sy.schema().valueBlock.value}),new n.BL({optional:!0,name:t.entityName||"",idBlock:{tagClass:3,tagNumber:1},value:ea.schema().valueBlock.value}),new n.BL({optional:!0,name:t.objectDigestInfo||"",idBlock:{tagClass:3,tagNumber:2},value:sT.schema().valueBlock.value})]})}fromSchema(e){u.gZ(e,sG);let t=n.FL(e,e,sQ.schema({names:{baseCertificateID:s_,entityName:sz,objectDigestInfo:sZ}}));w.assertSchema(t,this.className),s_ in t.result&&(this.baseCertificateID=new sy({schema:new n.gd({value:t.result.baseCertificateID.valueBlock.value})})),sz in t.result&&(this.entityName=new ea({schema:new n.gd({value:t.result.entityName.valueBlock.value})})),sZ in t.result&&(this.objectDigestInfo=new sT({schema:new n.gd({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){let e=new n.gd;return this.baseCertificateID&&e.valueBlock.value.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new n.BL({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){let e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}sQ.CLASS_NAME="Holder";let sY="version",sX="holder",s1="issuer",s0="signature",s2="serialNumber",s3="attrCertValidityPeriod",s4="attributes",s8="issuerUniqueID",s5="extensions",s6=[sY,sX,s1,s0,s2,s3,s4,s8,s5];class s9 extends y{constructor(e={}){super(),this.version=u.kd(e,sY,s9.defaultValues(sY)),this.holder=u.kd(e,sX,s9.defaultValues(sX)),this.issuer=u.kd(e,s1,s9.defaultValues(s1)),this.signature=u.kd(e,s0,s9.defaultValues(s0)),this.serialNumber=u.kd(e,s2,s9.defaultValues(s2)),this.attrCertValidityPeriod=u.kd(e,s3,s9.defaultValues(s3)),this.attributes=u.kd(e,s4,s9.defaultValues(s4)),s8 in e&&(this.issuerUniqueID=u.kd(e,s8,s9.defaultValues(s8))),s5 in e&&(this.extensions=u.kd(e,s5,s9.defaultValues(s5))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sY:return 1;case sX:return new sQ;case s1:return{};case s0:return new F;case s2:return new n.jz;case s3:return new X;case s4:return[];case s8:return new n.Rq;case s5:return new sd;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),sQ.schema(t.holder||{}),new n.GR({value:[ea.schema({names:{blockName:t.issuer||""}}),new n.BL({name:t.issuer||"",idBlock:{tagClass:3,tagNumber:0},value:s$.schema().valueBlock.value})]}),F.schema(t.signature||{}),new n.jz({name:t.serialNumber||""}),X.schema(t.attrCertValidityPeriod||{}),new n.gd({name:t.attributes||"",value:[new n.Fl({value:Z.schema()})]}),new n.Rq({optional:!0,name:t.issuerUniqueID||""}),sd.schema(t.extensions||{},!0)]})}fromSchema(e){u.gZ(e,s6);let t=n.FL(e,e,s9.schema({names:{version:sY,holder:{names:{blockName:sX}},issuer:s1,signature:{names:{blockName:s0}},serialNumber:s2,attrCertValidityPeriod:{names:{blockName:s3}},attributes:s4,issuerUniqueID:s8,extensions:{names:{blockName:s5}}}}));if(w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new sQ({schema:t.result.holder}),3===t.result.issuer.idBlock.tagClass)this.issuer=new s$({schema:new n.gd({value:t.result.issuer.valueBlock.value})});else throw Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2");this.signature=new F({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new X({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,e=>new Z({schema:e})),s8 in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),s5 in t.result&&(this.extensions=new sd({schema:t.result.extensions}))}toSchema(){let e=new n.gd({value:[new n.jz({value:this.version}),this.holder.toSchema(),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new n.gd({value:Array.from(this.attributes,e=>e.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){let e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,e=>e.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}s9.CLASS_NAME="AttributeCertificateInfoV2";let s7="acinfo",re="signatureAlgorithm",rt="signatureValue",ra=[s7,re,rt];class rs extends y{constructor(e={}){super(),this.acinfo=u.kd(e,s7,rs.defaultValues(s7)),this.signatureAlgorithm=u.kd(e,re,rs.defaultValues(re)),this.signatureValue=u.kd(e,rt,rs.defaultValues(rt)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case s7:return new s9;case re:return new F;case rt:return new n.Rq;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[s9.schema(t.acinfo||{}),F.schema(t.signatureAlgorithm||{}),new n.Rq({name:t.signatureValue||""})]})}fromSchema(e){u.gZ(e,ra);let t=n.FL(e,e,rs.schema({names:{acinfo:{names:{blockName:s7}},signatureAlgorithm:{names:{blockName:re}},signatureValue:rt}}));w.assertSchema(t,this.className),this.acinfo=new s9({schema:t.result.acinfo}),this.signatureAlgorithm=new F({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new n.gd({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}rs.CLASS_NAME="AttributeCertificateV2";let rr="contentType",ri="content",rn=[rr,ri];class rl extends y{constructor(e={}){super(),this.contentType=u.kd(e,rr,rl.defaultValues(rr)),this.content=u.kd(e,ri,rl.defaultValues(ri)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rr:return"";case ri:return new n.FS;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case rr:return"string"==typeof t&&t===this.defaultValues(rr);case ri:return t instanceof n.FS;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return"optional"in t==!1&&(t.optional=!1),new n.gd({name:t.blockName||"ContentInfo",optional:t.optional,value:[new n.dS({name:t.contentType||rr}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.FS({name:t.content||ri})]})]})}fromSchema(e){u.gZ(e,rn);let t=n.FL(e,e,rl.schema());w.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new n.gd({value:[new n.dS({value:this.contentType}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){let e={contentType:this.contentType};return this.content instanceof n.FS||(e.content=this.content.toJSON()),e}}rl.CLASS_NAME="ContentInfo",rl.DATA=ew,rl.SIGNED_DATA=ey,rl.ENVELOPED_DATA=ev,rl.ENCRYPTED_DATA=ek;let ru="type",ro="value",rc="utcTimeName",rh="generalTimeName",rm=[rc,rh];!function(e){e[e.UTCTime=0]="UTCTime",e[e.GeneralizedTime=1]="GeneralizedTime",e[e.empty=2]="empty"}(s||(s={}));class rd extends y{constructor(e={}){super(),this.type=u.kd(e,ru,rd.defaultValues(ru)),this.value=u.kd(e,ro,rd.defaultValues(ro)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ru:return 0;case ro:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){let a=u.kd(e,"names",{});return new n.GR({optional:t,value:[new n.O6({name:a.utcTimeName||""}),new n.O_({name:a.generalTimeName||""})]})}fromSchema(e){u.gZ(e,rm);let t=n.FL(e,e,rd.schema({names:{utcTimeName:rc,generalTimeName:rh}}));w.assertSchema(t,this.className),rc in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),rh in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return 0===this.type?new n.O6({valueDate:this.value}):1===this.type?new n.O_({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}rd.CLASS_NAME="Time";let rf="version",rg="serialNumber",rp="signature",rw="issuer",ry="notBefore",rv="notAfter",rk="subject",rS="subjectPublicKeyInfo",rb="issuerUniqueID",rA="subjectUniqueID",rN="extensions",rC="signatureAlgorithm",rV="signatureValue",rB="tbsCertificate",rI=`${rB}.${rf}`,rE=`${rB}.${rg}`,rD=`${rB}.${rp}`,rx=`${rB}.${rw}`,rO=`${rB}.${ry}`,rP=`${rB}.${rv}`,rL=`${rB}.${rk}`,rK=`${rB}.${rS}`,rH=`${rB}.${rb}`,rR=`${rB}.${rA}`,rj=`${rB}.${rN}`,rU=[rB,rI,rE,rD,rx,rO,rP,rL,rK,rH,rR,rj,rC,rV];class rJ extends y{get tbs(){return l._H.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(u.kd(e,"tbs",rJ.defaultValues("tbs"))),this.version=u.kd(e,rf,rJ.defaultValues(rf)),this.serialNumber=u.kd(e,rg,rJ.defaultValues(rg)),this.signature=u.kd(e,rp,rJ.defaultValues(rp)),this.issuer=u.kd(e,rw,rJ.defaultValues(rw)),this.notBefore=u.kd(e,ry,rJ.defaultValues(ry)),this.notAfter=u.kd(e,rv,rJ.defaultValues(rv)),this.subject=u.kd(e,rk,rJ.defaultValues(rk)),this.subjectPublicKeyInfo=u.kd(e,rS,rJ.defaultValues(rS)),rb in e&&(this.issuerUniqueID=u.kd(e,rb,rJ.defaultValues(rb))),rA in e&&(this.subjectUniqueID=u.kd(e,rA,rJ.defaultValues(rA))),rN in e&&(this.extensions=u.kd(e,rN,rJ.defaultValues(rN))),this.signatureAlgorithm=u.kd(e,rC,rJ.defaultValues(rC)),this.signatureValue=u.kd(e,rV,rJ.defaultValues(rV)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":return f;case rf:return 0;case rg:return new n.jz;case rp:return new F;case rw:return new C;case ry:case rv:return new rd;case rk:return new C;case rS:return new tQ;case rb:case rA:return f;case rN:return[];case rC:return new F;case rV:return new n.Rq;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[function(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||rB,value:[new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.jz({name:t.tbsCertificateVersion||rI})]}),new n.jz({name:t.tbsCertificateSerialNumber||rE}),F.schema(t.signature||{names:{blockName:rD}}),C.schema(t.issuer||{names:{blockName:rx}}),new n.gd({name:t.tbsCertificateValidity||"tbsCertificate.validity",value:[rd.schema(t.notBefore||{names:{utcTimeName:rO,generalTimeName:rO}}),rd.schema(t.notAfter||{names:{utcTimeName:rP,generalTimeName:rP}})]}),C.schema(t.subject||{names:{blockName:rL}}),tQ.schema(t.subjectPublicKeyInfo||{names:{blockName:rK}}),new n.sG({name:t.tbsCertificateIssuerUniqueID||rH,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new n.sG({name:t.tbsCertificateSubjectUniqueID||rR,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[sd.schema(t.extensions||{names:{blockName:rj}})]})]})}(t.tbsCertificate),F.schema(t.signatureAlgorithm||{names:{blockName:rC}}),new n.Rq({name:t.signatureValue||rV})]})}fromSchema(e){u.gZ(e,rU);let t=n.FL(e,e,rJ.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:rj}}}}}}));w.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,rI in t.result&&(this.version=t.result[rI].valueBlock.valueDec),this.serialNumber=t.result[rE],this.signature=new F({schema:t.result[rD]}),this.issuer=new C({schema:t.result[rx]}),this.notBefore=new rd({schema:t.result[rO]}),this.notAfter=new rd({schema:t.result[rP]}),this.subject=new C({schema:t.result[rL]}),this.subjectPublicKeyInfo=new tQ({schema:t.result[rK]}),rH in t.result&&(this.issuerUniqueID=t.result[rH].valueBlock.valueHex),rR in t.result&&(this.subjectUniqueID=t.result[rR].valueBlock.valueHex),rj in t.result&&(this.extensions=Array.from(t.result[rj],e=>new sc({schema:e}))),this.signatureAlgorithm=new F({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){let e=[];return rf in this&&this.version!==rJ.defaultValues(rf)&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.jz({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new n.gd({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new n.sG({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new n.sG({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new n.gd({value:Array.from(this.extensions,e=>e.toSchema())})]})),new n.gd({value:e})}toSchema(e=!1){let t;if(!1===e){if(!this.tbsView.byteLength)return rJ.schema().value[0];let e=n.mH(this.tbsView);w.assert(e,"TBS Certificate"),t=e.result}else t=this.encodeTBS();return new n.gd({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){let e={tbs:l.U$.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return rf in this&&this.version!==rJ.defaultValues(rf)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=l.U$.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=l.U$.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,e=>e.toJSON())),e}async getPublicKey(e,t=aM(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=aM(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",a=aM(!0)){if(!e)throw Error("Need to provide a private key for signing");let s=await a.getSignatureParameters(e,t),r=s.parameters;this.signature=s.signatureAlgorithm,this.signatureAlgorithm=s.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());let i=await a.signWithPrivateKey(this.tbsView,e,r);this.signatureValue=new n.Rq({valueHex:i})}async verify(e,t=aM(!0)){let a;if(e?a=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(a=this.subjectPublicKeyInfo),!(a instanceof tQ))throw Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,a,this.signatureAlgorithm)}}function rT(e,t=null){if(t&&e.issuer.isEqual(t.issuer)&&e.serialNumber.isEqual(t.serialNumber))return null;let a=!1;if(e.extensions){for(let t of e.extensions)if(t.extnID===ei&&t.parsedValue instanceof ex&&t.parsedValue.cA){a=!0;break}}return a?e:null}rJ.CLASS_NAME="Certificate";let rF="certId",rq="certValue",rM="parsedValue",rW=[rF,rq];class r$ extends y{constructor(e={}){super(),this.certId=u.kd(e,rF,r$.defaultValues(rF)),this.certValue=u.kd(e,rq,r$.defaultValues(rq)),rM in e&&(this.parsedValue=u.kd(e,rM,r$.defaultValues(rM))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rF:return"";case rq:return new n.FS;case rM:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case rF:return""===t;case rq:return t instanceof n.FS;case rM:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.id||"id"}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.FS({name:t.value||"value"})]})]})}fromSchema(e){u.gZ(e,rW);let t=n.FL(e,e,r$.schema({names:{id:rF,value:rq}}));w.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;let a=this.certValue.valueBlock.valueHexView;switch(this.certId){case eS:try{this.parsedValue=rJ.fromBER(a)}catch(e){rs.fromBER(a)}break;case eb:this.parsedValue=rs.fromBER(a);break;default:throw Error(`Incorrect CERT_ID value in CertBag: ${this.certId}`)}}toSchema(){return rM in this&&("acinfo"in this.parsedValue?this.certId=eb:this.certId=eS,this.certValue=new n.lW({valueHex:this.parsedValue.toSchema().toBER(!1)})),new n.gd({value:[new n.dS({value:this.certId}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}r$.CLASS_NAME="CertBag";let r_="userCertificate",rz="revocationDate",rZ="crlEntryExtensions",rG=[r_,rz,rZ];class rQ extends y{constructor(e={}){super(),this.userCertificate=u.kd(e,r_,rQ.defaultValues(r_)),this.revocationDate=u.kd(e,rz,rQ.defaultValues(rz)),rZ in e&&(this.crlEntryExtensions=u.kd(e,rZ,rQ.defaultValues(rZ))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case r_:return new n.jz;case rz:return new rd;case rZ:return new sd;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.userCertificate||r_}),rd.schema({names:{utcTimeName:t.revocationDate||rz,generalTimeName:t.revocationDate||rz}}),sd.schema({names:{blockName:t.crlEntryExtensions||rZ}},!0)]})}fromSchema(e){u.gZ(e,rG);let t=n.FL(e,e,rQ.schema());w.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new rd({schema:t.result.revocationDate}),rZ in t.result&&(this.crlEntryExtensions=new sd({schema:t.result.crlEntryExtensions}))}toSchema(){let e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new n.gd({value:e})}toJSON(){let e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}rQ.CLASS_NAME="RevokedCertificate";let rY="version",rX="signature",r1="issuer",r0="thisUpdate",r2="nextUpdate",r3="revokedCertificates",r4="crlExtensions",r8="signatureAlgorithm",r5="signatureValue",r6="tbsCertList",r9=`${r6}.version`,r7=`${r6}.signature`,ie=`${r6}.issuer`,it=`${r6}.thisUpdate`,ia=`${r6}.nextUpdate`,is=`${r6}.revokedCertificates`,ir=`${r6}.extensions`,ii=[r6,r9,r7,ie,it,ia,is,ir,r8,r5],il=[ef,er,"2.5.29.20","2.5.29.27",en,ec,ep,"2.5.29.21","2.5.29.24",el];class iu extends y{get tbs(){return l._H.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(u.kd(e,"tbs",iu.defaultValues("tbs"))),this.version=u.kd(e,rY,iu.defaultValues(rY)),this.signature=u.kd(e,rX,iu.defaultValues(rX)),this.issuer=u.kd(e,r1,iu.defaultValues(r1)),this.thisUpdate=u.kd(e,r0,iu.defaultValues(r0)),r2 in e&&(this.nextUpdate=u.kd(e,r2,iu.defaultValues(r2))),r3 in e&&(this.revokedCertificates=u.kd(e,r3,iu.defaultValues(r3))),r4 in e&&(this.crlExtensions=u.kd(e,r4,iu.defaultValues(r4))),this.signatureAlgorithm=u.kd(e,r8,iu.defaultValues(r8)),this.signatureValue=u.kd(e,r5,iu.defaultValues(r5)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":return f;case rY:return 0;case rX:return new F;case r1:return new C;case r0:case r2:return new rd;case r3:return[];case r4:return new sd;case r8:return new F;case r5:return new n.Rq;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"CertificateList",value:[function(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||r6,value:[new n.jz({optional:!0,name:t.tbsCertListVersion||r9,value:2}),F.schema(t.signature||{names:{blockName:r7}}),C.schema(t.issuer||{names:{blockName:ie}}),rd.schema(t.tbsCertListThisUpdate||{names:{utcTimeName:it,generalTimeName:it}}),rd.schema(t.tbsCertListNextUpdate||{names:{utcTimeName:ia,generalTimeName:ia}},!0),new n.gd({optional:!0,value:[new n.Fl({name:t.tbsCertListRevokedCertificates||is,value:new n.gd({value:[new n.jz,rd.schema(),sd.schema({},!0)]})})]}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[sd.schema(t.crlExtensions||{names:{blockName:ir}})]})]})}(e),F.schema(t.signatureAlgorithm||{names:{blockName:r8}}),new n.Rq({name:t.signatureValue||r5})]})}fromSchema(e){u.gZ(e,ii);let t=n.FL(e,e,iu.schema());w.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,r9 in t.result&&(this.version=t.result[r9].valueBlock.valueDec),this.signature=new F({schema:t.result[r7]}),this.issuer=new C({schema:t.result[ie]}),this.thisUpdate=new rd({schema:t.result[it]}),ia in t.result&&(this.nextUpdate=new rd({schema:t.result[ia]})),is in t.result&&(this.revokedCertificates=Array.from(t.result[is],e=>new rQ({schema:e}))),ir in t.result&&(this.crlExtensions=new sd({schema:t.result[ir]})),this.signatureAlgorithm=new F({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){let e=[];return this.version!==iu.defaultValues(rY)&&e.push(new n.jz({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new n.gd({value:Array.from(this.revokedCertificates,e=>e.toSchema())})),this.crlExtensions&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new n.gd({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return iu.schema();let e=n.mH(this.tbsView);w.assert(e,"TBS Certificate Revocation List"),t=e.result}return new n.gd({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){let e={tbs:l.U$.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==iu.defaultValues(rY)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,e=>e.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(let t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",a=aM(!0)){if(!e)throw Error("Need to provide a private key for signing");let s=await a.getSignatureParameters(e,t),{parameters:r}=s;this.signature=s.signatureAlgorithm,this.signatureAlgorithm=s.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());let i=await a.signWithPrivateKey(this.tbsView,e,r);this.signatureValue=new n.Rq({valueHex:i})}async verify(e={},t=aM(!0)){let a;if(e.issuerCertificate&&(a=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(a=e.publicKeyInfo),!a)throw Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(let e of this.crlExtensions.extensions)if(e.critical&&!il.includes(e.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,a,this.signatureAlgorithm)}}iu.CLASS_NAME="CertificateRevocationList";let io="crlId",ic="crlValue",ih="parsedValue",im=[io,ic];class id extends y{constructor(e={}){super(),this.crlId=u.kd(e,io,id.defaultValues(io)),this.crlValue=u.kd(e,ic,id.defaultValues(ic)),ih in e&&(this.parsedValue=u.kd(e,ih,id.defaultValues(ih))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case io:return"";case ic:return new n.FS;case ih:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case io:return""===t;case ic:return t instanceof n.FS;case ih:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.id||"id"}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.FS({name:t.value||"value"})]})]})}fromSchema(e){u.gZ(e,im);let t=n.FL(e,e,id.schema({names:{id:io,value:ic}}));if(w.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId===eA)this.parsedValue=iu.fromBER(this.certValue.valueBlock.valueHex);else throw Error(`Incorrect CRL_ID value in CRLBag: ${this.crlId}`)}toSchema(){return this.parsedValue&&(this.crlId=eA,this.crlValue=new n.lW({valueHex:this.parsedValue.toSchema().toBER(!1)})),new n.gd({value:[new n.dS({value:this.crlId}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}id.CLASS_NAME="CRLBag";let ig="version",ip="encryptedContentInfo",iw="unprotectedAttrs",iy=[ig,ip,iw];class iv extends y{constructor(e={}){super(),this.version=u.kd(e,ig,iv.defaultValues(ig)),this.encryptedContentInfo=u.kd(e,ip,iv.defaultValues(ip)),iw in e&&(this.unprotectedAttrs=u.kd(e,iw,iv.defaultValues(iw))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ig:return 0;case ip:return new ab;case iw:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ig:return 0===t;case ip:return ab.compareWithDefault("contentType",t.contentType)&&ab.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&ab.compareWithDefault("encryptedContent",t.encryptedContent);case iw:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),ab.schema(t.encryptedContentInfo||{}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new n.Fl({name:t.unprotectedAttrs||"",value:Z.schema()})]})]})}fromSchema(e){u.gZ(e,iy);let t=n.FL(e,e,iv.schema({names:{version:ig,encryptedContentInfo:{names:{blockName:ip}},unprotectedAttrs:iw}}));w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new ab({schema:t.result.encryptedContentInfo}),iw in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,e=>new Z({schema:e})))}toSchema(){let e=[];return e.push(new n.jz({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){let e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,e=>e.toJSON())),e}async encrypt(e,t=aM(!0)){g.assert(e,"parameters","object");let a={...e,contentType:"1.2.840.113549.1.7.1"};this.encryptedContentInfo=await t.encryptEncryptedContentInfo(a)}async decrypt(e,t=aM(!0)){g.assert(e,"parameters","object");let a={...e,encryptedContentInfo:this.encryptedContentInfo};return t.decryptEncryptedContentInfo(a)}}iv.CLASS_NAME="EncryptedData";let ik="encryptionAlgorithm",iS="encryptedData",ib="parsedValue",iA=[ik,iS];class iN extends y{constructor(e={}){super(),this.encryptionAlgorithm=u.kd(e,ik,iN.defaultValues(ik)),this.encryptedData=u.kd(e,iS,iN.defaultValues(iS)),ib in e&&(this.parsedValue=u.kd(e,ib,iN.defaultValues(ib))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ik:return new F;case iS:return new n.lW;case ib:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ik:return F.compareWithDefault("algorithmId",t.algorithmId)&&"algorithmParams"in t==!1;case iS:return t.isEqual(iN.defaultValues(e));case ib:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[F.schema(t.encryptionAlgorithm||{names:{blockName:ik}}),new n.GR({value:[new n.lW({name:t.encryptedData||iS}),new n.lW({idBlock:{isConstructed:!0},name:t.encryptedData||iS})]})]})}fromSchema(e){u.gZ(e,iA);let t=n.FL(e,e,iN.schema({names:{encryptionAlgorithm:{names:{blockName:ik}},encryptedData:iS}}));w.assertSchema(t,this.className),this.encryptionAlgorithm=new F({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new n.gd({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=aM(!0)){let a=new iv({encryptedContentInfo:new ab({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}),s=await a.decrypt(e,t);this.parsedValue=aw.fromBER(s)}async makeInternalValues(e,t=aM(!0)){if(!this.parsedValue)throw Error('Please initialize "parsedValue" first');let a=new iv,s={...e,contentToEncrypt:this.parsedValue.toSchema().toBER(!1)};if(await a.encrypt(s,t),!a.encryptedContentInfo.encryptedContent)throw Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=a.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=a.encryptedContentInfo.encryptedContent}}iN.CLASS_NAME="PKCS8ShroudedKeyBag";let iC="secretTypeId",iV="secretValue",iB=[iC,iV];class iI extends y{constructor(e={}){super(),this.secretTypeId=u.kd(e,iC,iI.defaultValues(iC)),this.secretValue=u.kd(e,iV,iI.defaultValues(iV)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iC:return"";case iV:return new n.FS;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case iC:return""===t;case iV:return t instanceof n.FS;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.id||"id"}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.FS({name:t.value||"value"})]})]})}fromSchema(e){u.gZ(e,iB);let t=n.FL(e,e,iI.schema({names:{id:iC,value:iV}}));w.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new n.gd({value:[new n.dS({value:this.secretTypeId}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}iI.CLASS_NAME="SecretBag";class iE{static getItems(){return this.items||(this.items={},iE.register("1.2.840.113549.1.12.10.1.1",aw),iE.register("1.2.840.113549.1.12.10.1.2",iN),iE.register("1.2.840.113549.1.12.10.1.3",r$),iE.register("1.2.840.113549.1.12.10.1.4",id),iE.register("1.2.840.113549.1.12.10.1.5",iI),iE.register("1.2.840.113549.1.12.10.1.6",iH)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}let iD="bagId",ix="bagValue",iO="bagAttributes",iP=[iD,ix,iO];class iL extends y{constructor(e={}){super(),this.bagId=u.kd(e,iD,iL.defaultValues(iD)),this.bagValue=u.kd(e,ix,iL.defaultValues(ix)),iO in e&&(this.bagAttributes=u.kd(e,iO,iL.defaultValues(iO))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iD:return"";case ix:return new n.FS;case iO:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case iD:return""===t;case ix:return t instanceof n.FS;case iO:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.bagId||iD}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.FS({name:t.bagValue||ix})]}),new n.NZ({optional:!0,value:[new n.Fl({name:t.bagAttributes||iO,value:Z.schema()})]})]})}fromSchema(e){u.gZ(e,iP);let t=n.FL(e,e,iL.schema({names:{bagId:iD,bagValue:ix,bagAttributes:iO}}));w.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();let a=iE.find(this.bagId);if(!a)throw Error(`Invalid BAG_ID for SafeBag: ${this.bagId}`);this.bagValue=new a({schema:t.result.bagValue}),iO in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,e=>new Z({schema:e})))}toSchema(){let e=[new n.dS({value:this.bagId}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new n.NZ({value:Array.from(this.bagAttributes,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){let e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,e=>e.toJSON())),e}}iL.CLASS_NAME="SafeBag";let iK="safeBags";class iH extends y{constructor(e={}){super(),this.safeBags=u.kd(e,iK,iH.defaultValues(iK)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===iK?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===iK?0===t.length:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.safeBags||"",value:iL.schema()})]})}fromSchema(e){u.gZ(e,[iK]);let t=n.FL(e,e,iH.schema({names:{safeBags:iK}}));w.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,e=>new iL({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}iH.CLASS_NAME="SafeContents";let iR="otherCertFormat",ij="otherCert",iU=[iR,ij];class iJ extends y{constructor(e={}){super(),this.otherCertFormat=u.kd(e,iR,iJ.defaultValues(iR)),this.otherCert=u.kd(e,ij,iJ.defaultValues(ij)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iR:return"";case ij:return new n.FS;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.otherCertFormat||iR}),new n.FS({name:t.otherCert||ij})]})}fromSchema(e){u.gZ(e,iU);let t=n.FL(e,e,iJ.schema());w.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new n.gd({value:[new n.dS({value:this.otherCertFormat}),this.otherCert]})}toJSON(){let e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof n.FS||(e.otherCert=this.otherCert.toJSON()),e}}let iT="certificates",iF=[iT];class iq extends y{constructor(e={}){super(),this.certificates=u.kd(e,iT,iq.defaultValues(iT)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===iT?[]:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.NZ({name:t.blockName||"",value:[new n.Fl({name:t.certificates||iT,value:new n.GR({value:[rJ.schema(),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.FS]}),new n.BL({idBlock:{tagClass:3,tagNumber:1},value:[new n.gd]}),new n.BL({idBlock:{tagClass:3,tagNumber:2},value:rs.schema().valueBlock.value}),new n.BL({idBlock:{tagClass:3,tagNumber:3},value:iJ.schema().valueBlock.value})]})})]})}fromSchema(e){u.gZ(e,iF);let t=n.FL(e,e,iq.schema());w.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],e=>{let t=e.idBlock.tagNumber;if(1===e.idBlock.tagClass)return new rJ({schema:e});let a=new n.gd({value:e.valueBlock.value});switch(t){case 1:if(1===a.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec)return new rs({schema:a});return new sK({schema:a});case 2:return new rs({schema:a});case 3:return new iJ({schema:a})}return e})}toSchema(){return new n.NZ({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof rJ:break;case e instanceof sK:return new n.BL({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof rs:return new n.BL({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof iJ:return new n.BL({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}iq.CLASS_NAME="CertificateSet";let iM="otherRevInfoFormat",iW="otherRevInfo",i$=[iM,iW];class i_ extends y{constructor(e={}){super(),this.otherRevInfoFormat=u.kd(e,iM,i_.defaultValues(iM)),this.otherRevInfo=u.kd(e,iW,i_.defaultValues(iW)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iM:return"";case iW:return new n.FS;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.otherRevInfoFormat||iM}),new n.FS({name:t.otherRevInfo||iW})]})}fromSchema(e){u.gZ(e,i$);let t=n.FL(e,e,i_.schema());w.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new n.gd({value:[new n.dS({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){let e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof n.FS||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}i_.CLASS_NAME="OtherRevocationInfoFormat";let iz="crls",iZ="otherRevocationInfos",iG=[iz];class iQ extends y{constructor(e={}){super(),this.crls=u.kd(e,iz,iQ.defaultValues(iz)),this.otherRevocationInfos=u.kd(e,iZ,iQ.defaultValues(iZ)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iz:case iZ:return[];default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.NZ({name:t.blockName||"",value:[new n.Fl({name:t.crls||"",value:new n.GR({value:[iu.schema(),new n.BL({idBlock:{tagClass:3,tagNumber:1},value:[new n.dS,new n.FS]})]})})]})}fromSchema(e){u.gZ(e,iG);let t=n.FL(e,e,iQ.schema({names:{crls:iz}}));if(w.assertSchema(t,this.className),t.result.crls)for(let e of t.result.crls)1===e.idBlock.tagClass?this.crls.push(new iu({schema:e})):this.otherRevocationInfos.push(new i_({schema:e}))}toSchema(){let e=[];return e.push(...Array.from(this.crls,e=>e.toSchema())),e.push(...Array.from(this.otherRevocationInfos,e=>{let t=e.toSchema();return t.idBlock.tagClass=3,t.idBlock.tagNumber=1,t})),new n.NZ({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}iQ.CLASS_NAME="RevocationInfoChoices";let iY="certs",iX="crls",i1=[iY,iX];class i0 extends y{constructor(e={}){super(),this.crls=u.kd(e,iX,i0.defaultValues(iX)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iY:return new iq;case iX:return new iQ;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case iY:return 0===t.certificates.length;case iX:return 0===t.crls.length&&0===t.otherRevocationInfos.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.BL({name:t.certs||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:iq.schema().valueBlock.value}),new n.BL({name:t.crls||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:iQ.schema().valueBlock.value})]})}fromSchema(e){u.gZ(e,i1);let t=n.FL(e,e,i0.schema({names:{certs:iY,crls:iX}}));w.assertSchema(t,this.className),iY in t.result&&(this.certs=new iq({schema:new n.NZ({value:t.result.certs.valueBlock.value})})),iX in t.result&&(this.crls=new iQ({schema:new n.NZ({value:t.result.crls.valueBlock.value})}))}toSchema(){let e=[];return this.certs&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new n.gd({value:e})}toJSON(){let e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}i0.CLASS_NAME="OriginatorInfo";let i2="issuer",i3="serialNumber",i4=[i2,i3];class i8 extends y{constructor(e={}){super(),this.issuer=u.kd(e,i2,i8.defaultValues(i2)),this.serialNumber=u.kd(e,i3,i8.defaultValues(i3)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case i2:return new C;case i3:return new n.jz;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[C.schema(t.issuer||{}),new n.jz({name:t.serialNumber||""})]})}fromSchema(e){u.gZ(e,i4);let t=n.FL(e,e,i8.schema({names:{issuer:{names:{blockName:i2}},serialNumber:i3}}));w.assertSchema(t,this.className),this.issuer=new C({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new n.gd({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}i8.CLASS_NAME="IssuerAndSerialNumber";let i5="variant",i6="value",i9=["blockName"];class i7 extends y{constructor(e={}){super(),this.variant=u.kd(e,i5,i7.defaultValues(i5)),i6 in e&&(this.value=u.kd(e,i6,i7.defaultValues(i6))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case i5:return -1;case i6:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case i5:return -1===t;case i6:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.GR({value:[i8.schema({names:{blockName:t.blockName||""}}),new n.sG({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){u.gZ(e,i9);let t=n.FL(e,e,i7.schema({names:{blockName:"blockName"}}));w.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new i8({schema:t.result.blockName})):(this.variant=2,this.value=new n.lW({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof i8))throw Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof n.lW))throw Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new n.sG({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new n.FS}}toJSON(){let e={variant:this.variant};return(1===this.variant||2===this.variant)&&this.value&&(e.value=this.value.toJSON()),e}}i7.CLASS_NAME="RecipientIdentifier";let ne="version",nt="keyEncryptionAlgorithm",na="encryptedKey",ns="recipientCertificate",nr=[ne,"rid",nt,na];class ni extends y{constructor(e={}){super(),this.version=u.kd(e,ne,ni.defaultValues(ne)),this.rid=u.kd(e,"rid",ni.defaultValues("rid")),this.keyEncryptionAlgorithm=u.kd(e,nt,ni.defaultValues(nt)),this.encryptedKey=u.kd(e,na,ni.defaultValues(na)),this.recipientCertificate=u.kd(e,ns,ni.defaultValues(ns)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ne:return -1;case"rid":return{};case nt:return new F;case na:return new n.lW;case ns:return new rJ;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ne:return t===ni.defaultValues(ne);case"rid":return 0===Object.keys(t).length;case nt:case na:return t.isEqual(ni.defaultValues(e));case ns:return!1;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),i7.schema(t.rid||{}),F.schema(t.keyEncryptionAlgorithm||{}),new n.lW({name:t.encryptedKey||""})]})}fromSchema(e){u.gZ(e,nr);let t=n.FL(e,e,ni.schema({names:{version:ne,rid:{names:{blockName:"rid"}},keyEncryptionAlgorithm:{names:{blockName:nt}},encryptedKey:na}}));w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,3===t.result.rid.idBlock.tagClass?this.rid=new n.lW({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new i8({schema:t.result.rid}),this.keyEncryptionAlgorithm=new F({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){let e=[];return this.rid instanceof i8?(this.version=0,e.push(new n.jz({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new n.jz({value:this.version})),e.push(new n.sG({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new n.gd({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}ni.CLASS_NAME="KeyTransRecipientInfo";let nn="algorithm",nl="publicKey",nu=[nn,nl];class no extends y{constructor(e={}){super(),this.algorithm=u.kd(e,nn,no.defaultValues(nn)),this.publicKey=u.kd(e,nl,no.defaultValues(nl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nn:return new F;case nl:return new n.Rq;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nn:case nl:return t.isEqual(no.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[F.schema(t.algorithm||{}),new n.Rq({name:t.publicKey||""})]})}fromSchema(e){u.gZ(e,nu);let t=n.FL(e,e,no.schema({names:{algorithm:{names:{blockName:nn}},publicKey:nl}}));w.assertSchema(t,this.className),this.algorithm=new F({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new n.gd({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}no.CLASS_NAME="OriginatorPublicKey";let nc="variant",nh="value",nm=["blockName"];class nd extends y{constructor(e={}){super(),this.variant=u.kd(e,nc,nd.defaultValues(nc)),nh in e&&(this.value=u.kd(e,nh,nd.defaultValues(nh))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nc:return -1;case nh:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nc:return -1===t;case nh:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.GR({value:[i8.schema({names:{blockName:t.blockName||""}}),new n.sG({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||""}),new n.BL({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||"",value:no.schema().valueBlock.value})]})}fromSchema(e){u.gZ(e,nm);let t=n.FL(e,e,nd.schema({names:{blockName:"blockName"}}));w.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new i8({schema:t.result.blockName})):0===t.result.blockName.idBlock.tagNumber?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new no({schema:new n.gd({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{let e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new n.FS}}toJSON(){let e={variant:this.variant};return(1===this.variant||2===this.variant||3===this.variant)&&(e.value=this.value.toJSON()),e}}nd.CLASS_NAME="OriginatorIdentifierOrKey";let nf="keyAttrId",ng="keyAttr",np=[nf,ng];class nw extends y{constructor(e={}){super(),this.keyAttrId=u.kd(e,nf,nw.defaultValues(nf)),ng in e&&(this.keyAttr=u.kd(e,ng,nw.defaultValues(ng))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nf:return"";case ng:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nf:return"string"==typeof t&&""===t;case ng:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({optional:t.optional||!0,name:t.blockName||"",value:[new n.dS({name:t.keyAttrId||""}),new n.FS({optional:!0,name:t.keyAttr||""})]})}fromSchema(e){u.gZ(e,np);let t=n.FL(e,e,nw.schema({names:{keyAttrId:nf,keyAttr:ng}}));w.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),ng in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){let e=[];return e.push(new n.dS({value:this.keyAttrId})),ng in this&&e.push(this.keyAttr),new n.gd({value:e})}toJSON(){let e={keyAttrId:this.keyAttrId};return ng in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}nw.CLASS_NAME="OtherKeyAttribute";let ny="subjectKeyIdentifier",nv="date",nk="other",nS=[ny,nv,nk];class nb extends y{constructor(e={}){super(),this.subjectKeyIdentifier=u.kd(e,ny,nb.defaultValues(ny)),nv in e&&(this.date=u.kd(e,nv,nb.defaultValues(nv))),nk in e&&(this.other=u.kd(e,nk,nb.defaultValues(nk))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ny:return new n.lW;case nv:return new n.O_;case nk:return new nw;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ny:return t.isEqual(nb.defaultValues(ny));case nv:return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case nk:return""===t.keyAttrId&&"keyAttr"in t==!1;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.lW({name:t.subjectKeyIdentifier||""}),new n.O_({optional:!0,name:t.date||""}),nw.schema(t.other||{})]})}fromSchema(e){u.gZ(e,nS);let t=n.FL(e,e,nb.schema({names:{subjectKeyIdentifier:ny,date:nv,other:{names:{blockName:nk}}}}));w.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,nv in t.result&&(this.date=t.result.date),nk in t.result&&(this.other=new nw({schema:t.result.other}))}toSchema(){let e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new n.gd({value:e})}toJSON(){let e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}nb.CLASS_NAME="RecipientKeyIdentifier";let nA="variant",nN="value",nC=["blockName"];class nV extends y{constructor(e={}){super(),this.variant=u.kd(e,nA,nV.defaultValues(nA)),this.value=u.kd(e,nN,nV.defaultValues(nN)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nA:return -1;case nN:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nA:return -1===t;case nN:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.GR({value:[i8.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||""}}),new n.BL({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:0},value:nb.schema(t.rKeyId||{names:{blockName:t.blockName||""}}).valueBlock.value})]})}fromSchema(e){u.gZ(e,nC);let t=n.FL(e,e,nV.schema({names:{blockName:"blockName"}}));w.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new i8({schema:t.result.blockName})):(this.variant=2,this.value=new nb({schema:new n.gd({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new n.BL({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new n.FS}}toJSON(){let e={variant:this.variant};return(1===this.variant||2===this.variant)&&(e.value=this.value.toJSON()),e}}nV.CLASS_NAME="KeyAgreeRecipientIdentifier";let nB="encryptedKey",nI=["rid",nB];class nE extends y{constructor(e={}){super(),this.rid=u.kd(e,"rid",nE.defaultValues("rid")),this.encryptedKey=u.kd(e,nB,nE.defaultValues(nB)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"rid":return new nV;case nB:return new n.lW;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"rid":return -1===t.variant&&"value"in t==!1;case nB:return t.isEqual(nE.defaultValues(nB));default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[nV.schema(t.rid||{}),new n.lW({name:t.encryptedKey||""})]})}fromSchema(e){u.gZ(e,nI);let t=n.FL(e,e,nE.schema({names:{rid:{names:{blockName:"rid"}},encryptedKey:nB}}));w.assertSchema(t,this.className),this.rid=new nV({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new n.gd({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}nE.CLASS_NAME="RecipientEncryptedKey";let nD="encryptedKeys",nx="RecipientEncryptedKeys",nO=[nx];class nP extends y{constructor(e={}){super(),this.encryptedKeys=u.kd(e,nD,nP.defaultValues(nD)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===nD?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===nD?0===t.length:super.defaultValues(e)}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.RecipientEncryptedKeys||"",value:nE.schema()})]})}fromSchema(e){u.gZ(e,nO);let t=n.FL(e,e,nP.schema({names:{RecipientEncryptedKeys:nx}}));w.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,e=>new nE({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}nP.CLASS_NAME="RecipientEncryptedKeys";let nL="version",nK="originator",nH="keyEncryptionAlgorithm",nR="recipientEncryptedKeys",nj="recipientCertificate",nU="recipientPublicKey",nJ=[nL,nK,"ukm",nH,nR];class nT extends y{constructor(e={}){super(),this.version=u.kd(e,nL,nT.defaultValues(nL)),this.originator=u.kd(e,nK,nT.defaultValues(nK)),"ukm"in e&&(this.ukm=u.kd(e,"ukm",nT.defaultValues("ukm"))),this.keyEncryptionAlgorithm=u.kd(e,nH,nT.defaultValues(nH)),this.recipientEncryptedKeys=u.kd(e,nR,nT.defaultValues(nR)),this.recipientCertificate=u.kd(e,nj,nT.defaultValues(nj)),this.recipientPublicKey=u.kd(e,nU,nT.defaultValues(nU)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nL:return 0;case nK:return new nd;case"ukm":return new n.lW;case nH:return new F;case nR:return new nP;case nj:return new rJ;case nU:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nL:return 0===t;case nK:return -1===t.variant&&"value"in t==!1;case"ukm":return t.isEqual(nT.defaultValues("ukm"));case nH:return""===t.algorithmId&&"algorithmParams"in t==!1;case nR:return 0===t.encryptedKeys.length;case nj:case nU:return!1;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[nd.schema(t.originator||{})]}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new n.lW({name:t.ukm||""})]}),F.schema(t.keyEncryptionAlgorithm||{}),nP.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){u.gZ(e,nJ);let t=n.FL(e,e,nT.schema({names:{version:nL,originator:{names:{blockName:nK}},ukm:"ukm",keyEncryptionAlgorithm:{names:{blockName:nH}},recipientEncryptedKeys:{names:{blockName:nR}}}}));w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new nd({schema:t.result.originator}),"ukm"in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new F({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new nP({schema:t.result.recipientEncryptedKeys})}toSchema(){let e=[];return e.push(new n.jz({value:this.version})),e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new n.gd({value:e})}toJSON(){let e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}nT.CLASS_NAME="KeyAgreeRecipientInfo";let nF="keyIdentifier",nq="date",nM="other",nW=[nF,nq,nM];class n$ extends y{constructor(e={}){super(),this.keyIdentifier=u.kd(e,nF,n$.defaultValues(nF)),nq in e&&(this.date=u.kd(e,nq,n$.defaultValues(nq))),nM in e&&(this.other=u.kd(e,nM,n$.defaultValues(nM))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nF:return new n.lW;case nq:return new n.O_;case nM:return new nw;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nF:return t.isEqual(n$.defaultValues(nF));case nq:return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case nM:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&"keyAttr"in t==!1;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.lW({name:t.keyIdentifier||""}),new n.O_({optional:!0,name:t.date||""}),nw.schema(t.other||{})]})}fromSchema(e){u.gZ(e,nW);let t=n.FL(e,e,n$.schema({names:{keyIdentifier:nF,date:nq,other:{names:{blockName:nM}}}}));w.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,nq in t.result&&(this.date=t.result.date),nM in t.result&&(this.other=new nw({schema:t.result.other}))}toSchema(){let e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new n.gd({value:e})}toJSON(){let e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}n$.CLASS_NAME="KEKIdentifier";let n_="version",nz="kekid",nZ="keyEncryptionAlgorithm",nG="encryptedKey",nQ="preDefinedKEK",nY=[n_,nz,nZ,nG];class nX extends y{constructor(e={}){super(),this.version=u.kd(e,n_,nX.defaultValues(n_)),this.kekid=u.kd(e,nz,nX.defaultValues(nz)),this.keyEncryptionAlgorithm=u.kd(e,nZ,nX.defaultValues(nZ)),this.encryptedKey=u.kd(e,nG,nX.defaultValues(nG)),this.preDefinedKEK=u.kd(e,nQ,nX.defaultValues(nQ)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case n_:return 0;case nz:return new n$;case nZ:return new F;case nG:return new n.lW;case nQ:return f;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===nX.defaultValues(n_);case nz:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&"date"in t==!1&&"other"in t==!1;case nZ:return""===t.algorithmId&&"algorithmParams"in t==!1;case nG:return t.isEqual(nX.defaultValues(nG));case nQ:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),n$.schema(t.kekid||{}),F.schema(t.keyEncryptionAlgorithm||{}),new n.lW({name:t.encryptedKey||""})]})}fromSchema(e){u.gZ(e,nY);let t=n.FL(e,e,nX.schema({names:{version:n_,kekid:{names:{blockName:nz}},keyEncryptionAlgorithm:{names:{blockName:nZ}},encryptedKey:nG}}));w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new n$({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new F({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new n.gd({value:[new n.jz({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}nX.CLASS_NAME="KEKRecipientInfo";let n1="version",n0="keyDerivationAlgorithm",n2="keyEncryptionAlgorithm",n3="encryptedKey",n4="password",n8=[n1,n0,n2,n3];class n5 extends y{constructor(e={}){super(),this.version=u.kd(e,n1,n5.defaultValues(n1)),n0 in e&&(this.keyDerivationAlgorithm=u.kd(e,n0,n5.defaultValues(n0))),this.keyEncryptionAlgorithm=u.kd(e,n2,n5.defaultValues(n2)),this.encryptedKey=u.kd(e,n3,n5.defaultValues(n3)),this.password=u.kd(e,n4,n5.defaultValues(n4)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case n1:return -1;case n0:case n2:return new F;case n3:return new n.lW;case n4:return f;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case n1:return -1===t;case n0:case n2:return""===t.algorithmId&&"algorithmParams"in t==!1;case n3:return t.isEqual(n5.defaultValues(n3));case n4:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),new n.BL({name:t.keyDerivationAlgorithm||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:F.schema().valueBlock.value}),F.schema(t.keyEncryptionAlgorithm||{}),new n.lW({name:t.encryptedKey||""})]})}fromSchema(e){u.gZ(e,n8);let t=n.FL(e,e,n5.schema({names:{version:n1,keyDerivationAlgorithm:n0,keyEncryptionAlgorithm:{names:{blockName:n2}},encryptedKey:n3}}));w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,n0 in t.result&&(this.keyDerivationAlgorithm=new F({schema:new n.gd({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new F({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){let e=[];return e.push(new n.jz({value:this.version})),this.keyDerivationAlgorithm&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new n.gd({value:e})}toJSON(){let e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}n5.CLASS_NAME="PasswordRecipientInfo";let n6="oriType",n9="oriValue",n7=[n6,n9];class le extends y{constructor(e={}){super(),this.oriType=u.kd(e,n6,le.defaultValues(n6)),this.oriValue=u.kd(e,n9,le.defaultValues(n9)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case n6:return"";case n9:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case n6:return""===t;case n9:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.oriType||""}),new n.FS({name:t.oriValue||""})]})}fromSchema(e){u.gZ(e,n7);let t=n.FL(e,e,le.schema({names:{oriType:n6,oriValue:n9}}));w.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new n.gd({value:[new n.dS({value:this.oriType}),this.oriValue]})}toJSON(){let e={oriType:this.oriType};return le.compareWithDefault(n9,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}le.CLASS_NAME="OtherRecipientInfo";let lt="variant",la="value",ls=["blockName"];class lr extends y{constructor(e={}){super(),this.variant=u.kd(e,lt,lr.defaultValues(lt)),la in e&&(this.value=u.kd(e,la,lr.defaultValues(la))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lt:return -1;case la:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case lt:return t===lr.defaultValues(e);case la:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.GR({value:[ni.schema({names:{blockName:t.blockName||""}}),new n.BL({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:1},value:nT.schema().valueBlock.value}),new n.BL({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:2},value:nX.schema().valueBlock.value}),new n.BL({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:3},value:n5.schema().valueBlock.value}),new n.BL({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:4},value:le.schema().valueBlock.value})]})}fromSchema(e){u.gZ(e,ls);let t=n.FL(e,e,lr.schema({names:{blockName:"blockName"}}));if(w.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass)this.variant=1,this.value=new ni({schema:t.result.blockName});else{let e=new n.gd({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new nT({schema:e});break;case 2:this.variant=3,this.value=new nX({schema:e});break;case 3:this.variant=4,this.value=new n5({schema:e});break;case 4:this.variant=5,this.value=new le({schema:e});break;default:throw Error("Incorrect structure of RecipientInfo block")}}}toSchema(){p.assertEmpty(this.value,"value","RecipientInfo");let e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new n.FS}}toJSON(){let e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}lr.CLASS_NAME="RecipientInfo";let li="hashAlgorithm",ln="maskGenAlgorithm",ll="pSourceAlgorithm",lu=[li,ln,ll];class lo extends y{constructor(e={}){super(),this.hashAlgorithm=u.kd(e,li,lo.defaultValues(li)),this.maskGenAlgorithm=u.kd(e,ln,lo.defaultValues(ln)),this.pSourceAlgorithm=u.kd(e,ll,lo.defaultValues(ll)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case li:return new F({algorithmId:"1.3.14.3.2.26",algorithmParams:new n.Uv});case ln:return new F({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new F({algorithmId:"1.3.14.3.2.26",algorithmParams:new n.Uv}).toSchema()});case ll:return new F({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new n.lW({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.BL({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[F.schema(t.hashAlgorithm||{})]}),new n.BL({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[F.schema(t.maskGenAlgorithm||{})]}),new n.BL({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[F.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){u.gZ(e,lu);let t=n.FL(e,e,lo.schema({names:{hashAlgorithm:{names:{blockName:li}},maskGenAlgorithm:{names:{blockName:ln}},pSourceAlgorithm:{names:{blockName:ll}}}}));w.assertSchema(t,this.className),li in t.result&&(this.hashAlgorithm=new F({schema:t.result.hashAlgorithm})),ln in t.result&&(this.maskGenAlgorithm=new F({schema:t.result.maskGenAlgorithm})),ll in t.result&&(this.pSourceAlgorithm=new F({schema:t.result.pSourceAlgorithm}))}toSchema(){let e=[];return this.hashAlgorithm.isEqual(lo.defaultValues(li))||e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(lo.defaultValues(ln))||e.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(lo.defaultValues(ll))||e.push(new n.BL({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new n.gd({value:e})}toJSON(){let e={};return this.hashAlgorithm.isEqual(lo.defaultValues(li))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(lo.defaultValues(ln))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(lo.defaultValues(ll))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}lo.CLASS_NAME="RSAESOAEPParams";let lc="keyInfo",lh="entityUInfo",lm="suppPubInfo",ld=[lc,lh,lm];class lf extends y{constructor(e={}){super(),this.keyInfo=u.kd(e,lc,lf.defaultValues(lc)),lh in e&&(this.entityUInfo=u.kd(e,lh,lf.defaultValues(lh))),this.suppPubInfo=u.kd(e,lm,lf.defaultValues(lm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lc:return new F;case lh:case lm:return new n.lW;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case lc:case lh:case lm:return t.isEqual(lf.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[F.schema(t.keyInfo||{}),new n.BL({name:t.entityUInfo||"",idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new n.lW]}),new n.BL({name:t.suppPubInfo||"",idBlock:{tagClass:3,tagNumber:2},value:[new n.lW]})]})}fromSchema(e){u.gZ(e,ld);let t=n.FL(e,e,lf.schema({names:{keyInfo:{names:{blockName:lc}},entityUInfo:lh,suppPubInfo:lm}}));w.assertSchema(t,this.className),this.keyInfo=new F({schema:t.result.keyInfo}),lh in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){let e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new n.BL({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new n.gd({value:e})}toJSON(){let e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}lf.CLASS_NAME="ECCCMSSharedInfo";let lg="version",lp="originatorInfo",lw="recipientInfos",ly="encryptedContentInfo",lv="unprotectedAttrs",lk=[lg,lp,lw,ly,lv],lS={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},lb={"P-256":256,"P-384":384,"P-521":528};class lA extends y{constructor(e={}){super(),this.version=u.kd(e,lg,lA.defaultValues(lg)),lp in e&&(this.originatorInfo=u.kd(e,lp,lA.defaultValues(lp))),this.recipientInfos=u.kd(e,lw,lA.defaultValues(lw)),this.encryptedContentInfo=u.kd(e,ly,lA.defaultValues(ly)),lv in e&&(this.unprotectedAttrs=u.kd(e,lv,lA.defaultValues(lv))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lg:return 0;case lp:return new i0;case lw:return[];case ly:return new ab;case lv:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case lg:return t===lA.defaultValues(e);case lp:return 0===t.certs.certificates.length&&0===t.crls.crls.length;case lw:case lv:return 0===t.length;case ly:return ab.compareWithDefault("contentType",t.contentType)&&ab.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&ab.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||""}),new n.BL({name:t.originatorInfo||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:i0.schema().valueBlock.value}),new n.NZ({value:[new n.Fl({name:t.recipientInfos||"",value:lr.schema()})]}),ab.schema(t.encryptedContentInfo||{}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new n.Fl({name:t.unprotectedAttrs||"",value:Z.schema()})]})]})}fromSchema(e){u.gZ(e,lk);let t=n.FL(e,e,lA.schema({names:{version:lg,originatorInfo:lp,recipientInfos:lw,encryptedContentInfo:{names:{blockName:ly}},unprotectedAttrs:lv}}));w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,lp in t.result&&(this.originatorInfo=new i0({schema:new n.gd({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,e=>new lr({schema:e})),this.encryptedContentInfo=new ab({schema:t.result.encryptedContentInfo}),lv in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,e=>new Z({schema:e})))}toSchema(){let e=[];return e.push(new n.jz({value:this.version})),this.originatorInfo&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new n.NZ({value:Array.from(this.recipientInfos,e=>e.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){let e={version:this.version,recipientInfos:Array.from(this.recipientInfos,e=>e.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,e=>e.toJSON())),e}addRecipientByCertificate(e,t,a,s=aM(!0)){let r=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},lS,t||{});if(-1!==e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549"))a=1;else if(-1!==e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045"))a=2;else throw Error(`Unknown type of certificate's public key: ${e.subjectPublicKeyInfo.algorithm.algorithmId}`);switch(a){case 1:{let t,a;if(!0===r.useOAEP){t=s.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");let e=new F({algorithmId:s.getOIDByAlgorithm({name:r.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),algorithmParams:new n.Uv});a=new lo({hashAlgorithm:e,maskGenAlgorithm:new F({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:e.toSchema()})}).toSchema()}else{if(""===(t=s.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"})))throw Error("Can not find OID for RSAES-PKCS1-v1_5");a=new n.Uv}let i=new ni({version:0,rid:new i8({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new F({algorithmId:t,algorithmParams:a}),recipientCertificate:e});this.recipientInfos.push(new lr({variant:1,value:i}))}break;case 2:{let t=new nV({variant:1,value:new i8({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(t,r,{recipientCertificate:e},s)}break;default:throw Error(`Unknown "variant" value: ${a}`)}return!0}addRecipientByPreDefinedData(e,t={},a,s=aM(!0)){if(g.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw Error("Pre-defined data could have zero length");if(!t.keyIdentifier){let e=new ArrayBuffer(16),a=new Uint8Array(e);s.getRandomValues(a),t.keyIdentifier=e}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),void 0===t.iterationCount&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new n.Uv),a){case 1:{let a=s.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),r=new nX({version:4,kekid:new n$({keyIdentifier:new n.lW({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new F({algorithmId:a,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new lr({variant:3,value:r}))}break;case 2:{let a=s.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),r=new ArrayBuffer(64),i=new Uint8Array(r);s.getRandomValues(i);let l=s.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),u=new aP({salt:new n.lW({valueHex:r}),iterationCount:t.iterationCount,prf:new F({algorithmId:l,algorithmParams:new n.Uv})}),o=s.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),c=new n5({version:0,keyDerivationAlgorithm:new F({algorithmId:a,algorithmParams:u.toSchema()}),keyEncryptionAlgorithm:new F({algorithmId:o,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new lr({variant:4,value:c}))}break;default:throw Error(`Unknown value for "variant": ${a}`)}}addRecipientByKeyIdentifier(e,t,a,s=aM(!0)){let r=Object.assign({},lS,a||{}),i=new nV({variant:2,value:new nb({subjectKeyIdentifier:new n.lW({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,r,{recipientPublicKey:e},s)}_addKeyAgreeRecipientInfo(e,t,a,s=aM(!0)){let r=new nE({rid:e}),i=new F({algorithmId:s.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm")}),l=s.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),u=new ArrayBuffer(64),o=new Uint8Array(u);s.getRandomValues(o);let c=new nT(Object.assign({version:3,ukm:new n.lW({valueHex:u}),keyEncryptionAlgorithm:new F({algorithmId:l,algorithmParams:i.toSchema()}),recipientEncryptedKeys:new nP({encryptedKeys:[r]})},a));this.recipientInfos.push(new lr({variant:2,value:c}))}async encrypt(e,t,a=aM(!0)){let s=new ArrayBuffer(16),r=new Uint8Array(s);a.getRandomValues(r);let i=new Uint8Array(t),l=a.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),u=await a.generateKey(e,!0,["encrypt"]),o=await a.encrypt({name:e.name,iv:r},u,i),c=await a.exportKey("raw",u);this.version=2,this.encryptedContentInfo=new ab({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new F({algorithmId:l,algorithmParams:new n.lW({valueHex:s})}),encryptedContent:new n.lW({valueHex:o})});let h=async e=>{let t,s;let r=this.recipientInfos[e].value;if(r.recipientPublicKey)t=r.recipientPublicKey.algorithm.namedCurve,s=r.recipientPublicKey;else if(r.recipientCertificate){let i=r.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(i.constructor.blockName()!==n.dS.blockName())throw Error(`Incorrect "recipientCertificate" for index ${e}`);switch(i.valueBlock.toString()){case"1.2.840.10045.3.1.7":t="P-256";break;case"1.3.132.0.34":t="P-384";break;case"1.3.132.0.35":t="P-521";break;default:throw Error(`Incorrect curve OID for index ${e}`)}s=await r.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:t},usages:[]}},a)}else throw Error("Unsupported RecipientInfo");let i=lb[t],l=await a.generateKey({name:"ECDH",namedCurve:t},!0,["deriveBits"]),o=await a.exportKey("spki",l.publicKey),c=await a.deriveBits({name:"ECDH",public:s},l.privateKey,i),h=new F({schema:r.keyEncryptionAlgorithm.algorithmParams}),m=a.getAlgorithmByOID(h.algorithmId,!0,"aesKWAlgorithm"),d=m.length,f=new ArrayBuffer(4),g=new Uint8Array(f);for(let e=3;e>=0;e--)g[e]=d,d>>=8;let p=new lf({keyInfo:new F({algorithmId:h.algorithmId}),entityUInfo:r.ukm,suppPubInfo:new n.lW({valueHex:f})}).toSchema().toBER(!1),w=a.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),y=await a$(w.kdf,c,m.length,p,a),v=await a.importKey("raw",y,{name:"AES-KW"},!0,["wrapKey"]),k=await a.wrapKey("raw",u,v,{name:"AES-KW"}),S=new nd;return S.variant=3,S.value=no.fromBER(o),r.originator=S,r.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new n.lW({valueHex:k}),{ecdhPrivateKey:l.privateKey}},m=async e=>{let t=this.recipientInfos[e].value,s=a.getAlgorithmByOID(t.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if("RSA-OAEP"===s.name){let e=new lo({schema:t.keyEncryptionAlgorithm.algorithmParams});if(s.hash=a.getAlgorithmByOID(e.hashAlgorithm.algorithmId),"name"in s.hash==!1)throw Error(`Incorrect OID for hash algorithm: ${e.hashAlgorithm.algorithmId}`)}try{let e=await t.recipientCertificate.getPublicKey({algorithm:{algorithm:s,usages:["encrypt","wrapKey"]}},a),r=await a.encrypt(e.algorithm,e,c);t.encryptedKey=new n.lW({valueHex:r})}catch{}},d=async e=>{let t=this.recipientInfos[e].value,s=a.getAlgorithmByOID(t.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),r=await a.importKey("raw",new Uint8Array(t.preDefinedKEK),s,!0,["wrapKey"]),i=await a.wrapKey("raw",u,r,s);t.encryptedKey=new n.lW({valueHex:i})},f=async e=>{let t;let s=this.recipientInfos[e].value;if(!s.keyDerivationAlgorithm)throw Error('Please append encoded "keyDerivationAlgorithm"');if(!s.keyDerivationAlgorithm.algorithmParams)throw Error('Incorrectly encoded "keyDerivationAlgorithm"');try{t=new aP({schema:s.keyDerivationAlgorithm.algorithmParams})}catch(e){throw Error('Incorrectly encoded "keyDerivationAlgorithm"')}let r=new Uint8Array(s.password),i=await a.importKey("raw",r,"PBKDF2",!1,["deriveKey"]),l=a.getAlgorithmByOID(s.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),o="SHA-1";t.prf&&(o=a.getAlgorithmByOID(t.prf.algorithmId,!0,"prfAlgorithm").hash.name);let c=new Uint8Array(t.salt.valueBlock.valueHex),h=t.iterationCount,m=await a.deriveKey({name:"PBKDF2",hash:{name:o},salt:c,iterations:h},i,l,!0,["wrapKey"]),d=await a.wrapKey("raw",u,m,l);s.encryptedKey=new n.lW({valueHex:d})},g=[];for(let e=0;e<this.recipientInfos.length;e++)switch(this.recipientInfos[e].variant){case 1:g.push(await m(e));break;case 2:g.push(await h(e));break;case 3:g.push(await d(e));break;case 4:g.push(await f(e));break;default:throw Error(`Unknown recipient type in array with index ${e}`)}return g}async decrypt(e,t,a=aM(!0)){let s;let r=t||{};if(e+1>this.recipientInfos.length)throw Error(`Maximum value for "index" is: ${this.recipientInfos.length-1}`);let i=async e=>{let t,s,i,u;let o=this.recipientInfos[e].value,c=o.originator;if(r.recipientCertificate){let a=r.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(a.constructor.blockName()!==n.dS.blockName())throw Error(`Incorrect "recipientCertificate" for index ${e}`);t=a.valueBlock.toString()}else if(c.value.algorithm.algorithmParams){let a=c.value.algorithm.algorithmParams;if(a.constructor.blockName()!==n.dS.blockName())throw Error(`Incorrect originator for index ${e}`);t=a.valueBlock.toString()}else throw Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!r.recipientPrivateKey)throw Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(t){case"1.2.840.10045.3.1.7":s="P-256",i=256;break;case"1.3.132.0.34":s="P-384",i=384;break;case"1.3.132.0.35":s="P-521",i=528;break;default:throw Error(`Incorrect curve OID for index ${e}`)}let h=a;l._H.isBufferSource(r.recipientPrivateKey)?u=await a.importKey("pkcs8",r.recipientPrivateKey,{name:"ECDH",namedCurve:s},!0,["deriveBits"]):(u=r.recipientPrivateKey,"crypto"in r&&r.crypto&&(h=r.crypto.subtle)),"algorithmParams"in c.value.algorithm==!1&&(c.value.algorithm.algorithmParams=new n.dS({value:t}));let m=c.value.toSchema().toBER(!1),d=await a.importKey("spki",m,{name:"ECDH",namedCurve:s},!0,[]),f=await h.deriveBits({name:"ECDH",public:d},u,i);async function g(e){e=e||!1;let t=new F({schema:o.keyEncryptionAlgorithm.algorithmParams}),s=a.getAlgorithmByOID(t.algorithmId,!0,"kwAlgorithm"),r=s.length,i=new ArrayBuffer(4),l=new Uint8Array(i);for(let e=3;e>=0;e--)l[e]=r,r>>=8;let u={algorithmId:t.algorithmId};e&&(u.algorithmParams=new n.Uv);let c=new lf({keyInfo:new F(u),entityUInfo:o.ukm,suppPubInfo:new n.lW({valueHex:i})}).toSchema().toBER(!1),h=a.getAlgorithmByOID(o.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!h.name)throw Error(`Incorrect OID for key encryption algorithm: ${o.keyEncryptionAlgorithm.algorithmId}`);return a$(h.kdf,f,s.length,c,a)}let p=await g(),w=async e=>a.importKey("raw",e,{name:"AES-KW"},!0,["unwrapKey"]),y=await w(p),v=async e=>{let t=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,s=a.getAlgorithmByOID(t,!0,"contentEncryptionAlgorithm");return a.unwrapKey("raw",o.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,e,{name:"AES-KW"},s,!0,["decrypt"])};try{return await v(y)}catch{let e=await g(!0);return v(await w(e))}},u=async e=>{let t;let s=this.recipientInfos[e].value;if(!r.recipientPrivateKey)throw Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');let i=a.getAlgorithmByOID(s.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if("RSA-OAEP"===i.name){let e=new lo({schema:s.keyEncryptionAlgorithm.algorithmParams});if(i.hash=a.getAlgorithmByOID(e.hashAlgorithm.algorithmId),"name"in i.hash==!1)throw Error(`Incorrect OID for hash algorithm: ${e.hashAlgorithm.algorithmId}`)}let n=a;l._H.isBufferSource(r.recipientPrivateKey)?t=await a.importKey("pkcs8",r.recipientPrivateKey,i,!0,["decrypt"]):(t=r.recipientPrivateKey,"crypto"in r&&r.crypto&&(n=r.crypto.subtle));let u=await n.decrypt(t.algorithm,t,s.encryptedKey.valueBlock.valueHexView),o=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,c=a.getAlgorithmByOID(o,!0,"contentEncryptionAlgorithm");if("name"in c==!1)throw Error(`Incorrect "contentEncryptionAlgorithm": ${o}`);return a.importKey("raw",u,c,!0,["decrypt"])},o=async e=>{let t=this.recipientInfos[e].value;if(!r.preDefinedData)throw Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');let s=a.getAlgorithmByOID(t.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),i=await a.importKey("raw",r.preDefinedData,s,!0,["unwrapKey"]),n=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,l=a.getAlgorithmByOID(n,!0,"contentEncryptionAlgorithm");if(!l.name)throw Error(`Incorrect "contentEncryptionAlgorithm": ${n}`);return a.unwrapKey("raw",t.encryptedKey.valueBlock.valueHexView,i,s,l,!0,["decrypt"])},c=async e=>{let t;let s=this.recipientInfos[e].value;if(!r.preDefinedData)throw Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!s.keyDerivationAlgorithm)throw Error('Please append encoded "keyDerivationAlgorithm"');if(!s.keyDerivationAlgorithm.algorithmParams)throw Error('Incorrectly encoded "keyDerivationAlgorithm"');try{t=new aP({schema:s.keyDerivationAlgorithm.algorithmParams})}catch(e){throw Error('Incorrectly encoded "keyDerivationAlgorithm"')}let i=await a.importKey("raw",r.preDefinedData,"PBKDF2",!1,["deriveKey"]),n=a.getAlgorithmByOID(s.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),l=t.prf?a.getAlgorithmByOID(t.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",u=new Uint8Array(t.salt.valueBlock.valueHex),o=t.iterationCount,c=await a.deriveKey({name:"PBKDF2",hash:{name:l},salt:u,iterations:o},i,n,!0,["unwrapKey"]),h=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,m=a.getAlgorithmByOID(h,!0,"contentEncryptionAlgorithm");return a.unwrapKey("raw",s.encryptedKey.valueBlock.valueHexView,c,n,m,!0,["decrypt"])};switch(this.recipientInfos[e].variant){case 1:s=await u(e);break;case 2:s=await i(e);break;case 3:s=await o(e);break;case 4:s=await c(e);break;default:throw Error(`Unknown recipient type in array with index ${e}`)}let h=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,m=a.getAlgorithmByOID(h,!0,"contentEncryptionAlgorithm"),d=new Uint8Array(this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex);if(!this.encryptedContentInfo.encryptedContent)throw Error("Required property `encryptedContent` is empty");let f=this.encryptedContentInfo.getEncryptedContent();return a.decrypt({name:m.name,iv:d},s,f)}}lA.CLASS_NAME="EnvelopedData";let lN="safeContents",lC="parsedValue",lV="contentInfos";class lB extends y{constructor(e={}){super(),this.safeContents=u.kd(e,lN,lB.defaultValues(lN)),lC in e&&(this.parsedValue=u.kd(e,lC,lB.defaultValues(lC))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lN:return[];case lC:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case lN:return 0===t.length;case lC:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.Fl({name:t.contentInfos||"",value:rl.schema()})]})}fromSchema(e){u.gZ(e,[lV]);let t=n.FL(e,e,lB.schema({names:{contentInfos:lV}}));w.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,e=>new rl({schema:e}))}toSchema(){return new n.gd({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=aM(!0)){if(p.assert(e,lN),g.assert(e.safeContents,lN,"Array"),e.safeContents.length!==this.safeContents.length)throw new g('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');for(let[a,s]of(this.parsedValue={safeContents:[]},this.safeContents.entries())){let r=e.safeContents[a],i=`parameters.safeContents[${a}]`;switch(s.contentType){case ew:{g.assert(s.content,"this.safeContents[j].content",n.lW);let e=s.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:iH.fromBER(e)})}break;case ev:{let e=new lA({schema:s.content});p.assert(i,r,"recipientCertificate","recipientKey");let a=r.recipientCertificate,n=r.recipientKey,l=await e.decrypt(0,{recipientCertificate:a,recipientPrivateKey:n},t);this.parsedValue.safeContents.push({privacyMode:2,value:iH.fromBER(l)})}break;case ek:{let e=new iv({schema:s.content});p.assert(i,r,"password");let a=r.password,n=await e.decrypt({password:a},t);this.parsedValue.safeContents.push({privacyMode:1,value:iH.fromBER(n)})}break;default:throw Error(`Unknown "contentType" for AuthenticatedSafe: " ${s.contentType}`)}}}async makeInternalValues(e,t=aM(!0)){if(!this.parsedValue)throw Error('Please run "parseValues" first or add "parsedValue" manually');if(g.assert(this.parsedValue,"this.parsedValue","object"),g.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),g.assert(e,"parameters","object"),p.assert(e,"safeContents"),g.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new g('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');for(let[a,s]of(this.safeContents=[],this.parsedValue.safeContents.entries()))switch(p.assert("content",s,"privacyMode","value"),g.assert(s.value,"content.value",iH),s.privacyMode){case 0:{let e=s.value.toSchema().toBER(!1);this.safeContents.push(new rl({contentType:"1.2.840.113549.1.7.1",content:new n.lW({valueHex:e})}))}break;case 1:{let r=new iv,i=e.safeContents[a];i.contentToEncrypt=s.value.toSchema().toBER(!1),await r.encrypt(i,t),this.safeContents.push(new rl({contentType:"1.2.840.113549.1.7.6",content:r.toSchema()}))}break;case 2:{let r=new lA,i=s.value.toSchema().toBER(!1),n=e.safeContents[a];switch(p.assert(`parameters.safeContents[${a}]`,n,"encryptingCertificate","encryptionAlgorithm"),!0){case"aes-cbc"===n.encryptionAlgorithm.name.toLowerCase():case"aes-gcm"===n.encryptionAlgorithm.name.toLowerCase():break;default:throw Error(`Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": ${n.encryptionAlgorithm}`)}switch(!0){case 128===n.encryptionAlgorithm.length:case 192===n.encryptionAlgorithm.length:case 256===n.encryptionAlgorithm.length:break;default:throw Error(`Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": ${n.encryptionAlgorithm.length}`)}let l=n.encryptionAlgorithm;r.addRecipientByCertificate(n.encryptingCertificate,{},void 0,t),await r.encrypt(l,i,t),this.safeContents.push(new rl({contentType:"1.2.840.113549.1.7.3",content:r.toSchema()}))}break;default:throw Error(`Incorrect value for "content.privacyMode": ${s.privacyMode}`)}return this}}lB.CLASS_NAME="AuthenticatedSafe";let lI="hashAlgorithm",lE="issuerNameHash",lD="issuerKeyHash",lx="serialNumber",lO=[lI,lE,lD,lx];class lP extends y{static async create(e,t,a=aM(!0)){let s=new lP;return await s.createForCertificate(e,t,a),s}constructor(e={}){super(),this.hashAlgorithm=u.kd(e,lI,lP.defaultValues(lI)),this.issuerNameHash=u.kd(e,lE,lP.defaultValues(lE)),this.issuerKeyHash=u.kd(e,lD,lP.defaultValues(lD)),this.serialNumber=u.kd(e,lx,lP.defaultValues(lx)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lI:return new F;case lE:case lD:return new n.lW;case lx:return new n.jz;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case lI:return""===t.algorithmId&&"algorithmParams"in t==!1;case lE:case lD:case lx:return t.isEqual(lP.defaultValues(lx));default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[F.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||""}}),new n.lW({name:t.issuerNameHash||""}),new n.lW({name:t.issuerKeyHash||""}),new n.jz({name:t.serialNumber||""})]})}fromSchema(e){u.gZ(e,lO);let t=n.FL(e,e,lP.schema({names:{hashAlgorithm:lI,issuerNameHash:lE,issuerKeyHash:lD,serialNumber:lx}}));w.assertSchema(t,this.className),this.hashAlgorithm=new F({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new n.gd({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!!(this.hashAlgorithm.algorithmId===e.hashAlgorithm.algorithmId&&l._H.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)&&l._H.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)&&this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,a=aM(!0)){p.assert(t,lI,"issuerCertificate");let s=a.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new F({algorithmId:s,algorithmParams:new n.Uv});let r=t.issuerCertificate;this.serialNumber=e.serialNumber;let i=await a.digest({name:t.hashAlgorithm},r.subject.toSchema().toBER(!1));this.issuerNameHash=new n.lW({valueHex:i});let l=r.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,u=await a.digest({name:t.hashAlgorithm},l);this.issuerKeyHash=new n.lW({valueHex:u})}}lP.CLASS_NAME="CertID";let lL="certID",lK="certStatus",lH="thisUpdate",lR="nextUpdate",lj="singleExtensions",lU=[lL,lK,lH,lR,lj];class lJ extends y{constructor(e={}){super(),this.certID=u.kd(e,lL,lJ.defaultValues(lL)),this.certStatus=u.kd(e,lK,lJ.defaultValues(lK)),this.thisUpdate=u.kd(e,lH,lJ.defaultValues(lH)),lR in e&&(this.nextUpdate=u.kd(e,lR,lJ.defaultValues(lR))),lj in e&&(this.singleExtensions=u.kd(e,lj,lJ.defaultValues(lj))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lL:return new lP;case lK:return{};case lH:case lR:return new Date(0,0,0);case lj:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case lL:return lP.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&lP.compareWithDefault("issuerNameHash",t.issuerNameHash)&&lP.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&lP.compareWithDefault("serialNumber",t.serialNumber);case lK:return 0===Object.keys(t).length;case lH:case lR:return t===lJ.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[lP.schema(t.certID||{}),new n.GR({value:[new n.sG({name:t.certStatus||"",idBlock:{tagClass:3,tagNumber:0}}),new n.BL({name:t.certStatus||"",idBlock:{tagClass:3,tagNumber:1},value:[new n.O_,new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.ns]})]}),new n.sG({name:t.certStatus||"",idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new n.O_({name:t.thisUpdate||""}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.O_({name:t.nextUpdate||""})]}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[sd.schema(t.singleExtensions||{})]})]})}fromSchema(e){u.gZ(e,lU);let t=n.FL(e,e,lJ.schema({names:{certID:{names:{blockName:lL}},certStatus:lK,thisUpdate:lH,nextUpdate:lR,singleExtensions:{names:{blockName:lj}}}}));w.assertSchema(t,this.className),this.certID=new lP({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),lR in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),lj in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,e=>new sc({schema:e})))}toSchema(){let e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new n.O_({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.O_({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new n.gd({value:Array.from(this.singleExtensions,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){let e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,e=>e.toJSON())),e}}lJ.CLASS_NAME="SingleResponse";let lT="version",lF="responderID",lq="producedAt",lM="responses",lW="responseExtensions",l$="ResponseData",l_=`${l$}.${lT}`,lz=`${l$}.${lF}`,lZ=`${l$}.${lq}`,lG=`${l$}.${lM}`,lQ=`${l$}.${lW}`,lY=[l$,l_,lz,lZ,lG,lQ];class lX extends y{get tbs(){return l._H.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(u.kd(e,"tbs",lX.defaultValues("tbs"))),lT in e&&(this.version=u.kd(e,lT,lX.defaultValues(lT))),this.responderID=u.kd(e,lF,lX.defaultValues(lF)),this.producedAt=u.kd(e,lq,lX.defaultValues(lq)),this.responses=u.kd(e,lM,lX.defaultValues(lM)),lW in e&&(this.responseExtensions=u.kd(e,lW,lX.defaultValues(lW))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lT:return 0;case"tbs":return f;case lF:return{};case lq:return new Date(0,0,0);case lM:case lW:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"tbs":return 0===t.byteLength;case lF:return 0===Object.keys(t).length;case lq:return t===lX.defaultValues(e);case lM:case lW:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||l$,value:[new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.jz({name:t.version||l_})]}),new n.GR({value:[new n.BL({name:t.responderID||lz,idBlock:{tagClass:3,tagNumber:1},value:[C.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new n.BL({name:t.responderID||lz,idBlock:{tagClass:3,tagNumber:2},value:[new n.lW({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new n.O_({name:t.producedAt||lZ}),new n.gd({value:[new n.Fl({name:lG,value:lJ.schema(t.response||{})})]}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[sd.schema(t.extensions||{names:{blockName:lQ}})]})]})}fromSchema(e){u.gZ(e,lY);let t=n.FL(e,e,lX.schema());w.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,l_ in t.result&&(this.version=t.result[l_].valueBlock.valueDec),1===t.result[lz].idBlock.tagNumber?this.responderID=new C({schema:t.result[lz].valueBlock.value[0]}):this.responderID=t.result[lz].valueBlock.value[0],this.producedAt=t.result[lZ].toDate(),this.responses=Array.from(t.result[lG],e=>new lJ({schema:e})),lQ in t.result&&(this.responseExtensions=Array.from(t.result[lQ].valueBlock.value,e=>new sc({schema:e})))}toSchema(e=!1){let t;if(!1===e){if(!this.tbsView.byteLength)return lX.schema();let e=n.mH(this.tbsView);w.assert(e,"TBS Response Data"),t=e.result}else{let e=[];lT in this&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.jz({value:this.version})]})),this.responderID instanceof C?e.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):e.push(new n.BL({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),e.push(new n.O_({valueDate:this.producedAt})),e.push(new n.gd({value:Array.from(this.responses,e=>e.toSchema())})),this.responseExtensions&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:[new n.gd({value:Array.from(this.responseExtensions,e=>e.toSchema())})]})),t=new n.gd({value:e})}return t}toJSON(){let e={};return lT in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,e=>e.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,e=>e.toJSON())),e}}lX.CLASS_NAME="ResponseData";let l1="trustedCerts",l0="certs",l2="crls",l3="ocsps",l4="checkDate",l8="findOrigin",l5="findIssuer";!function(e){e[e.unknown=-1]="unknown",e[e.success=0]="success",e[e.noRevocation=11]="noRevocation",e[e.noPath=60]="noPath",e[e.noValidPath=97]="noValidPath"}(r||(r={}));class l6 extends Error{constructor(e,t){super(t),this.name=l6.NAME,this.code=e,this.message=t}}l6.NAME="ChainValidationError";class l9{constructor(e={}){this.trustedCerts=u.kd(e,l1,this.defaultValues(l1)),this.certs=u.kd(e,l0,this.defaultValues(l0)),this.crls=u.kd(e,l2,this.defaultValues(l2)),this.ocsps=u.kd(e,l3,this.defaultValues(l3)),this.checkDate=u.kd(e,l4,this.defaultValues(l4)),this.findOrigin=u.kd(e,l8,this.defaultValues(l8)),this.findIssuer=u.kd(e,l5,this.defaultValues(l5))}static defaultFindOrigin(e,t){for(let a of(0===e.tbsView.byteLength&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER())),t.certs))if(0===a.tbsView.byteLength&&(a.tbsView=new Uint8Array(a.encodeTBS().toBER())),l._H.isEqual(e.tbsView,a.tbsView))return"Intermediate Certificates";for(let a of t.trustedCerts)if(0===a.tbsView.byteLength&&(a.tbsView=new Uint8Array(a.encodeTBS().toBER())),l._H.isEqual(e.tbsView,a.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,a=aM(!0)){let s=[],r=null,i=null,n=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,a))return[e]}catch(e){}if(e.extensions){for(let t of e.extensions)if(t.extnID===ef&&t.parsedValue instanceof eE){t.parsedValue.keyIdentifier?r=t.parsedValue.keyIdentifier:(t.parsedValue.authorityCertIssuer&&(i=t.parsedValue.authorityCertIssuer),t.parsedValue.authorityCertSerialNumber&&(n=t.parsedValue.authorityCertSerialNumber));break}}function u(t){if(null!==r&&t.extensions){let e=!1;for(let a of t.extensions)if("2.5.29.14"===a.extnID&&a.parsedValue){e=!0,l._H.isEqual(a.parsedValue.valueBlock.valueHex,r.valueBlock.valueHexView)&&s.push(t);break}if(e)return}let a=!1;null!==n&&(a=t.serialNumber.isEqual(n)),null!==i?t.subject.isEqual(i)&&a&&s.push(t):e.issuer.isEqual(t.subject)&&s.push(t)}for(let e of t.trustedCerts)u(e);for(let e of t.certs)u(e);for(let t=s.length-1;t>=0;t--)try{let r=await e.verify(s[t],a);!1===r&&s.splice(t,1)}catch(e){s.splice(t,1)}return s}defaultValues(e){switch(e){case l1:case l0:case l2:case l3:return[];case l4:return new Date;case l8:return l9.defaultFindOrigin;case l5:return this.defaultFindIssuer;default:throw Error(`Invalid member name for CertificateChainValidationEngine class: ${e}`)}}async sort(e=!1,t=aM(!0)){let a;let s=[],i=async(e,t)=>{let a=[];if(function(e,t){for(let a=0;a<t.length;a++)if(l._H.isEqual(e.tbsView,t[a].tbsView))return!0;return!1}(e,this.trustedCerts))return[[e]];let s=await this.findIssuer(e,this,t);if(0===s.length)throw Error("No valid certificate paths found");for(let r=0;r<s.length;r++){if(l._H.isEqual(s[r].tbsView,e.tbsView)){a.push([s[r]]);continue}let n=await i(s[r],t);for(let e=0;e<n.length;e++){let t=n[e].slice();t.splice(0,0,s[r]),function(e){let t=!0;for(let a=0;a<e.length;a++){for(let s=0;s<e.length;s++)if(s!==a&&e[a]===e[s]){t=!1;break}if(!t)break}return t}(t)?a.push(t):a.push(n[e])}}return a},n=async e=>{let a=[],r=[],i=[];if(a.push(...s.filter(t=>e.issuer.isEqual(t.subject))),0===a.length)return{status:1,statusMessage:"No certificate's issuers"};if(r.push(...this.crls.filter(t=>t.issuer.isEqual(e.issuer))),0===r.length)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let e=0;e<r.length;e++){let s=r[e];if(!s.nextUpdate||!(s.nextUpdate.value<this.checkDate))for(let s=0;s<a.length;s++)try{if(await r[e].verify({issuerCertificate:a[s]},t)){i.push({crl:r[e],certificate:a[s]});break}}catch(e){}}return i.length?{status:0,statusMessage:"",result:i}:{status:3,statusMessage:"No valid CRLs found"}},u=async(e,a)=>{let s=t.getAlgorithmByOID(e.signatureAlgorithm.algorithmId);if(!s.name||!s.hash)return 1;for(let s=0;s<this.ocsps.length;s++){let r=this.ocsps[s],i=await r.getCertificateStatus(e,a,t);if(i.isForCertificate){if(0===i.status)return 0;return 1}}return 2};async function o(e,t=!1){let a=!1,s=!1,r=!1,i=!1;if(e.extensions){for(let t=0;t<e.extensions.length;t++){let n=e.extensions[t];if(n.critical&&!n.parsedValue)return{result:!1,resultCode:6,resultMessage:`Unable to parse critical certificate extension: ${n.extnID}`};if("2.5.29.15"===n.extnID){r=!0;let e=new Uint8Array(n.parsedValue.valueBlock.valueHex);(4&e[0])==4&&(s=!0),(2&e[0])==2&&(i=!0)}n.extnID===ei&&"cA"in n.parsedValue&&!0===n.parsedValue.cA&&(a=!0)}if(!0===s&&!1===a)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(!0===r&&!0===a&&!1===s)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(!0===a&&!0===r&&t&&!1===i)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return!1===a?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:""}}let c=async(t,a)=>{for(let e=0;e<t.length;e++)if(t[e].notBefore.value>a||t[e].notAfter.value<a)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(t.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let e=t.length-2;e>=0;e--)if(!1===t[e].issuer.isEqual(t[e].subject)&&!1===t[e].issuer.isEqual(t[e+1].subject))return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(0!==this.crls.length||0!==this.ocsps.length)for(let a=0;a<t.length-1;a++){let s=2,i={status:0,statusMessage:""};if(0!==this.ocsps.length)switch(s=await u(t[a],t[a+1])){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(0!==this.crls.length){if(0===(i=await n(t[a])).status&&i.result)for(let e=0;e<i.result.length;e++){if(i.result[e].crl.isCertificateRevoked(t[a]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if(!1===(await o(i.result[e].certificate,!0)).result)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(!1===e)throw new l6(r.noRevocation,`No revocation values found for one of certificates: ${i.statusMessage}`)}else if(2===s)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(2===s&&2===i.status&&e){let e=t[a+1],s=!1;if(e.extensions)for(let t of e.extensions)switch(t.extnID){case eo:case ec:case ep:s=!0}if(s)throw new l6(r.noRevocation,`No revocation values found for one of certificates: ${i.statusMessage}`)}}for(let[e,a]of t.entries())if(e&&!(await o(a)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}};s.push(...this.trustedCerts),s.push(...this.certs);for(let e=0;e<s.length;e++)for(let t=0;t<s.length;t++)if(e!==t&&l._H.isEqual(s[e].tbsView,s[t].tbsView)){s.splice(t,1),e=0;break}let h=s[s.length-1],m=[h];if(0===(a=await i(h,t)).length)throw new l6(r.noPath,"Unable to find certificate path");for(let e=a.length-1;e>=0;e--){let t=!1;for(let s=0;s<a[e].length;s++){let r=a[e][s];for(let e=0;e<this.trustedCerts.length;e++)if(l._H.isEqual(r.tbsView,this.trustedCerts[e].tbsView)){t=!0;break}if(t)break}t||a.splice(e,1)}if(0===a.length)throw new l6(r.noValidPath,"No valid certificate paths found");let d=a[0].length,f=0;for(let e=0;e<a.length;e++)a[e].length<d&&(d=a[e].length,f=e);for(let e=0;e<a[f].length;e++)m.push(a[f][e]);if(!1===(a=await c(m,this.checkDate)).result)throw a;return m}async verify(e={},t=aM(!0)){function a(e,t){let a=v(e),s=v(t),r=a.split("."),i=s.split("."),n=r.length,l=i.length;if(0===n||0===l||n<l)return!1;for(let e=0;e<n;e++)if(0===r[e].length)return!1;for(let e=0;e<l;e++)if(0===i[e].length){if(0===e){if(1===l)return!1;continue}return!1}for(let e=0;e<l;e++)if(0!==i[l-1-e].length&&0!==r[n-1-e].localeCompare(i[l-1-e]))return!1;return!0}function s(e,t){let s=v(e),r=v(t),i=s.split("@"),n=r.split("@");if(0===i.length||0===n.length||i.length<n.length)return!1;if(1===n.length){if(a(i[1],n[0])){let e=i[1].split("."),t=n[0].split(".");return 0===t[0].length||e.length===t.length}return!1}return 0===s.localeCompare(r)}function i(e,t){let s=v(e),r=v(t),i=s.split("/");if(r.split("/").length>1)return!1;if(i.length>1){for(let e=0;e<i.length;e++)if(i[e].length>0&&":"!==i[e].charAt(i[e].length-1)){s=i[e].split(":")[0];break}}if(a(s,r)){let e=s.split("."),t=r.split(".");return 0===t[0].length||e.length===t.length}return!1}function n(e,t){let a=e.valueBlock.valueHexView,s=t.valueBlock.valueHexView;if(4===a.length&&8===s.length){for(let e=0;e<4;e++)if((a[e]^s[e])&s[e+4])return!1;return!0}if(16===a.length&&32===s.length){for(let e=0;e<16;e++)if((a[e]^s[e])&s[e+16])return!1;return!0}return!1}function l(e,t){if(0===e.typesAndValues.length||0===t.typesAndValues.length)return!0;if(e.typesAndValues.length<t.typesAndValues.length)return!1;let a=!0,s=0;for(let r=0;r<t.typesAndValues.length;r++){let i=!1;for(let n=s;n<e.typesAndValues.length;n++)if(i=e.typesAndValues[n].isEqual(t.typesAndValues[r]),e.typesAndValues[n].type===t.typesAndValues[r].type&&(a=a&&i),!0===i){if(0!==s&&s!==n)return!1;s=n+1;break}if(!1===i)return!1}return 0!==s&&a}try{if(0===this.certs.length)throw Error("Empty certificate array");let r=e.passedWhenNotRevValues||!1,u=e.initialPolicySet||[em],o=e.initialExplicitPolicy||!1,c=e.initialPolicyMappingInhibit||!1,h=e.initialInhibitPolicy||!1,m=e.initialPermittedSubtreesSet||[],d=e.initialExcludedSubtreesSet||[],f=e.initialRequiredNameForms||[],g=o,p=c,w=h,y=[!1,!1,!1],v=0,k=0,S=0,b=m,A=d,N=1;this.certs=await this.sort(r,t);let C=[];C.push(em);let V=[],B=Array(this.certs.length-1);for(let e=0;e<this.certs.length-1;e++)B[e]=!0;V.push(B);let I=Array(this.certs.length-1),E=Array(this.certs.length-1),D=g?this.certs.length-1:-1;for(let e=this.certs.length-2;e>=0;e--,N++){let t=this.certs[e];if(t.extensions){for(let a=0;a<t.extensions.length;a++){let s=t.extensions[a];if(s.extnID===eh){E[e]=s.parsedValue;for(let t=0;t<C.length;t++)if(C[t]===em){delete V[t][e];break}for(let t=0;t<s.parsedValue.certificatePolicies.length;t++){let a=-1,r=s.parsedValue.certificatePolicies[t].policyIdentifier;for(let e=0;e<C.length;e++)if(r===C[e]){a=e;break}if(-1===a){C.push(r);let t=Array(this.certs.length-1);t[e]=!0,V.push(t)}else V[a][e]=!0}}if(s.extnID===ed){if(p)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};I[e]=s.parsedValue}s.extnID===eg&&!1===g&&(0===s.parsedValue.requireExplicitPolicy?(g=!0,D=e):!1===y[0]?(y[0]=!0,v=s.parsedValue.requireExplicitPolicy):v=v>s.parsedValue.requireExplicitPolicy?s.parsedValue.requireExplicitPolicy:v,0===s.parsedValue.inhibitPolicyMapping?p=!0:!1===y[1]?(y[1]=!0,k=s.parsedValue.inhibitPolicyMapping+1):k=k>s.parsedValue.inhibitPolicyMapping+1?s.parsedValue.inhibitPolicyMapping+1:k),"2.5.29.54"===s.extnID&&!1===w&&(0===s.parsedValue.valueBlock.valueDec?w=!0:!1===y[2]?(y[2]=!0,S=s.parsedValue.valueBlock.valueDec):S=S>s.parsedValue.valueBlock.valueDec?s.parsedValue.valueBlock.valueDec:S)}if(!0===w){let t=-1;for(let e=0;e<C.length;e++)if(C[e]===em){t=e;break}-1!==t&&delete V[0][e]}!1===g&&!0===y[0]&&(v--,0===v&&(g=!0,D=e,y[0]=!1)),!1===p&&!0===y[1]&&(k--,0===k&&(p=!0,y[1]=!1)),!1===w&&!0===y[2]&&(S--,0===S&&(w=!0,y[2]=!1))}}for(let e=0;e<this.certs.length-1;e++)if(e<this.certs.length-2&&void 0!==I[e+1])for(let t=0;t<I[e+1].mappings.length;t++){if(I[e+1].mappings[t].issuerDomainPolicy===em||I[e+1].mappings[t].subjectDomainPolicy===em)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let a=-1,s=-1;for(let r=0;r<C.length;r++)C[r]===I[e+1].mappings[t].issuerDomainPolicy&&(a=r),C[r]===I[e+1].mappings[t].subjectDomainPolicy&&(s=r);void 0!==V[a][e]&&delete V[a][e];for(let r=0;r<E[e].certificatePolicies.length;r++)if(I[e+1].mappings[t].subjectDomainPolicy===E[e].certificatePolicies[r].policyIdentifier&&-1!==a&&-1!==s)for(let t=0;t<=e;t++)void 0!==V[s][t]&&(V[a][t]=!0,delete V[s][t])}for(let e=0;e<C.length;e++)if(C[e]===em)for(let t=0;t<D;t++)delete V[e][t];let x=[];for(let e=0;e<V.length;e++){let t=!0;for(let a=0;a<this.certs.length-1;a++){let s=!1;if(a<D&&C[e]===em&&C.length>1){t=!1;break}if(void 0===V[e][a]){if(a>=D){for(let e=0;e<C.length;e++)if(C[e]===em){!0===V[e][a]&&(s=!0);break}}if(!s){t=!1;break}}}!0===t&&x.push(C[e])}let O=[];if(1===u.length&&u[0]===em&&!1===g)O=u;else if(1===x.length&&x[0]===em)O=u;else for(let e=0;e<x.length;e++)for(let t=0;t<u.length;t++)if(u[t]===x[e]||u[t]===em){O.push(x[e]);break}let P={result:O.length>0,resultCode:0,resultMessage:O.length>0?"":'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:x,userConstrPolicies:O,explicitPolicyIndicator:g,policyMappings:I,certificatePath:this.certs};if(0===O.length||!1===P.result)return P;N=1;for(let e=this.certs.length-2;e>=0;e--,N++){let t=this.certs[e],r=[],u=[],o=[];if(t.extensions)for(let e=0;e<t.extensions.length;e++){let a=t.extensions[e];a.extnID===eu&&("permittedSubtrees"in a.parsedValue&&(u=u.concat(a.parsedValue.permittedSubtrees)),"excludedSubtrees"in a.parsedValue&&(o=o.concat(a.parsedValue.excludedSubtrees))),a.extnID===es&&(r=r.concat(a.parsedValue.altNames))}let c=f.length<=0;for(let e=0;e<f.length;e++)if(4===f[e].base.type){if(f[e].base.value.typesAndValues.length!==t.subject.typesAndValues.length)continue;c=!0;for(let a=0;a<t.subject.typesAndValues.length;a++)if(t.subject.typesAndValues[a].type!==f[e].base.value.typesAndValues[a].type){c=!1;break}}if(!1===c)throw P.result=!1,P.resultCode=21,P.resultMessage="No necessary name form found",P;let h=[[],[],[],[],[]];for(let e=0;e<b.length;e++)switch(b[e].base.type){case 1:h[0].push(b[e]);break;case 2:h[1].push(b[e]);break;case 4:h[2].push(b[e]);break;case 6:h[3].push(b[e]);break;case 7:h[4].push(b[e])}for(let e=0;e<5;e++){let u=!1,o=!1,c=h[e];for(let h=0;h<c.length;h++){switch(e){case 0:if(r.length>0)for(let e=0;e<r.length;e++)1===r[e].type&&(o=!0,u=u||s(r[e].value,c[h].base.value));else for(let e=0;e<t.subject.typesAndValues.length;e++)("1.2.840.113549.1.9.1"===t.subject.typesAndValues[e].type||"0.9.2342.19200300.100.1.3"===t.subject.typesAndValues[e].type)&&(o=!0,u=u||s(t.subject.typesAndValues[e].value.valueBlock.value,c[h].base.value));break;case 1:if(r.length>0)for(let e=0;e<r.length;e++)2===r[e].type&&(o=!0,u=u||a(r[e].value,c[h].base.value));break;case 2:o=!0,u=l(t.subject,c[h].base.value);break;case 3:if(r.length>0)for(let e=0;e<r.length;e++)6===r[e].type&&(o=!0,u=u||i(r[e].value,c[h].base.value));break;case 4:if(r.length>0)for(let e=0;e<r.length;e++)7===r[e].type&&(o=!0,u=u||n(r[e].value,c[h].base.value))}if(u)break}if(!1===u&&c.length>0&&o)throw P.result=!1,P.resultCode=41,P.resultMessage='Failed to meet "permitted sub-trees" name constraint',P}let m=!1;for(let e=0;e<A.length;e++){switch(A[e].base.type){case 1:if(r.length>=0)for(let t=0;t<r.length;t++)1===r[t].type&&(m=m||s(r[t].value,A[e].base.value));else for(let a=0;a<t.subject.typesAndValues.length;a++)("1.2.840.113549.1.9.1"===t.subject.typesAndValues[a].type||"0.9.2342.19200300.100.1.3"===t.subject.typesAndValues[a].type)&&(m=m||s(t.subject.typesAndValues[a].value.valueBlock.value,A[e].base.value));break;case 2:if(r.length>0)for(let t=0;t<r.length;t++)2===r[t].type&&(m=m||a(r[t].value,A[e].base.value));break;case 4:m=m||l(t.subject,A[e].base.value);break;case 6:if(r.length>0)for(let t=0;t<r.length;t++)6===r[t].type&&(m=m||i(r[t].value,A[e].base.value));break;case 7:if(r.length>0)for(let t=0;t<r.length;t++)7===r[t].type&&(m=m||n(r[t].value,A[e].base.value))}if(m)break}if(!0===m)throw P.result=!1,P.resultCode=42,P.resultMessage='Failed to meet "excluded sub-trees" name constraint',P;b=b.concat(u),A=A.concat(o)}return P}catch(e){if(e instanceof Error){if(e instanceof l6)return{result:!1,resultCode:e.code,resultMessage:e.message,error:e};return{result:!1,resultCode:r.unknown,resultMessage:e.message,error:e}}if(e&&"object"==typeof e&&"resultMessage"in e)return e;return{result:!1,resultCode:-1,resultMessage:`${e}`}}}}let l7="tbsResponseData",ue="signatureAlgorithm",ut="signature",ua="certs",us="BasicOCSPResponse",ur=`${us}.${l7}`,ui=`${us}.${ue}`,un=`${us}.${ut}`,ul=`${us}.${ua}`,uu=[ur,ui,un,ul];class uo extends y{constructor(e={}){super(),this.tbsResponseData=u.kd(e,l7,uo.defaultValues(l7)),this.signatureAlgorithm=u.kd(e,ue,uo.defaultValues(ue)),this.signature=u.kd(e,ut,uo.defaultValues(ut)),ua in e&&(this.certs=u.kd(e,ua,uo.defaultValues(ua))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case l7:return new lX;case ue:return new F;case ut:return new n.Rq;case ua:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let e=lX.compareWithDefault("tbs",t.tbs)&&lX.compareWithDefault("responderID",t.responderID)&&lX.compareWithDefault("producedAt",t.producedAt)&&lX.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(e=e&&lX.compareWithDefault("responseExtensions",t.responseExtensions)),e}case ue:return""===t.algorithmId&&"algorithmParams"in t==!1;case ut:return t.isEqual(uo.defaultValues(e));case ua:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||us,value:[lX.schema(t.tbsResponseData||{names:{blockName:ur}}),F.schema(t.signatureAlgorithm||{names:{blockName:ui}}),new n.Rq({name:t.signature||un}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.gd({value:[new n.Fl({name:ul,value:rJ.schema(t.certs||{})})]})]})]})}fromSchema(e){u.gZ(e,uu);let t=n.FL(e,e,uo.schema());w.assertSchema(t,this.className),this.tbsResponseData=new lX({schema:t.result[ur]}),this.signatureAlgorithm=new F({schema:t.result[ui]}),this.signature=t.result[un],ul in t.result&&(this.certs=Array.from(t.result[ul],e=>new rJ({schema:e})))}toSchema(){let e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.gd({value:Array.from(this.certs,e=>e.toSchema())})]})),new n.gd({value:e})}toJSON(){let e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,e=>e.toJSON())),e}async getCertificateStatus(e,t,a=aM(!0)){let s={isForCertificate:!1,status:2},r={},i=[];for(let s of this.tbsResponseData.responses){let n=a.getAlgorithmByOID(s.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!r[n.name]){r[n.name]=1;let s=new lP;i.push(s),await s.createForCertificate(e,{hashAlgorithm:n.name,issuerCertificate:t},a)}}for(let e of this.tbsResponseData.responses)for(let t of i)if(e.certID.isEqual(t)){s.isForCertificate=!0;try{switch(e.certStatus.idBlock.isConstructed){case!0:1===e.certStatus.idBlock.tagNumber&&(s.status=1);break;case!1:switch(e.certStatus.idBlock.tagNumber){case 0:s.status=0;break;case 2:s.status=2}}}catch(e){}return s}return s}async sign(e,t="SHA-1",a=aM(!0)){if(!e)throw Error("Need to provide a private key for signing");let s=await a.getSignatureParameters(e,t),r=s.parameters.algorithm;if(!("name"in r))throw Error("Empty algorithm");this.signatureAlgorithm=s.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());let i=await a.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:r});this.signature=new n.Rq({valueHex:i})}async verify(e={},t=aM(!0)){let a=null,s=-1,r=e.trustedCerts||[];if(!this.certs)throw Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof C:for(let[e,t]of this.certs.entries())if(t.subject.isEqual(this.tbsResponseData.responderID)){s=e;break}break;case this.tbsResponseData.responderID instanceof n.lW:for(let[e,a]of this.certs.entries()){let r=await t.digest({name:"sha-1"},a.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(u.JQ(r,this.tbsResponseData.responderID.valueBlock.valueHex)){s=e;break}}break;default:throw Error("Wrong value for responderID")}if(-1===s)throw Error("Correct certificate was not found in OCSP response");let i=[a=this.certs[s]];for(let e of this.certs){let t=await rT(e,a);t&&i.push(t)}let l=new l9({certs:i,trustedCerts:r});if(!(await l.verify({},t)).result)throw Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[s].subjectPublicKeyInfo,this.signatureAlgorithm)}}uo.CLASS_NAME="BasicOCSPResponse";let uc="version",uh="subject",um="subjectPublicKeyInfo",ud="attributes",uf="signatureAlgorithm",ug="signatureValue",up="CertificationRequestInfo",uw=`${up}.version`,uy=`${up}.subject`,uv=`${up}.subjectPublicKeyInfo`,uk=`${up}.attributes`,uS=[up,uw,uy,uv,uk,uf,ug];class ub extends y{get tbs(){return l._H.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(u.kd(e,"tbs",ub.defaultValues("tbs"))),this.version=u.kd(e,uc,ub.defaultValues(uc)),this.subject=u.kd(e,uh,ub.defaultValues(uh)),this.subjectPublicKeyInfo=u.kd(e,um,ub.defaultValues(um)),ud in e&&(this.attributes=u.kd(e,ud,ub.defaultValues(ud))),this.signatureAlgorithm=u.kd(e,uf,ub.defaultValues(uf)),this.signatureValue=u.kd(e,ug,ub.defaultValues(ug)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":return f;case uc:return 0;case uh:return new C;case um:return new tQ;case ud:return[];case uf:return new F;case ug:return new n.Rq;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({value:[function(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.CertificationRequestInfo||up,value:[new n.jz({name:t.CertificationRequestInfoVersion||uw}),C.schema(t.subject||{names:{blockName:uy}}),tQ.schema({names:{blockName:uv}}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.Fl({optional:!0,name:t.CertificationRequestInfoAttributes||uk,value:Z.schema(t.attributes||{})})]})]})}(t.certificationRequestInfo||{}),new n.gd({name:t.signatureAlgorithm||uf,value:[new n.dS,new n.FS({optional:!0})]}),new n.Rq({name:t.signatureValue||ug})]})}fromSchema(e){u.gZ(e,uS);let t=n.FL(e,e,ub.schema());w.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[uw].valueBlock.valueDec,this.subject=new C({schema:t.result[uy]}),this.subjectPublicKeyInfo=new tQ({schema:t.result[uv]}),uk in t.result&&(this.attributes=Array.from(t.result[uk],e=>new Z({schema:e}))),this.signatureAlgorithm=new F({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){let e=[new n.jz({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return ud in this&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],e=>e.toSchema())})),new n.gd({value:e})}toSchema(e=!1){let t;if(!1===e){if(0===this.tbsView.byteLength)return ub.schema();let e=n.mH(this.tbsView);w.assert(e,"PKCS#10 Certificate Request"),t=e.result}else t=this.encodeTBS();return new n.gd({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){let e={tbs:l.U$.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return ud in this&&(e.attributes=Array.from(this.attributes||[],e=>e.toJSON())),e}async sign(e,t="SHA-1",a=aM(!0)){if(!e)throw Error("Need to provide a private key for signing");let s=await a.getSignatureParameters(e,t),r=s.parameters;this.signatureAlgorithm=s.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());let i=await a.signWithPrivateKey(this.tbsView,e,r);this.signatureValue=new n.Rq({valueHex:i})}async verify(e=aM(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=aM(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}ub.CLASS_NAME="CertificationRequest";let uA="digestAlgorithm",uN="digest",uC=[uA,uN];class uV extends y{constructor(e={}){super(),this.digestAlgorithm=u.kd(e,uA,uV.defaultValues(uA)),this.digest=u.kd(e,uN,uV.defaultValues(uN)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uA:return new F;case uN:return new n.lW;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uA:return F.compareWithDefault("algorithmId",t.algorithmId)&&"algorithmParams"in t==!1;case uN:return t.isEqual(uV.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[F.schema(t.digestAlgorithm||{names:{blockName:uA}}),new n.lW({name:t.digest||uN})]})}fromSchema(e){u.gZ(e,uC);let t=n.FL(e,e,uV.schema({names:{digestAlgorithm:{names:{blockName:uA}},digest:uN}}));w.assertSchema(t,this.className),this.digestAlgorithm=new F({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new n.gd({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}uV.CLASS_NAME="DigestInfo";let uB="eContentType",uI="eContent",uE=[uB,uI];class uD extends y{constructor(e={}){if(super(),this.eContentType=u.kd(e,uB,uD.defaultValues(uB)),uI in e&&(this.eContent=u.kd(e,uI,uD.defaultValues(uI)),1===this.eContent.idBlock.tagClass&&4===this.eContent.idBlock.tagNumber&&!1===this.eContent.idBlock.isConstructed)){let e=new n.lW({idBlock:{isConstructed:!0},isConstructed:!0}),t=0,a=this.eContent.valueBlock.valueHexView.slice().buffer,s=a.byteLength;for(;s>0;){let r=new Uint8Array(a,t,t+65536>a.byteLength?a.byteLength-t:65536),i=new ArrayBuffer(r.length),l=new Uint8Array(i);for(let e=0;e<l.length;e++)l[e]=r[e];e.valueBlock.value.push(new n.lW({valueHex:i})),s-=r.length,t+=r.length}this.eContent=e}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uB:return"";case uI:return new n.lW;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uB:return""===t;case uI:if(1===t.idBlock.tagClass&&4===t.idBlock.tagNumber)return t.isEqual(uD.defaultValues(uI));return!1;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.eContentType||""}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.FS({name:t.eContent||""})]})]})}fromSchema(e){u.gZ(e,uE);let t=n.FL(e,e,uD.schema({names:{eContentType:uB,eContent:uI}}));w.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),uI in t.result&&(this.eContent=t.result.eContent)}toSchema(){let e=[];return e.push(new n.dS({value:this.eContentType})),this.eContent&&!1===uD.compareWithDefault(uI,this.eContent)&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new n.gd({value:e})}toJSON(){let e={eContentType:this.eContentType};return this.eContent&&!1===uD.compareWithDefault(uI,this.eContent)&&(e.eContent=this.eContent.toJSON()),e}}uD.CLASS_NAME="EncapsulatedContentInfo";let ux="macSalt",uO="iterations",uP=["mac",ux,uO];class uL extends y{constructor(e={}){super(),this.mac=u.kd(e,"mac",uL.defaultValues("mac")),this.macSalt=u.kd(e,ux,uL.defaultValues(ux)),uO in e&&(this.iterations=u.kd(e,uO,uL.defaultValues(uO))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"mac":return new uV;case ux:return new n.lW;case uO:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"mac":return uV.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&uV.compareWithDefault("digest",t.digest);case ux:return t.isEqual(uL.defaultValues(e));case uO:return t===uL.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",optional:t.optional||!0,value:[uV.schema(t.mac||{names:{blockName:"mac"}}),new n.lW({name:t.macSalt||ux}),new n.jz({optional:!0,name:t.iterations||uO})]})}fromSchema(e){u.gZ(e,uP);let t=n.FL(e,e,uL.schema({names:{mac:{names:{blockName:"mac"}},macSalt:ux,iterations:uO}}));w.assertSchema(t,this.className),this.mac=new uV({schema:t.result.mac}),this.macSalt=t.result.macSalt,uO in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){let e=[this.mac.toSchema(),this.macSalt];return void 0!==this.iterations&&e.push(new n.jz({value:this.iterations})),new n.gd({value:e})}toJSON(){let e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return void 0!==this.iterations&&(e.iterations=this.iterations),e}}uL.CLASS_NAME="MacData";let uK="hashAlgorithm",uH="hashedMessage",uR=[uK,uH];class uj extends y{static async create(e,t,a=aM(!0)){let s=a.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),r=await a.digest(e,t);return new uj({hashAlgorithm:new F({algorithmId:s,algorithmParams:new n.Uv}),hashedMessage:new n.lW({valueHex:r})})}constructor(e={}){super(),this.hashAlgorithm=u.kd(e,uK,uj.defaultValues(uK)),this.hashedMessage=u.kd(e,uH,uj.defaultValues(uH)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uK:return new F;case uH:return new n.lW;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uK:return""===t.algorithmId&&"algorithmParams"in t==!1;case uH:return 0===t.isEqual(uj.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[F.schema(t.hashAlgorithm||{}),new n.lW({name:t.hashedMessage||""})]})}fromSchema(e){u.gZ(e,uR);let t=n.FL(e,e,uj.schema({names:{hashAlgorithm:{names:{blockName:uK}},hashedMessage:uH}}));w.assertSchema(t,this.className),this.hashAlgorithm=new F({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new n.gd({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}uj.CLASS_NAME="MessageImprint";let uU="reqCert",uJ="singleRequestExtensions",uT=[uU,uJ];class uF extends y{constructor(e={}){super(),this.reqCert=u.kd(e,uU,uF.defaultValues(uU)),uJ in e&&(this.singleRequestExtensions=u.kd(e,uJ,uF.defaultValues(uJ))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uU:return new lP;case uJ:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uU:return t.isEqual(uF.defaultValues(e));case uJ:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[lP.schema(t.reqCert||{}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[sc.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||""}})]})]})}fromSchema(e){u.gZ(e,uT);let t=n.FL(e,e,uF.schema({names:{reqCert:{names:{blockName:uU}},extensions:{names:{blockName:uJ}}}}));w.assertSchema(t,this.className),this.reqCert=new lP({schema:t.result.reqCert}),uJ in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,e=>new sc({schema:e})))}toSchema(){let e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.gd({value:Array.from(this.singleRequestExtensions,e=>e.toSchema())})]})),new n.gd({value:e})}toJSON(){let e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,e=>e.toJSON())),e}}uF.CLASS_NAME="Request";let uq="version",uM="requestorName",uW="requestList",u$="requestExtensions",u_="TBSRequest",uz=`${u_}.${uq}`,uZ=`${u_}.${uM}`,uG=`${u_}.requests`,uQ=`${u_}.${u$}`,uY=[u_,uz,uZ,uG,uQ];class uX extends y{get tbs(){return l._H.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(u.kd(e,"tbs",uX.defaultValues("tbs"))),uq in e&&(this.version=u.kd(e,uq,uX.defaultValues(uq))),uM in e&&(this.requestorName=u.kd(e,uM,uX.defaultValues(uM))),this.requestList=u.kd(e,uW,uX.defaultValues(uW)),u$ in e&&(this.requestExtensions=u.kd(e,u$,uX.defaultValues(u$))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":return f;case uq:return 0;case uM:return new I;case uW:case u$:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"tbs":return 0===t.byteLength;case uq:return t===uX.defaultValues(e);case uM:return t.type===I.defaultValues("type")&&0===Object.keys(t.value).length;case uW:case u$:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||u_,value:[new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.jz({name:t.TBSRequestVersion||uz})]}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[I.schema(t.requestorName||{names:{blockName:uZ}})]}),new n.gd({name:t.requestList||"TBSRequest.requestList",value:[new n.Fl({name:t.requests||uG,value:uF.schema(t.requestNames||{})})]}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[sd.schema(t.extensions||{names:{blockName:t.requestExtensions||uQ}})]})]})}fromSchema(e){u.gZ(e,uY);let t=n.FL(e,e,uX.schema());w.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,uz in t.result&&(this.version=t.result[uz].valueBlock.valueDec),uZ in t.result&&(this.requestorName=new I({schema:t.result[uZ]})),this.requestList=Array.from(t.result[uG],e=>new uF({schema:e})),uQ in t.result&&(this.requestExtensions=Array.from(t.result[uQ].valueBlock.value,e=>new sc({schema:e})))}toSchema(e=!1){let t;if(!1===e){if(0===this.tbsView.byteLength)return uX.schema();let e=n.mH(this.tbsView);if(w.assert(e,"TBS Request"),!(e.result instanceof n.gd))throw Error("ASN.1 result should be SEQUENCE");t=e.result}else{let e=[];void 0!==this.version&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[new n.jz({value:this.version})]})),this.requestorName&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),e.push(new n.gd({value:Array.from(this.requestList,e=>e.toSchema())})),this.requestExtensions&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:2},value:[new n.gd({value:Array.from(this.requestExtensions,e=>e.toSchema())})]})),t=new n.gd({value:e})}return t}toJSON(){let e={};return void 0!=this.version&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,e=>e.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,e=>e.toJSON())),e}}uX.CLASS_NAME="TBSRequest";let u1="signatureAlgorithm",u0="signature",u2="certs";class u3 extends y{constructor(e={}){super(),this.signatureAlgorithm=u.kd(e,u1,u3.defaultValues(u1)),this.signature=u.kd(e,u0,u3.defaultValues(u0)),u2 in e&&(this.certs=u.kd(e,u2,u3.defaultValues(u2))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case u1:return new F;case u0:return new n.Rq;case u2:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case u1:return""===t.algorithmId&&"algorithmParams"in t==!1;case u0:return t.isEqual(u3.defaultValues(e));case u2:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[F.schema(t.signatureAlgorithm||{}),new n.Rq({name:t.signature||""}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.gd({value:[new n.Fl({name:t.certs||"",value:rJ.schema({})})]})]})]})}fromSchema(e){u.gZ(e,[u1,u0,u2]);let t=n.FL(e,e,u3.schema({names:{signatureAlgorithm:{names:{blockName:u1}},signature:u0,certs:u2}}));w.assertSchema(t,this.className),this.signatureAlgorithm=new F({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,u2 in t.result&&(this.certs=Array.from(t.result.certs,e=>new rJ({schema:e})))}toSchema(){let e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.gd({value:Array.from(this.certs,e=>e.toSchema())})]})),new n.gd({value:e})}toJSON(){let e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,e=>e.toJSON())),e}}u3.CLASS_NAME="Signature";let u4="tbsRequest",u8="optionalSignature",u5=[u4,u8];class u6 extends y{constructor(e={}){super(),this.tbsRequest=u.kd(e,u4,u6.defaultValues(u4)),u8 in e&&(this.optionalSignature=u.kd(e,u8,u6.defaultValues(u8))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case u4:return new uX;case u8:return new u3;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case u4:return uX.compareWithDefault("tbs",t.tbs)&&uX.compareWithDefault("version",t.version)&&uX.compareWithDefault("requestorName",t.requestorName)&&uX.compareWithDefault("requestList",t.requestList)&&uX.compareWithDefault("requestExtensions",t.requestExtensions);case u8:return u3.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&u3.compareWithDefault("signature",t.signature)&&u3.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"OCSPRequest",value:[uX.schema(t.tbsRequest||{names:{blockName:u4}}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[u3.schema(t.optionalSignature||{names:{blockName:u8}})]})]})}fromSchema(e){u.gZ(e,u5);let t=n.FL(e,e,u6.schema());w.assertSchema(t,this.className),this.tbsRequest=new uX({schema:t.result.tbsRequest}),u8 in t.result&&(this.optionalSignature=new u3({schema:t.result.optionalSignature}))}toSchema(e=!1){let t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new n.gd({value:t})}toJSON(){let e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,a=aM(!0)){let s=new lP;await s.createForCertificate(e,t,a),this.tbsRequest.requestList.push(new uF({reqCert:s}))}async sign(e,t="SHA-1",a=aM(!0)){if(p.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw Error('Need to create "optionalSignature" field before signing');let s=await a.getSignatureParameters(e,t),r=s.parameters;this.optionalSignature.signatureAlgorithm=s.signatureAlgorithm;let i=this.tbsRequest.toSchema(!0).toBER(!1),l=await a.signWithPrivateKey(i,e,r);this.optionalSignature.signature=new n.Rq({valueHex:l})}verify(){}}u6.CLASS_NAME="OCSPRequest";let u9="responseType",u7="response",oe=[u9,u7];class ot extends y{constructor(e={}){super(),this.responseType=u.kd(e,u9,ot.defaultValues(u9)),this.response=u.kd(e,u7,ot.defaultValues(u7)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case u9:return"";case u7:return new n.lW;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case u9:return""===t;case u7:return t.isEqual(ot.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.dS({name:t.responseType||""}),new n.lW({name:t.response||""})]})}fromSchema(e){u.gZ(e,oe);let t=n.FL(e,e,ot.schema({names:{responseType:u9,response:u7}}));w.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new n.gd({value:[new n.dS({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}ot.CLASS_NAME="ResponseBytes";let oa="responseStatus",os="responseBytes";class or extends y{constructor(e={}){super(),this.responseStatus=u.kd(e,oa,or.defaultValues(oa)),os in e&&(this.responseBytes=u.kd(e,os,or.defaultValues(os))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oa:return new n.ns;case os:return new ot;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oa:return t.isEqual(or.defaultValues(e));case os:return ot.compareWithDefault("responseType",t.responseType)&&ot.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"OCSPResponse",value:[new n.ns({name:t.responseStatus||oa}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ot.schema(t.responseBytes||{names:{blockName:os}})]})]})}fromSchema(e){u.gZ(e,[oa,os]);let t=n.FL(e,e,or.schema());w.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,os in t.result&&(this.responseBytes=new ot({schema:t.result.responseBytes}))}toSchema(){let e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new n.gd({value:e})}toJSON(){let e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,a=aM(!0)){let s;let r={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==eN)return r;try{let e=n.mH(this.responseBytes.response.valueBlock.valueHexView);w.assert(e,"Basic OCSP response"),s=new uo({schema:e.result})}catch(e){return r}return s.getCertificateStatus(e,t,a)}async sign(e,t,a=aM(!0)){var s;if(this.responseBytes&&this.responseBytes.responseType===eN)return uo.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,a);throw Error(`Unknown ResponseBytes type: ${(null===(s=this.responseBytes)||void 0===s?void 0:s.responseType)||"Unknown"}`)}async verify(e=null,t=aM(!0)){var a;if(os in this==!1)throw Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===eN){let a=uo.fromBER(this.responseBytes.response.valueBlock.valueHexView);return null!==e&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw Error(`Unknown ResponseBytes type: ${(null===(a=this.responseBytes)||void 0===a?void 0:a.responseType)||"Unknown"}`)}}or.CLASS_NAME="OCSPResponse";let oi="type",on="attributes",ol="encodedValue",ou=[on];class oo extends y{constructor(e={}){super(),this.type=u.kd(e,oi,oo.defaultValues(oi)),this.attributes=u.kd(e,on,oo.defaultValues(on)),this.encodedValue=u.kd(e,ol,oo.defaultValues(ol)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oi:return -1;case on:return[];case ol:return f;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oi:return t===oo.defaultValues(oi);case on:return 0===t.length;case ol:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.BL({name:t.blockName||"",optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new n.Fl({name:t.attributes||"",value:Z.schema()})]})}fromSchema(e){u.gZ(e,ou);let t=n.FL(e,e,oo.schema({names:{tagNumber:this.type,attributes:on}}));if(w.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=l._H.toArrayBuffer(t.result.valueBeforeDecodeView),new Uint8Array(this.encodedValue)[0]=49,on in t.result==!1){if(0!==this.type)return;throw Error("Wrong structure of SignedUnsignedAttributes")}this.attributes=Array.from(t.result.attributes,e=>new Z({schema:e}))}toSchema(){if(oo.compareWithDefault(oi,this.type)||oo.compareWithDefault(on,this.attributes))throw Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(oo.compareWithDefault(oi,this.type)||oo.compareWithDefault(on,this.attributes))throw Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}oo.CLASS_NAME="SignedAndUnsignedAttributes";let oc="version",oh="digestAlgorithm",om="signedAttrs",od="signatureAlgorithm",of="signature",og="unsignedAttrs",op="SignerInfo",ow=`${op}.${oc}`,oy=`${op}.sid`,ov=`${op}.${oh}`,ok=`${op}.${om}`,oS=`${op}.${od}`,ob=`${op}.${of}`,oA=`${op}.${og}`,oN=[ow,oy,ov,ok,oS,ob,oA];class oC extends y{constructor(e={}){super(),this.version=u.kd(e,oc,oC.defaultValues(oc)),this.sid=u.kd(e,"sid",oC.defaultValues("sid")),this.digestAlgorithm=u.kd(e,oh,oC.defaultValues(oh)),om in e&&(this.signedAttrs=u.kd(e,om,oC.defaultValues(om))),this.signatureAlgorithm=u.kd(e,od,oC.defaultValues(od)),this.signature=u.kd(e,of,oC.defaultValues(of)),og in e&&(this.unsignedAttrs=u.kd(e,og,oC.defaultValues(og))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oc:return 0;case"sid":return new n.FS;case oh:return new F;case om:return new oo({type:0});case od:return new F;case of:return new n.lW;case og:return new oo({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oc:return oC.defaultValues(oc)===t;case"sid":return t instanceof n.FS;case oh:if(t instanceof F==!1)return!1;return t.isEqual(oC.defaultValues(oh));case om:return oo.compareWithDefault("type",t.type)&&oo.compareWithDefault("attributes",t.attributes)&&oo.compareWithDefault("encodedValue",t.encodedValue);case od:if(t instanceof F==!1)return!1;return t.isEqual(oC.defaultValues(od));case of:case og:return oo.compareWithDefault("type",t.type)&&oo.compareWithDefault("attributes",t.attributes)&&oo.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:op,value:[new n.jz({name:t.version||ow}),new n.GR({value:[i8.schema(t.sidSchema||{names:{blockName:oy}}),new n.GR({value:[new n.BL({optional:!0,name:t.sid||oy,idBlock:{tagClass:3,tagNumber:0},value:[new n.lW]}),new n.sG({optional:!0,name:t.sid||oy,idBlock:{tagClass:3,tagNumber:0}})]})]}),F.schema(t.digestAlgorithm||{names:{blockName:ov}}),oo.schema(t.signedAttrs||{names:{blockName:ok,tagNumber:0}}),F.schema(t.signatureAlgorithm||{names:{blockName:oS}}),new n.lW({name:t.signature||ob}),oo.schema(t.unsignedAttrs||{names:{blockName:oA,tagNumber:1}})]})}fromSchema(e){u.gZ(e,oN);let t=n.FL(e,e,oC.schema());w.assertSchema(t,this.className),this.version=t.result[ow].valueBlock.valueDec;let a=t.result[oy];1===a.idBlock.tagClass?this.sid=new i8({schema:a}):this.sid=a,this.digestAlgorithm=new F({schema:t.result[ov]}),ok in t.result&&(this.signedAttrs=new oo({type:0,schema:t.result[ok]})),this.signatureAlgorithm=new F({schema:t.result[oS]}),this.signature=t.result[ob],oA in t.result&&(this.unsignedAttrs=new oo({type:1,schema:t.result[oA]}))}toSchema(){if(oC.compareWithDefault("sid",this.sid))throw Error('Incorrectly initialized "SignerInfo" class');let e=[];return e.push(new n.jz({value:this.version})),this.sid instanceof i8?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&!1===oC.compareWithDefault(om,this.signedAttrs)&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&!1===oC.compareWithDefault(og,this.unsignedAttrs)&&e.push(this.unsignedAttrs.toSchema()),new n.gd({value:e})}toJSON(){if(oC.compareWithDefault("sid",this.sid))throw Error('Incorrectly initialized "SignerInfo" class');let e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof n.FS||(e.sid=this.sid.toJSON()),this.signedAttrs&&!1===oC.compareWithDefault(om,this.signedAttrs)&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&!1===oC.compareWithDefault(og,this.unsignedAttrs)&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}oC.CLASS_NAME="SignerInfo";let oV="version",oB="policy",oI="messageImprint",oE="serialNumber",oD="genTime",ox="ordering",oO="nonce",oP="accuracy",oL="extensions",oK="TSTInfo",oH=`${oK}.${oV}`,oR=`${oK}.${oB}`,oj=`${oK}.${oI}`,oU=`${oK}.${oE}`,oJ=`${oK}.${oD}`,oT=`${oK}.${oP}`,oF=`${oK}.${ox}`,oq=`${oK}.${oO}`,oM=`${oK}.tsa`,oW=`${oK}.${oL}`,o$=[oH,oR,oj,oU,oJ,oT,oF,oq,oM,oW];class o_ extends y{constructor(e={}){super(),this.version=u.kd(e,oV,o_.defaultValues(oV)),this.policy=u.kd(e,oB,o_.defaultValues(oB)),this.messageImprint=u.kd(e,oI,o_.defaultValues(oI)),this.serialNumber=u.kd(e,oE,o_.defaultValues(oE)),this.genTime=u.kd(e,oD,o_.defaultValues(oD)),oP in e&&(this.accuracy=u.kd(e,oP,o_.defaultValues(oP))),ox in e&&(this.ordering=u.kd(e,ox,o_.defaultValues(ox))),oO in e&&(this.nonce=u.kd(e,oO,o_.defaultValues(oO))),"tsa"in e&&(this.tsa=u.kd(e,"tsa",o_.defaultValues("tsa"))),oL in e&&(this.extensions=u.kd(e,oL,o_.defaultValues(oL))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oV:return 0;case oB:return"";case oI:return new uj;case oE:return new n.jz;case oD:return new Date(0,0,0);case oP:return new H;case ox:return!1;case oO:return new n.jz;case"tsa":return new I;case oL:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oV:case oB:case oD:case ox:return t===o_.defaultValues(ox);case oI:return uj.compareWithDefault(uK,t.hashAlgorithm)&&uj.compareWithDefault(uH,t.hashedMessage);case oE:case oO:return t.isEqual(o_.defaultValues(oO));case oP:return H.compareWithDefault(P,t.seconds)&&H.compareWithDefault(L,t.millis)&&H.compareWithDefault(K,t.micros);case"tsa":return I.compareWithDefault(V,t.type)&&I.compareWithDefault(B,t.value);case oL:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||oK,value:[new n.jz({name:t.version||oH}),new n.dS({name:t.policy||oR}),uj.schema(t.messageImprint||{names:{blockName:oj}}),new n.jz({name:t.serialNumber||oU}),new n.O_({name:t.genTime||oJ}),H.schema(t.accuracy||{names:{blockName:oT}}),new n.v8({name:t.ordering||oF,optional:!0}),new n.jz({name:t.nonce||oq,optional:!0}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[I.schema(t.tsa||{names:{blockName:oM}})]}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new n.Fl({name:t.extensions||oW,value:sc.schema(t.extension||{})})]})]})}fromSchema(e){u.gZ(e,o$);let t=n.FL(e,e,o_.schema());w.assertSchema(t,this.className),this.version=t.result[oH].valueBlock.valueDec,this.policy=t.result[oR].valueBlock.toString(),this.messageImprint=new uj({schema:t.result[oj]}),this.serialNumber=t.result[oU],this.genTime=t.result[oJ].toDate(),oT in t.result&&(this.accuracy=new H({schema:t.result[oT]})),oF in t.result&&(this.ordering=t.result[oF].valueBlock.value),oq in t.result&&(this.nonce=t.result[oq]),oM in t.result&&(this.tsa=new I({schema:t.result[oM]})),oW in t.result&&(this.extensions=Array.from(t.result[oW],e=>new sc({schema:e})))}toSchema(){let e=[];return e.push(new n.jz({value:this.version})),e.push(new n.dS({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new n.O_({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),void 0!==this.ordering&&e.push(new n.v8({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){let e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),void 0!==this.ordering&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,e=>e.toJSON())),e}async verify(e,t=aM(!0)){if(!e.data)throw Error('"data" is a mandatory attribute for TST_INFO verification');let a=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw Error("Generation time for TSTInfo object is more than notAfter value");let s=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),r=await t.digest(s.name,new Uint8Array(a));return l._H.isEqual(r,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}o_.CLASS_NAME="TSTInfo";let oz="version",oZ="digestAlgorithms",oG="encapContentInfo",oQ="certificates",oY="crls",oX="signerInfos",o1="ocsps",o0="SignedData",o2=`${o0}.${oz}`,o3=`${o0}.${oZ}`,o4=`${o0}.${oG}`,o8=`${o0}.${oQ}`,o5=`${o0}.${oY}`,o6=`${o0}.${oX}`,o9=[o2,o3,o4,o8,o5,o6];class o7 extends Error{constructor({message:e,code:t=0,date:a=new Date,signatureVerified:s=null,signerCertificate:r=null,signerCertificateVerified:i=null,timestampSerial:n=null,certificatePath:l=[]}){super(e),this.name="SignedDataVerifyError",this.date=a,this.code=t,this.timestampSerial=n,this.signatureVerified=s,this.signerCertificate=r,this.signerCertificateVerified=i,this.certificatePath=l}}class ce extends y{constructor(e={}){super(),this.version=u.kd(e,oz,ce.defaultValues(oz)),this.digestAlgorithms=u.kd(e,oZ,ce.defaultValues(oZ)),this.encapContentInfo=u.kd(e,oG,ce.defaultValues(oG)),oQ in e&&(this.certificates=u.kd(e,oQ,ce.defaultValues(oQ))),oY in e&&(this.crls=u.kd(e,oY,ce.defaultValues(oY))),o1 in e&&(this.ocsps=u.kd(e,o1,ce.defaultValues(o1))),this.signerInfos=u.kd(e,oX,ce.defaultValues(oX)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oz:return 0;case oZ:return[];case oG:return new uD;case oQ:case oY:case o1:case oX:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oz:return t===ce.defaultValues(oz);case oG:return uD.compareWithDefault("eContentType",t.eContentType)&&uD.compareWithDefault("eContent",t.eContent);case oZ:case oQ:case oY:case o1:case oX:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return void 0===t.optional&&(t.optional=!1),new n.gd({name:t.blockName||o0,optional:t.optional,value:[new n.jz({name:t.version||o2}),new n.NZ({value:[new n.Fl({name:t.digestAlgorithms||o3,value:F.schema()})]}),uD.schema(t.encapContentInfo||{names:{blockName:o4}}),new n.BL({name:t.certificates||o8,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:iq.schema().valueBlock.value}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:iQ.schema(t.crls||{names:{crls:o5}}).valueBlock.value}),new n.NZ({value:[new n.Fl({name:t.signerInfos||o6,value:oC.schema()})]})]})}fromSchema(e){u.gZ(e,o9);let t=n.FL(e,e,ce.schema());if(w.assertSchema(t,this.className),this.version=t.result[o2].valueBlock.valueDec,o3 in t.result&&(this.digestAlgorithms=Array.from(t.result[o3],e=>new F({schema:e}))),this.encapContentInfo=new uD({schema:t.result[o4]}),o8 in t.result){let e=new iq({schema:new n.NZ({value:t.result[o8].valueBlock.value})});this.certificates=e.certificates.slice(0)}o5 in t.result&&(this.crls=Array.from(t.result[o5],e=>1===e.idBlock.tagClass?new iu({schema:e}):(e.idBlock.tagClass=1,e.idBlock.tagNumber=16,new i_({schema:e})))),o6 in t.result&&(this.signerInfos=Array.from(t.result[o6],e=>new oC({schema:e})))}toSchema(e=!1){let t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(e=>e instanceof iJ)||this.crls&&this.crls.length&&this.crls.some(e=>e instanceof i_)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(e=>e instanceof rs)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(e=>e instanceof sK)||this.signerInfos.some(e=>3===e.version)||this.encapContentInfo.eContentType!==ce.ID_DATA?this.version=3:this.version=1,t.push(new n.jz({value:this.version})),t.push(new n.NZ({value:Array.from(this.digestAlgorithms,e=>e.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){let e=new iq({certificates:this.certificates}).toSchema();t.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:e.valueBlock.value}))}return this.crls&&t.push(new n.BL({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,t=>{if(t instanceof i_){let e=t.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}return t.toSchema(e)})})),t.push(new n.NZ({value:Array.from(this.signerInfos,e=>e.toSchema())})),new n.gd({value:t})}toJSON(){let e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,e=>e.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,e=>e.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,e=>e.toJSON())),this.crls&&(e.crls=Array.from(this.crls,e=>e.toJSON())),e}async verify({signer:e=-1,data:t=f,trustedCerts:a=[],checkDate:s=new Date,checkChain:r=!1,passedWhenNotRevValues:i=!1,extendedMode:n=!1,findOrigin:l=null,findIssuer:o=null}={},c=aM(!0)){let h=null,m=null;try{let d=f,g="",p=[],w=this.signerInfos[e];if(!w)throw new o7({date:s,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new o7({date:s,code:2,message:"No certificates attached to this signed data"});if(w.sid instanceof i8){for(let e of this.certificates)if(e instanceof rJ&&e.issuer.isEqual(w.sid.issuer)&&e.serialNumber.isEqual(w.sid.serialNumber)){h=e;break}}else{let e=w.sid,t=e.idBlock.isConstructed?e.valueBlock.value[0].valueBlock.valueHex:e.valueBlock.valueHex;for(let e of this.certificates){if(!(e instanceof rJ))continue;let a=await c.digest({name:"sha-1"},e.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(u.JQ(a,t)){h=e;break}}}if(!h)throw new o7({date:s,code:3,message:"Unable to find signer certificate"});if("1.2.840.113549.1.9.16.1.4"===this.encapContentInfo.eContentType){let e;if(!this.encapContentInfo.eContent)throw new o7({date:s,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:h,timestampSerial:m,signerCertificateVerified:!0});try{e=o_.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch(e){throw new o7({date:s,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:h,timestampSerial:m,signerCertificateVerified:!0})}if(s=e.genTime,m=e.serialNumber.valueBlock.valueHexView.slice(),0===t.byteLength)throw new o7({date:s,code:4,message:"Missed detached data input array"});if(!await e.verify({data:t},c))throw new o7({date:s,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:h,timestampSerial:m,signerCertificateVerified:!0})}if(r){let e=this.certificates.filter(e=>e instanceof rJ&&!!rT(e,h)),t={checkDate:s,certs:e,trustedCerts:a};o&&(t.findIssuer=o),l&&(t.findOrigin=l);let r=new l9(t);if(r.certs.push(h),this.crls)for(let e of this.crls)"thisUpdate"in e?r.crls.push(e):e.otherRevInfoFormat===eN&&r.ocsps.push(new uo({schema:e.otherRevInfo}));this.ocsps&&r.ocsps.push(...this.ocsps);let n=await r.verify({passedWhenNotRevValues:i},c).catch(e=>{throw new o7({date:s,code:5,message:`Validation of signer's certificate failed with error: ${e instanceof Object?e.resultMessage:e}`,signerCertificate:h,signerCertificateVerified:!1})});if(n.certificatePath&&(p=n.certificatePath),!n.result)throw new o7({date:s,code:5,message:`Validation of signer's certificate failed: ${n.resultMessage}`,signerCertificate:h,signerCertificateVerified:!1})}let y=c.getAlgorithmByOID(w.digestAlgorithm.algorithmId);if(!("name"in y))throw new o7({date:s,code:7,message:`Unsupported signature algorithm: ${w.digestAlgorithm.algorithmId}`,signerCertificate:h,signerCertificateVerified:!0});g=y.name;let v=this.encapContentInfo.eContent;if(v)t=1===v.idBlock.tagClass&&4===v.idBlock.tagNumber?v.getValue():v.valueBlock.valueBeforeDecodeView;else if(0===t.byteLength)throw new o7({date:s,code:8,message:"Missed detached data input array",signerCertificate:h,signerCertificateVerified:!0});if(w.signedAttrs){let e=!1,t=!1;for(let a of w.signedAttrs.attributes)if("1.2.840.113549.1.9.3"===a.type&&(e=!0),"1.2.840.113549.1.9.4"===a.type&&(t=!0,d=a.values[0].valueBlock.valueHex),e&&t)break;if(!1===e)throw new o7({date:s,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:h,signerCertificateVerified:!0});if(!1===t)throw new o7({date:s,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:h,signerCertificateVerified:!0})}if(w.signedAttrs){let e=await c.digest(g,new Uint8Array(t));if(!u.JQ(e,d))throw new o7({date:s,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:h,timestampSerial:m,signerCertificateVerified:!0});t=w.signedAttrs.encodedValue}let k="1.2.840.113549.1.1.1"===w.signatureAlgorithm.algorithmId?await c.verifyWithPublicKey(t,w.signature,h.subjectPublicKeyInfo,w.signatureAlgorithm,g):await c.verifyWithPublicKey(t,w.signature,h.subjectPublicKeyInfo,w.signatureAlgorithm);if(n)return{date:s,code:14,message:"",signatureVerified:k,signerCertificate:h,timestampSerial:m,signerCertificateVerified:!0,certificatePath:p};return k}catch(e){if(e instanceof o7)throw e;throw new o7({date:s,code:15,message:`Error during verification: ${e instanceof Error?e.message:e}`,signatureVerified:null,signerCertificate:h,timestampSerial:m,signerCertificateVerified:!0})}}async sign(e,t,a="SHA-1",s=f,r=aM(!0)){var i;if(!e)throw Error("Need to provide a private key for signing");let u=this.signerInfos[t];if(!u)throw RangeError("SignerInfo index is out of range");!(null===(i=u.signedAttrs)||void 0===i?void 0:i.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(a=e.algorithm.hash.name);let o=r.getOIDByAlgorithm({name:a},!0,"hashAlgorithm");0===this.digestAlgorithms.filter(e=>e.algorithmId===o).length&&this.digestAlgorithms.push(new F({algorithmId:o,algorithmParams:new n.Uv})),u.digestAlgorithm=new F({algorithmId:o,algorithmParams:new n.Uv});let c=await r.getSignatureParameters(e,a),h=c.parameters;if(u.signatureAlgorithm=c.signatureAlgorithm,u.signedAttrs)0!==u.signedAttrs.encodedValue.byteLength?s=u.signedAttrs.encodedValue:(s=u.signedAttrs.toSchema().toBER(),l._H.toUint8Array(s)[0]=49);else{let e=this.encapContentInfo.eContent;if(e)s=1===e.idBlock.tagClass&&4===e.idBlock.tagNumber?e.getValue():e.valueBlock.valueBeforeDecodeView;else if(0===s.byteLength)throw Error("Missed detached data input array")}let m=await r.signWithPrivateKey(s,e,h);u.signature=new n.lW({valueHex:m})}}ce.CLASS_NAME="SignedData",ce.ID_DATA=ew;let ct="version",ca="authSafe",cs="macData",cr="parsedValue",ci=[ct,ca,cs];class cn extends y{constructor(e={}){super(),this.version=u.kd(e,ct,cn.defaultValues(ct)),this.authSafe=u.kd(e,ca,cn.defaultValues(ca)),cs in e&&(this.macData=u.kd(e,cs,cn.defaultValues(cs))),cr in e&&(this.parsedValue=u.kd(e,cr,cn.defaultValues(cr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ct:return 3;case ca:return new rl;case cs:return new uL;case cr:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ct:return t===cn.defaultValues(e);case ca:return rl.compareWithDefault("contentType",t.contentType)&&rl.compareWithDefault("content",t.content);case cs:return uL.compareWithDefault("mac",t.mac)&&uL.compareWithDefault("macSalt",t.macSalt)&&uL.compareWithDefault("iterations",t.iterations);case cr:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.version||ct}),rl.schema(t.authSafe||{names:{blockName:ca}}),uL.schema(t.macData||{names:{blockName:cs,optional:!0}})]})}fromSchema(e){u.gZ(e,ci);let t=n.FL(e,e,cn.schema({names:{version:ct,authSafe:{names:{blockName:ca}},macData:{names:{blockName:cs}}}}));w.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new rl({schema:t.result.authSafe}),cs in t.result&&(this.macData=new uL({schema:t.result.macData}))}toSchema(){let e=[new n.jz({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new n.gd({value:e})}toJSON(){let e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=aM(!0)){if(g.assert(e,"parameters","object"),!this.parsedValue)throw Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(p.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),p.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new p("iterations");p.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),p.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),p.assertEmpty(e.password,"password");let a=new ArrayBuffer(64),s=new Uint8Array(a);t.getRandomValues(s);let r=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new rl({contentType:rl.DATA,content:new n.lW({valueHex:r})});let i=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:a,iterationCount:e.iterations,contentToStamp:r});this.macData=new uL({mac:new uV({digestAlgorithm:new F({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new n.lW({valueHex:i})}),macSalt:new n.lW({valueHex:a}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new p("signingCertificate");p.assertEmpty(e.privateKey,"privateKey"),p.assertEmpty(e.hashAlgorithm,"hashAlgorithm");let a=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),s=new ce({version:1,encapContentInfo:new uD({eContentType:"1.2.840.113549.1.7.1",eContent:new n.lW({valueHex:a})}),certificates:[e.signingCertificate]}),r=await t.digest({name:e.hashAlgorithm},new Uint8Array(a)),i=[];i.push(new Z({type:"1.2.840.113549.1.9.3",values:[new n.dS({value:"1.2.840.113549.1.7.1"})]})),i.push(new Z({type:"1.2.840.113549.1.9.5",values:[new n.O6({valueDate:new Date})]})),i.push(new Z({type:"1.2.840.113549.1.9.4",values:[new n.lW({valueHex:r})]})),s.signerInfos.push(new oC({version:1,sid:new i8({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new oo({type:0,attributes:i})})),await s.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new rl({contentType:"1.2.840.113549.1.7.2",content:s.toSchema(!0)})}break;default:throw Error(`Parameter "integrityMode" has unknown value: ${this.parsedValue.integrityMode}`)}}async parseInternalValues(e,t=aM(!0)){switch(g.assert(e,"parameters","object"),void 0===e.checkIntegrity&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case rl.DATA:{p.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,g.assert(this.authSafe.content,"authSafe.content",n.lW);let a=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=lB.fromBER(a),e.checkIntegrity){if(!this.macData)throw Error('Absent "macData" value, can not check PKCS#12 data integrity');let s=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:s.name,salt:l._H.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:a,signatureToVerify:l._H.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw Error("Integrity for the PKCS#12 data is broken!")}}break;case rl.SIGNED_DATA:{this.parsedValue.integrityMode=1;let e=new ce({schema:this.authSafe.content}),a=e.encapContentInfo.eContent;p.assert(a,"eContent","cmsSigned.encapContentInfo"),g.assert(a,"eContent",n.lW);let s=a.getValue();if(this.parsedValue.authenticatedSafe=lB.fromBER(s),!await e.verify({signer:0,checkChain:!1},t))throw Error("Integrity for the PKCS#12 data is broken!")}break;default:throw Error(`Incorrect value for "this.authSafe.contentType": ${this.authSafe.contentType}`)}}}cn.CLASS_NAME="PFX";let cl="status",cu="statusStrings",co="failInfo",cc=[cl,cu,co];!function(e){e[e.granted=0]="granted",e[e.grantedWithMods=1]="grantedWithMods",e[e.rejection=2]="rejection",e[e.waiting=3]="waiting",e[e.revocationWarning=4]="revocationWarning",e[e.revocationNotification=5]="revocationNotification"}(i||(i={}));class ch extends y{constructor(e={}){super(),this.status=u.kd(e,cl,ch.defaultValues(cl)),cu in e&&(this.statusStrings=u.kd(e,cu,ch.defaultValues(cu))),co in e&&(this.failInfo=u.kd(e,co,ch.defaultValues(co))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cl:return 2;case cu:return[];case co:return new n.Rq;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cl:return t===ch.defaultValues(e);case cu:return 0===t.length;case co:return t.isEqual(ch.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||"",value:[new n.jz({name:t.status||""}),new n.gd({optional:!0,value:[new n.Fl({name:t.statusStrings||"",value:new n.Jn})]}),new n.Rq({name:t.failInfo||"",optional:!0})]})}fromSchema(e){u.gZ(e,cc);let t=n.FL(e,e,ch.schema({names:{status:cl,statusStrings:cu,failInfo:co}}));w.assertSchema(t,this.className);let a=t.result.status;if(!0===a.valueBlock.isHexOnly||a.valueBlock.valueDec<0||a.valueBlock.valueDec>5)throw Error('PKIStatusInfo "status" has invalid value');this.status=a.valueBlock.valueDec,cu in t.result&&(this.statusStrings=t.result.statusStrings),co in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){let e=[];return e.push(new n.jz({value:this.status})),this.statusStrings&&e.push(new n.gd({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new n.gd({value:e})}toJSON(){let e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,e=>e.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}ch.CLASS_NAME="PKIStatusInfo";let cm="version",cd="messageImprint",cf="reqPolicy",cg="nonce",cp="certReq",cw="extensions",cy="TimeStampReq",cv=`${cy}.${cm}`,ck=`${cy}.${cd}`,cS=`${cy}.${cf}`,cb=`${cy}.${cg}`,cA=`${cy}.${cp}`,cN=`${cy}.${cw}`,cC=[cv,ck,cS,cb,cA,cN];class cV extends y{constructor(e={}){super(),this.version=u.kd(e,cm,cV.defaultValues(cm)),this.messageImprint=u.kd(e,cd,cV.defaultValues(cd)),cf in e&&(this.reqPolicy=u.kd(e,cf,cV.defaultValues(cf))),cg in e&&(this.nonce=u.kd(e,cg,cV.defaultValues(cg))),cp in e&&(this.certReq=u.kd(e,cp,cV.defaultValues(cp))),cw in e&&(this.extensions=u.kd(e,cw,cV.defaultValues(cw))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cm:return 0;case cd:return new uj;case cf:return"";case cg:return new n.jz;case cp:return!1;case cw:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cm:case cf:case cp:return t===cV.defaultValues(e);case cd:return uj.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&uj.compareWithDefault("hashedMessage",t.hashedMessage);case cg:return t.isEqual(cV.defaultValues(e));case cw:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||cy,value:[new n.jz({name:t.version||cv}),uj.schema(t.messageImprint||{names:{blockName:ck}}),new n.dS({name:t.reqPolicy||cS,optional:!0}),new n.jz({name:t.nonce||cb,optional:!0}),new n.v8({name:t.certReq||cA,optional:!0}),new n.BL({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new n.Fl({name:t.extensions||cN,value:sc.schema()})]})]})}fromSchema(e){u.gZ(e,cC);let t=n.FL(e,e,cV.schema());w.assertSchema(t,this.className),this.version=t.result[cv].valueBlock.valueDec,this.messageImprint=new uj({schema:t.result[ck]}),cS in t.result&&(this.reqPolicy=t.result[cS].valueBlock.toString()),cb in t.result&&(this.nonce=t.result[cb]),cA in t.result&&(this.certReq=t.result[cA].valueBlock.value),cN in t.result&&(this.extensions=Array.from(t.result[cN],e=>new sc({schema:e})))}toSchema(){let e=[];return e.push(new n.jz({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new n.dS({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),cp in this&&!1===cV.compareWithDefault(cp,this.certReq)&&e.push(new n.v8({value:this.certReq})),this.extensions&&e.push(new n.BL({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,e=>e.toSchema())})),new n.gd({value:e})}toJSON(){let e={version:this.version,messageImprint:this.messageImprint.toJSON()};return void 0!==this.reqPolicy&&(e.reqPolicy=this.reqPolicy),void 0!==this.nonce&&(e.nonce=this.nonce.toJSON()),void 0!==this.certReq&&!1===cV.compareWithDefault(cp,this.certReq)&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,e=>e.toJSON())),e}}cV.CLASS_NAME="TimeStampReq";let cB="status",cI="timeStampToken",cE="TimeStampResp",cD=`${cE}.${cB}`,cx=`${cE}.${cI}`,cO=[cD,cx];class cP extends y{constructor(e={}){super(),this.status=u.kd(e,cB,cP.defaultValues(cB)),cI in e&&(this.timeStampToken=u.kd(e,cI,cP.defaultValues(cI))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cB:return new ch;case cI:return new rl;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cB:return ch.compareWithDefault(cB,t.status)&&"statusStrings"in t==!1&&"failInfo"in t==!1;case cI:return""===t.contentType&&t.content instanceof n.FS;default:return super.defaultValues(e)}}static schema(e={}){let t=u.kd(e,"names",{});return new n.gd({name:t.blockName||cE,value:[ch.schema(t.status||{names:{blockName:cD}}),rl.schema(t.timeStampToken||{names:{blockName:cx,optional:!0}})]})}fromSchema(e){u.gZ(e,cO);let t=n.FL(e,e,cP.schema());w.assertSchema(t,this.className),this.status=new ch({schema:t.result[cD]}),cx in t.result&&(this.timeStampToken=new rl({schema:t.result[cx]}))}toSchema(){let e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new n.gd({value:e})}toJSON(){let e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,a=aM(!0)){return this.assertContentType(),new ce({schema:this.timeStampToken.content}).sign(e,0,t,void 0,a)}async verify(e={signer:0,trustedCerts:[],data:f},t=aM(!0)){return this.assertContentType(),new ce({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==ey)throw Error(`Wrong format of timeStampToken: ${this.timeStampToken.contentType}`)}}cP.CLASS_NAME="TimeStampResp",!function(){if("undefined"!=typeof self){if("crypto"in self){let e="webcrypto";"webkitSubtle"in self.crypto&&(e="safari"),aq(e,new aJ({name:e,crypto:crypto}))}}else if("undefined"!=typeof crypto&&"webcrypto"in crypto){let e="NodeJS ^15";aq(e,new aJ({name:e,crypto:crypto.webcrypto}))}}()}}]);
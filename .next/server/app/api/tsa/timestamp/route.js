(()=>{var e={};e.id=467,e.ids=[467],e.modules={55:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>T,serverHooks:()=>g,workAsyncStorage:()=>_,workUnitAsyncStorage:()=>R});var s={};r.r(s),r.d(s,{POST:()=>m,runtime:()=>f});var o=r(6559),n=r(8088),a=r(7719),i=r(2190),p=r(5037);async function u(e,t={}){let{timeoutMs:r=1e4,...s}=t,o=new AbortController,n=setTimeout(()=>o.abort(),r);try{return await fetch(e,{...s,signal:o.signal})}finally{clearTimeout(n)}}var l=r(8504),c=r(3871),d=r(5740);let f="nodejs";async function m(e){let t=(0,l.a)("tsa_"),r=e.headers.get("x-forwarded-for")||"unknown";if(!(0,c.i)({key:`tsa:${r}`,capacity:30,refillPerSec:.5}).ok)return i.NextResponse.json({error:"Rate limit exceeded",reqId:t},{status:429});let s=(0,p._)();if(!s.TSA_URL)return i.NextResponse.json({error:"TSA not configured in preview",reqId:t},{status:501});if(Number(e.headers.get("content-length")||"0")>0xa00000)return i.NextResponse.json({error:"Payload too large",reqId:t},{status:413});let o=e.headers.get("content-type")||"";if(!["application/timestamp-query","application/octet-stream"].includes(o))return i.NextResponse.json({error:"Unsupported content-type",reqId:t},{status:415});let n=await e.arrayBuffer();try{let e=await u(s.TSA_URL,{method:"POST",headers:{"content-type":o},body:n,timeoutMs:1e4}),t=await e.arrayBuffer();return new i.NextResponse(t,{status:e.status,headers:{"content-type":e.headers.get("content-type")||"application/octet-stream"}})}catch(r){let e=r instanceof Error?r.message:String(r);return d.v.error("tsa proxy error",{reqId:t,error:e}),i.NextResponse.json({error:"TSA proxy error",reqId:t},{status:502})}}let T=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/tsa/timestamp/route",pathname:"/api/tsa/timestamp",filename:"route",bundlePath:"app/api/tsa/timestamp/route"},resolvedPagePath:"/Users/jeremiah/Desktop/c2pa tool/app/api/tsa/timestamp/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:_,workUnitAsyncStorage:R,serverHooks:g}=T;function x(){return(0,a.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:R})}},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3871:(e,t,r)=>{"use strict";r.d(t,{i:()=>o});let s=new Map;function o(e){let t=Date.now(),{key:r,capacity:o,refillPerSec:n}=e,a=1e3/Math.max(n,1),i=s.get(r)||{tokens:o,lastRefill:t};if(t-i.lastRefill>=a){let e=Math.floor((t-i.lastRefill)/a);i.tokens=Math.min(o,i.tokens+e),i.lastRefill=t}return i.tokens>0?(i.tokens-=1,s.set(r,i),{ok:!0}):(s.set(r,i),{ok:!1})}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5037:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});var s=r(209);let o=s.Ik({ACCOUNT_ID:s.Yj().min(1).optional(),AUTH_TOKEN:s.Yj().min(1).optional(),API_BASE:s.Yj().url().default("https://api.c2patool.io"),TSA_URL:s.Yj().url().optional(),CERT_PROFILE_ID:s.Yj().optional(),CONFORMING_PRODUCT_ID:s.Yj().optional()});function n(){return o.parse({ACCOUNT_ID:process.env.ACCOUNT_ID,AUTH_TOKEN:process.env.AUTH_TOKEN,API_BASE:process.env.API_BASE,TSA_URL:process.env.TSA_URL||"https://api.c2patool.io/v1/timestamp",CERT_PROFILE_ID:process.env.CERT_PROFILE_ID,CONFORMING_PRODUCT_ID:process.env.CONFORMING_PRODUCT_ID})}},5740:(e,t,r)=>{"use strict";function s(e){if(e)return e.length<=8?"***":e.slice(0,4)+"***"+e.slice(-2)}function o(e,t,r={}){let n={level:e,msg:t,...r,t:new Date().toISOString()};"token"in n&&"string"==typeof n.token&&(n.token=s(n.token)),"AUTH_TOKEN"in n&&"string"==typeof n.AUTH_TOKEN&&(n.AUTH_TOKEN=s(n.AUTH_TOKEN));try{console.log(JSON.stringify(n))}catch{console.log(e.toUpperCase(),t,r)}}r.d(t,{v:()=>n});let n={debug:(e,t)=>o("debug",e,t),info:(e,t)=>o("info",e,t),warn:(e,t)=>o("warn",e,t),error:(e,t)=>o("error",e,t)}},6487:()=>{},8335:()=>{},8504:(e,t,r)=>{"use strict";function s(e="req_"){return e+Math.random().toString(36).slice(2)}r.d(t,{a:()=>s})},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,209],()=>r(55));module.exports=s})();
(()=>{var e={};e.id=199,e.ids=[199],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3871:(e,t,r)=>{"use strict";r.d(t,{i:()=>i});let s=new Map;function i(e){let t=Date.now(),{key:r,capacity:i,refillPerSec:o}=e,n=1e3/Math.max(o,1),a=s.get(r)||{tokens:i,lastRefill:t};if(t-a.lastRefill>=n){let e=Math.floor((t-a.lastRefill)/n);a.tokens=Math.min(i,a.tokens+e),a.lastRefill=t}return a.tokens>0?(a.tokens-=1,s.set(r,a),{ok:!0}):(s.set(r,a),{ok:!1})}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5037:(e,t,r)=>{"use strict";r.d(t,{_:()=>o});var s=r(209);let i=s.Ik({ACCOUNT_ID:s.Yj().min(1).optional(),AUTH_TOKEN:s.Yj().min(1).optional(),API_BASE:s.Yj().url().default("https://api.c2patool.io"),TSA_URL:s.Yj().url().optional(),CERT_PROFILE_ID:s.Yj().optional(),CONFORMING_PRODUCT_ID:s.Yj().optional()});function o(){return i.parse({ACCOUNT_ID:process.env.ACCOUNT_ID,AUTH_TOKEN:process.env.AUTH_TOKEN,API_BASE:process.env.API_BASE,TSA_URL:process.env.TSA_URL||"https://api.c2patool.io/v1/timestamp",CERT_PROFILE_ID:process.env.CERT_PROFILE_ID,CONFORMING_PRODUCT_ID:process.env.CONFORMING_PRODUCT_ID})}},5740:(e,t,r)=>{"use strict";function s(e){if(e)return e.length<=8?"***":e.slice(0,4)+"***"+e.slice(-2)}function i(e,t,r={}){let o={level:e,msg:t,...r,t:new Date().toISOString()};"token"in o&&"string"==typeof o.token&&(o.token=s(o.token)),"AUTH_TOKEN"in o&&"string"==typeof o.AUTH_TOKEN&&(o.AUTH_TOKEN=s(o.AUTH_TOKEN));try{console.log(JSON.stringify(o))}catch{console.log(e.toUpperCase(),t,r)}}r.d(t,{v:()=>o});let o={debug:(e,t)=>i("debug",e,t),info:(e,t)=>i("info",e,t),warn:(e,t)=>i("warn",e,t),error:(e,t)=>i("error",e,t)}},6188:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>T,routeModule:()=>_,serverHooks:()=>C,workAsyncStorage:()=>I,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>g});var i=r(6559),o=r(8088),n=r(7719),a=r(2190),c=r(209),u=r(5037),p=r(5740),l=r(8504),f=r(3871);let d=c.Ik({csr:c.Yj().min(1),profileId:c.Yj().optional(),conformingProductId:c.Yj().optional(),subject:c.Ik({CN:c.Yj().optional(),O:c.Yj().optional(),C:c.Yj().optional()}).optional()});async function g(e){let t=(0,l.a)();try{let r=(0,u._)(),s=e.headers.get("x-forwarded-for")||"unknown";if(!(0,f.i)({key:`cert:${s}`,capacity:30,refillPerSec:.5}).ok)return a.NextResponse.json({error:"Rate limit exceeded",reqId:t},{status:429});let i=await e.json().catch(()=>({})),o=d.safeParse(i);if(!o.success)return a.NextResponse.json({error:"Invalid request",reqId:t},{status:400});if(!r.AUTH_TOKEN){let e=`-----BEGIN CERTIFICATE-----
${btoa("preview cert")}
-----END CERTIFICATE-----`;return p.v.info("Preview stub certificate returned (no secrets configured)",{reqId:t}),a.NextResponse.json({certificatePem:e,requestId:t})}try{let e={certificate_profile_id:o.data.profileId||r.CERT_PROFILE_ID,certificate_signing_request:o.data.csr,conforming_product_id:o.data.conformingProductId||r.CONFORMING_PRODUCT_ID};o.data.subject&&(o.data.subject.CN||o.data.subject.O||o.data.subject.C)?e.experimental=o.data.subject:e.experimental={CN:"C2PA Test User"},p.v.info("Calling SSL.com certificate API",{reqId:t,profileId:e.certificate_profile_id,hasConformingProductId:!!e.conforming_product_id,conformingProductId:e.conforming_product_id,requestBody:e});let s=await fetch(`${r.API_BASE}/api/v1/certificate-requests`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${r.AUTH_TOKEN}`},body:JSON.stringify(e)}),i=await s.json().catch(()=>({}));if(!s.ok)return p.v.warn("Issuance API error",{reqId:t,status:s.status,error:i?.error||i?.message||JSON.stringify(i),fullResponse:i,sentData:{profile:e.certificate_profile_id,hasCSR:!!e.certificate_signing_request,csrLength:e.certificate_signing_request?.length,csrPreview:e.certificate_signing_request?.slice(0,100),hasSubject:!!e.experimental,subject:e.experimental}}),a.NextResponse.json({error:i?.error||i?.message||"Issuance failed",detail:JSON.stringify(i).slice(0,500),reqId:t},{status:s.status});let n=i.certificates?.[0];p.v.info("Certificate API success",{reqId:t,responseKeys:Object.keys(i),hasCertificatePem:!!i.certificatePem,hasCertificate:!!i.certificate,hasCertificates:!!i.certificates,certificatesLength:Array.isArray(i.certificates)?i.certificates.length:0,firstCertType:typeof n,firstCertKeys:n&&"object"==typeof n?Object.keys(n):null,firstCertPreview:"string"==typeof n?n.slice(0,50):JSON.stringify(n).slice(0,100)});let c=i.certificatePem;if(!c&&i.certificates&&Array.isArray(i.certificates)&&i.certificates.length>0){let e=i.certificates[0];"string"==typeof e?c=e:e&&"object"==typeof e&&(c=e.pem||e.certificate||e.certificatePem||e.data)}if(!c)return p.v.error("No certificate found in API response",{reqId:t,responseKeys:Object.keys(i),firstCert:n}),a.NextResponse.json({error:"No certificate in response",reqId:t},{status:500});return c=function(e){let t=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),r=(t=t.trim()).match(/-----BEGIN CERTIFICATE-----[\s\S]*?-----END CERTIFICATE-----/g);return r&&0!==r.length?r[0].trim():t}(c),p.v.info("Returning cleaned certificate",{reqId:t,certLength:c.length,certPreview:c.slice(0,150)}),a.NextResponse.json({certificatePem:c,requestId:t,meta:i.meta})}catch(e){return p.v.error("Issuance forward error",{reqId:t,error:e?.message||String(e)}),a.NextResponse.json({error:"Upstream error",reqId:t},{status:502})}}catch(r){let e=r instanceof Error?r.message:String(r);return p.v.error("cert-requests error",{reqId:t,error:e}),a.NextResponse.json({error:"Server error",reqId:t},{status:500})}}let _=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/cert-requests/route",pathname:"/api/cert-requests",filename:"route",bundlePath:"app/api/cert-requests/route"},resolvedPagePath:"/Users/jeremiah/Desktop/c2pa tool/app/api/cert-requests/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:I,workUnitAsyncStorage:m,serverHooks:C}=_;function T(){return(0,n.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:m})}},6487:()=>{},8335:()=>{},8504:(e,t,r)=>{"use strict";function s(e="req_"){return e+Math.random().toString(36).slice(2)}r.d(t,{a:()=>s})},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,209],()=>r(6188));module.exports=s})();
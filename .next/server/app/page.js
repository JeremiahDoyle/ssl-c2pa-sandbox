(()=>{var e={};e.id=974,e.ids=[974],e.modules={597:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/jeremiah/Desktop/c2pa tool/app/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/jeremiah/Desktop/c2pa tool/app/page.tsx","default")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1261:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{default:function(){return o},getImageProps:function(){return l}});let a=s(4985),r=s(4953),i=s(6533),n=a._(s(1933));function l(e){let{props:t}=(0,r.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,s]of Object.entries(t))void 0===s&&delete t[e];return{props:t}}let o=i.Image},2380:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,6346,23)),Promise.resolve().then(s.t.bind(s,7924,23)),Promise.resolve().then(s.t.bind(s,5656,23)),Promise.resolve().then(s.t.bind(s,2480,23)),Promise.resolve().then(s.t.bind(s,8243,23)),Promise.resolve().then(s.t.bind(s,8827,23)),Promise.resolve().then(s.t.bind(s,2763,23)),Promise.resolve().then(s.t.bind(s,7173,23))},2704:()=>{},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},3964:(e,t,s)=>{"use strict";let a;s.r(t),s.d(t,{default:()=>fB});var r,i,n,l,o,u,c,h,m,d=s(687),f=s(3210),g=s(1261),p=s.n(g),y=s(7590);function v({title:e,children:t}){return(0,d.jsxs)("section",{className:"card",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold",children:e}),(0,d.jsx)("div",{className:"mt-3",children:t})]})}function w({onFile:e,accept:t="image/jpeg,image/png,image/webp",maxBytes:s=0xa00000}){let[a,r]=(0,f.useState)(!1),i=(0,f.useRef)(null),n=(0,f.useCallback)(t=>{t.preventDefault(),r(!1);let a=t.dataTransfer.files?.[0];if(a){if(a.size>s)return alert("File too large");e(a)}},[e,s]),l=(0,f.useCallback)(t=>{let a=t.target.files?.[0];if(a){if(a.size>s)return alert("File too large");e(a)}},[e,s]);return(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{role:"button",tabIndex:0,"aria-label":"Upload image",onKeyDown:e=>{"Enter"===e.key&&i.current?.click()},onDragOver:e=>{e.preventDefault(),r(!0)},onDragLeave:()=>r(!1),onDrop:n,onClick:()=>i.current?.click(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${a?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-gray-50"}`,children:(0,d.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,d.jsx)("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,d.jsx)("p",{className:"text-base font-medium text-gray-700",children:"Click to select an image"}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:"or drag and drop"}),(0,d.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"JPEG, PNG, WebP • Max 10MB"})]})}),(0,d.jsx)("input",{ref:i,type:"file",accept:t,className:"hidden",onChange:l})]})}(function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let s of e)t[s]=s;return t},e.getValidEnumValues=t=>{let s=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of s)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t},e.find=(e,t)=>{for(let s of e)if(t(s))return s},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t})(r||(r={})),(i||(i={})).mergeShapes=(e,t)=>({...e,...t});let b=r.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),k=e=>{switch(typeof e){case"undefined":return b.undefined;case"string":return b.string;case"number":return Number.isNaN(e)?b.nan:b.number;case"boolean":return b.boolean;case"function":return b.function;case"bigint":return b.bigint;case"symbol":return b.symbol;case"object":if(Array.isArray(e))return b.array;if(null===e)return b.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return b.promise;if("undefined"!=typeof Map&&e instanceof Map)return b.map;if("undefined"!=typeof Set&&e instanceof Set)return b.set;if("undefined"!=typeof Date&&e instanceof Date)return b.date;return b.object;default:return b.unknown}},S=r.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class A extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},s={_errors:[]},a=e=>{for(let r of e.issues)if("invalid_union"===r.code)r.unionErrors.map(a);else if("invalid_return_type"===r.code)a(r.returnTypeError);else if("invalid_arguments"===r.code)a(r.argumentsError);else if(0===r.path.length)s._errors.push(t(r));else{let e=s,a=0;for(;a<r.path.length;){let s=r.path[a];a===r.path.length-1?(e[s]=e[s]||{_errors:[]},e[s]._errors.push(t(r))):e[s]=e[s]||{_errors:[]},e=e[s],a++}}};return a(this),s}static assert(e){if(!(e instanceof A))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,r.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},s=[];for(let a of this.issues)if(a.path.length>0){let s=a.path[0];t[s]=t[s]||[],t[s].push(e(a))}else s.push(e(a));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}A.create=e=>new A(e);let N=(e,t)=>{let s;switch(e.code){case S.invalid_type:s=e.received===b.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case S.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,r.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:s=`Unrecognized key(s) in object: ${r.joinValues(e.keys,", ")}`;break;case S.invalid_union:s="Invalid input";break;case S.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${r.joinValues(e.options)}`;break;case S.invalid_enum_value:s=`Invalid enum value. Expected ${r.joinValues(e.options)}, received '${e.received}'`;break;case S.invalid_arguments:s="Invalid function arguments";break;case S.invalid_return_type:s="Invalid function return type";break;case S.invalid_date:s="Invalid date";break;case S.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:r.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case S.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case S.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case S.custom:s="Invalid input";break;case S.invalid_intersection_types:s="Intersection results could not be merged";break;case S.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case S.not_finite:s="Number must be finite";break;default:s=t.defaultError,r.assertNever(e)}return{message:s}};!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(n||(n={}));let x=e=>{let{data:t,path:s,errorMaps:a,issueData:r}=e,i=[...s,...r.path||[]],n={...r,path:i};if(void 0!==r.message)return{...r,path:i,message:r.message};let l="";for(let e of a.filter(e=>!!e).slice().reverse())l=e(n,{data:t,defaultError:l}).message;return{...r,path:i,message:l}};function C(e,t){let s=x({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,N,N==N?void 0:N].filter(e=>!!e)});e.common.issues.push(s)}class B{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let s=[];for(let a of t){if("aborted"===a.status)return V;"dirty"===a.status&&e.dirty(),s.push(a.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){let s=[];for(let e of t){let t=await e.key,a=await e.value;s.push({key:t,value:a})}return B.mergeObjectSync(e,s)}static mergeObjectSync(e,t){let s={};for(let a of t){let{key:t,value:r}=a;if("aborted"===t.status||"aborted"===r.status)return V;"dirty"===t.status&&e.dirty(),"dirty"===r.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==r.value||a.alwaysSet)&&(s[t.value]=r.value)}return{status:e.value,value:s}}}let V=Object.freeze({status:"aborted"}),E=e=>({status:"dirty",value:e}),I=e=>({status:"valid",value:e}),_=e=>"aborted"===e.status,D=e=>"dirty"===e.status,O=e=>"valid"===e.status,P=e=>"undefined"!=typeof Promise&&e instanceof Promise;class U{constructor(e,t,s,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let R=(e,t)=>{if(O(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new A(e.common.issues);return this._error=t,this._error}}};function j(e){if(!e)return{};let{errorMap:t,invalid_type_error:s,required_error:a,description:r}=e;if(t&&(s||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:r}:{errorMap:(t,r)=>{let{message:i}=e;return"invalid_enum_value"===t.code?{message:i??r.defaultError}:void 0===r.data?{message:i??a??r.defaultError}:"invalid_type"!==t.code?{message:r.defaultError}:{message:i??s??r.defaultError}},description:r}}class T{get description(){return this._def.description}_getType(e){return k(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:k(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new B,ctx:{common:e.parent.common,data:e.data,parsedType:k(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(P(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){let s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:k(e)},a=this._parseSync({data:e,path:s.path,parent:s});return R(s,a)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:k(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:t});return O(s)?{value:s.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>O(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){let s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:k(e)},a=this._parse({data:e,path:s.path,parent:s});return R(s,await (P(a)?a:Promise.resolve(a)))}refine(e,t){let s=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let r=e(t),i=()=>a.addIssue({code:S.custom,...s(t)});return"undefined"!=typeof Promise&&r instanceof Promise?r.then(e=>!!e||(i(),!1)):!!r||(i(),!1)})}refinement(e,t){return this._refinement((s,a)=>!!e(s)||(a.addIssue("function"==typeof t?t(s,a):t),!1))}_refinement(e){return new e_({schema:this,typeName:l.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return eD.create(this,this._def)}nullable(){return eO.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ef.create(this)}promise(){return eI.create(this,this._def)}or(e){return ep.create([this,e],this._def)}and(e){return ew.create(this,e,this._def)}transform(e){return new e_({...j(this._def),schema:this,typeName:l.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new eP({...j(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:l.ZodDefault})}brand(){return new ej({typeName:l.ZodBranded,type:this,...j(this._def)})}catch(e){return new eU({...j(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:l.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return eT.create(this,e)}readonly(){return eL.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let L=/^c[^\s-]{8,}$/i,H=/^[0-9a-z]+$/,K=/^[0-9A-HJKMNP-TV-Z]{26}$/i,M=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J=/^[a-z0-9_-]{21}$/i,$=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,F=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,q=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,W=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Z=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,G=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,z=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Q=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Y=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,X="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ee=RegExp(`^${X}$`);function et(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let s=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${s}`}class es extends T{_parse(e){var t,s,i,n;let l;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==b.string){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.string,received:t.parsedType}),V}let o=new B;for(let u of this._def.checks)if("min"===u.kind)e.data.length<u.value&&(C(l=this._getOrReturnCtx(e,l),{code:S.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),o.dirty());else if("max"===u.kind)e.data.length>u.value&&(C(l=this._getOrReturnCtx(e,l),{code:S.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),o.dirty());else if("length"===u.kind){let t=e.data.length>u.value,s=e.data.length<u.value;(t||s)&&(l=this._getOrReturnCtx(e,l),t?C(l,{code:S.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}):s&&C(l,{code:S.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}),o.dirty())}else if("email"===u.kind)q.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"email",code:S.invalid_string,message:u.message}),o.dirty());else if("emoji"===u.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"emoji",code:S.invalid_string,message:u.message}),o.dirty());else if("uuid"===u.kind)M.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"uuid",code:S.invalid_string,message:u.message}),o.dirty());else if("nanoid"===u.kind)J.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"nanoid",code:S.invalid_string,message:u.message}),o.dirty());else if("cuid"===u.kind)L.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"cuid",code:S.invalid_string,message:u.message}),o.dirty());else if("cuid2"===u.kind)H.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"cuid2",code:S.invalid_string,message:u.message}),o.dirty());else if("ulid"===u.kind)K.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"ulid",code:S.invalid_string,message:u.message}),o.dirty());else if("url"===u.kind)try{new URL(e.data)}catch{C(l=this._getOrReturnCtx(e,l),{validation:"url",code:S.invalid_string,message:u.message}),o.dirty()}else"regex"===u.kind?(u.regex.lastIndex=0,u.regex.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"regex",code:S.invalid_string,message:u.message}),o.dirty())):"trim"===u.kind?e.data=e.data.trim():"includes"===u.kind?e.data.includes(u.value,u.position)||(C(l=this._getOrReturnCtx(e,l),{code:S.invalid_string,validation:{includes:u.value,position:u.position},message:u.message}),o.dirty()):"toLowerCase"===u.kind?e.data=e.data.toLowerCase():"toUpperCase"===u.kind?e.data=e.data.toUpperCase():"startsWith"===u.kind?e.data.startsWith(u.value)||(C(l=this._getOrReturnCtx(e,l),{code:S.invalid_string,validation:{startsWith:u.value},message:u.message}),o.dirty()):"endsWith"===u.kind?e.data.endsWith(u.value)||(C(l=this._getOrReturnCtx(e,l),{code:S.invalid_string,validation:{endsWith:u.value},message:u.message}),o.dirty()):"datetime"===u.kind?(function(e){let t=`${X}T${et(e)}`,s=[];return s.push(e.local?"Z?":"Z"),e.offset&&s.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${s.join("|")})`,RegExp(`^${t}$`)})(u).test(e.data)||(C(l=this._getOrReturnCtx(e,l),{code:S.invalid_string,validation:"datetime",message:u.message}),o.dirty()):"date"===u.kind?ee.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{code:S.invalid_string,validation:"date",message:u.message}),o.dirty()):"time"===u.kind?RegExp(`^${et(u)}$`).test(e.data)||(C(l=this._getOrReturnCtx(e,l),{code:S.invalid_string,validation:"time",message:u.message}),o.dirty()):"duration"===u.kind?F.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"duration",code:S.invalid_string,message:u.message}),o.dirty()):"ip"===u.kind?(t=e.data,!(("v4"===(s=u.version)||!s)&&W.test(t)||("v6"===s||!s)&&G.test(t))&&(C(l=this._getOrReturnCtx(e,l),{validation:"ip",code:S.invalid_string,message:u.message}),o.dirty())):"jwt"===u.kind?!function(e,t){if(!$.test(e))return!1;try{let[s]=e.split(".");if(!s)return!1;let a=s.replace(/-/g,"+").replace(/_/g,"/").padEnd(s.length+(4-s.length%4)%4,"="),r=JSON.parse(atob(a));if("object"!=typeof r||null===r||"typ"in r&&r?.typ!=="JWT"||!r.alg||t&&r.alg!==t)return!1;return!0}catch{return!1}}(e.data,u.alg)&&(C(l=this._getOrReturnCtx(e,l),{validation:"jwt",code:S.invalid_string,message:u.message}),o.dirty()):"cidr"===u.kind?(i=e.data,!(("v4"===(n=u.version)||!n)&&Z.test(i)||("v6"===n||!n)&&z.test(i))&&(C(l=this._getOrReturnCtx(e,l),{validation:"cidr",code:S.invalid_string,message:u.message}),o.dirty())):"base64"===u.kind?Q.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"base64",code:S.invalid_string,message:u.message}),o.dirty()):"base64url"===u.kind?Y.test(e.data)||(C(l=this._getOrReturnCtx(e,l),{validation:"base64url",code:S.invalid_string,message:u.message}),o.dirty()):r.assertNever(u);return{status:o.value,value:e.data}}_regex(e,t,s){return this.refinement(t=>e.test(t),{validation:t,code:S.invalid_string,...n.errToObj(s)})}_addCheck(e){return new es({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...n.errToObj(e)})}url(e){return this._addCheck({kind:"url",...n.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...n.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...n.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...n.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...n.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...n.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...n.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...n.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...n.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...n.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...n.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...n.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...n.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...n.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...n.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...n.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...n.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...n.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...n.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...n.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...n.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...n.errToObj(t)})}nonempty(e){return this.min(1,n.errToObj(e))}trim(){return new es({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new es({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new es({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}es.create=e=>new es({checks:[],typeName:l.ZodString,coerce:e?.coerce??!1,...j(e)});class ea extends T{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==b.number){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.number,received:t.parsedType}),V}let s=new B;for(let a of this._def.checks)"int"===a.kind?r.isInteger(e.data)||(C(t=this._getOrReturnCtx(e,t),{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(C(t=this._getOrReturnCtx(e,t),{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(C(t=this._getOrReturnCtx(e,t),{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):"multipleOf"===a.kind?0!==function(e,t){let s=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,r=s>a?s:a;return Number.parseInt(e.toFixed(r).replace(".",""))%Number.parseInt(t.toFixed(r).replace(".",""))/10**r}(e.data,a.value)&&(C(t=this._getOrReturnCtx(e,t),{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(C(t=this._getOrReturnCtx(e,t),{code:S.not_finite,message:a.message}),s.dirty()):r.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,n.toString(t))}gt(e,t){return this.setLimit("min",e,!1,n.toString(t))}lte(e,t){return this.setLimit("max",e,!0,n.toString(t))}lt(e,t){return this.setLimit("max",e,!1,n.toString(t))}setLimit(e,t,s,a){return new ea({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:n.toString(a)}]})}_addCheck(e){return new ea({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:n.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:n.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:n.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:n.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:n.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:n.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:n.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:n.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:n.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&r.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let s of this._def.checks){if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;"min"===s.kind?(null===t||s.value>t)&&(t=s.value):"max"===s.kind&&(null===e||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ea.create=e=>new ea({checks:[],typeName:l.ZodNumber,coerce:e?.coerce||!1,...j(e)});class er extends T{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==b.bigint)return this._getInvalidInput(e);let s=new B;for(let a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(C(t=this._getOrReturnCtx(e,t),{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(C(t=this._getOrReturnCtx(e,t),{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(C(t=this._getOrReturnCtx(e,t),{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):r.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.bigint,received:t.parsedType}),V}gte(e,t){return this.setLimit("min",e,!0,n.toString(t))}gt(e,t){return this.setLimit("min",e,!1,n.toString(t))}lte(e,t){return this.setLimit("max",e,!0,n.toString(t))}lt(e,t){return this.setLimit("max",e,!1,n.toString(t))}setLimit(e,t,s,a){return new er({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:n.toString(a)}]})}_addCheck(e){return new er({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:n.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:n.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:n.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:n.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:n.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}er.create=e=>new er({checks:[],typeName:l.ZodBigInt,coerce:e?.coerce??!1,...j(e)});class ei extends T{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==b.boolean){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.boolean,received:t.parsedType}),V}return I(e.data)}}ei.create=e=>new ei({typeName:l.ZodBoolean,coerce:e?.coerce||!1,...j(e)});class en extends T{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==b.date){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.date,received:t.parsedType}),V}if(Number.isNaN(e.data.getTime()))return C(this._getOrReturnCtx(e),{code:S.invalid_date}),V;let s=new B;for(let a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(C(t=this._getOrReturnCtx(e,t),{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),s.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(C(t=this._getOrReturnCtx(e,t),{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),s.dirty()):r.assertNever(a);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new en({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:n.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:n.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}en.create=e=>new en({checks:[],coerce:e?.coerce||!1,typeName:l.ZodDate,...j(e)});class el extends T{_parse(e){if(this._getType(e)!==b.symbol){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.symbol,received:t.parsedType}),V}return I(e.data)}}el.create=e=>new el({typeName:l.ZodSymbol,...j(e)});class eo extends T{_parse(e){if(this._getType(e)!==b.undefined){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.undefined,received:t.parsedType}),V}return I(e.data)}}eo.create=e=>new eo({typeName:l.ZodUndefined,...j(e)});class eu extends T{_parse(e){if(this._getType(e)!==b.null){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.null,received:t.parsedType}),V}return I(e.data)}}eu.create=e=>new eu({typeName:l.ZodNull,...j(e)});class ec extends T{constructor(){super(...arguments),this._any=!0}_parse(e){return I(e.data)}}ec.create=e=>new ec({typeName:l.ZodAny,...j(e)});class eh extends T{constructor(){super(...arguments),this._unknown=!0}_parse(e){return I(e.data)}}eh.create=e=>new eh({typeName:l.ZodUnknown,...j(e)});class em extends T{_parse(e){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.never,received:t.parsedType}),V}}em.create=e=>new em({typeName:l.ZodNever,...j(e)});class ed extends T{_parse(e){if(this._getType(e)!==b.undefined){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.void,received:t.parsedType}),V}return I(e.data)}}ed.create=e=>new ed({typeName:l.ZodVoid,...j(e)});class ef extends T{_parse(e){let{ctx:t,status:s}=this._processInputParams(e),a=this._def;if(t.parsedType!==b.array)return C(t,{code:S.invalid_type,expected:b.array,received:t.parsedType}),V;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,r=t.data.length<a.exactLength.value;(e||r)&&(C(t,{code:e?S.too_big:S.too_small,minimum:r?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),s.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(C(t,{code:S.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),s.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(C(t,{code:S.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((e,s)=>a.type._parseAsync(new U(t,e,t.path,s)))).then(e=>B.mergeArray(s,e));let r=[...t.data].map((e,s)=>a.type._parseSync(new U(t,e,t.path,s)));return B.mergeArray(s,r)}get element(){return this._def.type}min(e,t){return new ef({...this._def,minLength:{value:e,message:n.toString(t)}})}max(e,t){return new ef({...this._def,maxLength:{value:e,message:n.toString(t)}})}length(e,t){return new ef({...this._def,exactLength:{value:e,message:n.toString(t)}})}nonempty(e){return this.min(1,e)}}ef.create=(e,t)=>new ef({type:e,minLength:null,maxLength:null,exactLength:null,typeName:l.ZodArray,...j(t)});class eg extends T{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=r.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==b.object){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.object,received:t.parsedType}),V}let{status:t,ctx:s}=this._processInputParams(e),{shape:a,keys:r}=this._getCached(),i=[];if(!(this._def.catchall instanceof em&&"strip"===this._def.unknownKeys))for(let e in s.data)r.includes(e)||i.push(e);let n=[];for(let e of r){let t=a[e],r=s.data[e];n.push({key:{status:"valid",value:e},value:t._parse(new U(s,r,s.path,e)),alwaysSet:e in s.data})}if(this._def.catchall instanceof em){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of i)n.push({key:{status:"valid",value:e},value:{status:"valid",value:s.data[e]}});else if("strict"===e)i.length>0&&(C(s,{code:S.unrecognized_keys,keys:i}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of i){let a=s.data[t];n.push({key:{status:"valid",value:t},value:e._parse(new U(s,a,s.path,t)),alwaysSet:t in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of n){let s=await t.key,a=await t.value;e.push({key:s,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>B.mergeObjectSync(t,e)):B.mergeObjectSync(t,n)}get shape(){return this._def.shape()}strict(e){return n.errToObj,new eg({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,s)=>{let a=this._def.errorMap?.(t,s).message??s.defaultError;return"unrecognized_keys"===t.code?{message:n.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new eg({...this._def,unknownKeys:"strip"})}passthrough(){return new eg({...this._def,unknownKeys:"passthrough"})}extend(e){return new eg({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new eg({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:l.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new eg({...this._def,catchall:e})}pick(e){let t={};for(let s of r.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new eg({...this._def,shape:()=>t})}omit(e){let t={};for(let s of r.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new eg({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof eg){let s={};for(let a in t.shape){let r=t.shape[a];s[a]=eD.create(e(r))}return new eg({...t._def,shape:()=>s})}if(t instanceof ef)return new ef({...t._def,type:e(t.element)});if(t instanceof eD)return eD.create(e(t.unwrap()));if(t instanceof eO)return eO.create(e(t.unwrap()));if(t instanceof eb)return eb.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let s of r.objectKeys(this.shape)){let a=this.shape[s];e&&!e[s]?t[s]=a:t[s]=a.optional()}return new eg({...this._def,shape:()=>t})}required(e){let t={};for(let s of r.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let e=this.shape[s];for(;e instanceof eD;)e=e._def.innerType;t[s]=e}return new eg({...this._def,shape:()=>t})}keyof(){return eB(r.objectKeys(this.shape))}}eg.create=(e,t)=>new eg({shape:()=>e,unknownKeys:"strip",catchall:em.create(),typeName:l.ZodObject,...j(t)}),eg.strictCreate=(e,t)=>new eg({shape:()=>e,unknownKeys:"strict",catchall:em.create(),typeName:l.ZodObject,...j(t)}),eg.lazycreate=(e,t)=>new eg({shape:e,unknownKeys:"strip",catchall:em.create(),typeName:l.ZodObject,...j(t)});class ep extends T{_parse(e){let{ctx:t}=this._processInputParams(e),s=this._def.options;if(t.common.async)return Promise.all(s.map(async e=>{let s={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let s of e)if("dirty"===s.result.status)return t.common.issues.push(...s.ctx.common.issues),s.result;let s=e.map(e=>new A(e.ctx.common.issues));return C(t,{code:S.invalid_union,unionErrors:s}),V});{let e;let a=[];for(let r of s){let s={...t,common:{...t.common,issues:[]},parent:null},i=r._parseSync({data:t.data,path:t.path,parent:s});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:s}),s.common.issues.length&&a.push(s.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let r=a.map(e=>new A(e));return C(t,{code:S.invalid_union,unionErrors:r}),V}}get options(){return this._def.options}}ep.create=(e,t)=>new ep({options:e,typeName:l.ZodUnion,...j(t)});let ey=e=>{if(e instanceof ex)return ey(e.schema);if(e instanceof e_)return ey(e.innerType());if(e instanceof eC)return[e.value];if(e instanceof eV)return e.options;if(e instanceof eE)return r.objectValues(e.enum);else if(e instanceof eP)return ey(e._def.innerType);else if(e instanceof eo)return[void 0];else if(e instanceof eu)return[null];else if(e instanceof eD)return[void 0,...ey(e.unwrap())];else if(e instanceof eO)return[null,...ey(e.unwrap())];else if(e instanceof ej)return ey(e.unwrap());else if(e instanceof eL)return ey(e.unwrap());else if(e instanceof eU)return ey(e._def.innerType);else return[]};class ev extends T{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==b.object)return C(t,{code:S.invalid_type,expected:b.object,received:t.parsedType}),V;let s=this.discriminator,a=t.data[s],r=this.optionsMap.get(a);return r?t.common.async?r._parseAsync({data:t.data,path:t.path,parent:t}):r._parseSync({data:t.data,path:t.path,parent:t}):(C(t,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),V)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){let a=new Map;for(let s of t){let t=ey(s.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let r of t){if(a.has(r))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(r)}`);a.set(r,s)}}return new ev({typeName:l.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...j(s)})}}class ew extends T{_parse(e){let{status:t,ctx:s}=this._processInputParams(e),a=(e,a)=>{if(_(e)||_(a))return V;let i=function e(t,s){let a=k(t),i=k(s);if(t===s)return{valid:!0,data:t};if(a===b.object&&i===b.object){let a=r.objectKeys(s),i=r.objectKeys(t).filter(e=>-1!==a.indexOf(e)),n={...t,...s};for(let a of i){let r=e(t[a],s[a]);if(!r.valid)return{valid:!1};n[a]=r.data}return{valid:!0,data:n}}if(a===b.array&&i===b.array){if(t.length!==s.length)return{valid:!1};let a=[];for(let r=0;r<t.length;r++){let i=e(t[r],s[r]);if(!i.valid)return{valid:!1};a.push(i.data)}return{valid:!0,data:a}}if(a===b.date&&i===b.date&&+t==+s)return{valid:!0,data:t};return{valid:!1}}(e.value,a.value);return i.valid?((D(e)||D(a))&&t.dirty(),{status:t.value,value:i.data}):(C(s,{code:S.invalid_intersection_types}),V)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}ew.create=(e,t,s)=>new ew({left:e,right:t,typeName:l.ZodIntersection,...j(s)});class eb extends T{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==b.array)return C(s,{code:S.invalid_type,expected:b.array,received:s.parsedType}),V;if(s.data.length<this._def.items.length)return C(s,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),V;!this._def.rest&&s.data.length>this._def.items.length&&(C(s,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...s.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new U(s,e,s.path,t)):null}).filter(e=>!!e);return s.common.async?Promise.all(a).then(e=>B.mergeArray(t,e)):B.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new eb({...this._def,rest:e})}}eb.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new eb({items:e,typeName:l.ZodTuple,rest:null,...j(t)})};class ek extends T{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==b.object)return C(s,{code:S.invalid_type,expected:b.object,received:s.parsedType}),V;let a=[],r=this._def.keyType,i=this._def.valueType;for(let e in s.data)a.push({key:r._parse(new U(s,e,s.path,e)),value:i._parse(new U(s,s.data[e],s.path,e)),alwaysSet:e in s.data});return s.common.async?B.mergeObjectAsync(t,a):B.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,s){return new ek(t instanceof T?{keyType:e,valueType:t,typeName:l.ZodRecord,...j(s)}:{keyType:es.create(),valueType:e,typeName:l.ZodRecord,...j(t)})}}class eS extends T{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==b.map)return C(s,{code:S.invalid_type,expected:b.map,received:s.parsedType}),V;let a=this._def.keyType,r=this._def.valueType,i=[...s.data.entries()].map(([e,t],i)=>({key:a._parse(new U(s,e,s.path,[i,"key"])),value:r._parse(new U(s,t,s.path,[i,"value"]))}));if(s.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let s of i){let a=await s.key,r=await s.value;if("aborted"===a.status||"aborted"===r.status)return V;("dirty"===a.status||"dirty"===r.status)&&t.dirty(),e.set(a.value,r.value)}return{status:t.value,value:e}})}{let e=new Map;for(let s of i){let a=s.key,r=s.value;if("aborted"===a.status||"aborted"===r.status)return V;("dirty"===a.status||"dirty"===r.status)&&t.dirty(),e.set(a.value,r.value)}return{status:t.value,value:e}}}}eS.create=(e,t,s)=>new eS({valueType:t,keyType:e,typeName:l.ZodMap,...j(s)});class eA extends T{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==b.set)return C(s,{code:S.invalid_type,expected:b.set,received:s.parsedType}),V;let a=this._def;null!==a.minSize&&s.data.size<a.minSize.value&&(C(s,{code:S.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&s.data.size>a.maxSize.value&&(C(s,{code:S.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let r=this._def.valueType;function i(e){let s=new Set;for(let a of e){if("aborted"===a.status)return V;"dirty"===a.status&&t.dirty(),s.add(a.value)}return{status:t.value,value:s}}let n=[...s.data.values()].map((e,t)=>r._parse(new U(s,e,s.path,t)));return s.common.async?Promise.all(n).then(e=>i(e)):i(n)}min(e,t){return new eA({...this._def,minSize:{value:e,message:n.toString(t)}})}max(e,t){return new eA({...this._def,maxSize:{value:e,message:n.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}eA.create=(e,t)=>new eA({valueType:e,minSize:null,maxSize:null,typeName:l.ZodSet,...j(t)});class eN extends T{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==b.function)return C(t,{code:S.invalid_type,expected:b.function,received:t.parsedType}),V;function s(e,s){return x({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,N,N].filter(e=>!!e),issueData:{code:S.invalid_arguments,argumentsError:s}})}function a(e,s){return x({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,N,N].filter(e=>!!e),issueData:{code:S.invalid_return_type,returnTypeError:s}})}let r={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof eI){let e=this;return I(async function(...t){let n=new A([]),l=await e._def.args.parseAsync(t,r).catch(e=>{throw n.addIssue(s(t,e)),n}),o=await Reflect.apply(i,this,l);return await e._def.returns._def.type.parseAsync(o,r).catch(e=>{throw n.addIssue(a(o,e)),n})})}{let e=this;return I(function(...t){let n=e._def.args.safeParse(t,r);if(!n.success)throw new A([s(t,n.error)]);let l=Reflect.apply(i,this,n.data),o=e._def.returns.safeParse(l,r);if(!o.success)throw new A([a(l,o.error)]);return o.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new eN({...this._def,args:eb.create(e).rest(eh.create())})}returns(e){return new eN({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new eN({args:e||eb.create([]).rest(eh.create()),returns:t||eh.create(),typeName:l.ZodFunction,...j(s)})}}class ex extends T{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ex.create=(e,t)=>new ex({getter:e,typeName:l.ZodLazy,...j(t)});class eC extends T{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return C(t,{received:t.data,code:S.invalid_literal,expected:this._def.value}),V}return{status:"valid",value:e.data}}get value(){return this._def.value}}function eB(e,t){return new eV({values:e,typeName:l.ZodEnum,...j(t)})}eC.create=(e,t)=>new eC({value:e,typeName:l.ZodLiteral,...j(t)});class eV extends T{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),s=this._def.values;return C(t,{expected:r.joinValues(s),received:t.parsedType,code:S.invalid_type}),V}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),s=this._def.values;return C(t,{received:t.data,code:S.invalid_enum_value,options:s}),V}return I(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return eV.create(e,{...this._def,...t})}exclude(e,t=this._def){return eV.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}eV.create=eB;class eE extends T{_parse(e){let t=r.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==b.string&&s.parsedType!==b.number){let e=r.objectValues(t);return C(s,{expected:r.joinValues(e),received:s.parsedType,code:S.invalid_type}),V}if(this._cache||(this._cache=new Set(r.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=r.objectValues(t);return C(s,{received:s.data,code:S.invalid_enum_value,options:e}),V}return I(e.data)}get enum(){return this._def.values}}eE.create=(e,t)=>new eE({values:e,typeName:l.ZodNativeEnum,...j(t)});class eI extends T{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==b.promise&&!1===t.common.async?(C(t,{code:S.invalid_type,expected:b.promise,received:t.parsedType}),V):I((t.parsedType===b.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}eI.create=(e,t)=>new eI({type:e,typeName:l.ZodPromise,...j(t)});class e_ extends T{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===l.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:s}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:e=>{C(s,e),e.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===a.type){let e=a.transform(s.data,i);if(s.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return V;let a=await this._def.schema._parseAsync({data:e,path:s.path,parent:s});return"aborted"===a.status?V:"dirty"===a.status||"dirty"===t.value?E(a.value):a});{if("aborted"===t.value)return V;let a=this._def.schema._parseSync({data:e,path:s.path,parent:s});return"aborted"===a.status?V:"dirty"===a.status||"dirty"===t.value?E(a.value):a}}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,i);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==s.common.async)return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(s=>"aborted"===s.status?V:("dirty"===s.status&&t.dirty(),e(s.value).then(()=>({status:t.value,value:s.value}))));{let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===a.status?V:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type){if(!1!==s.common.async)return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(e=>O(e)?Promise.resolve(a.transform(e.value,i)).then(e=>({status:t.value,value:e})):V);{let e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!O(e))return V;let r=a.transform(e.value,i);if(r instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:r}}}r.assertNever(a)}}e_.create=(e,t,s)=>new e_({schema:e,typeName:l.ZodEffects,effect:t,...j(s)}),e_.createWithPreprocess=(e,t,s)=>new e_({schema:t,effect:{type:"preprocess",transform:e},typeName:l.ZodEffects,...j(s)});class eD extends T{_parse(e){return this._getType(e)===b.undefined?I(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eD.create=(e,t)=>new eD({innerType:e,typeName:l.ZodOptional,...j(t)});class eO extends T{_parse(e){return this._getType(e)===b.null?I(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eO.create=(e,t)=>new eO({innerType:e,typeName:l.ZodNullable,...j(t)});class eP extends T{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return t.parsedType===b.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}eP.create=(e,t)=>new eP({innerType:e,typeName:l.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...j(t)});class eU extends T{_parse(e){let{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return P(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new A(s.common.issues)},input:s.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new A(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}eU.create=(e,t)=>new eU({innerType:e,typeName:l.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...j(t)});class eR extends T{_parse(e){if(this._getType(e)!==b.nan){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:b.nan,received:t.parsedType}),V}return{status:"valid",value:e.data}}}eR.create=e=>new eR({typeName:l.ZodNaN,...j(e)}),Symbol("zod_brand");class ej extends T{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class eT extends T{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?V:"dirty"===e.status?(t.dirty(),E(e.value)):this._def.out._parseAsync({data:e.value,path:s.path,parent:s})})();{let e=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?V:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:s.path,parent:s})}}static create(e,t){return new eT({in:e,out:t,typeName:l.ZodPipeline})}}class eL extends T{_parse(e){let t=this._def.innerType._parse(e),s=e=>(O(e)&&(e.value=Object.freeze(e.value)),e);return P(t)?t.then(e=>s(e)):s(t)}unwrap(){return this._def.innerType}}eL.create=(e,t)=>new eL({innerType:e,typeName:l.ZodReadonly,...j(t)}),eg.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(l||(l={}));let eH=es.create;ea.create,eR.create,er.create,ei.create,en.create,el.create,eo.create,eu.create;let eK=ec.create;eh.create,em.create,ed.create;let eM=ef.create,eJ=eg.create;eg.strictCreate,ep.create,ev.create,ew.create,eb.create;let e$=ek.create;eS.create,eA.create,eN.create,ex.create,eC.create,eV.create,eE.create,eI.create,e_.create,eD.create,eO.create,e_.createWithPreprocess,eT.create;let eF=eJ({title:eH().optional(),format:eH().default("image/jpeg"),assertions:eM(e$(eK())).default([]),ta_url:eH().url().optional()}).strict(),eq={minimal:{title:"Signed image",format:"image/jpeg",assertions:[{label:"c2pa.actions",data:{actions:[{action:"c2pa.created"}]}}],ta_url:"https://api.c2patool.io/api/v1/timestamps/ecc"},editorial:{title:"Editorial image",format:"image/jpeg",assertions:[{label:"c2pa.actions",data:{actions:[{action:"c2pa.edited"}]}},{label:"org.iptc.ext",data:{creditLine:"SSL.com Preview"}}],ta_url:"https://api.c2patool.io/api/v1/timestamps/ecc"}};class eW{static isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let s=eW.toUint8Array(e),a=eW.toUint8Array(t);if(s.length!==a.byteLength)return!1;for(let e=0;e<s.length;e++)if(s[e]!==a[e])return!1;return!0}static concat(...e){let t;t=!Array.isArray(e[0])||e[1]instanceof Function?Array.isArray(e[0])&&e[1]instanceof Function?e[0]:e[e.length-1]instanceof Function?e.slice(0,e.length-1):e:e[0];let s=0;for(let e of t)s+=e.byteLength;let a=new Uint8Array(s),r=0;for(let e of t){let t=this.toUint8Array(e);a.set(t,r),r+=t.length}return e[e.length-1]instanceof Function?this.toView(a,e[e.length-1]):a.buffer}}let eZ="string",eG=/^[0-9a-f\s]+$/i,ez=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,eQ=/^[a-zA-Z0-9-_]+$/;class eY{static fromString(e){let t=unescape(encodeURIComponent(e)),s=new Uint8Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return s.buffer}static toString(e){let t=eW.toUint8Array(e),s="";for(let e=0;e<t.length;e++)s+=String.fromCharCode(t[e]);return decodeURIComponent(escape(s))}}class eX{static toString(e,t=!1){let s=eW.toArrayBuffer(e),a=new DataView(s),r="";for(let e=0;e<s.byteLength;e+=2)r+=String.fromCharCode(a.getUint16(e,t));return r}static fromString(e,t=!1){let s=new ArrayBuffer(2*e.length),a=new DataView(s);for(let s=0;s<e.length;s++)a.setUint16(2*s,e.charCodeAt(s),t);return s}}class e0{static isHex(e){return typeof e===eZ&&eG.test(e)}static isBase64(e){return typeof e===eZ&&ez.test(e)}static isBase64Url(e){return typeof e===eZ&&eQ.test(e)}static ToString(e,t="utf8"){let s=eW.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(s);case"binary":return this.ToBinary(s);case"hex":return this.ToHex(s);case"base64":return this.ToBase64(s);case"base64url":return this.ToBase64Url(s);case"utf16le":return eX.toString(s,!0);case"utf16":case"utf16be":return eX.toString(s);default:throw Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return eX.fromString(e,!0);case"utf16":case"utf16be":return eX.fromString(e);default:throw Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){let t=eW.toUint8Array(e);return"undefined"!=typeof btoa?btoa(this.ToString(t,"binary")):Buffer.from(t).toString("base64")}static FromBase64(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!e0.isBase64(t))throw TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!e0.isBase64Url(t))throw TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=e0.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return eY.fromString(e);case"utf16":case"utf16be":return eX.fromString(e);case"utf16le":case"usc2":return eX.fromString(e,!0);default:throw Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=e0.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return eY.toString(e);case"utf16":case"utf16be":return eX.toString(e);case"utf16le":case"usc2":return eX.toString(e,!0);default:throw Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){let t=e.length,s=new Uint8Array(t);for(let a=0;a<t;a++)s[a]=e.charCodeAt(a);return s.buffer}static ToBinary(e){let t=eW.toUint8Array(e),s="";for(let e=0;e<t.length;e++)s+=String.fromCharCode(t[e]);return s}static ToHex(e){let t=eW.toUint8Array(e),s="",a=t.length;for(let e=0;e<a;e++){let a=t[e];a<16&&(s+="0"),s+=a.toString(16)}return s}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!e0.isHex(t))throw TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);let s=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){let a=t.slice(e,e+2);s[e/2]=parseInt(a,16)}return s.buffer}static ToUtf16String(e,t=!1){return eX.toString(e,t)}static FromUtf16String(e,t=!1){return eX.fromString(e,t)}static Base64Padding(e){let t=4-e.length%4;if(t<4)for(let s=0;s<t;s++)e+="=";return e}static formatString(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}function e1(e,t,s){var a;return e instanceof Object==!1?s:null!==(a=e[t])&&void 0!==a?a:s}function e2(e,t=0,s=e.byteLength-t,a=!1){let r="";for(let i of new Uint8Array(e,t,s)){let e=i.toString(16).toUpperCase();1===e.length&&(r+="0"),r+=e,a&&(r+=" ")}return r.trim()}function e3(e,t){let s=0;if(1===e.length)return e[0];for(let a=e.length-1;a>=0;a--)s+=e[e.length-1-a]*Math.pow(2,t*a);return s}function e4(e,t,s=-1){let a=e,r=0,i=Math.pow(2,t);for(let n=1;n<8;n++){if(e<i){let e;if(s<0)e=new ArrayBuffer(n),r=n;else{if(s<n)return new ArrayBuffer(0);e=new ArrayBuffer(s),r=s}let i=new Uint8Array(e);for(let e=n-1;e>=0;e--){let s=Math.pow(2,e*t);i[r-e-1]=Math.floor(a/s),a-=i[r-e-1]*s}return e}i*=Math.pow(2,t)}return new ArrayBuffer(0)}function e8(...e){let t=0,s=0;for(let s of e)t+=s.byteLength;let a=new ArrayBuffer(t),r=new Uint8Array(a);for(let t of e)r.set(new Uint8Array(t),s),s+=t.byteLength;return a}function e5(...e){let t=0,s=0;for(let s of e)t+=s.length;let a=new Uint8Array(new ArrayBuffer(t));for(let t of e)a.set(t,s),s+=t.length;return a}function e6(){let e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let t=255===e[0]&&128&e[1],s=0===e[0]&&(128&e[1])==0;(t||s)&&this.warnings.push("Needlessly long format")}let t=new Uint8Array(new ArrayBuffer(this.valueHex.byteLength));for(let e=0;e<this.valueHex.byteLength;e++)t[e]=0;t[0]=128&e[0];let s=e3(t,8),a=new Uint8Array(new ArrayBuffer(this.valueHex.byteLength));for(let t=0;t<this.valueHex.byteLength;t++)a[t]=e[t];return a[0]&=127,e3(a,8)-s}function e9(e,t){if(e.byteLength!==t.byteLength)return!1;let s=new Uint8Array(e),a=new Uint8Array(t);for(let e=0;e<s.length;e++)if(s[e]!==a[e])return!1;return!0}function e7(e,t){let s=e.toString(10);if(t<s.length)return"";let a=t-s.length,r=Array(a);for(let e=0;e<a;e++)r[e]="0";return r.join("").concat(s)}e0.DEFAULT_UTF8_ENCODING="utf8";let te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",tt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function ts(e,t=!1,s=!1,a=!1){let r=0,i=0,n=0,l="",o=t?tt:te;if(a){let t=0;for(let s=0;s<e.length;s++)if(0!==e.charCodeAt(s)){t=s;break}e=e.slice(t)}for(;r<e.length;){let t=e.charCodeAt(r++);r>=e.length&&(i=1);let a=e.charCodeAt(r++);r>=e.length&&(n=1);let u=e.charCodeAt(r++),c=t>>2,h=(3&t)<<4|a>>4,m=(15&a)<<2|u>>6,d=63&u;1===i?m=d=64:1===n&&(d=64),s?64===m?l+=`${o.charAt(c)}${o.charAt(h)}`:64===d?l+=`${o.charAt(c)}${o.charAt(h)}${o.charAt(m)}`:l+=`${o.charAt(c)}${o.charAt(h)}${o.charAt(m)}${o.charAt(d)}`:l+=`${o.charAt(c)}${o.charAt(h)}${o.charAt(m)}${o.charAt(d)}`}return l}function ta(e,t=!1,s=!1){let a=t?tt:te;function r(e){for(let t=0;t<64;t++)if(a.charAt(t)===e)return t;return 64}function i(e){return 64===e?0:e}let n=0,l="";for(;n<e.length;){let t=r(e.charAt(n++)),s=n>=e.length?0:r(e.charAt(n++)),a=n>=e.length?0:r(e.charAt(n++)),o=n>=e.length?0:r(e.charAt(n++)),u=i(t)<<2|i(s)>>4,c=(15&i(s))<<4|i(a)>>2,h=(3&i(a))<<6|i(o);l+=String.fromCharCode(u),64!==a&&(l+=String.fromCharCode(c)),64!==o&&(l+=String.fromCharCode(h))}if(s){let e=l.length,t=-1;for(let s=e-1;s>=0;s--)if(0!==l.charCodeAt(s)){t=s;break}l=-1!==t?l.slice(0,t+1):""}return l}function tr(e){let t="";for(let s of new Uint8Array(e))t+=String.fromCharCode(s);return t}function ti(e){let t=e.length,s=new ArrayBuffer(t),a=new Uint8Array(s);for(let s=0;s<t;s++)a[s]=e.charCodeAt(s);return s}let tn=Math.log(2);function tl(e,t){for(let s of t)delete e[s]}function to(){if("undefined"==typeof BigInt)throw Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function tu(e){let t=0,s=0;for(let s=0;s<e.length;s++)t+=e[s].byteLength;let a=new Uint8Array(t);for(let t=0;t<e.length;t++){let r=e[t];a.set(new Uint8Array(r),s),s+=r.byteLength}return a.buffer}function tc(e,t,s,a){return t instanceof Uint8Array?t.byteLength?s<0?(e.error="Wrong parameter: inputOffset less than zero",!1):a<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-s-a<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class th{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return tu(this.items)}}let tm=[new Uint8Array([1])],td="0123456789",tf="name",tg="valueHexView",tp=new ArrayBuffer(0),ty=new Uint8Array(0),tv="EndOfContent",tw="OCTET STRING",tb="BIT STRING";function tk(e){var t;return(t=class extends e{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}constructor(...e){var t;super(...e);let s=e[0]||{};this.isHexOnly=null!==(t=s.isHexOnly)&&void 0!==t&&t,this.valueHexView=s.valueHex?eW.toUint8Array(s.valueHex):ty}fromBER(e,t,s){let a=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!tc(this,a,t,s))return -1;let r=t+s;return(this.valueHexView=a.subarray(t,r),this.valueHexView.length)?(this.blockLength=s,r):(this.warnings.push("Zero buffer length"),t)}toBER(e=!1){return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",tp)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:e0.ToHex(this.valueHexView)}}}).NAME="hexBlock",t}class tS{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t="",warnings:s=[],valueBeforeDecode:a=ty}={}){this.blockLength=e,this.error=t,this.warnings=s,this.valueBeforeDecodeView=eW.toUint8Array(a)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:e0.ToHex(this.valueBeforeDecodeView)}}}tS.NAME="baseBlock";class tA extends tS{fromBER(e,t,s){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}tA.NAME="valueBlock";class tN extends tk(tS){constructor({idBlock:e={}}={}){var t,s,a,r;super(),e?(this.isHexOnly=null!==(t=e.isHexOnly)&&void 0!==t&&t,this.valueHexView=e.valueHex?eW.toUint8Array(e.valueHex):ty,this.tagClass=null!==(s=e.tagClass)&&void 0!==s?s:-1,this.tagNumber=null!==(a=e.tagNumber)&&void 0!==a?a:-1,this.isConstructed=null!==(r=e.isConstructed)&&void 0!==r&&r):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",tp}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){let s=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,s[0]=t}return s.buffer}if(!this.isHexOnly){let s=e4(this.tagNumber,7),a=new Uint8Array(s),r=s.byteLength,i=new Uint8Array(r+1);if(i[0]=31|t,!e){for(let e=0;e<r-1;e++)i[e+1]=128|a[e];i[r]=a[r-1]}return i.buffer}let s=new Uint8Array(this.valueHexView.byteLength+1);if(s[0]=31|t,!e){let e=this.valueHexView;for(let t=0;t<e.length-1;t++)s[t+1]=128|e[t];s[this.valueHexView.byteLength]=e[e.length-1]}return s.buffer}fromBER(e,t,s){let a=eW.toUint8Array(e);if(!tc(this,a,t,s))return -1;let r=a.subarray(t,t+s);if(0===r.length)return this.error="Zero buffer length",-1;switch(192&r[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(32&r[0])==32,this.isHexOnly=!1;let i=31&r[0];if(31!==i)this.tagNumber=i,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),s=255;for(;128&r[e];){if(t[e-1]=127&r[e],++e>=r.length)return this.error="End of input reached before message was fully decoded",-1;if(e===s){let e=new Uint8Array(s+=255);for(let s=0;s<t.length;s++)e[s]=t[s];t=this.valueHexView=new Uint8Array(s)}}this.blockLength=e+1,t[e-1]=127&r[e];let a=new Uint8Array(e);for(let s=0;s<e;s++)a[s]=t[s];(t=this.valueHexView=new Uint8Array(e)).set(a),this.blockLength<=9?this.tagNumber=e3(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}tN.NAME="identificationBlock";class tx extends tS{constructor({lenBlock:e={}}={}){var t,s,a;super(),this.isIndefiniteForm=null!==(t=e.isIndefiniteForm)&&void 0!==t&&t,this.longFormUsed=null!==(s=e.longFormUsed)&&void 0!==s&&s,this.length=null!==(a=e.length)&&void 0!==a?a:0}fromBER(e,t,s){let a=eW.toUint8Array(e);if(!tc(this,a,t,s))return -1;let r=a.subarray(t,t+s);if(0===r.length)return this.error="Zero buffer length",-1;if(255===r[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===r[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&r[0]),!1===this.longFormUsed)return this.length=r[0],this.blockLength=1,t+this.blockLength;let i=127&r[0];if(i>8)return this.error="Too big integer",-1;if(i+1>r.length)return this.error="End of input reached before message was fully decoded",-1;let n=t+1,l=a.subarray(n,n+i);return 0===l[i-1]&&this.warnings.push("Needlessly long encoded length"),this.length=e3(l,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=i+1,t+this.blockLength}toBER(e=!1){let t,s;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&((s=new Uint8Array(t))[0]=128),t;if(this.longFormUsed){let a=e4(this.length,8);if(a.byteLength>127)return this.error="Too big length",tp;if(t=new ArrayBuffer(a.byteLength+1),e)return t;let r=new Uint8Array(a);(s=new Uint8Array(t))[0]=128|a.byteLength;for(let e=0;e<a.byteLength;e++)s[e+1]=r[e];return t}return t=new ArrayBuffer(1),!1===e&&((s=new Uint8Array(t))[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}tx.NAME="lengthBlock";let tC={};class tB extends tS{constructor({name:e="",optional:t=!1,primitiveSchema:s,...a}={},r){super(a),this.name=e,this.optional=t,s&&(this.primitiveSchema=s),this.idBlock=new tN(a),this.lenBlock=new tx(a),this.valueBlock=r?new r(a):new tA(a)}fromBER(e,t,s){let a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?s:this.lenBlock.length);return -1===a?this.error=this.valueBlock.error:(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),a}toBER(e,t){let s=t||new th;t||function e(t){var s;if(t instanceof tC.Constructed)for(let s of t.valueBlock.value)e(s)&&(t.lenBlock.isIndefiniteForm=!0);return!!(null===(s=t.lenBlock)||void 0===s?void 0:s.isIndefiniteForm)}(this);let a=this.idBlock.toBER(e);if(s.write(a),this.lenBlock.isIndefiniteForm)s.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,s),s.write(new ArrayBuffer(2));else{let t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;let a=this.lenBlock.toBER(e);s.write(a),s.write(t)}return t?tp:s.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():e0.ToHex(this.toBER())}onAsciiEncoding(){let e=this.constructor.NAME,t=e0.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){return this===e||e instanceof this.constructor&&e9(this.toBER(),e.toBER())}}tB.NAME="BaseBlock";class tV extends tB{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e="",...t}={},s){super(t,s),e&&this.fromString(e)}fromBER(e,t,s){let a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?s:this.lenBlock.length);return -1===a?this.error=this.valueBlock.error:(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),a}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}tV.NAME="BaseStringBlock";class tE extends tk(tA){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}tE.NAME="PrimitiveValueBlock";class tI extends tB{constructor(e={}){super(e,tE),this.idBlock.isConstructed=!1}}function t_(e,t=0,s=e.length){let a=t,r=new tB({},tA),i=new tS;if(!tc(i,e,t,s))return r.error=i.error,{offset:-1,result:r};if(!e.subarray(t,t+s).length)return r.error="Zero buffer length",{offset:-1,result:r};let n=r.idBlock.fromBER(e,t,s);if(r.idBlock.warnings.length&&r.warnings.concat(r.idBlock.warnings),-1===n)return r.error=r.idBlock.error,{offset:-1,result:r};if(t=n,s-=r.idBlock.blockLength,n=r.lenBlock.fromBER(e,t,s),r.lenBlock.warnings.length&&r.warnings.concat(r.lenBlock.warnings),-1===n)return r.error=r.lenBlock.error,{offset:-1,result:r};if(t=n,s-=r.lenBlock.blockLength,!r.idBlock.isConstructed&&r.lenBlock.isIndefiniteForm)return r.error="Indefinite length form used for primitive encoding form",{offset:-1,result:r};let l=tB;if(1===r.idBlock.tagClass){if(r.idBlock.tagNumber>=37&&!1===r.idBlock.isHexOnly)return r.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:r};switch(r.idBlock.tagNumber){case 0:if(r.idBlock.isConstructed&&r.lenBlock.length>0)return r.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:r};l=tC.EndOfContent;break;case 1:l=tC.Boolean;break;case 2:l=tC.Integer;break;case 3:l=tC.BitString;break;case 4:l=tC.OctetString;break;case 5:l=tC.Null;break;case 6:l=tC.ObjectIdentifier;break;case 10:l=tC.Enumerated;break;case 12:l=tC.Utf8String;break;case 13:l=tC.RelativeObjectIdentifier;break;case 14:l=tC.TIME;break;case 15:return r.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:r};case 16:l=tC.Sequence;break;case 17:l=tC.Set;break;case 18:l=tC.NumericString;break;case 19:l=tC.PrintableString;break;case 20:l=tC.TeletexString;break;case 21:l=tC.VideotexString;break;case 22:l=tC.IA5String;break;case 23:l=tC.UTCTime;break;case 24:l=tC.GeneralizedTime;break;case 25:l=tC.GraphicString;break;case 26:l=tC.VisibleString;break;case 27:l=tC.GeneralString;break;case 28:l=tC.UniversalString;break;case 29:l=tC.CharacterString;break;case 30:l=tC.BmpString;break;case 31:l=tC.DATE;break;case 32:l=tC.TimeOfDay;break;case 33:l=tC.DateTime;break;case 34:l=tC.Duration;break;default:{let e=r.idBlock.isConstructed?new tC.Constructed:new tC.Primitive;e.idBlock=r.idBlock,e.lenBlock=r.lenBlock,e.warnings=r.warnings,r=e}}}else l=r.idBlock.isConstructed?tC.Constructed:tC.Primitive;return n=(r=function(e,t){if(e instanceof t)return e;let s=new t;return s.idBlock=e.idBlock,s.lenBlock=e.lenBlock,s.warnings=e.warnings,s.valueBeforeDecodeView=e.valueBeforeDecodeView,s}(r,l)).fromBER(e,t,r.lenBlock.isIndefiniteForm?s:r.lenBlock.length),r.valueBeforeDecodeView=e.subarray(a,a+r.blockLength),{offset:n,result:r}}function tD(e){if(!e.byteLength){let e=new tB({},tA);return e.error="Input buffer has zero length",{offset:-1,result:e}}return t_(eW.toUint8Array(e).slice(),0,e.byteLength)}tC.Primitive=tI,tI.NAME="PRIMITIVE";class tO extends tA{constructor({value:e=[],isIndefiniteForm:t=!1,...s}={}){super(s),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,s){var a,r;let i=eW.toUint8Array(e);if(!tc(this,i,t,s))return -1;if(this.valueBeforeDecodeView=i.subarray(t,t+s),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let n=t;for(;a=this.isIndefiniteForm,r=s,(a?1:r)>0;){let e=t_(i,n,s);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(n=e.offset,this.blockLength+=e.result.blockLength,s-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===tv)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===tv?this.value.pop():this.warnings.push("No EndOfContent block encoded")),n}toBER(e,t){let s=t||new th;for(let t=0;t<this.value.length;t++)this.value[t].toBER(e,s);return t?tp:s.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let t of this.value)e.value.push(t.toJSON());return e}}tO.NAME="ConstructedValueBlock";class tP extends tB{constructor(e={}){super(e,tO),this.idBlock.isConstructed=!0}fromBER(e,t,s){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?s:this.lenBlock.length);return -1===a?this.error=this.valueBlock.error:(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),a}onAsciiEncoding(){let e=[];for(let t of this.valueBlock.value)e.push(t.toString("ascii").split("\n").map(e=>`  ${e}`).join("\n"));let t=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join("\n")}`:`${t} :`}}tC.Constructed=tP,tP.NAME="CONSTRUCTED";class tU extends tA{fromBER(e,t,s){return t}toBER(e){return tp}}tU.override="EndOfContentValueBlock";class tR extends tB{constructor(e={}){super(e,tU),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}tC.EndOfContent=tR,tR.NAME=tv;class tj extends tB{constructor(e={}){super(e,tA),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,s){return(this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=s,t+s>e.byteLength)?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+s}toBER(e,t){let s=new ArrayBuffer(2);if(!e){let e=new Uint8Array(s);e[0]=5,e[1]=0}return t&&t.write(s),s}onAsciiEncoding(){return`${this.constructor.NAME}`}}tC.Null=tj,tj.NAME="NULL";class tT extends tk(tA){get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=255*!!e}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=eW.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,s){let a=eW.toUint8Array(e);return tc(this,a,t,s)?(this.valueHexView=a.subarray(t,t+s),s>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,e6.call(this),this.blockLength=s,t+s):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}tT.NAME="BooleanValueBlock";class tL extends tB{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,tT),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}tC.Boolean=tL,tL.NAME="BOOLEAN";class tH extends tk(tO){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,s){let a=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(a=tO.prototype.fromBER.call(this,e,t,s)))return a;for(let e=0;e<this.value.length;e++){let t=this.value[e].constructor.NAME;if(t===tv){if(!this.isIndefiniteForm)return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1;break}if(t!==tw)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,a=super.fromBER(e,t,s),this.blockLength=s;return a}toBER(e,t){return this.isConstructed?tO.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}tH.NAME="OctetStringValueBlock";class tK extends tB{constructor({idBlock:e={},lenBlock:t={},...s}={}){var a,r;null!==(a=s.isConstructed)&&void 0!==a||(s.isConstructed=!!(null===(r=s.value)||void 0===r?void 0:r.length)),super({idBlock:{isConstructed:s.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!s.isIndefiniteForm},...s},tH),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,s){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===s)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let a=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+s);try{if(a.byteLength){let e=t_(a,0,a.byteLength);-1!==e.offset&&e.offset===s&&(this.valueBlock.value=[e.result])}}catch{}}return super.fromBER(e,t,s)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return tP.prototype.onAsciiEncoding.call(this);let e=this.constructor.NAME,t=e0.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof o&&e.push(t.valueBlock.valueHexView);return eW.concat(e)}}tC.OctetString=o=tK,tK.NAME=tw;class tM extends tk(tO){constructor({unusedBits:e=0,isConstructed:t=!1,...s}={}){super(s),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,s){if(!s)return t;let a=-1;if(this.isConstructed){if(-1===(a=tO.prototype.fromBER.call(this,e,t,s)))return a;for(let e of this.value){let t=e.constructor.NAME;if(t===tv){if(!this.isIndefiniteForm)return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1;break}if(t!==tb)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let s=e.valueBlock;if(this.unusedBits>0&&s.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=s.unusedBits}return a}let r=eW.toUint8Array(e);if(!tc(this,r,t,s))return -1;let i=r.subarray(t,t+s);if(this.unusedBits=i[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let e=i.subarray(1);try{if(e.byteLength){let t=t_(e,0,e.byteLength);-1!==t.offset&&t.offset===s-1&&(this.value=[t.result])}}catch{}}return this.valueHexView=i.subarray(1),this.blockLength=i.length,t+s}toBER(e,t){if(this.isConstructed)return tO.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return tp;let s=new Uint8Array(this.valueHexView.length+1);return s[0]=this.unusedBits,s.set(this.valueHexView,1),s.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}tM.NAME="BitStringValueBlock";class tJ extends tB{constructor({idBlock:e={},lenBlock:t={},...s}={}){var a,r;null!==(a=s.isConstructed)&&void 0!==a||(s.isConstructed=!!(null===(r=s.value)||void 0===r?void 0:r.length)),super({idBlock:{isConstructed:s.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!s.isIndefiniteForm},...s},tM),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,s){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,s)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return tP.prototype.onAsciiEncoding.call(this);{let e=[];for(let t of this.valueBlock.valueHexView)e.push(t.toString(2).padStart(8,"0"));let t=e.join(""),s=this.constructor.NAME,a=t.substring(0,t.length-this.valueBlock.unusedBits);return`${s} : ${a}`}}}function t$(e){if(e>=tm.length)for(let t=tm.length;t<=e;t++){let e=new Uint8Array([0]),s=tm[t-1].slice(0);for(let t=s.length-1;t>=0;t--){let a=new Uint8Array([(s[t]<<1)+e[0]]);e[0]=a[0]/10,s[t]=a[0]%10}e[0]>0&&(s=e5(e,s)),tm.push(s)}return tm[e]}tC.BitString=tJ,tJ.NAME=tb;class tF extends tk(tA){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=e6.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){let t=e<0?-1*e:e,s=128;for(let a=1;a<8;a++){if(t<=s){if(e<0){let e=e4(s-t,8,a),r=new Uint8Array(e);return r[0]|=128,e}let r=e4(t,8,a),i=new Uint8Array(r);if(128&i[0]){let e=r.slice(0),t=new Uint8Array(e);i=new Uint8Array(r=new ArrayBuffer(r.byteLength+1));for(let s=0;s<e.byteLength;s++)i[s+1]=t[s];i[0]=0}return r}s*=256}return new ArrayBuffer(0)}(e))}get valueDec(){return this._valueDec}fromDER(e,t,s,a=0){let r=this.fromBER(e,t,s);if(-1===r)return r;let i=this.valueHexView;return 0===i[0]&&(128&i[1])!=0?this.valueHexView=i.subarray(1):0!==a&&i.length<a&&(a-i.length>1&&(a=i.length+1),this.valueHexView=i.subarray(a-i.length)),r}toDER(e=!1){let t=this.valueHexView;switch(!0){case(128&t[0])!=0:{let e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&(128&t[1])==0:this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,s){let a=super.fromBER(e,t,s);return -1===a||this.setValueHex(),a}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e;let t=8*this.valueHexView.length-1,s=new Uint8Array(8*this.valueHexView.length/3),a=0,r=this.valueHexView,i="",n=!1;for(let n=r.byteLength-1;n>=0;n--){e=r[n];for(let r=0;r<8;r++)(1&e)==1&&(a===t?(s=function(e,t){let s,a=0,r=new Uint8Array(e),i=new Uint8Array(t),n=r.slice(0),l=n.length-1,o=i.slice(0),u=o.length-1,c=0;for(let e=u;e>=0;e--,c++)!0==(s=n[l-c]-o[u-c]-a)<0?(a=1,n[l-c]=s+10):(a=0,n[l-c]=s);if(a>0)for(let e=l-u+1;e>=0;e--,c++)if((s=n[l-c]-a)<0)a=1,n[l-c]=s+10;else{a=0,n[l-c]=s;break}return n.slice()}(t$(a),s),i="-"):s=function(e,t){let s=new Uint8Array([0]),a=new Uint8Array(e),r=new Uint8Array(t),i=a.slice(0),n=i.length-1,l=r.slice(0),o=l.length-1,u=0,c=o<n?n:o,h=0;for(let e=c;e>=0;e--,h++)u=!0==h<l.length?i[n-h]+l[o-h]+s[0]:i[n-h]+s[0],(s[0]=u/10,!0==h>=i.length)?i=e5(new Uint8Array([u%10]),i):i[n-h]=u%10;return s[0]>0&&(i=e5(s,i)),i}(s,t$(a))),a++,e>>=1}for(let e=0;e<s.length;e++)s[e]&&(n=!0),n&&(i+=td.charAt(s[e]));return!1===n&&(i+=td.charAt(0)),i}}tF.NAME="IntegerValueBlock",Object.defineProperty(tF.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class tq extends tB{constructor(e={}){super(e,tF),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return to(),BigInt(this.valueBlock.toString())}static fromBigInt(e){to();let t=BigInt(e),s=new th,a=t.toString(16).replace(/^-/,""),r=new Uint8Array(e0.FromHex(a));if(t<0){let e=new Uint8Array(r.length+(128&r[0]?1:0));e[0]|=128;let a=BigInt(`0x${e0.ToHex(e)}`)+t,i=eW.toUint8Array(e0.FromHex(a.toString(16)));i[0]|=128,s.write(i)}else 128&r[0]&&s.write(new Uint8Array([0])),s.write(r);return new u({valueHex:s.final()})}convertToDER(){let e=new u({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new u({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}tC.Integer=u=tq,tq.NAME="INTEGER";class tW extends tq{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}tC.Enumerated=tW,tW.NAME="ENUMERATED";class tZ extends tk(tA){constructor({valueDec:e=-1,isFirstSid:t=!1,...s}={}){super(s),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,s){if(!s)return t;let a=eW.toUint8Array(e);if(!tc(this,a,t,s))return -1;let r=a.subarray(t,t+s);this.valueHexView=new Uint8Array(s);for(let e=0;e<s&&(this.valueHexView[e]=127&r[e],this.blockLength++,(128&r[e])!=0);e++);let i=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)i[e]=this.valueHexView[e];return(this.valueHexView=i,(128&r[this.blockLength-1])!=0)?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=e3(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){to();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;let s=new Uint8Array(t.length/7);for(let e=0;e<s.length;e++)s[e]=parseInt(t.slice(7*e,7*e+7),2)+128*(e+1<s.length);this.fromBER(s.buffer,0,s.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let t=this.valueHexView,s=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)s[e]=128|t[e];return s[this.blockLength-1]=t[this.blockLength-1],s.buffer}let t=e4(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",tp;let s=new Uint8Array(t.byteLength);if(!e){let e=new Uint8Array(t),a=t.byteLength-1;for(let t=0;t<a;t++)s[t]=128|e[t];s[a]=e[a]}return s}toString(){let e="";if(this.isHexOnly)e=e0.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}tZ.NAME="sidBlock";class tG extends tA{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,s){let a=t;for(;s>0;){let t=new tZ;if(-1===(a=t.fromBER(e,a,s))){this.blockLength=0,this.error=t.error;break}0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,s-=t.blockLength,this.value.push(t)}return a}toBER(e){let t=[];for(let s=0;s<this.value.length;s++){let a=this.value[s].toBER(e);if(0===a.byteLength)return this.error=this.value[s].error,tp;t.push(a)}return tu(t)}fromString(e){this.value=[];let t=0,s=0,a="",r=!1;do if(a=-1===(s=e.indexOf(".",t))?e.substring(t):e.substring(t,s),t=s+1,r){let e=this.value[0],t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:this.value=[];return}let s=parseInt(a,10);if(isNaN(s))return;e.valueDec=s+t,r=!1}else{let e=new tZ;if(a>Number.MAX_SAFE_INTEGER)to(),e.valueBigInt=BigInt(a);else if(e.valueDec=parseInt(a,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,r=!0),this.value.push(e)}while(-1!==s)}toString(){let e="",t=!1;for(let s=0;s<this.value.length;s++){t=this.value[s].isHexOnly;let a=this.value[s].toString();0!==s&&(e=`${e}.`),t?(a=`{${a}}`,this.value[s].isFirstSid?e=`2.{${a} - 80}`:e+=a):e+=a}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}tG.NAME="ObjectIdentifierValueBlock";class tz extends tB{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,tG),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}tC.ObjectIdentifier=tz,tz.NAME="OBJECT IDENTIFIER";class tQ extends tk(tS){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,s){if(0===s)return t;let a=eW.toUint8Array(e);if(!tc(this,a,t,s))return -1;let r=a.subarray(t,t+s);this.valueHexView=new Uint8Array(s);for(let e=0;e<s&&(this.valueHexView[e]=127&r[e],this.blockLength++,(128&r[e])!=0);e++);let i=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength;e++)i[e]=this.valueHexView[e];return(this.valueHexView=i,(128&r[this.blockLength-1])!=0)?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=e3(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let t=this.valueHexView,s=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)s[e]=128|t[e];return s[this.blockLength-1]=t[this.blockLength-1],s.buffer}let t=e4(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",tp;let s=new Uint8Array(t.byteLength);if(!e){let e=new Uint8Array(t),a=t.byteLength-1;for(let t=0;t<a;t++)s[t]=128|e[t];s[a]=e[a]}return s.buffer}toString(){let e="";return this.isHexOnly?e0.ToHex(this.valueHexView):this.valueDec.toString()}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}tQ.NAME="relativeSidBlock";class tY extends tA{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,s){let a=t;for(;s>0;){let t=new tQ;if(-1===(a=t.fromBER(e,a,s))){this.blockLength=0,this.error=t.error;break}this.blockLength+=t.blockLength,s-=t.blockLength,this.value.push(t)}return a}toBER(e,t){let s=[];for(let t=0;t<this.value.length;t++){let a=this.value[t].toBER(e);if(0===a.byteLength)return this.error=this.value[t].error,tp;s.push(a)}return tu(s)}fromString(e){this.value=[];let t=0,s=0,a="";do{a=-1===(s=e.indexOf(".",t))?e.substring(t):e.substring(t,s),t=s+1;let r=new tQ;if(r.valueDec=parseInt(a,10),isNaN(r.valueDec))break;this.value.push(r)}while(-1!==s);return!0}toString(){let e="",t=!1;for(let s=0;s<this.value.length;s++){t=this.value[s].isHexOnly;let a=this.value[s].toString();0!==s&&(e=`${e}.`),t?e+=a=`{${a}}`:e+=a}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}tY.NAME="RelativeObjectIdentifierValueBlock";class tX extends tB{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,tY),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}tC.RelativeObjectIdentifier=tX,tX.NAME="RelativeObjectIdentifier";class t0 extends tP{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}tC.Sequence=t0,t0.NAME="SEQUENCE";class t1 extends tP{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}tC.Set=t1,t1.NAME="SET";class t2 extends tk(tA){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=""}toJSON(){return{...super.toJSON(),value:this.value}}}t2.NAME="StringValueBlock";class t3 extends t2{}t3.NAME="SimpleStringValueBlock";class t4 extends tV{constructor({...e}={}){super(e,t3)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,eW.toUint8Array(e))}fromString(e){let t=e.length,s=this.valueBlock.valueHexView=new Uint8Array(t);for(let a=0;a<t;a++)s[a]=e.charCodeAt(a);this.valueBlock.value=e}}t4.NAME="SIMPLE STRING";class t8 extends t4{fromBuffer(e){this.valueBlock.valueHexView=eW.toUint8Array(e);try{this.valueBlock.value=e0.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=e0.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(e0.FromUtf8String(e)),this.valueBlock.value=e}}t8.NAME="Utf8StringValueBlock";class t5 extends t8{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}tC.Utf8String=t5,t5.NAME="UTF8String";class t6 extends t4{fromBuffer(e){this.valueBlock.value=e0.ToUtf16String(e),this.valueBlock.valueHexView=eW.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(e0.FromUtf16String(e))}}t6.NAME="BmpStringValueBlock";class t9 extends t6{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}tC.BmpString=t9,t9.NAME="BMPString";class t7 extends t4{fromBuffer(e){let t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),s=new Uint8Array(t);for(let e=0;e<s.length;e+=4)s[e]=s[e+3],s[e+1]=s[e+2],s[e+2]=0,s[e+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){let t=e.length,s=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let a=0;a<t;a++){let t=new Uint8Array(e4(e.charCodeAt(a),8));if(t.length>4)continue;let r=4-t.length;for(let e=t.length-1;e>=0;e--)s[4*a+e+r]=t[e]}this.valueBlock.value=e}}t7.NAME="UniversalStringValueBlock";class se extends t7{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}tC.UniversalString=se,se.NAME="UniversalString";class st extends t4{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}tC.NumericString=st,st.NAME="NumericString";class ss extends t4{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}tC.PrintableString=ss,ss.NAME="PrintableString";class sa extends t4{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}tC.TeletexString=sa,sa.NAME="TeletexString";class sr extends t4{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}tC.VideotexString=sr,sr.NAME="VideotexString";class si extends t4{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}tC.IA5String=si,si.NAME="IA5String";class sn extends t4{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}tC.GraphicString=sn,sn.NAME="GraphicString";class sl extends t4{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}tC.VisibleString=sl,sl.NAME="VisibleString";class so extends t4{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}tC.GeneralString=so,so.NAME="GeneralString";class su extends t4{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}tC.CharacterString=su,su.NAME="CharacterString";class sc extends sl{constructor({value:e,valueDate:t,...s}={}){if(super(s),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,eW.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),s=new Uint8Array(t);for(let t=0;t<e.length;t++)s[t]=e.charCodeAt(t);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(null===t){this.error="Wrong input string for conversion";return}let s=parseInt(t[1],10);s>=50?this.year=1900+s:this.year=2e3+s,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(e="iso"){if("iso"===e){let e=Array(7);return e[0]=e7(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=e7(this.month,2),e[2]=e7(this.day,2),e[3]=e7(this.hour,2),e[4]=e7(this.minute,2),e[5]=e7(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}tC.UTCTime=sc,sc.NAME="UTCTime";class sh extends sc{constructor(e={}){var t;super(e),null!==(t=this.millisecond)&&void 0!==t||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,s=!1,a="",r="",i=0,n=0,l=0;if("Z"===e[e.length-1])a=e.substring(0,e.length-1),s=!0;else{if(isNaN(new Number(e[e.length-1]).valueOf()))throw Error("Wrong input string for conversion");a=e}if(s){if(-1!==a.indexOf("+")||-1!==a.indexOf("-"))throw Error("Wrong input string for conversion")}else{let e=1,t=a.indexOf("+"),s="";if(-1===t&&(t=a.indexOf("-"),e=-1),-1!==t){if(s=a.substring(t+1),a=a.substring(0,t),2!==s.length&&4!==s.length)throw Error("Wrong input string for conversion");let r=parseInt(s.substring(0,2),10);if(isNaN(r.valueOf()))throw Error("Wrong input string for conversion");if(n=e*r,4===s.length){if(isNaN((r=parseInt(s.substring(2,4),10)).valueOf()))throw Error("Wrong input string for conversion");l=e*r}}}let o=a.indexOf(".");if(-1===o&&(o=a.indexOf(",")),-1!==o){let e=new Number(`0${a.substring(o)}`);if(isNaN(e.valueOf()))throw Error("Wrong input string for conversion");i=e.valueOf(),r=a.substring(0,o)}else r=a;switch(!0){case 8===r.length:if(t=/(\d{4})(\d{2})(\d{2})/ig,-1!==o)throw Error("Wrong input string for conversion");break;case 10===r.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,-1!==o){let e=60*i;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===r.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,-1!==o){let e=60*i;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===r.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,-1!==o){let e=1e3*i;this.millisecond=Math.floor(e)}break;default:throw Error("Wrong input string for conversion")}let u=t.exec(r);if(null===u)throw Error("Wrong input string for conversion");for(let e=1;e<u.length;e++)switch(e){case 1:this.year=parseInt(u[e],10);break;case 2:this.month=parseInt(u[e],10);break;case 3:this.day=parseInt(u[e],10);break;case 4:this.hour=parseInt(u[e],10)+n;break;case 5:this.minute=parseInt(u[e],10)+l;break;case 6:this.second=parseInt(u[e],10);break;default:throw Error("Wrong input string for conversion")}if(!1===s){let e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(e="iso"){if("iso"===e){let e=[];return e.push(e7(this.year,4)),e.push(e7(this.month,2)),e.push(e7(this.day,2)),e.push(e7(this.hour,2)),e.push(e7(this.minute,2)),e.push(e7(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(e7(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}tC.GeneralizedTime=sh,sh.NAME="GeneralizedTime";class sm extends t5{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}tC.DATE=sm,sm.NAME="DATE";class sd extends t5{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}tC.TimeOfDay=sd,sd.NAME="TimeOfDay";class sf extends t5{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}tC.DateTime=sf,sf.NAME="DateTime";class sg extends t5{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}tC.Duration=sg,sg.NAME="Duration";class sp extends t5{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}tC.TIME=sp,sp.NAME="TIME";class sy{constructor({name:e="",optional:t=!1}={}){this.name=e,this.optional=t}}class sv extends sy{constructor({value:e=[],...t}={}){super(t),this.value=e}}class sw extends sy{constructor({value:e=new sy,local:t=!1,...s}={}){super(s),this.value=e,this.local=t}}class sb{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=eW.toUint8Array(e)}constructor({data:e=ty}={}){this.dataView=eW.toUint8Array(e)}fromBER(e,t,s){let a=t+s;return this.dataView=eW.toUint8Array(e).subarray(t,a),a}toBER(e){return this.dataView.slice().buffer}}function sk(e,t,s){if(s instanceof sv){for(let a of s.value)if(sk(e,t,a).verified)return{verified:!0,result:e};{let e={verified:!1,result:{error:"Wrong values for Choice type"}};return s.hasOwnProperty(tf)&&(e.name=s.name),e}}if(s instanceof sy)return s.hasOwnProperty(tf)&&(e[s.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(s instanceof Object==!1||"idBlock"in s==!1||"fromBER"in s.idBlock==!1||"toBER"in s.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let a=s.idBlock.toBER(!1);if(0===a.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===s.idBlock.fromBER(a,0,a.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===s.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(s.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===s.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(s.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===s.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(s.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!("isHexOnly"in s.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(s.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(s.idBlock.isHexOnly){if(tg in s.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let a=s.idBlock.valueHexView,r=t.idBlock.valueHexView;if(a.length!==r.length)return{verified:!1,result:e};for(let t=0;t<a.length;t++)if(a[t]!==r[1])return{verified:!1,result:e}}if(s.name&&(s.name=s.name.replace(/^\s+|\s+$/g,""),s.name&&(e[s.name]=t)),s instanceof tC.Constructed){let a=0,r={verified:!1,result:{error:"Unknown error"}},i=s.valueBlock.value.length;if(i>0&&s.valueBlock.value[0]instanceof sw&&(i=t.valueBlock.value.length),0===i)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==s.valueBlock.value.length){let t=!0;for(let e=0;e<s.valueBlock.value.length;e++)t=t&&(s.valueBlock.value[e].optional||!1);return t?{verified:!0,result:e}:(s.name&&(s.name=s.name.replace(/^\s+|\s+$/g,""),s.name&&delete e[s.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(let n=0;n<i;n++)if(n-a>=t.valueBlock.value.length){if(!1===s.valueBlock.value[n].optional){let t={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",s.name&&(s.name=s.name.replace(/^\s+|\s+$/g,""),s.name&&(delete e[s.name],t.name=s.name)),t}}else if(s.valueBlock.value[0]instanceof sw){if(!1===(r=sk(e,t.valueBlock.value[n],s.valueBlock.value[0].value)).verified){if(!s.valueBlock.value[0].optional)return s.name&&(s.name=s.name.replace(/^\s+|\s+$/g,""),s.name&&delete e[s.name]),r;a++}if(tf in s.valueBlock.value[0]&&s.valueBlock.value[0].name.length>0){let a={};void 0===(a="local"in s.valueBlock.value[0]&&s.valueBlock.value[0].local?t:e)[s.valueBlock.value[0].name]&&(a[s.valueBlock.value[0].name]=[]),a[s.valueBlock.value[0].name].push(t.valueBlock.value[n])}}else if(!1===(r=sk(e,t.valueBlock.value[n-a],s.valueBlock.value[n])).verified){if(!s.valueBlock.value[n].optional)return s.name&&(s.name=s.name.replace(/^\s+|\s+$/g,""),s.name&&delete e[s.name]),r;a++}if(!1===r.verified){let t={verified:!1,result:e};return s.name&&(s.name=s.name.replace(/^\s+|\s+$/g,""),s.name&&(delete e[s.name],t.name=s.name)),t}return{verified:!0,result:e}}if(s.primitiveSchema&&tg in t.valueBlock){let a=t_(t.valueBlock.valueHexView);if(-1===a.offset){let t={verified:!1,result:a.result};return s.name&&(s.name=s.name.replace(/^\s+|\s+$/g,""),s.name&&(delete e[s.name],t.name=s.name)),t}return sk(e,a.result,s.primitiveSchema)}return{verified:!0,result:e}}class sS{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){let t=e.length;this.length=t;for(let s=0;s<t;s++)this.view[s]=e.charCodeAt(s)}toString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)s+=String.fromCharCode(this.view[a]);return s}fromHexString(e){let t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);let s=new Map;s.set("0",0),s.set("1",1),s.set("2",2),s.set("3",3),s.set("4",4),s.set("5",5),s.set("6",6),s.set("7",7),s.set("8",8),s.set("9",9),s.set("A",10),s.set("a",10),s.set("B",11),s.set("b",11),s.set("C",12),s.set("c",12),s.set("D",13),s.set("d",13),s.set("E",14),s.set("e",14),s.set("F",15),s.set("f",15);let a=0,r=0;for(let i=0;i<t;i++)i%2?(r|=s.get(e.charAt(i)),this.view[a]=r,a++):r=s.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let s="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){let e=this.view[a].toString(16).toUpperCase();s=s+(1==e.length?"0":"")+e}return s}copy(e=0,t=this.length-e){if(!e&&!this.length)return new sS;if(e<0||e>this.length-1)throw Error(`Wrong start position: ${e}`);return new sS({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new sS;if(e<0||e>this.length-1)throw Error(`Wrong start position: ${e}`);return new sS({buffer:this._buffer.slice(e,t)})}realloc(e){let t=new ArrayBuffer(e),s=new Uint8Array(t);e>this._view.length?s.set(this._view):s.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){let t=this.length,s=e.length,a=e._view.subarray();this.realloc(t+s),this._view.set(a,t)}insert(e,t=0,s=this.length-t){return!(t>this.length-1)&&(s>this.length-t&&(s=this.length-t),s>e.length&&(s=e.length),s==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,s),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,s,a){let{start:r,length:i,backward:n}=this.prepareFindParameters(t,s,a),l=e.length;if(l>i)return -1;let o=[];for(let t=0;t<l;t++)o.push(e.view[t]);for(let e=0;e<=i-l;e++){let t=!0,s=n?r-l-e:r+e;for(let e=0;e<l;e++)if(this.view[e+s]!=o[e]){t=!1;break}if(t)return n?r-l-e:r+l+e}return -1}findFirstIn(e,t,s,a){let{start:r,length:i,backward:n}=this.prepareFindParameters(t,s,a),l={id:-1,position:n?0:r+i,length:0};for(let t=0;t<e.length;t++){let s=this.findPattern(e[t],r,i,n);if(-1!=s){let a=!1,r=e[t].length;n?s-r>=l.position-l.length&&(a=!0):s-r<=l.position-l.length&&(a=!0),a&&(l.position=s,l.id=t,l.length=r)}}return l}findAllIn(e,t,s){let{start:a,length:r}=this.prepareFindParameters(t,s),i=[],n={id:-1,position:a};for(;;){let t=n.position;if(-1==(n=this.findFirstIn(e,n.position,r)).id)break;r-=n.position-t,i.push({id:n.id,position:n.position})}return i}findAllPatternIn(e,t,s){let{start:a,length:r}=this.prepareFindParameters(t,s),i=[],n=e.length;if(n>r)return -1;let l=Array.from(e.view);for(let e=0;e<=r-n;e++){let t=!0,s=a+e;for(let e=0;e<n;e++)if(this.view[e+s]!=l[e]){t=!1;break}t&&(i.push(a+n+e),e+=n-1)}return i}findFirstNotIn(e,t,s,a){let{start:r,length:i,backward:n}=this.prepareFindParameters(t,s,a),l={left:{id:-1,position:r},right:{id:-1,position:0},value:new sS},o=i;for(;o>0;){if(l.right=this.findFirstIn(e,n?r-i+o:r+i-o,o,n),-1==l.right.id){i=o,n?r-=i:r=l.left.position,l.value=new sS({buffer:this._buffer.slice(r,r+i)});break}if(l.right.position!=(n?l.left.position-e[l.right.id].length:l.left.position+e[l.right.id].length)){n?(r=l.right.position+e[l.right.id].length,i=l.left.position-l.right.position-e[l.right.id].length):(r=l.left.position,i=l.right.position-l.left.position-e[l.right.id].length),l.value=new sS({buffer:this._buffer.slice(r,r+i)});break}l.left=l.right,o-=e[l.right.id].length}if(n){let e=l.right;l.right=l.left,l.left=e}return l}findAllNotIn(e,t,s){let{start:a,length:r}=this.prepareFindParameters(t,s),i=[],n={left:{id:-1,position:a},right:{id:-1,position:a},value:new sS};do{let t=n.right.position;n=this.findFirstNotIn(e,n.right.position,r),r-=n.right.position-t,i.push({left:{id:n.left.id,position:n.left.position},right:{id:n.right.id,position:n.right.position},value:n.value})}while(-1!=n.right.id);return i}findFirstSequence(e,t,s,a){let{start:r,length:i,backward:n}=this.prepareFindParameters(t,s,a),l=this.skipNotPatterns(e,r,i,n);if(-1==l)return{position:-1,value:new sS};let o=this.skipPatterns(e,l,i-(n?r-l:l-r),n);return n?(r=o,i=l-o):(r=l,i=o-l),{position:o,value:new sS({buffer:this._buffer.slice(r,r+i)})}}findAllSequences(e,t,s){let{start:a,length:r}=this.prepareFindParameters(t,s),i=[],n={position:a,value:new sS};do{let t=n.position;-1!=(n=this.findFirstSequence(e,n.position,r)).position&&(r-=n.position-t,i.push({position:n.position,value:n.value}))}while(-1!=n.position);return i}findPairedPatterns(e,t,s,a){let r=[];if(e.isEqual(t))return r;let{start:i,length:n}=this.prepareFindParameters(s,a),l=0,o=this.findAllPatternIn(e,i,n);if(!Array.isArray(o)||0==o.length)return r;let u=this.findAllPatternIn(t,i,n);if(!Array.isArray(u)||0==u.length)return r;for(;l<o.length&&0!=u.length;){if(o[0]==u[0]){r.push({left:o[0],right:u[0]}),o.splice(0,1),u.splice(0,1);continue}if(o[l]>u[0])break;for(;o[l]<u[0]&&!(++l>=o.length););r.push({left:o[l-1],right:u[0]}),o.splice(l-1,1),u.splice(0,1),l=0}return r.sort((e,t)=>e.left-t.left),r}findPairedArrays(e,t,s,a){let{start:r,length:i}=this.prepareFindParameters(s,a),n=[],l=0,o=this.findAllIn(e,r,i);if(0==o.length)return n;let u=this.findAllIn(t,r,i);if(0==u.length)return n;for(;l<o.length&&0!=u.length;){if(o[0].position==u[0].position){n.push({left:o[0],right:u[0]}),o.splice(0,1),u.splice(0,1);continue}if(o[l].position>u[0].position)break;for(;o[l].position<u[0].position&&!(++l>=o.length););n.push({left:o[l-1],right:u[0]}),o.splice(l-1,1),u.splice(0,1),l=0}return n.sort((e,t)=>e.left.position-t.left.position),n}replacePattern(e,t,s,a,r=null){let i,n=[],l={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:o,length:u}=this.prepareFindParameters(s,a);if(null==r){if(0==(n=this.findAllIn([e],o,u)).length)return l}else n=r;l.searchPatternPositions.push(...Array.from(n,e=>e.position));let c=e.length-t.length,h=new ArrayBuffer(this.view.length-n.length*c),m=new Uint8Array(h);for(m.set(new Uint8Array(this.buffer,0,o)),i=0;i<n.length;i++){let s=0==i?o:n[i-1].position;m.set(new Uint8Array(this.buffer,s,n[i].position-e.length-s),s-i*c),m.set(t.view,n[i].position-e.length-i*c),l.replacePatternPositions.push(n[i].position-e.length-i*c)}return i--,m.set(new Uint8Array(this.buffer,n[i].position,this.length-n[i].position),n[i].position-e.length+t.length-i*c),this.buffer=h,this.view=new Uint8Array(this.buffer),l.status=1,l}skipPatterns(e,t,s,a){let{start:r,length:i,backward:n}=this.prepareFindParameters(t,s,a),l=r;for(let t=0;t<e.length;t++){let s=e[t].length,a=n?l-s:l,o=!0;for(let r=0;r<s;r++)if(this.view[r+a]!=e[t].view[r]){o=!1;break}if(o){if(t=-1,n){if((l-=s)<=0)break}else if((l+=s)>=r+i)break}}return l}skipNotPatterns(e,t,s,a){let{start:r,length:i,backward:n}=this.prepareFindParameters(t,s,a),l=-1;for(let t=0;t<i;t++){for(let s=0;s<e.length;s++){let a=e[s].length,i=n?r-t-a:r+t,o=!0;for(let t=0;t<a;t++)if(this.view[t+i]!=e[s].view[t]){o=!1;break}if(o){l=n?r-t:r+t;break}}if(-1!=l)break}return l}prepareFindParameters(e=null,t=null,s=!1){return null===e&&(e=s?this.length:0),e>this.length&&(e=this.length),s?(null===t&&(t=e),t>e&&(t=e)):(null===t&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:s}}}class sA{constructor(e={}){this._stream=new sS,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new sS({view:e.view}):"buffer"in e?this.stream=new sS({buffer:e.buffer}):"string"in e?this.stream=new sS({string:e.string}):"hexstring"in e?this.stream=new sS({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new sS,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(null==t||t>this.length)&&(t=this.length);let s=this.stream.findPattern(e,this.start,this.length,this.backward);if(-1==s)return s;if(this.backward){if(s<this.start-e.length-t)return -1}else if(s>this.start+e.length+t)return -1;return this.start=s,s}findFirstIn(e,t=null){(null==t||t>this.length)&&(t=this.length);let s=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(-1==s.id)return s;if(this.backward){if(s.position<this.start-e[s.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(s.position>this.start+e[s.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=s.position,s}findAllIn(e){let t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(null==t||t>this._length)&&(t=this._length);let s=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(-1==s.left.id&&-1==s.right.id)return s;if(this.backward){if(-1!=s.right.id&&s.right.position<this._start-e[s.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new sS}}else if(-1!=s.left.id&&s.left.position>this._start+e[s.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new sS};return this.backward?-1==s.left.id?this.start=0:this.start=s.left.position:-1==s.right.id?this.start=this._start+this._length:this.start=s.right.position,s}findAllNotIn(e){let t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,s=null){(null==t||t>this._length)&&(t=this._length),(null==s||s>t)&&(s=t);let a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(0==a.value.length)return a;if(this.backward){if(a.position<this._start-a.value.length-s)return{position:-1,value:new sS}}else if(a.position>this._start+a.value.length+s)return{position:-1,value:new sS};return this.start=a.position,a}findAllSequences(e){let t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,s=null){(null==s||s>this.length)&&(s=this.length);let a=this.backward?this.start-this.length:this.start,r=this.stream.findPairedPatterns(e,t,a,this.length);if(r.length){if(this.backward){if(r[0].right<this.start-t.length-s)return[]}else if(r[0].left>this.start+e.length+s)return[]}return r}findPairedArrays(e,t,s=null){(null==s||s>this.length)&&(s=this.length);let a=this.backward?this.start-this.length:this.start,r=this.stream.findPairedArrays(e,t,a,this.length);if(r.length){if(this.backward){if(r[0].right.position<this.start-t[r[0].right.id].length-s)return[]}else if(r[0].left.position>this.start+e[r[0].left.id].length+s)return[]}return r}replacePattern(e,t){let s=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,s,this.length)}skipPatterns(e){let t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){let t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return -1==t?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);let t=new Uint8Array(new Uint16Array([e]).buffer);this.stream.view[this._start]=t[1],this._stream.view[this._start+1]=t[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);let t=new Uint8Array(new Uint32Array([e]).buffer);this._stream.view[this._start]=t[2],this._stream.view[this._start+1]=t[1],this._stream.view[this._start+2]=t[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);let t=new Uint8Array(new Uint32Array([e]).buffer);this._stream.view[this._start]=t[3],this._stream.view[this._start+1]=t[2],this._stream.view[this._start+2]=t[1],this._stream.view[this._start+3]=t[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);let t=new Uint8Array(new Int16Array([e]).buffer);this._stream.view[this._start]=t[1],this._stream.view[this._start+1]=t[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);let t=new Uint8Array(new Int32Array([e]).buffer);this._stream.view[this._start]=t[3],this._stream.view[this._start+1]=t[2],this._stream.view[this._start+2]=t[1],this._stream.view[this._start+3]=t[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){let s;if(this._length<=0)return new Uint8Array(0);if(this._length<e&&(e=this._length),this.backward){let t=this._stream.view.subarray(this._length-e,this._length);s=new Uint8Array(e);for(let a=0;a<e;a++)s[e-1-a]=t[a]}else s=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),s}getUint16(e=!0){let t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){let t=this.getUint16(e);return 32768&t?-(32768-(32768^t)):t}getUint24(e=!0){let t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){let t=this.getBlock(4,e);return t.length<4?0:0x1000000*t[0]+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){let t=this.getUint32(e);return 0x80000000&t?-(0x80000000-(0x80000000^t)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+sA.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}sA.APPEND_BLOCK=1e3;function sN(e,...t){if(!(e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function sx(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function sC(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function sB(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function sV(e,t){return e<<32-t|e>>>t}function sE(e,t){return e<<t|e>>>32-t>>>0}(e,t)=>t.toString(16).padStart(2,"0");let sI={_0:48,_9:57,A:65,F:70,a:97,f:102};function s_(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}(e)),sN(e),e}class sD{}function sO(e){let t=t=>e().update(s_(t)).digest(),s=e();return t.outputLen=s.outputLen,t.blockLen=s.blockLen,t.create=()=>e(),t}class sP extends sD{constructor(e,t,s,a){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=a,this.buffer=new Uint8Array(e),this.view=sB(this.buffer)}update(e){sx(this),sN(e=s_(e));let{view:t,buffer:s,blockLen:a}=this,r=e.length;for(let i=0;i<r;){let n=Math.min(a-this.pos,r-i);if(n===a){let t=sB(e);for(;a<=r-i;i+=a)this.process(t,i);continue}s.set(e.subarray(i,i+n),this.pos),this.pos+=n,i+=n,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){sx(this),function(e,t){sN(e);let s=t.outputLen;if(e.length<s)throw Error("digestInto() expects output buffer of length at least "+s)}(e,this),this.finished=!0;let{buffer:t,view:s,blockLen:a,isLE:r}=this,{pos:i}=this;t[i++]=128,sC(this.buffer.subarray(i)),this.padOffset>a-i&&(this.process(s,0),i=0);for(let e=i;e<a;e++)t[e]=0;(function(e,t,s,a){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,s,a);let r=BigInt(32),i=BigInt(0xffffffff),n=Number(s>>r&i),l=Number(s&i),o=4*!!a,u=4*!a;e.setUint32(t+o,n,a),e.setUint32(t+u,l,a)})(s,a-8,BigInt(8*this.length),r),this.process(s,0);let n=sB(e),l=this.outputLen;if(l%4)throw Error("_sha2: outputLen should be aligned to 32bit");let o=l/4,u=this.get();if(o>u.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<o;e++)n.setUint32(4*e,u[e],r)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:s,length:a,finished:r,destroyed:i,pos:n}=this;return e.destroyed=i,e.finished=r,e.length=a,e.pos=n,a%t&&e.buffer.set(s),e}clone(){return this._cloneInto()}}let sU=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),sR=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),sj=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),sT=Uint32Array.from([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0]),sL=new Uint32Array(80);class sH extends sP{constructor(){super(64,20,8,!1),this.A=0|sT[0],this.B=0|sT[1],this.C=0|sT[2],this.D=0|sT[3],this.E=0|sT[4]}get(){let{A:e,B:t,C:s,D:a,E:r}=this;return[e,t,s,a,r]}set(e,t,s,a,r){this.A=0|e,this.B=0|t,this.C=0|s,this.D=0|a,this.E=0|r}process(e,t){for(let s=0;s<16;s++,t+=4)sL[s]=e.getUint32(t,!1);for(let e=16;e<80;e++)sL[e]=sE(sL[e-3]^sL[e-8]^sL[e-14]^sL[e-16],1);let{A:s,B:a,C:r,D:i,E:n}=this;for(let e=0;e<80;e++){var l,o,u,c;let t,h;e<20?(t=(l=a)&r^~l&i,h=0x5a827999):e<40?(t=a^r^i,h=0x6ed9eba1):e<60?(t=(o=a)&(u=r)^o&(c=i)^u&c,h=0x8f1bbcdc):(t=a^r^i,h=0xca62c1d6);let m=sE(s,5)+t+n+h+sL[e]|0;n=i,i=r,r=sE(a,30),a=s,s=m}s=s+this.A|0,a=a+this.B|0,r=r+this.C|0,i=i+this.D|0,n=n+this.E|0,this.set(s,a,r,i,n)}roundClean(){sC(sL)}destroy(){this.set(0,0,0,0,0),sC(this.buffer)}}let sK=sO(()=>new sH),sM=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),sJ=Uint8Array.from(Array(16).fill(0).map((e,t)=>t)),s$=sJ.map(e=>(9*e+5)%16),sF=(()=>{let e=[[sJ],[s$]];for(let t=0;t<4;t++)for(let s of e)s.push(s[t].map(e=>sM[e]));return e})();sF[0],sF[1],e=>Uint8Array.from(e);let sq=BigInt(0x100000000-1),sW=BigInt(32),sZ=(e,t,s)=>e>>>s,sG=(e,t,s)=>e<<32-s|t>>>s,sz=(e,t,s)=>e>>>s|t<<32-s,sQ=(e,t,s)=>e<<32-s|t>>>s,sY=(e,t,s)=>e<<64-s|t>>>s-32,sX=(e,t,s)=>e>>>s-32|t<<64-s;function s0(e,t,s,a){let r=(t>>>0)+(a>>>0);return{h:e+s+(r/0x100000000|0)|0,l:0|r}}let s1=(e,t,s)=>(e>>>0)+(t>>>0)+(s>>>0),s2=(e,t,s,a)=>t+s+a+(e/0x100000000|0)|0,s3=(e,t,s,a)=>(e>>>0)+(t>>>0)+(s>>>0)+(a>>>0),s4=(e,t,s,a,r)=>t+s+a+r+(e/0x100000000|0)|0,s8=(e,t,s,a,r)=>(e>>>0)+(t>>>0)+(s>>>0)+(a>>>0)+(r>>>0),s5=(e,t,s,a,r,i)=>t+s+a+r+i+(e/0x100000000|0)|0,s6=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),s9=new Uint32Array(64);class s7 extends sP{constructor(e=32){super(64,e,8,!1),this.A=0|sU[0],this.B=0|sU[1],this.C=0|sU[2],this.D=0|sU[3],this.E=0|sU[4],this.F=0|sU[5],this.G=0|sU[6],this.H=0|sU[7]}get(){let{A:e,B:t,C:s,D:a,E:r,F:i,G:n,H:l}=this;return[e,t,s,a,r,i,n,l]}set(e,t,s,a,r,i,n,l){this.A=0|e,this.B=0|t,this.C=0|s,this.D=0|a,this.E=0|r,this.F=0|i,this.G=0|n,this.H=0|l}process(e,t){for(let s=0;s<16;s++,t+=4)s9[s]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=s9[e-15],s=s9[e-2],a=sV(t,7)^sV(t,18)^t>>>3,r=sV(s,17)^sV(s,19)^s>>>10;s9[e]=r+s9[e-7]+a+s9[e-16]|0}let{A:s,B:a,C:r,D:i,E:n,F:l,G:o,H:u}=this;for(let e=0;e<64;e++){var c,h,m,d;let t=u+(sV(n,6)^sV(n,11)^sV(n,25))+((c=n)&l^~c&o)+s6[e]+s9[e]|0,f=(sV(s,2)^sV(s,13)^sV(s,22))+((h=s)&(m=a)^h&(d=r)^m&d)|0;u=o,o=l,l=n,n=i+t|0,i=r,r=a,a=s,s=t+f|0}s=s+this.A|0,a=a+this.B|0,r=r+this.C|0,i=i+this.D|0,n=n+this.E|0,l=l+this.F|0,o=o+this.G|0,u=u+this.H|0,this.set(s,a,r,i,n,l,o,u)}roundClean(){sC(s9)}destroy(){this.set(0,0,0,0,0,0,0,0),sC(this.buffer)}}let ae=function(e,t=!1){let s=e.length,a=new Uint32Array(s),r=new Uint32Array(s);for(let i=0;i<s;i++){let{h:s,l:n}=function(e,t=!1){return t?{h:Number(e&sq),l:Number(e>>sW&sq)}:{h:0|Number(e>>sW&sq),l:0|Number(e&sq)}}(e[i],t);[a[i],r[i]]=[s,n]}return[a,r]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),at=ae[0],as=ae[1],aa=new Uint32Array(80),ar=new Uint32Array(80);class ai extends sP{constructor(e=64){super(128,e,16,!1),this.Ah=0|sj[0],this.Al=0|sj[1],this.Bh=0|sj[2],this.Bl=0|sj[3],this.Ch=0|sj[4],this.Cl=0|sj[5],this.Dh=0|sj[6],this.Dl=0|sj[7],this.Eh=0|sj[8],this.El=0|sj[9],this.Fh=0|sj[10],this.Fl=0|sj[11],this.Gh=0|sj[12],this.Gl=0|sj[13],this.Hh=0|sj[14],this.Hl=0|sj[15]}get(){let{Ah:e,Al:t,Bh:s,Bl:a,Ch:r,Cl:i,Dh:n,Dl:l,Eh:o,El:u,Fh:c,Fl:h,Gh:m,Gl:d,Hh:f,Hl:g}=this;return[e,t,s,a,r,i,n,l,o,u,c,h,m,d,f,g]}set(e,t,s,a,r,i,n,l,o,u,c,h,m,d,f,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|s,this.Bl=0|a,this.Ch=0|r,this.Cl=0|i,this.Dh=0|n,this.Dl=0|l,this.Eh=0|o,this.El=0|u,this.Fh=0|c,this.Fl=0|h,this.Gh=0|m,this.Gl=0|d,this.Hh=0|f,this.Hl=0|g}process(e,t){for(let s=0;s<16;s++,t+=4)aa[s]=e.getUint32(t),ar[s]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|aa[e-15],s=0|ar[e-15],a=sz(t,s,1)^sz(t,s,8)^sZ(t,s,7),r=sQ(t,s,1)^sQ(t,s,8)^sG(t,s,7),i=0|aa[e-2],n=0|ar[e-2],l=sz(i,n,19)^sY(i,n,61)^sZ(i,n,6),o=s3(r,sQ(i,n,19)^sX(i,n,61)^sG(i,n,6),ar[e-7],ar[e-16]),u=s4(o,a,l,aa[e-7],aa[e-16]);aa[e]=0|u,ar[e]=0|o}let{Ah:s,Al:a,Bh:r,Bl:i,Ch:n,Cl:l,Dh:o,Dl:u,Eh:c,El:h,Fh:m,Fl:d,Gh:f,Gl:g,Hh:p,Hl:y}=this;for(let e=0;e<80;e++){let t=sz(c,h,14)^sz(c,h,18)^sY(c,h,41),v=sQ(c,h,14)^sQ(c,h,18)^sX(c,h,41),w=c&m^~c&f,b=s8(y,v,h&d^~h&g,as[e],ar[e]),k=s5(b,p,t,w,at[e],aa[e]),S=0|b,A=sz(s,a,28)^sY(s,a,34)^sY(s,a,39),N=sQ(s,a,28)^sX(s,a,34)^sX(s,a,39),x=s&r^s&n^r&n,C=a&i^a&l^i&l;p=0|f,y=0|g,f=0|m,g=0|d,m=0|c,d=0|h,({h:c,l:h}=s0(0|o,0|u,0|k,0|S)),o=0|n,u=0|l,n=0|r,l=0|i,r=0|s,i=0|a;let B=s1(S,N,C);s=s2(B,k,A,x),a=0|B}({h:s,l:a}=s0(0|this.Ah,0|this.Al,0|s,0|a)),({h:r,l:i}=s0(0|this.Bh,0|this.Bl,0|r,0|i)),({h:n,l:l}=s0(0|this.Ch,0|this.Cl,0|n,0|l)),({h:o,l:u}=s0(0|this.Dh,0|this.Dl,0|o,0|u)),({h:c,l:h}=s0(0|this.Eh,0|this.El,0|c,0|h)),({h:m,l:d}=s0(0|this.Fh,0|this.Fl,0|m,0|d)),({h:f,l:g}=s0(0|this.Gh,0|this.Gl,0|f,0|g)),({h:p,l:y}=s0(0|this.Hh,0|this.Hl,0|p,0|y)),this.set(s,a,r,i,n,l,o,u,c,h,m,d,f,g,p,y)}roundClean(){sC(aa,ar)}destroy(){sC(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class an extends ai{constructor(){super(48),this.Ah=0|sR[0],this.Al=0|sR[1],this.Bh=0|sR[2],this.Bl=0|sR[3],this.Ch=0|sR[4],this.Cl=0|sR[5],this.Dh=0|sR[6],this.Dl=0|sR[7],this.Eh=0|sR[8],this.El=0|sR[9],this.Fh=0|sR[10],this.Fl=0|sR[11],this.Gh=0|sR[12],this.Gl=0|sR[13],this.Hh=0|sR[14],this.Hl=0|sR[15]}}let al=sO(()=>new s7),ao=sO(()=>new ai),au=sO(()=>new an),ac=new ArrayBuffer(0);class ah extends TypeError{constructor(){super(...arguments),this.name=ah.NAME}static isType(e,t){if("string"==typeof t){if("Array"===t&&Array.isArray(e))return!0;if("ArrayBuffer"===t&&e instanceof ArrayBuffer)return!0;if("ArrayBufferView"===t&&ArrayBuffer.isView(e))return!0;else if(typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...s){for(let t of s)if(this.isType(e,t))return;let a=s.map(e=>e instanceof Function&&"name"in e?e.name:`${e}`);throw new ah(`Parameter '${t}' is not of type ${a.length>1?`(${a.join(" or ")})`:a[0]}`)}}ah.NAME="ArgumentError";class am extends TypeError{static assert(...e){let t,s,a=null;for(let r of("string"==typeof e[0]?(a=e[0],t=e[1],s=e.slice(2)):(t=e[0],s=e.slice(1)),ah.assert(t,"parameters","object"),s))if(null==t[r])throw new am(r,a)}static assertEmpty(e,t,s){if(null==e)throw new am(t,s)}constructor(e,t=null,s){super(),this.name=am.NAME,this.field=e,t&&(this.target=t),s?this.message=s:this.message=`Absent mandatory parameter '${e}' ${t?` in '${t}'`:""}`}}am.NAME="ParameterError";class ad extends Error{static assertSchema(e,t){if(!e.verified)throw Error(`Object's schema was not verified against input data for ${t}`)}static assert(e,t){if(-1===e.offset)throw new ad(`Error during parsing of ASN.1 data. Data is not correct for '${t}'.`)}constructor(e){super(e),this.name="AsnError"}}class af{static blockName(){return this.CLASS_NAME}static fromBER(e){let t=tD(e);ad.assert(t,this.name);try{return new this({schema:t.result})}catch(e){throw new ad(`Cannot create '${this.CLASS_NAME}' from ASN.1 object`)}}static defaultValues(e){throw Error(`Invalid member name for ${this.CLASS_NAME} class: ${e}`)}static schema(e={}){throw Error(`Method '${this.CLASS_NAME}.schema' should be overridden`)}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch{t=this.toSchema(!0)}return e0.ToString(t.toBER(),e)}}function ag(e){let t=!1,s="",a=e.trim();for(let e=0;e<a.length;e++)32===a.charCodeAt(e)?!1===t&&(t=!0):(t&&(s+=" ",t=!1),s+=a[e]);return s.toLowerCase()}af.CLASS_NAME="PkiObject";let ap="type",ay="value";class av extends af{constructor(e={}){super(),this.type=e1(e,ap,av.defaultValues(ap)),this.value=e1(e,ay,av.defaultValues(ay)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ap:return"";case ay:return{};default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.type||""}),new sy({name:t.value||""})]})}fromSchema(e){tl(e,[ap,"typeValue"]);let t=sk(e,e,av.schema({names:{type:ap,value:"typeValue"}}));ad.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new t0({value:[new tz({value:this.type}),this.value]})}toJSON(){let e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){let t=[t5.blockName(),t9.blockName(),se.blockName(),st.blockName(),ss.blockName(),sa.blockName(),sr.blockName(),si.blockName(),sn.blockName(),sl.blockName(),so.blockName(),su.blockName()];if(e instanceof ArrayBuffer)return eW.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===av.blockName()){if(this.type!==e.type)return!1;let s=[!1,!1],a=this.value.constructor.blockName();for(let r of t)a===r&&(s[0]=!0),e.value.constructor.blockName()===r&&(s[1]=!0);if(s[0]!==s[1])return!1;if(s[0]&&s[1]){let t=ag(this.value.valueBlock.value),s=ag(e.value.valueBlock.value);if(0!==t.localeCompare(s))return!1}else if(!eW.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}av.CLASS_NAME="AttributeTypeAndValue";let aw="typesAndValues",ab="valueBeforeDecode";class ak extends af{constructor(e={}){super(),this.typesAndValues=e1(e,aw,ak.defaultValues(aw)),this.valueBeforeDecode=e1(e,ab,ak.defaultValues(ab)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case aw:return[];case ab:return ac;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case aw:return 0===t.length;case ab:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.repeatedSequence||"",value:new t1({value:[new sw({name:t.repeatedSet||"",value:av.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){tl(e,["RDN",aw]);let t=sk(e,e,ak.schema({names:{blockName:"RDN",repeatedSet:aw}}));ad.assertSchema(t,this.className),aw in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,e=>new av({schema:e}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(0===this.valueBeforeDecode.byteLength)return new t0({value:[new t1({value:Array.from(this.typesAndValues,e=>e.toSchema())})]});let e=tD(this.valueBeforeDecode);if(ad.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof t0))throw Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof ak){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(let[t,s]of this.typesAndValues.entries())if(!1===s.isEqual(e.typesAndValues[t]))return!1;return!0}return e instanceof ArrayBuffer&&e9(this.valueBeforeDecode,e)}}ak.CLASS_NAME="RelativeDistinguishedNames";let aS="type",aA="value";class aN extends af{constructor(e={}){super(),this.type=e1(e,aS,aN.defaultValues(aS)),this.value=e1(e,aA,aN.defaultValues(aA)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case aS:return 9;case aA:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case aS:return t===aN.defaultValues(e);case aA:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new sv({value:[new tP({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||"",value:[new tz,new tP({idBlock:{tagClass:3,tagNumber:0},value:[new sy]})]}),new tI({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:1}}),new tI({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:2}}),new tP({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||"",value:[function(e={},t=!1){let s=e1(e,"names",{});return new t0({optional:t,value:[new tP({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:s.country_name||"",value:[new sv({value:[new st,new ss]})]}),new tP({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:s.administration_domain_name||"",value:[new sv({value:[new st,new ss]})]}),new tI({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:s.network_address||"",isHexOnly:!0}),new tI({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:s.terminal_identifier||"",isHexOnly:!0}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:s.private_domain_name||"",value:[new sv({value:[new st,new ss]})]}),new tI({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:s.organization_name||"",isHexOnly:!0}),new tI({optional:!0,name:s.numeric_user_identifier||"",idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new tP({optional:!0,name:s.personal_name||"",idBlock:{tagClass:3,tagNumber:5},value:[new tI({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new tI({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new tI({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new tI({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new tP({optional:!0,name:s.organizational_unit_names||"",idBlock:{tagClass:3,tagNumber:6},value:[new sw({value:new ss})]})]})}(t.builtInStandardAttributes||{},!1),function(e=!1){return new t0({optional:e,value:[new ss,new ss]})}(!0),function(e=!1){return new t1({optional:e,value:[new tI({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new sy]})]})}(!0)]}),new tP({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||"",value:[ak.schema(t.directoryName||{})]}),new tP({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||"",value:[new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sv({value:[new sa,new ss,new se,new t5,new t9]})]}),new tP({idBlock:{tagClass:3,tagNumber:1},value:[new sv({value:[new sa,new ss,new se,new t5,new t9]})]})]}),new tI({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:6}}),new tI({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:7}}),new tI({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){tl(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);let t=sk(e,e,aN.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(ad.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=t.result.blockName;break;case 1:case 2:case 6:{let e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=22;let s=tD(e.toBER(!1));ad.assert(s,"GeneralName value"),this.value=s.result.valueBlock.value}break;case 4:this.value=new ak({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new tK({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{let e=t.result.blockName;e.idBlock.tagClass=1,e.idBlock.tagNumber=6;let s=tD(e.toBER(!1));ad.assert(s,"GeneralName registeredID"),this.value=s.result.valueBlock.toString()}}}toSchema(){switch(this.type){case 0:case 3:case 5:return new tP({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{let e=new si({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new tP({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{let e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{let e=new tz({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return aN.schema()}}toJSON(){let e={type:this.type,value:""};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch(e){}return e}}aN.CLASS_NAME="GeneralName";let ax="accessMethod",aC="accessLocation",aB=[ax,aC];class aV extends af{constructor(e={}){super(),this.accessMethod=e1(e,ax,aV.defaultValues(ax)),this.accessLocation=e1(e,aC,aV.defaultValues(aC)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ax:return"";case aC:return new aN;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.accessMethod||""}),aN.schema(t.accessLocation||{})]})}fromSchema(e){tl(e,aB);let t=sk(e,e,aV.schema({names:{accessMethod:ax,accessLocation:{names:{blockName:aC}}}}));ad.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new aN({schema:t.result.accessLocation})}toSchema(){return new t0({value:[new tz({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}aV.CLASS_NAME="AccessDescription";let aE="seconds",aI="millis",a_="micros";class aD extends af{constructor(e={}){super(),aE in e&&(this.seconds=e1(e,aE,aD.defaultValues(aE))),aI in e&&(this.millis=e1(e,aI,aD.defaultValues(aI))),a_ in e&&(this.micros=e1(e,a_,aD.defaultValues(a_))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case aE:case aI:case a_:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case aE:case aI:case a_:return t===aD.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",optional:!0,value:[new tq({optional:!0,name:t.seconds||""}),new tI({name:t.millis||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new tI({name:t.micros||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){tl(e,[aE,aI,a_]);let t=sk(e,e,aD.schema({names:{seconds:aE,millis:aI,micros:a_}}));if(ad.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){let e=new tq({valueHex:t.result.millis.valueBlock.valueHex});this.millis=e.valueBlock.valueDec}if("micros"in t.result){let e=new tq({valueHex:t.result.micros.valueBlock.valueHex});this.micros=e.valueBlock.valueDec}}toSchema(){let e=[];if(void 0!==this.seconds&&e.push(new tq({value:this.seconds})),void 0!==this.millis){let t=new tq({value:this.millis});e.push(new tI({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(void 0!==this.micros){let t=new tq({value:this.micros});e.push(new tI({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new t0({value:e})}toJSON(){let e={};return void 0!==this.seconds&&(e.seconds=this.seconds),void 0!==this.millis&&(e.millis=this.millis),void 0!==this.micros&&(e.micros=this.micros),e}}aD.CLASS_NAME="Accuracy";let aO="algorithmId",aP="algorithmParams",aU="algorithm",aR="params",aj=[aU,aR];class aT extends af{constructor(e={}){super(),this.algorithmId=e1(e,aO,aT.defaultValues(aO)),aP in e&&(this.algorithmParams=e1(e,aP,aT.defaultValues(aP))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case aO:return"";case aP:return new sy;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case aO:return""===t;case aP:return t instanceof sy;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",optional:t.optional||!1,value:[new tz({name:t.algorithmIdentifier||""}),new sy({name:t.algorithmParams||"",optional:!0})]})}fromSchema(e){tl(e,aj);let t=sk(e,e,aT.schema({names:{algorithmIdentifier:aU,algorithmParams:aR}}));ad.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),aR in t.result&&(this.algorithmParams=t.result.params)}toSchema(){let e=[];return e.push(new tz({value:this.algorithmId})),!this.algorithmParams||this.algorithmParams instanceof sy||e.push(this.algorithmParams),new t0({value:e})}toJSON(){let e={algorithmId:this.algorithmId};return!this.algorithmParams||this.algorithmParams instanceof sy||(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return e instanceof aT&&this.algorithmId===e.algorithmId&&(this.algorithmParams?!!e.algorithmParams&&JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!e.algorithmParams)}}aT.CLASS_NAME="AlgorithmIdentifier";let aL="altNames",aH=[aL];class aK extends af{constructor(e={}){super(),this.altNames=e1(e,aL,aK.defaultValues(aL)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===aL?[]:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.altNames||"",value:aN.schema()})]})}fromSchema(e){tl(e,aH);let t=sk(e,e,aK.schema({names:{altNames:aL}}));ad.assertSchema(t,this.className),aL in t.result&&(this.altNames=Array.from(t.result.altNames,e=>new aN({schema:e})))}toSchema(){return new t0({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}aK.CLASS_NAME="AltName";let aM="type",aJ="values",a$=[aM,aJ];class aF extends af{constructor(e={}){super(),this.type=e1(e,aM,aF.defaultValues(aM)),this.values=e1(e,aJ,aF.defaultValues(aJ)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case aM:return"";case aJ:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case aM:return""===t;case aJ:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.type||""}),new t1({name:t.setName||"",value:[new sw({name:t.values||"",value:new sy})]})]})}fromSchema(e){tl(e,a$);let t=sk(e,e,aF.schema({names:{type:aM,values:aJ}}));ad.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new t0({value:[new tz({value:this.type}),new t1({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}aF.CLASS_NAME="Attribute";let aq="notBeforeTime",aW="notAfterTime",aZ=[aq,aW];class aG extends af{constructor(e={}){super(),this.notBeforeTime=e1(e,aq,aG.defaultValues(aq)),this.notAfterTime=e1(e,aW,aG.defaultValues(aW)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case aq:case aW:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sh({name:t.notBeforeTime||""}),new sh({name:t.notAfterTime||""})]})}fromSchema(e){tl(e,aZ);let t=sk(e,e,aG.schema({names:{notBeforeTime:aq,notAfterTime:aW}}));ad.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new t0({value:[new sh({valueDate:this.notBeforeTime}),new sh({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}aG.CLASS_NAME="AttCertValidityPeriod";let az="names",aQ="generalNames";class aY extends af{constructor(e={}){super(),this.names=e1(e,az,aY.defaultValues(az)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return"names"===e?[]:super.defaultValues(e)}static schema(e={},t=!1){let s=e1(e,az,{});return new t0({optional:t,name:s.blockName||"",value:[new sw({name:s.generalNames||"",value:aN.schema()})]})}fromSchema(e){tl(e,[az,aQ]);let t=sk(e,e,aY.schema({names:{blockName:az,generalNames:aQ}}));ad.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,e=>new aN({schema:e}))}toSchema(){return new t0({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}aY.CLASS_NAME="GeneralNames";let aX="2.5.29.17",a0="2.5.29.18",a1="2.5.29.19",a2="2.5.29.28",a3="2.5.29.29",a4="2.5.29.30",a8="2.5.29.31",a5="2.5.29.46",a6="2.5.29.32",a9="2.5.29.32.0",a7="2.5.29.33",re="2.5.29.35",rt="2.5.29.36",rs="1.3.6.1.5.5.7.1.1",ra="1.2.840.113549.1.7.1",rr="1.2.840.113549.1.7.2",ri="1.2.840.113549.1.7.3",rn="1.2.840.113549.1.7.6",rl="1.2.840.113549.1.9.22.1",ro="1.2.840.113549.1.9.22.3",ru="1.2.840.113549.1.9.23.1",rc="1.3.6.1.5.5.7.48.1.1",rh="keyIdentifier",rm="authorityCertIssuer",rd="authorityCertSerialNumber",rf=[rh,rm,rd];class rg extends af{constructor(e={}){super(),rh in e&&(this.keyIdentifier=e1(e,rh,rg.defaultValues(rh))),rm in e&&(this.authorityCertIssuer=e1(e,rm,rg.defaultValues(rm))),rd in e&&(this.authorityCertSerialNumber=e1(e,rd,rg.defaultValues(rd))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rh:return new tK;case rm:return[];case rd:return new tq;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tI({name:t.keyIdentifier||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new sw({name:t.authorityCertIssuer||"",value:aN.schema()})]}),new tI({name:t.authorityCertSerialNumber||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){tl(e,rf);let t=sk(e,e,rg.schema({names:{keyIdentifier:rh,authorityCertIssuer:rm,authorityCertSerialNumber:rd}}));ad.assertSchema(t,this.className),rh in t.result&&(this.keyIdentifier=new tK({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),rm in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,e=>new aN({schema:e}))),rd in t.result&&(this.authorityCertSerialNumber=new tq({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){let e=[];return this.keyIdentifier&&e.push(new tI({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,e=>e.toSchema())})),this.authorityCertSerialNumber&&e.push(new tI({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new t0({value:e})}toJSON(){let e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,e=>e.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}rg.CLASS_NAME="AuthorityKeyIdentifier";let rp="pathLenConstraint";class ry extends af{constructor(e={}){super(),this.cA=e1(e,"cA",!1),rp in e&&(this.pathLenConstraint=e1(e,rp,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return"cA"!==e&&super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tL({optional:!0,name:t.cA||""}),new tq({optional:!0,name:t.pathLenConstraint||""})]})}fromSchema(e){tl(e,["cA",rp]);let t=sk(e,e,ry.schema({names:{cA:"cA",pathLenConstraint:rp}}));ad.assertSchema(t,this.className),"cA"in t.result&&(this.cA=t.result.cA.valueBlock.value),rp in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){let e=[];return this.cA!==ry.defaultValues("cA")&&e.push(new tL({value:this.cA})),rp in this&&(this.pathLenConstraint instanceof tq?e.push(this.pathLenConstraint):e.push(new tq({value:this.pathLenConstraint}))),new t0({value:e})}toJSON(){let e={};return this.cA!==ry.defaultValues("cA")&&(e.cA=this.cA),rp in this&&(this.pathLenConstraint instanceof tq?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}ry.CLASS_NAME="BasicConstraints";let rv="certificateIndex",rw="keyIndex";class rb extends af{constructor(e={}){super(),this.certificateIndex=e1(e,rv,rb.defaultValues(rv)),this.keyIndex=e1(e,rw,rb.defaultValues(rw)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rv:case rw:return 0;default:return super.defaultValues(e)}}static schema(){return new tq}fromSchema(e){if(e.constructor.blockName()!==tq.blockName())throw Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0),s=new Uint8Array(t);switch(!0){case t.byteLength<4:{let e=new ArrayBuffer(4);new Uint8Array(e).set(s,4-t.byteLength),t=e.slice(0)}break;case t.byteLength>4:{let e=new ArrayBuffer(4);new Uint8Array(e).set(s.slice(0,4)),t=e.slice(0)}}let a=t.slice(0,2),r=new Uint8Array(a),i=r[0];r[0]=r[1],r[1]=i;let n=new Uint16Array(a);this.keyIndex=n[0];let l=t.slice(2),o=new Uint8Array(l);i=o[0],o[0]=o[1],o[1]=i;let u=new Uint16Array(l);this.certificateIndex=u[0]}toSchema(){let e=new ArrayBuffer(2);new Uint16Array(e)[0]=this.certificateIndex;let t=new Uint8Array(e),s=t[0];t[0]=t[1],t[1]=s;let a=new ArrayBuffer(2);new Uint16Array(a)[0]=this.keyIndex;let r=new Uint8Array(a);return s=r[0],r[0]=r[1],r[1]=s,new tq({valueHex:e8(a,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}rb.CLASS_NAME="CAVersion";let rk="policyQualifierId",rS="qualifier",rA=[rk,rS];class rN extends af{constructor(e={}){super(),this.policyQualifierId=e1(e,rk,rN.defaultValues(rk)),this.qualifier=e1(e,rS,rN.defaultValues(rS)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rk:return"";case rS:return new sy;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.policyQualifierId||""}),new sy({name:t.qualifier||""})]})}fromSchema(e){tl(e,rA);let t=sk(e,e,rN.schema({names:{policyQualifierId:rk,qualifier:rS}}));ad.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new t0({value:[new tz({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}rN.CLASS_NAME="PolicyQualifierInfo";let rx="policyIdentifier",rC="policyQualifiers",rB=[rx,rC];class rV extends af{constructor(e={}){super(),this.policyIdentifier=e1(e,rx,rV.defaultValues(rx)),rC in e&&(this.policyQualifiers=e1(e,rC,rV.defaultValues(rC))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rx:return"";case rC:return[];default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.policyIdentifier||""}),new t0({optional:!0,value:[new sw({name:t.policyQualifiers||"",value:rN.schema()})]})]})}fromSchema(e){tl(e,rB);let t=sk(e,e,rV.schema({names:{policyIdentifier:rx,policyQualifiers:rC}}));ad.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),rC in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,e=>new rN({schema:e})))}toSchema(){let e=[];return e.push(new tz({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new t0({value:Array.from(this.policyQualifiers,e=>e.toSchema())})),new t0({value:e})}toJSON(){let e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,e=>e.toJSON())),e}}rV.CLASS_NAME="PolicyInformation";let rE="certificatePolicies",rI=[rE];class r_ extends af{constructor(e={}){super(),this.certificatePolicies=e1(e,rE,r_.defaultValues(rE)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===rE?[]:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.certificatePolicies||"",value:rV.schema()})]})}fromSchema(e){tl(e,rI);let t=sk(e,e,r_.schema({names:{certificatePolicies:rE}}));ad.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,e=>new rV({schema:e}))}toSchema(){return new t0({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}r_.CLASS_NAME="CertificatePolicies";let rD="templateID",rO="templateMajorVersion",rP="templateMinorVersion",rU=[rD,rO,rP];class rR extends af{constructor(e={}){super(),this.templateID=e1(e,rD,rR.defaultValues(rD)),rO in e&&(this.templateMajorVersion=e1(e,rO,rR.defaultValues(rO))),rP in e&&(this.templateMinorVersion=e1(e,rP,rR.defaultValues(rP))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rD:return"";case rO:case rP:return 0;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.templateID||""}),new tq({name:t.templateMajorVersion||"",optional:!0}),new tq({name:t.templateMinorVersion||"",optional:!0})]})}fromSchema(e){tl(e,rU);let t=sk(e,e,rR.schema({names:{templateID:rD,templateMajorVersion:rO,templateMinorVersion:rP}}));ad.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),rO in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),rP in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){let e=[];return e.push(new tz({value:this.templateID})),rO in this&&e.push(new tq({value:this.templateMajorVersion})),rP in this&&e.push(new tq({value:this.templateMinorVersion})),new t0({value:e})}toJSON(){let e={templateID:this.templateID};return rO in this&&(e.templateMajorVersion=this.templateMajorVersion),rP in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}let rj="distributionPoint",rT="distributionPointNames",rL="reasons",rH="cRLIssuer",rK="cRLIssuerNames",rM=[rj,rT,rL,rH,rK];class rJ extends af{constructor(e={}){super(),rj in e&&(this.distributionPoint=e1(e,rj,rJ.defaultValues(rj))),rL in e&&(this.reasons=e1(e,rL,rJ.defaultValues(rL))),rH in e&&(this.cRLIssuer=e1(e,rH,rJ.defaultValues(rH))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rj:return[];case rL:return new tJ;case rH:return[];default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sv({value:[new tP({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sw({name:t.distributionPointNames||"",value:aN.schema()})]}),new tP({name:t.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:ak.schema().valueBlock.value})]})]}),new tI({name:t.reasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new tP({name:t.cRLIssuer||"",optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new sw({name:t.cRLIssuerNames||"",value:aN.schema()})]})]})}fromSchema(e){tl(e,rM);let t=sk(e,e,rJ.schema({names:{distributionPoint:rj,distributionPointNames:rT,reasons:rL,cRLIssuer:rH,cRLIssuerNames:rK}}));ad.assertSchema(t,this.className),rj in t.result&&(0===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(t.result.distributionPointNames,e=>new aN({schema:e}))),1===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new ak({schema:new t0({value:t.result.distributionPoint.valueBlock.value})}))),rL in t.result&&(this.reasons=new tJ({valueHex:t.result.reasons.valueBlock.valueHex})),rH in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,e=>new aN({schema:e})))}toSchema(){let e=[];if(this.distributionPoint){let t;t=new tP(this.distributionPoint instanceof Array?{idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,e=>e.toSchema())}:{idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new tI({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new tP({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,e=>e.toSchema())})),new t0({value:e})}toJSON(){let e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,e=>e.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,e=>e.toJSON())),e}}rJ.CLASS_NAME="DistributionPoint";let r$="distributionPoints",rF=[r$];class rq extends af{constructor(e={}){super(),this.distributionPoints=e1(e,r$,rq.defaultValues(r$)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===r$?[]:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.distributionPoints||"",value:rJ.schema()})]})}fromSchema(e){tl(e,rF);let t=sk(e,e,rq.schema({names:{distributionPoints:r$}}));ad.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,e=>new rJ({schema:e}))}toSchema(){return new t0({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}rq.CLASS_NAME="CRLDistributionPoints";let rW="keyPurposes",rZ=[rW];class rG extends af{constructor(e={}){super(),this.keyPurposes=e1(e,rW,rG.defaultValues(rW)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===rW?[]:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.keyPurposes||"",value:new tz})]})}fromSchema(e){tl(e,rZ);let t=sk(e,e,rG.schema({names:{keyPurposes:rW}}));ad.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,e=>e.valueBlock.toString())}toSchema(){return new t0({value:Array.from(this.keyPurposes,e=>new tz({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}rG.CLASS_NAME="ExtKeyUsage";let rz="accessDescriptions";class rQ extends af{constructor(e={}){super(),this.accessDescriptions=e1(e,rz,rQ.defaultValues(rz)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===rz?[]:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.accessDescriptions||"",value:aV.schema()})]})}fromSchema(e){tl(e,[rz]);let t=sk(e,e,rQ.schema({names:{accessDescriptions:rz}}));ad.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,e=>new aV({schema:e}))}toSchema(){return new t0({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}rQ.CLASS_NAME="InfoAccess";let rY="distributionPoint",rX="distributionPointNames",r0="onlyContainsUserCerts",r1="onlyContainsCACerts",r2="onlySomeReasons",r3="indirectCRL",r4="onlyContainsAttributeCerts",r8=[rY,rX,r0,r1,r2,r3,r4];class r5 extends af{constructor(e={}){super(),rY in e&&(this.distributionPoint=e1(e,rY,r5.defaultValues(rY))),this.onlyContainsUserCerts=e1(e,r0,r5.defaultValues(r0)),this.onlyContainsCACerts=e1(e,r1,r5.defaultValues(r1)),r2 in e&&(this.onlySomeReasons=e1(e,r2,r5.defaultValues(r2))),this.indirectCRL=e1(e,r3,r5.defaultValues(r3)),this.onlyContainsAttributeCerts=e1(e,r4,r5.defaultValues(r4)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rY:return[];case r0:case r1:return!1;case r2:return 0;case r3:case r4:return!1;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sv({value:[new tP({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:0},value:[new sw({name:t.distributionPointNames||"",value:aN.schema()})]}),new tP({name:t.distributionPoint||"",idBlock:{tagClass:3,tagNumber:1},value:ak.schema().valueBlock.value})]})]}),new tI({name:t.onlyContainsUserCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new tI({name:t.onlyContainsCACerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new tI({name:t.onlySomeReasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new tI({name:t.indirectCRL||"",optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new tI({name:t.onlyContainsAttributeCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){tl(e,r8);let t=sk(e,e,r5.schema({names:{distributionPoint:rY,distributionPointNames:rX,onlyContainsUserCerts:r0,onlyContainsCACerts:r1,onlySomeReasons:r2,indirectCRL:r3,onlyContainsAttributeCerts:r4}}));if(ad.assertSchema(t,this.className),rY in t.result)switch(!0){case 0===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(t.result.distributionPointNames,e=>new aN({schema:e}));break;case 1===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new ak({schema:new t0({value:t.result.distributionPoint.valueBlock.value})});break;default:throw Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(r0 in t.result){let e=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==e[0]}if(r1 in t.result){let e=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==e[0]}if(r2 in t.result){let e=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=e[0]}if(r3 in t.result){let e=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==e[0]}if(r4 in t.result){let e=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==e[0]}}toSchema(){let e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new tP({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,e=>e.toSchema())}):((t=this.distributionPoint.toSchema()).idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==r5.defaultValues(r0)&&e.push(new tI({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==r5.defaultValues(r1)&&e.push(new tI({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),void 0!==this.onlySomeReasons){let t=new ArrayBuffer(1);new Uint8Array(t)[0]=this.onlySomeReasons,e.push(new tI({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==r5.defaultValues(r3)&&e.push(new tI({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==r5.defaultValues(r4)&&e.push(new tI({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new t0({value:e})}toJSON(){let e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,e=>e.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==r5.defaultValues(r0)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==r5.defaultValues(r1)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),r2 in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==r5.defaultValues(r3)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==r5.defaultValues(r4)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}r5.CLASS_NAME="IssuingDistributionPoint";let r6="base",r9="minimum",r7="maximum",ie=[r6,r9,r7];class it extends af{constructor(e={}){super(),this.base=e1(e,r6,it.defaultValues(r6)),this.minimum=e1(e,r9,it.defaultValues(r9)),r7 in e&&(this.maximum=e1(e,r7,it.defaultValues(r7))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case r6:return new aN;case r9:case r7:return 0;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aN.schema(t.base||{}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new tq({name:t.minimum||""})]}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new tq({name:t.maximum||""})]})]})}fromSchema(e){tl(e,ie);let t=sk(e,e,it.schema({names:{base:{names:{blockName:r6}},minimum:r9,maximum:r7}}));ad.assertSchema(t,this.className),this.base=new aN({schema:t.result.base}),r9 in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),r7 in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){let e=[];if(e.push(this.base.toSchema()),0!==this.minimum){let t=0;t=this.minimum instanceof tq?this.minimum:new tq({value:this.minimum}),e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(r7 in this){let t=0;t=this.maximum instanceof tq?this.maximum:new tq({value:this.maximum}),e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new t0({value:e})}toJSON(){let e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),void 0!==this.maximum&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}it.CLASS_NAME="GeneralSubtree";let is="permittedSubtrees",ia="excludedSubtrees",ir=[is,ia];class ii extends af{constructor(e={}){super(),is in e&&(this.permittedSubtrees=e1(e,is,ii.defaultValues(is))),ia in e&&(this.excludedSubtrees=e1(e,ia,ii.defaultValues(ia))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case is:case ia:return[];default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sw({name:t.permittedSubtrees||"",value:it.schema()})]}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new sw({name:t.excludedSubtrees||"",value:it.schema()})]})]})}fromSchema(e){tl(e,ir);let t=sk(e,e,ii.schema({names:{permittedSubtrees:is,excludedSubtrees:ia}}));ad.assertSchema(t,this.className),is in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,e=>new it({schema:e}))),ia in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,e=>new it({schema:e})))}toSchema(){let e=[];return this.permittedSubtrees&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,e=>e.toSchema())})),this.excludedSubtrees&&e.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,e=>e.toSchema())})),new t0({value:e})}toJSON(){let e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,e=>e.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,e=>e.toJSON())),e}}ii.CLASS_NAME="NameConstraints";let il="requireExplicitPolicy",io="inhibitPolicyMapping",iu=[il,io];class ic extends af{constructor(e={}){super(),il in e&&(this.requireExplicitPolicy=e1(e,il,ic.defaultValues(il))),io in e&&(this.inhibitPolicyMapping=e1(e,io,ic.defaultValues(io))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case il:case io:return 0;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tI({name:t.requireExplicitPolicy||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new tI({name:t.inhibitPolicyMapping||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){tl(e,iu);let t=sk(e,e,ic.schema({names:{requireExplicitPolicy:il,inhibitPolicyMapping:io}}));if(ad.assertSchema(t,this.className),il in t.result){let e=t.result.requireExplicitPolicy;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;let s=tD(e.toBER(!1));ad.assert(s,"Integer"),this.requireExplicitPolicy=s.result.valueBlock.valueDec}if(io in t.result){let e=t.result.inhibitPolicyMapping;e.idBlock.tagClass=1,e.idBlock.tagNumber=2;let s=tD(e.toBER(!1));ad.assert(s,"Integer"),this.inhibitPolicyMapping=s.result.valueBlock.valueDec}}toSchema(){let e=[];if(il in this){let t=new tq({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(io in this){let t=new tq({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new t0({value:e})}toJSON(){let e={};return il in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),io in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}ic.CLASS_NAME="PolicyConstraints";let ih="issuerDomainPolicy",im="subjectDomainPolicy",id=[ih,im];class ig extends af{constructor(e={}){super(),this.issuerDomainPolicy=e1(e,ih,ig.defaultValues(ih)),this.subjectDomainPolicy=e1(e,im,ig.defaultValues(im)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ih:case im:return"";default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.issuerDomainPolicy||""}),new tz({name:t.subjectDomainPolicy||""})]})}fromSchema(e){tl(e,id);let t=sk(e,e,ig.schema({names:{issuerDomainPolicy:ih,subjectDomainPolicy:im}}));ad.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new t0({value:[new tz({value:this.issuerDomainPolicy}),new tz({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}ig.CLASS_NAME="PolicyMapping";let ip="mappings",iy=[ip];class iv extends af{constructor(e={}){super(),this.mappings=e1(e,ip,iv.defaultValues(ip)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===ip?[]:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.mappings||"",value:ig.schema()})]})}fromSchema(e){tl(e,iy);let t=sk(e,e,iv.schema({names:{mappings:ip}}));ad.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,e=>new ig({schema:e}))}toSchema(){return new t0({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}iv.CLASS_NAME="PolicyMappings";let iw="notBefore",ib="notAfter",ik=[iw,ib];class iS extends af{constructor(e={}){super(),iw in e&&(this.notBefore=e1(e,iw,iS.defaultValues(iw))),ib in e&&(this.notAfter=e1(e,ib,iS.defaultValues(ib))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iw:case ib:return new Date;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tI({name:t.notBefore||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new tI({name:t.notAfter||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){tl(e,ik);let t=sk(e,e,iS.schema({names:{notBefore:iw,notAfter:ib}}));if(ad.assertSchema(t,this.className),iw in t.result){let e=new sh;e.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=e.toDate()}if(ib in t.result){let e=new sh({valueHex:t.result.notAfter.valueBlock.valueHex});e.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=e.toDate()}}toSchema(){let e=[];return iw in this&&e.push(new tI({idBlock:{tagClass:3,tagNumber:0},valueHex:new sh({valueDate:this.notBefore}).valueBlock.valueHexView})),ib in this&&e.push(new tI({idBlock:{tagClass:3,tagNumber:1},valueHex:new sh({valueDate:this.notAfter}).valueBlock.valueHexView})),new t0({value:e})}toJSON(){let e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}iS.CLASS_NAME="PrivateKeyUsagePeriod";let iA="type",iN="values",ix=["id",iA],iC=[iN];class iB extends af{constructor(e={}){super(),this.id=e1(e,"id",iB.defaultValues("id")),iA in e&&(this.type=e1(e,iA,iB.defaultValues(iA))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"id":return"";case iA:return new tj;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"id":return""===t;case iA:return t instanceof tj;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.id||""}),new sy({name:t.type||"",optional:!0})]})}fromSchema(e){tl(e,ix);let t=sk(e,e,iB.schema({names:{id:"id",type:iA}}));ad.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),iA in t.result&&(this.type=t.result.type)}toSchema(){let e=[new tz({value:this.id})];return iA in this&&e.push(this.type),new t0({value:e})}toJSON(){let e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}iB.CLASS_NAME="QCStatement";class iV extends af{constructor(e={}){super(),this.values=e1(e,iN,iV.defaultValues(iN)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===iN?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===iN?0===t.length:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.values||"",value:iB.schema(t.value||{})})]})}fromSchema(e){tl(e,iC);let t=sk(e,e,iV.schema({names:{values:iN}}));ad.assertSchema(t,this.className),this.values=Array.from(t.result.values,e=>new iB({schema:e}))}toSchema(){return new t0({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}iV.CLASS_NAME="QCStatements";class iE{static register(e,t,s){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:s}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}iE.namedCurves={},iE.register("P-256","1.2.840.10045.3.1.7",32),iE.register("P-384","1.3.132.0.34",48),iE.register("P-521","1.3.132.0.35",66),iE.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),iE.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),iE.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);let iI="namedCurve";class i_ extends af{constructor(e={}){super(),this.x=e1(e,"x",i_.defaultValues("x")),this.y=e1(e,"y",i_.defaultValues("y")),this.namedCurve=e1(e,iI,i_.defaultValues(iI)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"x":case"y":return ac;case iI:return"";default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"x":case"y":return t instanceof ArrayBuffer&&e9(t,i_.defaultValues(e));case iI:return"string"==typeof t&&t===i_.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new sb}fromSchema(e){let t=eW.toUint8Array(e);if(4!==t[0])throw Error("Object's schema was not verified against input data for ECPublicKey");let s=iE.find(this.namedCurve);if(!s)throw Error(`Incorrect curve OID: ${this.namedCurve}`);let a=s.size;if(t.byteLength!==2*a+1)throw Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=s.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,2*a+1).buffer}toSchema(){return new sb({data:e8(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){let e=iE.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:ts(tr(this.x),!0,!0,!1),y:ts(tr(this.y),!0,!0,!1)}}fromJSON(e){am.assert("json",e,"crv","x","y");let t=0,s=iE.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);let a=ti(ta(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);let e=new Uint8Array(this.x),s=new Uint8Array(a);e.set(s,1)}else this.x=a.slice(0,t);let r=ti(ta(e.y,!0));if(r.byteLength<t){this.y=new ArrayBuffer(t);let e=new Uint8Array(this.y),s=new Uint8Array(r);e.set(s,1)}else this.y=r.slice(0,t)}}i_.CLASS_NAME="ECPublicKey";let iD="modulus",iO="publicExponent",iP=[iD,iO];class iU extends af{constructor(e={}){super(),this.modulus=e1(e,iD,iU.defaultValues(iD)),this.publicExponent=e1(e,iO,iU.defaultValues(iO)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iD:case iO:return new tq;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.modulus||""}),new tq({name:t.publicExponent||""})]})}fromSchema(e){tl(e,iP);let t=sk(e,e,iU.schema({names:{modulus:iD,publicExponent:iO}}));ad.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new t0({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:e0.ToBase64Url(this.modulus.valueBlock.valueHexView),e:e0.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){am.assert("json",e,"n","e");let t=ti(ta(e.n,!0));this.modulus=new tq({valueHex:t.slice(0,Math.pow(2,function(e){let t=Math.log(e)/tn,s=Math.floor(t),a=Math.round(t);return s===a?s:a}(t.byteLength)))}),this.publicExponent=new tq({valueHex:ti(ta(e.e,!0)).slice(0,3)})}}iU.CLASS_NAME="RSAPublicKey";let iR="algorithm",ij="subjectPublicKey",iT=[iR,ij];class iL extends af{get parsedKey(){if(void 0===this._parsedKey){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===tz.blockName())try{this._parsedKey=new i_({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":{let e=tD(this.subjectPublicKey.valueBlock.valueHexView);if(-1!==e.offset)try{this._parsedKey=new iU({schema:e.result})}catch(e){}}}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=e1(e,iR,iL.defaultValues(iR)),this.subjectPublicKey=e1(e,ij,iL.defaultValues(ij));let t=e1(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iR:return new aT;case ij:return new tJ;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aT.schema(t.algorithm||{}),new tJ({name:t.subjectPublicKey||""})]})}fromSchema(e){tl(e,iT);let t=sk(e,e,iL.schema({names:{algorithm:{names:{blockName:iR}},subjectPublicKey:ij}}));ad.assertSchema(t,this.className),this.algorithm=new aT({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new t0({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};let e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}return Object.assign(e,this.parsedKey.toJSON()),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new i_({json:e}),this.algorithm=new aT({algorithmId:"1.2.840.10045.2.1",algorithmParams:new tz({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new iU({json:e}),this.algorithm=new aT({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new tj});break;default:throw Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new tJ({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=nD(!0)){try{if(!e)throw Error("Need to provide publicKey input parameter");let s=await t.exportKey("spki",e),a=tD(s);try{this.fromSchema(a.result)}catch(e){throw Error("Error during initializing object from schema")}}catch(t){let e=t instanceof Error?t.message:`${t}`;throw Error(`Error during exporting public key: ${e}`)}}}iL.CLASS_NAME="PublicKeyInfo";let iH="version",iK="privateKey",iM="namedCurve",iJ="publicKey",i$=[iH,iK,iM,iJ];class iF extends af{constructor(e={}){super(),this.version=e1(e,iH,iF.defaultValues(iH)),this.privateKey=e1(e,iK,iF.defaultValues(iK)),iM in e&&(this.namedCurve=e1(e,iM,iF.defaultValues(iM))),iJ in e&&(this.publicKey=e1(e,iJ,iF.defaultValues(iJ))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iH:return 1;case iK:return new tK;case iM:return"";case iJ:return new i_;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case iH:return t===iF.defaultValues(e);case iK:return t.isEqual(iF.defaultValues(e));case iM:return""===t;case iJ:return i_.compareWithDefault(iM,t.namedCurve)&&i_.compareWithDefault("x",t.x)&&i_.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),new tK({name:t.privateKey||""}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new tz({name:t.namedCurve||""})]}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new tJ({name:t.publicKey||""})]})]})}fromSchema(e){tl(e,i$);let t=sk(e,e,iF.schema({names:{version:iH,privateKey:iK,namedCurve:iM,publicKey:iJ}}));if(ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,iM in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),iJ in t.result){let e={schema:t.result.publicKey.valueBlock.valueHex};iM in this&&(e.namedCurve=this.namedCurve),this.publicKey=new i_(e)}}toSchema(){let e=[new tq({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[new tz({value:this.namedCurve})]})),this.publicKey&&e.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:[new tJ({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new t0({value:e})}toJSON(){if(!this.namedCurve||iF.compareWithDefault(iM,this.namedCurve))throw Error('Not enough information for making JSON: absent "namedCurve" value');let e=iE.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:e0.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){let e=this.publicKey.toJSON();t.x=e.x,t.y=e.y}return t}fromJSON(e){am.assert("json",e,"crv","d");let t=0,s=iE.find(e.crv);s&&(this.namedCurve=s.id,t=s.size);let a=e0.FromBase64Url(e.d);if(a.byteLength<t){let e=new ArrayBuffer(t),s=new Uint8Array(e),r=new Uint8Array(a);s.set(r,1),this.privateKey=new tK({valueHex:e})}else this.privateKey=new tK({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new i_({json:e}))}}iF.CLASS_NAME="ECPrivateKey";let iq="prime",iW="exponent",iZ="coefficient",iG=[iq,iW,iZ];class iz extends af{constructor(e={}){super(),this.prime=e1(e,iq,iz.defaultValues(iq)),this.exponent=e1(e,iW,iz.defaultValues(iW)),this.coefficient=e1(e,iZ,iz.defaultValues(iZ)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iq:case iW:case iZ:return new tq;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.prime||""}),new tq({name:t.exponent||""}),new tq({name:t.coefficient||""})]})}fromSchema(e){tl(e,iG);let t=sk(e,e,iz.schema({names:{prime:iq,exponent:iW,coefficient:iZ}}));ad.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new t0({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:e0.ToBase64Url(this.prime.valueBlock.valueHexView),d:e0.ToBase64Url(this.exponent.valueBlock.valueHexView),t:e0.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){am.assert("json",e,"r","d","r"),this.prime=new tq({valueHex:e0.FromBase64Url(e.r)}),this.exponent=new tq({valueHex:e0.FromBase64Url(e.d)}),this.coefficient=new tq({valueHex:e0.FromBase64Url(e.t)})}}iz.CLASS_NAME="OtherPrimeInfo";let iQ="version",iY="modulus",iX="publicExponent",i0="privateExponent",i1="prime1",i2="prime2",i3="exponent1",i4="exponent2",i8="coefficient",i5="otherPrimeInfos",i6=[iQ,iY,iX,i0,i1,i2,i3,i4,i8,i5];class i9 extends af{constructor(e={}){super(),this.version=e1(e,iQ,i9.defaultValues(iQ)),this.modulus=e1(e,iY,i9.defaultValues(iY)),this.publicExponent=e1(e,iX,i9.defaultValues(iX)),this.privateExponent=e1(e,i0,i9.defaultValues(i0)),this.prime1=e1(e,i1,i9.defaultValues(i1)),this.prime2=e1(e,i2,i9.defaultValues(i2)),this.exponent1=e1(e,i3,i9.defaultValues(i3)),this.exponent2=e1(e,i4,i9.defaultValues(i4)),this.coefficient=e1(e,i8,i9.defaultValues(i8)),i5 in e&&(this.otherPrimeInfos=e1(e,i5,i9.defaultValues(i5))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iQ:return 0;case iY:case iX:case i0:case i1:case i2:case i3:case i4:case i8:return new tq;case i5:return[];default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),new tq({name:t.modulus||""}),new tq({name:t.publicExponent||""}),new tq({name:t.privateExponent||""}),new tq({name:t.prime1||""}),new tq({name:t.prime2||""}),new tq({name:t.exponent1||""}),new tq({name:t.exponent2||""}),new tq({name:t.coefficient||""}),new t0({optional:!0,value:[new sw({name:t.otherPrimeInfosName||"",value:iz.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){tl(e,i6);let t=sk(e,e,i9.schema({names:{version:iQ,modulus:iY,publicExponent:iX,privateExponent:i0,prime1:i1,prime2:i2,exponent1:i3,exponent2:i4,coefficient:i8,otherPrimeInfo:{names:{blockName:i5}}}}));ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),i5 in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,e=>new iz({schema:e})))}toSchema(){let e=[];return e.push(new tq({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new t0({value:Array.from(this.otherPrimeInfos,e=>e.toSchema())})),new t0({value:e})}toJSON(){let e={n:e0.ToBase64Url(this.modulus.valueBlock.valueHexView),e:e0.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:e0.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:e0.ToBase64Url(this.prime1.valueBlock.valueHexView),q:e0.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:e0.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:e0.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:e0.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,e=>e.toJSON())),e}fromJSON(e){am.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new tq({valueHex:e0.FromBase64Url(e.n)}),this.publicExponent=new tq({valueHex:e0.FromBase64Url(e.e)}),this.privateExponent=new tq({valueHex:e0.FromBase64Url(e.d)}),this.prime1=new tq({valueHex:e0.FromBase64Url(e.p)}),this.prime2=new tq({valueHex:e0.FromBase64Url(e.q)}),this.exponent1=new tq({valueHex:e0.FromBase64Url(e.dp)}),this.exponent2=new tq({valueHex:e0.FromBase64Url(e.dq)}),this.coefficient=new tq({valueHex:e0.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,e=>new iz({json:e})))}}i9.CLASS_NAME="RSAPrivateKey";let i7="version",ne="privateKeyAlgorithm",nt="privateKey",ns="attributes",na="parsedKey",nr=[i7,ne,nt,ns];class ni extends af{constructor(e={}){super(),this.version=e1(e,i7,ni.defaultValues(i7)),this.privateKeyAlgorithm=e1(e,ne,ni.defaultValues(ne)),this.privateKey=e1(e,nt,ni.defaultValues(nt)),ns in e&&(this.attributes=e1(e,ns,ni.defaultValues(ns))),na in e&&(this.parsedKey=e1(e,na,ni.defaultValues(na))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case i7:return 0;case ne:return new aT;case nt:return new tK;case ns:return[];case na:return{};default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),aT.schema(t.privateKeyAlgorithm||{}),new tK({name:t.privateKey||""}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sw({name:t.attributes||"",value:aF.schema()})]})]})}fromSchema(e){tl(e,nr);let t=sk(e,e,ni.schema({names:{version:i7,privateKeyAlgorithm:{names:{blockName:ne}},privateKey:nt,attributes:ns}}));switch(ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new aT({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,ns in t.result&&(this.attributes=Array.from(t.result.attributes,e=>new aF({schema:e}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{let e=tD(this.privateKey.valueBlock.valueHexView);-1!==e.offset&&(this.parsedKey=new i9({schema:e.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof tz){let e=tD(this.privateKey.valueBlock.valueHexView);-1!==e.offset&&(this.parsedKey=new iF({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:e.result}))}}}toSchema(){let e=[new tq({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,e=>e.toSchema())})),new t0({value:e})}toJSON(){if(!this.parsedKey){let e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(e.attributes=Array.from(this.attributes,e=>e.toJSON())),e}let e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}return Object.assign(e,this.parsedKey.toJSON()),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new iF({json:e}),this.privateKeyAlgorithm=new aT({algorithmId:"1.2.840.10045.2.1",algorithmParams:new tz({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new i9({json:e}),this.privateKeyAlgorithm=new aT({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new tj});break;default:throw Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new tK({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}ni.CLASS_NAME="PrivateKeyInfo";let nn="contentType",nl="contentEncryptionAlgorithm",no="encryptedContent",nu=[nn,nl,no];class nc extends af{constructor(e={}){if(super(),this.contentType=e1(e,nn,nc.defaultValues(nn)),this.contentEncryptionAlgorithm=e1(e,nl,nc.defaultValues(nl)),no in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,1===this.encryptedContent.idBlock.tagClass&&4===this.encryptedContent.idBlock.tagNumber&&!1===this.encryptedContent.idBlock.isConstructed&&!e.disableSplit)){let e=new tK({idBlock:{isConstructed:!0},isConstructed:!0}),t=0,s=this.encryptedContent.valueBlock.valueHexView.slice().buffer,a=s.byteLength;for(;a>0;){let r=new Uint8Array(s,t,t+1024>s.byteLength?s.byteLength-t:1024),i=new ArrayBuffer(r.length),n=new Uint8Array(i);for(let e=0;e<n.length;e++)n[e]=r[e];e.valueBlock.value.push(new tK({valueHex:i})),a-=r.length,t+=r.length}this.encryptedContent=e}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nn:return"";case nl:return new aT;case no:return new tK;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nn:return""===t;case nl:return""===t.algorithmId&&"algorithmParams"in t==!1;case no:return t.isEqual(nc.defaultValues(no));default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.contentType||""}),aT.schema(t.contentEncryptionAlgorithm||{}),new sv({value:[new tP({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0},value:[new sw({value:new tK})]}),new tI({name:t.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){tl(e,nu);let t=sk(e,e,nc.schema({names:{contentType:nn,contentEncryptionAlgorithm:{names:{blockName:nl}},encryptedContent:no}}));ad.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new aT({schema:t.result.contentEncryptionAlgorithm}),no in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){let e={isIndefiniteForm:!1},t=[];if(t.push(new tz({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;let s=this.encryptedContent;s.idBlock.tagClass=3,s.idBlock.tagNumber=0,s.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(s)}return new t0({lenBlock:e,value:t})}toJSON(){let e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw Error("Parameter 'encryptedContent' is undefined");return tK.prototype.getValue.call(this.encryptedContent)}}nc.CLASS_NAME="EncryptedContentInfo";let nh="hashAlgorithm",nm="maskGenAlgorithm",nd="saltLength",nf="trailerField",ng=[nh,nm,nd,nf];class np extends af{constructor(e={}){super(),this.hashAlgorithm=e1(e,nh,np.defaultValues(nh)),this.maskGenAlgorithm=e1(e,nm,np.defaultValues(nm)),this.saltLength=e1(e,nd,np.defaultValues(nd)),this.trailerField=e1(e,nf,np.defaultValues(nf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nh:return new aT({algorithmId:"1.3.14.3.2.26",algorithmParams:new tj});case nm:return new aT({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new aT({algorithmId:"1.3.14.3.2.26",algorithmParams:new tj}).toSchema()});case nd:return 20;case nf:return 1;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tP({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[aT.schema(t.hashAlgorithm||{})]}),new tP({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[aT.schema(t.maskGenAlgorithm||{})]}),new tP({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new tq({name:t.saltLength||""})]}),new tP({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new tq({name:t.trailerField||""})]})]})}fromSchema(e){tl(e,ng);let t=sk(e,e,np.schema({names:{hashAlgorithm:{names:{blockName:nh}},maskGenAlgorithm:{names:{blockName:nm}},saltLength:nd,trailerField:nf}}));ad.assertSchema(t,this.className),nh in t.result&&(this.hashAlgorithm=new aT({schema:t.result.hashAlgorithm})),nm in t.result&&(this.maskGenAlgorithm=new aT({schema:t.result.maskGenAlgorithm})),nd in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),nf in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){let e=[];return this.hashAlgorithm.isEqual(np.defaultValues(nh))||e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(np.defaultValues(nm))||e.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==np.defaultValues(nd)&&e.push(new tP({idBlock:{tagClass:3,tagNumber:2},value:[new tq({value:this.saltLength})]})),this.trailerField!==np.defaultValues(nf)&&e.push(new tP({idBlock:{tagClass:3,tagNumber:3},value:[new tq({value:this.trailerField})]})),new t0({value:e})}toJSON(){let e={};return this.hashAlgorithm.isEqual(np.defaultValues(nh))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(np.defaultValues(nm))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==np.defaultValues(nd)&&(e.saltLength=this.saltLength),this.trailerField!==np.defaultValues(nf)&&(e.trailerField=this.trailerField),e}}np.CLASS_NAME="RSASSAPSSParams";let ny="salt",nv="iterationCount",nw="keyLength",nb=[ny,nv,nw,"prf"];class nk extends af{constructor(e={}){super(),this.salt=e1(e,ny,nk.defaultValues(ny)),this.iterationCount=e1(e,nv,nk.defaultValues(nv)),nw in e&&(this.keyLength=e1(e,nw,nk.defaultValues(nw))),"prf"in e&&(this.prf=e1(e,"prf",nk.defaultValues("prf"))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ny:return{};case nv:return -1;case nw:return 0;case"prf":return new aT({algorithmId:"1.3.14.3.2.26",algorithmParams:new tj});default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sv({value:[new tK({name:t.saltPrimitive||""}),aT.schema(t.saltConstructed||{})]}),new tq({name:t.iterationCount||""}),new tq({name:t.keyLength||"",optional:!0}),aT.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){tl(e,nb);let t=sk(e,e,nk.schema({names:{saltPrimitive:ny,saltConstructed:{names:{blockName:ny}},iterationCount:nv,keyLength:nw,prf:{names:{blockName:"prf",optional:!0}}}}));ad.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,nw in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),"prf"in t.result&&(this.prf=new aT({schema:t.result.prf}))}toSchema(){let e=[];return e.push(this.salt),e.push(new tq({value:this.iterationCount})),nw in this&&nk.defaultValues(nw)!==this.keyLength&&e.push(new tq({value:this.keyLength})),this.prf&&!1===nk.defaultValues("prf").isEqual(this.prf)&&e.push(this.prf.toSchema()),new t0({value:e})}toJSON(){let e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return nw in this&&nk.defaultValues(nw)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&!1===nk.defaultValues("prf").isEqual(this.prf)&&(e.prf=this.prf.toJSON()),e}}nk.CLASS_NAME="PBKDF2Params";let nS="keyDerivationFunc",nA="encryptionScheme",nN=[nS,nA];class nx extends af{constructor(e={}){super(),this.keyDerivationFunc=e1(e,nS,nx.defaultValues(nS)),this.encryptionScheme=e1(e,nA,nx.defaultValues(nA)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nS:case nA:return new aT;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aT.schema(t.keyDerivationFunc||{}),aT.schema(t.encryptionScheme||{})]})}fromSchema(e){tl(e,nN);let t=sk(e,e,nx.schema({names:{keyDerivationFunc:{names:{blockName:nS}},encryptionScheme:{names:{blockName:nA}}}}));ad.assertSchema(t,this.className),this.keyDerivationFunc=new aT({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new aT({schema:t.result.encryptionScheme})}toSchema(){return new t0({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}nx.CLASS_NAME="PBES2Params";class nC{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=e1(e,"name","")}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){return this.crypto.getRandomValues(e)}}async function nB(e,t,s,a,r){let i,n,l;switch(e.toUpperCase()){case"SHA-1":i=20,n=64,l=sK;break;case"SHA-256":i=32,n=64,l=al;break;case"SHA-384":i=48,n=128,l=au;break;case"SHA-512":i=64,n=128,l=ao;break;default:throw Error("Unsupported hashing algorithm")}let o=new Uint8Array(s),u=new TextDecoder().decode(s);new TextEncoder().encode(u).some((e,t)=>e!==o[t])&&(u=String.fromCharCode(...o));let c=new Uint8Array(2*u.length+2),h=new DataView(c.buffer);for(let e=0;e<u.length;e++)h.setUint16(2*e,u.charCodeAt(e),!1);h.setUint16(2*u.length,0,!1);let m=new Uint8Array(n).fill(3),d=new Uint8Array(a),f=new Uint8Array(n*Math.ceil(d.length/n)).map((e,t)=>d[t%d.length]),g=new Uint8Array(n*Math.ceil(c.length/n)).map((e,t)=>c[t%c.length]),p=new Uint8Array(f.length+g.length);p.set(f),p.set(g,f.length);let y=Math.ceil((t>>3)/i),v=[];for(let e=0;e<y;e++){let e=new Uint8Array(m.length+p.length);e.set(m),e.set(p,m.length);for(let t=0;t<r;t++)e=l(e);let t=new Uint8Array(n).map((t,s)=>e[s%e.length]),s=Math.ceil(d.length/n)+Math.ceil(c.length/n),a=[];for(let e=0;e<s;e++){let s=Array.from(p.slice(e*n,(e+1)*n)),r=511;for(let e=t.length-1;e>=0;e--)r>>=8,r+=t[e]+(s[e]||0),s[e]=255&r;a.push(...s)}p=new Uint8Array(a),v.push(...e)}return new Uint8Array(v.slice(0,t>>3)).buffer}class nV extends nC{async importKey(e,t,s,a,r){var i,n,l,o,u,c;let h={},m=function e(t){let s="string"==typeof t?{name:t}:t;return"hash"in s?{...s,hash:e(s.hash)}:s}(s);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,s,a,r);case"spki":{let e=tD(eW.toArrayBuffer(t));ad.assert(e,"keyData");let s=new iL;try{s.fromSchema(e.result)}catch{throw new ah("Incorrect keyData")}switch(m.name.toUpperCase()){case"RSA-PSS":if(!m.hash)throw new am("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(m.hash.name.toUpperCase()){case"SHA-1":h.alg="PS1";break;case"SHA-256":h.alg="PS256";break;case"SHA-384":h.alg="PS384";break;case"SHA-512":h.alg="PS512";break;default:throw Error(`Incorrect hash algorithm: ${m.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":if(r=["verify"],h.kty="RSA",h.ext=a,h.key_ops=r,"1.2.840.113549.1.1.1"!==s.algorithm.algorithmId)throw Error(`Incorrect public key algorithm: ${s.algorithm.algorithmId}`);if(!h.alg){if(!m.hash)throw new am("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(m.hash.name.toUpperCase()){case"SHA-1":h.alg="RS1";break;case"SHA-256":h.alg="RS256";break;case"SHA-384":h.alg="RS384";break;case"SHA-512":h.alg="RS512";break;default:throw Error(`Incorrect hash algorithm: ${m.hash.name.toUpperCase()}`)}}Object.assign(h,s.toJSON());break;case"ECDSA":r=["verify"];case"ECDH":if(h={kty:"EC",ext:a,key_ops:r},"1.2.840.10045.2.1"!==s.algorithm.algorithmId)throw Error(`Incorrect public key algorithm: ${s.algorithm.algorithmId}`);Object.assign(h,s.toJSON());break;case"RSA-OAEP":if(h.kty="RSA",h.ext=a,h.key_ops=r,"safari"===this.name.toLowerCase())h.alg="RSA-OAEP";else{if(!m.hash)throw new am("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(m.hash.name.toUpperCase()){case"SHA-1":h.alg="RSA-OAEP";break;case"SHA-256":h.alg="RSA-OAEP-256";break;case"SHA-384":h.alg="RSA-OAEP-384";break;case"SHA-512":h.alg="RSA-OAEP-512";break;default:throw Error(`Incorrect hash algorithm: ${m.hash.name.toUpperCase()}`)}}Object.assign(h,s.toJSON());break;case"RSAES-PKCS1-V1_5":h.kty="RSA",h.ext=a,h.key_ops=r,h.alg="PS1",Object.assign(h,s.toJSON());break;default:throw Error(`Incorrect algorithm name: ${m.name.toUpperCase()}`)}}break;case"pkcs8":{let e=new ni,s=tD(eW.toArrayBuffer(t));ad.assert(s,"keyData");try{e.fromSchema(s.result)}catch(e){throw Error("Incorrect keyData")}if(!e.parsedKey)throw Error("Incorrect keyData");switch(m.name.toUpperCase()){case"RSA-PSS":switch(null===(i=m.hash)||void 0===i?void 0:i.name.toUpperCase()){case"SHA-1":h.alg="PS1";break;case"SHA-256":h.alg="PS256";break;case"SHA-384":h.alg="PS384";break;case"SHA-512":h.alg="PS512";break;default:throw Error(`Incorrect hash algorithm: ${null===(n=m.hash)||void 0===n?void 0:n.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":if(r=["sign"],h.kty="RSA",h.ext=a,h.key_ops=r,"1.2.840.113549.1.1.1"!==e.privateKeyAlgorithm.algorithmId)throw Error(`Incorrect private key algorithm: ${e.privateKeyAlgorithm.algorithmId}`);if("alg"in h==!1)switch(null===(l=m.hash)||void 0===l?void 0:l.name.toUpperCase()){case"SHA-1":h.alg="RS1";break;case"SHA-256":h.alg="RS256";break;case"SHA-384":h.alg="RS384";break;case"SHA-512":h.alg="RS512";break;default:throw Error(`Incorrect hash algorithm: ${null===(o=m.hash)||void 0===o?void 0:o.name.toUpperCase()}`)}Object.assign(h,e.toJSON());break;case"ECDSA":r=["sign"];case"ECDH":if(h={kty:"EC",ext:a,key_ops:r},"1.2.840.10045.2.1"!==e.privateKeyAlgorithm.algorithmId)throw Error(`Incorrect algorithm: ${e.privateKeyAlgorithm.algorithmId}`);Object.assign(h,e.toJSON());break;case"RSA-OAEP":if(h.kty="RSA",h.ext=a,h.key_ops=r,"safari"===this.name.toLowerCase())h.alg="RSA-OAEP";else switch(null===(u=m.hash)||void 0===u?void 0:u.name.toUpperCase()){case"SHA-1":h.alg="RSA-OAEP";break;case"SHA-256":h.alg="RSA-OAEP-256";break;case"SHA-384":h.alg="RSA-OAEP-384";break;case"SHA-512":h.alg="RSA-OAEP-512";break;default:throw Error(`Incorrect hash algorithm: ${null===(c=m.hash)||void 0===c?void 0:c.name.toUpperCase()}`)}Object.assign(h,e.toJSON());break;case"RSAES-PKCS1-V1_5":r=["decrypt"],h.kty="RSA",h.ext=a,h.key_ops=r,h.alg="PS1",Object.assign(h,e.toJSON());break;default:throw Error(`Incorrect algorithm name: ${m.name.toUpperCase()}`)}}break;case"jwk":h=t;break;default:throw Error(`Incorrect format: ${e}`)}if("safari"===this.name.toLowerCase())try{return this.subtle.importKey("jwk",ti(JSON.stringify(h)),s,a,r)}catch{}return this.subtle.importKey("jwk",h,s,a,r)}async exportKey(e,t){let s=await this.subtle.exportKey("jwk",t);switch("safari"===this.name.toLowerCase()&&s instanceof ArrayBuffer&&(s=JSON.parse(tr(s))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{let e=new iL;try{e.fromJSON(s)}catch(e){throw Error("Incorrect key data")}return e.toSchema().toBER(!1)}case"pkcs8":{let e=new ni;try{e.fromJSON(s)}catch(e){throw Error("Incorrect key data")}return e.toSchema().toBER(!1)}case"jwk":return s;default:throw Error(`Incorrect format: ${e}`)}}async convert(e,t,s,a,r,i){if(e.toLowerCase()===t.toLowerCase())return s;let n=await this.importKey(e,s,a,r,i);return this.exportKey(t,n)}getAlgorithmByOID(e,t=!1,s){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw Error(`Unsupported algorithm identifier ${s?`for ${s} `:""}: ${e}`);return{}}getOIDByAlgorithm(e,t=!1,s){let a="";switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13"}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11"}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35"}if(!a&&t)throw Error(`Unsupported algorithm ${s?`for ${s} `:""}: ${e.name}`);return a}getAlgorithmParameters(e,t){let s={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":s={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":s={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":s={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":s={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":s={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":s={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":s={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":s={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":s={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":s={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":s={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":s={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":s={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};s={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};s={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return s}getHashAlgorithm(e){let t="";switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{let s=new np({schema:e.algorithmParams});if(s.hashAlgorithm){let e=this.getAlgorithmByOID(s.hashAlgorithm.algorithmId);if(!("name"in e))return"";t=e.name}else t="SHA-1"}catch{}}return t}async encryptEncryptedContentInfo(e){am.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");let t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),s=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),r=new ArrayBuffer(16),i=new Uint8Array(r);this.getRandomValues(i);let n=new ArrayBuffer(64),l=new Uint8Array(n);this.getRandomValues(l);let o=new Uint8Array(e.contentToEncrypt),u=new nk({salt:new tK({valueHex:n}),iterationCount:e.iterationCount,prf:new aT({algorithmId:a,algorithmParams:new tj})}),c=new Uint8Array(e.password),h=await this.importKey("raw",c,"PBKDF2",!1,["deriveKey"]),m=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:l,iterations:e.iterationCount},h,e.contentEncryptionAlgorithm,!1,["encrypt"]),d=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:i},m,o),f=new nx({keyDerivationFunc:new aT({algorithmId:s,algorithmParams:u.toSchema()}),encryptionScheme:new aT({algorithmId:t,algorithmParams:new tK({valueHex:r})})});return new nc({contentType:e.contentType,contentEncryptionAlgorithm:new aT({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:f.toSchema()}),encryptedContent:new tK({valueHex:d})})}async decryptEncryptedContentInfo(e){let t,s;if(am.assert(e,"password","encryptedContentInfo"),"1.2.840.113549.1.5.13"!==e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId)throw Error(`Unknown "contentEncryptionAlgorithm": ${e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);try{t=new nx({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(e){throw Error('Incorrectly encoded "pbes2Parameters"')}try{s=new nk({schema:t.keyDerivationFunc.algorithmParams})}catch(e){throw Error('Incorrectly encoded "pbkdf2Params"')}let a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),r=new Uint8Array(t.encryptionScheme.algorithmParams.valueBlock.valueHex),i=new Uint8Array(s.salt.valueBlock.valueHex),n=s.iterationCount,l="SHA-1";s.prf&&(l=this.getAlgorithmByOID(s.prf.algorithmId,!0).hash.name);let o=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),u=await this.deriveKey({name:"PBKDF2",hash:{name:l},salt:i,iterations:n},o,a,!1,["decrypt"]),c=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:r},u,c)}async stampDataWithPassword(e){let t;if(e instanceof Object==!1)throw Error('Parameters must have type "Object"');switch(am.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp"),e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await nB(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),r=await this.importKey("raw",new Uint8Array(a),s,!1,["sign"]);return this.sign(s,r,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){am.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}let s={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await nB(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),r=await this.importKey("raw",new Uint8Array(a),s,!1,["verify"]);return this.verify(s,r,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");let s=new aT,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw Error("Parameter 'algorithm' is empty");let r=a.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?r.hash.name=e.algorithm.hash.name:r.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":s.algorithmId=this.getOIDByAlgorithm(r,!0);break;case"RSA-PSS":{switch(r.hash.name.toUpperCase()){case"SHA-256":r.saltLength=32;break;case"SHA-384":r.saltLength=48;break;case"SHA-512":r.saltLength=64}let e={};"SHA-1"!==r.hash.name.toUpperCase()&&(e.hashAlgorithm=new aT({algorithmId:this.getOIDByAlgorithm({name:r.hash.name},!0,"hashAlgorithm"),algorithmParams:new tj}),e.maskGenAlgorithm=new aT({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:e.hashAlgorithm.toSchema()})),20!==r.saltLength&&(e.saltLength=r.saltLength);let t=new np(e);s.algorithmId="1.2.840.113549.1.1.10",s.algorithmParams=t.toSchema()}break;default:throw Error(`Unsupported signature algorithm: ${e.algorithm.name}`)}return{signatureAlgorithm:s,parameters:a}}async signWithPrivateKey(e,t,s){let a=await this.sign(s.algorithm,t,e);return"ECDSA"===s.algorithm.name?function(e){if(e.byteLength%2!=0)return ac;let t=e.byteLength/2,s=new ArrayBuffer(t);new Uint8Array(s).set(new Uint8Array(e,0,t));let a=new tq({valueHex:s}),r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,t,t));let i=new tq({valueHex:r});return new t0({value:[a.convertToDER(),i.convertToDER()]}).toBER(!1)}(a):a}fillPublicKeyParameters(e,t){let s;let a={},r=this.getHashAlgorithm(t);if(""===r)throw Error(`Unsupported signature algorithm: ${t.algorithmId}`);s="1.2.840.113549.1.1.10"===t.algorithmId?t.algorithmId:e.algorithm.algorithmId;let i=this.getAlgorithmByOID(s,!0);if(a.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in a.algorithm.algorithm&&(a.algorithm.algorithm.hash.name=r),"ECDSA"===i.name){let t=e.algorithm;if(!t.algorithmParams)throw Error("Algorithm parameters for ECDSA public key are missed");let s=t.algorithmParams;if("idBlock"in t.algorithmParams&&(1!==s.idBlock.tagClass||6!==s.idBlock.tagNumber))throw Error("Incorrect type for ECDSA public key parameters");let r=this.getAlgorithmByOID(s.valueBlock.toString(),!0);a.algorithm.algorithm.namedCurve=r.name}return a}async getPublicKey(e,t,s){s||(s=this.fillPublicKeyParameters(e,t));let a=e.toSchema().toBER(!1);return this.importKey("spki",a,s.algorithm.algorithm,!0,s.algorithm.usages)}async verifyWithPublicKey(e,t,s,a,r){let i;if(r){let e;let t={};e="1.2.840.113549.1.1.10"===a.algorithmId?a.algorithmId:s.algorithm.algorithmId;let n=this.getAlgorithmByOID(e,!0);if(t.algorithm=this.getAlgorithmParameters(n.name,"importKey"),"hash"in t.algorithm.algorithm&&(t.algorithm.algorithm.hash.name=r),"ECDSA"===n.name){let e=!1;if("algorithmParams"in s.algorithm==!0&&"idBlock"in s.algorithm.algorithmParams&&1===s.algorithm.algorithmParams.idBlock.tagClass&&6===s.algorithm.algorithmParams.idBlock.tagNumber&&(e=!0),!1===e)throw Error("Incorrect type for ECDSA public key parameters");let a=this.getAlgorithmByOID(s.algorithm.algorithmParams.valueBlock.toString(),!0);t.algorithm.algorithm.namedCurve=a.name}i=await this.getPublicKey(s,null,t)}else{if(!(r=this.getHashAlgorithm(a)))throw Error(`Unsupported signature algorithm: ${a.algorithmId}`);i=await this.getPublicKey(s,a)}let n=this.getAlgorithmParameters(i.algorithm.name,"verify");"hash"in n.algorithm&&(n.algorithm.hash.name=r);let l=t.valueBlock.valueHexView;if("ECDSA"===i.algorithm.name){let e=iE.find(i.algorithm.namedCurve);if(!e)throw Error("Unsupported named curve in use");let t=tD(l);ad.assert(t,"Signature value"),l=function(e,t){if(!(e instanceof t0&&2===e.valueBlock.value.length&&e.valueBlock.value[0]instanceof tq&&e.valueBlock.value[1]instanceof tq))return ac;let s=e.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,a=e.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,r=new Uint8Array(2*t);return r.set(s,t-s.byteLength),r.set(a,2*t-a.byteLength),r.buffer}(t.result,e.size)}if("RSA-PSS"===i.algorithm.name){let e=new np({schema:a.algorithmParams});"saltLength"in e?n.algorithm.saltLength=e.saltLength:n.algorithm.saltLength=20;let t="SHA-1";"hashAlgorithm"in e&&(t=this.getAlgorithmByOID(e.hashAlgorithm.algorithmId,!0).name),n.algorithm.hash.name=t}return this.verify(n.algorithm,i,l,e)}}let nE={name:"none",crypto:null};function nI(e){return!!e&&"object"==typeof e&&"crypto"in e}function n_(e,...t){let s=null;if(t.length<2)s=t.length?t[0]:"undefined"!=typeof self&&self.crypto?new nV({name:"browser",crypto:self.crypto}):null;else{let e=t[0],a=t[1];nI(a)?s=a:nI(e)?s=e:"subtle"in e&&"getRandomValues"in e&&(s=new nV({crypto:e}))}if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){if(void 0===global[process.pid])global[process.pid]={};else if("object"!=typeof global[process.pid])throw Error(`Name global.${process.pid} already exists and it is not an object`);if(void 0===global[process.pid].pkijs)global[process.pid].pkijs={};else if("object"!=typeof global[process.pid].pkijs)throw Error(`Name global.${process.pid}.pkijs already exists and it is not an object`);global[process.pid].pkijs.engine={name:e,crypto:s}}else nE={name:e,crypto:s}}function nD(e=!1){let t=function(){if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){let e;try{e=global[process.pid].pkijs.engine}catch(e){throw Error("Please call 'setEngine' before call to 'getEngine'")}return e}return nE}();if(!t.crypto&&e)throw Error("Unable to create WebCrypto object");return t.crypto}async function nO(e,t,s,a,r){switch(e.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new ah(`Unknown hash function: ${e}`)}if(ah.assert(t,"zBuffer","ArrayBuffer"),0===t.byteLength)throw new ah("'zBuffer' has zero length, error");if(ah.assert(a,"SharedInfo","ArrayBuffer"),s>255)throw new ah("Please set 'Counter' argument to value less or equal to 255");let i=new ArrayBuffer(4),n=new Uint8Array(i);n[0]=0,n[1]=0,n[2]=0,n[3]=s;let l=ac;return l=e8(l,t),l=e8(l,i),l=e8(l,a),{counter:s,result:await r.digest({name:e},l)}}async function nP(e,t,s,a,r=nD(!0)){let i=0,n=1;switch(e.toUpperCase()){case"SHA-1":i=160;break;case"SHA-256":i=256;break;case"SHA-384":i=384;break;case"SHA-512":i=512;break;default:throw new ah(`Unknown hash function: ${e}`)}if(ah.assert(t,"Zbuffer","ArrayBuffer"),0===t.byteLength)throw new ah("'Zbuffer' has zero length, error");ah.assert(a,"SharedInfo","ArrayBuffer");let l=s/i;Math.floor(l)>0&&(n=Math.floor(l),l-n>0&&n++);let o=[];for(let s=1;s<=n;s++)o.push(await nO(e,t,s,a,r));let u=ac,c=1,h=!0;for(;h;){for(let e of(h=!1,o))if(e.counter===c){u=e8(u,e.result),h=!0;break}c++}if(s>>=3,u.byteLength>s){let e=new ArrayBuffer(s),t=new Uint8Array(e),a=new Uint8Array(u);for(let e=0;e<s;e++)t[e]=a[e];return e}return u}let nU="version",nR="logID",nj="extensions",nT="timestamp",nL="hashAlgorithm",nH="signatureAlgorithm",nK="signature",nM="none",nJ="sha1",n$="sha224",nF="sha256",nq="sha384",nW="sha512",nZ="anonymous",nG="ecdsa";class nz extends af{constructor(e={}){super(),this.version=e1(e,nU,nz.defaultValues(nU)),this.logID=e1(e,nR,nz.defaultValues(nR)),this.timestamp=e1(e,nT,nz.defaultValues(nT)),this.extensions=e1(e,nj,nz.defaultValues(nj)),this.hashAlgorithm=e1(e,nL,nz.defaultValues(nL)),this.signatureAlgorithm=e1(e,nH,nz.defaultValues(nH)),this.signature=e1(e,nK,nz.defaultValues(nK)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nU:return 0;case nR:case nj:return ac;case nT:return new Date(0);case nL:case nH:return"";case nK:return new sy;default:return super.defaultValues(e)}}fromSchema(e){if(e instanceof sb==!1)throw Error("Object's schema was not verified against input data for SignedCertificateTimestamp");let t=new sA({stream:new sS({buffer:e.data})});this.fromStream(t)}fromStream(e){let t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(e3(new Uint8Array(e.getBlock(8)),8));let s=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(s)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=nM;break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm=nJ;break;case 3:this.hashAlgorithm=n$;break;case 4:this.hashAlgorithm=nF;break;case 5:this.hashAlgorithm=nq;break;case 6:this.hashAlgorithm=nW;break;default:throw Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=nZ;break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm=nG;break;default:throw Error("Object's stream was not correct for SignedCertificateTimestamp")}let a=e.getUint16(),r=tD(new Uint8Array(e.getBlock(a)).buffer.slice(0));if(ad.assert(r,"SignedCertificateTimestamp"),this.signature=r.result,t!==47+s+a)throw Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){return new sb({data:this.toStream().stream.buffer})}toStream(){let e,t;let s=new sA;s.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),s.appendChar(this.version),s.appendView(new Uint8Array(this.logID));let a=new Uint8Array(new ArrayBuffer(8)),r=e4(this.timestamp.valueOf(),8);switch(a.set(new Uint8Array(r),8-r.byteLength),s.appendView(a),s.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&s.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case nM:e=0;break;case"md5":e=1;break;case nJ:e=2;break;case n$:e=3;break;case nF:e=4;break;case nq:e=5;break;case nW:e=6;break;default:throw Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}switch(s.appendChar(e),this.signatureAlgorithm.toLowerCase()){case nZ:t=0;break;case"rsa":t=1;break;case"dsa":t=2;break;case nG:t=3;break;default:throw Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}s.appendChar(t);let i=this.signature.toBER(!1);return s.appendUint16(i.byteLength),s.appendView(new Uint8Array(i)),s}toJSON(){return{version:this.version,logID:e2(this.logID),timestamp:this.timestamp,extensions:e2(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,s=0,a=nD(!0)){let r=ts(tr(this.logID)),i=null,n=new sA;for(let t of e)if(t.log_id===r){i=t.key;break}if(!i)throw Error(`Public key not found for CT with logId: ${r}`);let l=ti(ta(i)),o=iL.fromBER(l);n.appendChar(0),n.appendChar(0);let u=new Uint8Array(new ArrayBuffer(8)),c=e4(this.timestamp.valueOf(),8);return u.set(new Uint8Array(c),8-c.byteLength),n.appendView(u),n.appendUint16(s),0===s&&n.appendUint24(t.byteLength),n.appendView(new Uint8Array(t)),n.appendUint16(this.extensions.byteLength),0!==this.extensions.byteLength&&n.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(n.buffer.slice(0,n.length),new tK({valueHex:this.signature.toBER(!1)}),o,{algorithmId:""},"SHA-256")}}nz.CLASS_NAME="SignedCertificateTimestamp";let nQ="timestamps";class nY extends af{constructor(e={}){super(),this.timestamps=e1(e,nQ,nY.defaultValues(nQ)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===nQ?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===nQ?0===t.length:super.defaultValues(e)}static schema(e={}){var t;let s=e1(e,"names",{});return null!==(t=s.optional)&&void 0!==t||(s.optional=!1),new tK({name:s.blockName||"SignedCertificateTimestampList",optional:s.optional})}fromSchema(e){if(e instanceof tK==!1)throw Error("Object's schema was not verified against input data for SignedCertificateTimestampList");let t=new sA({stream:new sS({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new nz({stream:t}))}toSchema(){let e=new sA,t=0,s=[];for(let e of this.timestamps){let a=e.toStream();s.push(a),t+=a.stream.buffer.byteLength}for(let a of(e.appendUint16(t),s))e.appendView(a.stream.view);return new tK({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}nY.CLASS_NAME="SignedCertificateTimestampList";let nX="attributes",n0=[nX];class n1 extends af{constructor(e={}){super(),this.attributes=e1(e,nX,n1.defaultValues(nX)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===nX?[]:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.attributes||"",value:aF.schema()})]})}fromSchema(e){tl(e,n0);let t=sk(e,e,n1.schema({names:{attributes:nX}}));ad.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,e=>new aF({schema:e}))}toSchema(){return new t0({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}n1.CLASS_NAME="SubjectDirectoryAttributes";class n2{static getItems(){return this.types||(this.types={},n2.register(aX,"SubjectAltName",aK),n2.register(a0,"IssuerAltName",aK),n2.register(re,"AuthorityKeyIdentifier",rg),n2.register(a1,"BasicConstraints",ry),n2.register("1.3.6.1.4.1.311.21.1","MicrosoftCaVersion",rb),n2.register(a6,"CertificatePolicies",r_),n2.register("1.3.6.1.4.1.311.21.10","CertificatePoliciesMicrosoft",r_),n2.register("1.3.6.1.4.1.311.21.7","MicrosoftCertTemplateV2",rR),n2.register(a8,"CRLDistributionPoints",rq),n2.register(a5,"FreshestCRL",rq),n2.register("2.5.29.37","ExtKeyUsage",rG),n2.register(a3,"CertificateIssuer",aY),n2.register(rs,"AuthorityInfoAccess",rQ),n2.register("1.3.6.1.5.5.7.1.11","SubjectInfoAccess",rQ),n2.register(a2,"IssuingDistributionPoint",r5),n2.register(a4,"NameConstraints",ii),n2.register(rt,"PolicyConstraints",ic),n2.register(a7,"PolicyMappings",iv),n2.register("2.5.29.16","PrivateKeyUsagePeriod",iS),n2.register("1.3.6.1.5.5.7.1.3","QCStatements",iV),n2.register("1.3.6.1.4.1.11129.2.4.2","SignedCertificateTimestampList",nY),n2.register("2.5.29.9","SubjectDirectoryAttributes",n1)),this.types}static fromBER(e,t){let s=tD(t);if(-1===s.offset)return null;let a=this.find(e);if(a)try{return new a.type({schema:s.result})}catch(s){let t=new a.type;return t.parsingError=`Incorrectly formatted value of extension ${a.name} (${e})`,t}return s.result}static find(e){return this.getItems()[e]||null}static register(e,t,s){this.getItems()[e]={name:t,type:s}}}let n3="extnID",n4="critical",n8="extnValue",n5="parsedValue",n6=[n3,n4,n8];class n9 extends af{get parsedValue(){if(void 0===this._parsedValue){let e=n2.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=e1(e,n3,n9.defaultValues(n3)),this.critical=e1(e,n4,n9.defaultValues(n4)),n8 in e?this.extnValue=new tK({valueHex:e.extnValue}):this.extnValue=n9.defaultValues(n8),n5 in e&&(this.parsedValue=e1(e,n5,n9.defaultValues(n5))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case n3:return"";case n4:return!1;case n8:return new tK;case n5:return{};default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.extnID||""}),new tL({name:t.critical||"",optional:!0}),new tK({name:t.extnValue||""})]})}fromSchema(e){tl(e,n6);let t=sk(e,e,n9.schema({names:{extnID:n3,critical:n4,extnValue:n8}}));ad.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),n4 in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){let e=[];return e.push(new tz({value:this.extnID})),this.critical!==n9.defaultValues(n4)&&e.push(new tL({value:this.critical})),e.push(this.extnValue),new t0({value:e})}toJSON(){let e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==n9.defaultValues(n4)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}n9.CLASS_NAME="Extension";let n7="extensions",le=[n7];class lt extends af{constructor(e={}){super(),this.extensions=e1(e,n7,lt.defaultValues(n7)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===n7?[]:super.defaultValues(e)}static schema(e={},t=!1){let s=e1(e,"names",{});return new t0({optional:t,name:s.blockName||"",value:[new sw({name:s.extensions||"",value:n9.schema(s.extension||{})})]})}fromSchema(e){tl(e,le);let t=sk(e,e,lt.schema({names:{extensions:n7}}));ad.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,e=>new n9({schema:e}))}toSchema(){return new t0({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}lt.CLASS_NAME="Extensions";let ls="issuer",la="serialNumber",lr="issuerUID",li=[ls,la,lr];class ln extends af{constructor(e={}){super(),this.issuer=e1(e,ls,ln.defaultValues(ls)),this.serialNumber=e1(e,la,ln.defaultValues(la)),lr in e&&(this.issuerUID=e1(e,lr,ln.defaultValues(lr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ls:return new aY;case la:return new tq;case lr:return new tJ;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aY.schema(t.issuer||{}),new tq({name:t.serialNumber||""}),new tJ({optional:!0,name:t.issuerUID||""})]})}fromSchema(e){tl(e,li);let t=sk(e,e,ln.schema({names:{issuer:{names:{blockName:ls}},serialNumber:la,issuerUID:lr}}));ad.assertSchema(t,this.className),this.issuer=new aY({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,lr in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){let e=new t0({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){let e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}ln.CLASS_NAME="IssuerSerial";let ll="version",lo="baseCertificateID",lu="subjectName",lc="issuer",lh="signature",lm="serialNumber",ld="attrCertValidityPeriod",lf="attributes",lg="issuerUniqueID",lp="extensions",ly=[ll,lo,lu,lc,lh,lm,ld,lf,lg,lp];class lv extends af{constructor(e={}){super(),this.version=e1(e,ll,lv.defaultValues(ll)),lo in e&&(this.baseCertificateID=e1(e,lo,lv.defaultValues(lo))),lu in e&&(this.subjectName=e1(e,lu,lv.defaultValues(lu))),this.issuer=e1(e,lc,lv.defaultValues(lc)),this.signature=e1(e,lh,lv.defaultValues(lh)),this.serialNumber=e1(e,lm,lv.defaultValues(lm)),this.attrCertValidityPeriod=e1(e,ld,lv.defaultValues(ld)),this.attributes=e1(e,lf,lv.defaultValues(lf)),lg in e&&(this.issuerUniqueID=e1(e,lg,lv.defaultValues(lg))),lp in e&&(this.extensions=e1(e,lp,lv.defaultValues(lp))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ll:return 0;case lo:return new ln;case lu:case lc:return new aY;case lh:return new aT;case lm:return new tq;case ld:return new aG;case lf:return[];case lg:return new tJ;case lp:return new lt;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),new sv({value:[new tP({name:t.baseCertificateID||"",idBlock:{tagClass:3,tagNumber:0},value:ln.schema().valueBlock.value}),new tP({name:t.subjectName||"",idBlock:{tagClass:3,tagNumber:1},value:aY.schema().valueBlock.value})]}),aY.schema({names:{blockName:t.issuer||""}}),aT.schema(t.signature||{}),new tq({name:t.serialNumber||""}),aG.schema(t.attrCertValidityPeriod||{}),new t0({name:t.attributes||"",value:[new sw({value:aF.schema()})]}),new tJ({optional:!0,name:t.issuerUniqueID||""}),lt.schema(t.extensions||{},!0)]})}fromSchema(e){tl(e,ly);let t=sk(e,e,lv.schema({names:{version:ll,baseCertificateID:lo,subjectName:lu,issuer:lc,signature:{names:{blockName:lh}},serialNumber:lm,attrCertValidityPeriod:{names:{blockName:ld}},attributes:lf,issuerUniqueID:lg,extensions:{names:{blockName:lp}}}}));ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,lo in t.result&&(this.baseCertificateID=new ln({schema:new t0({value:t.result.baseCertificateID.valueBlock.value})})),lu in t.result&&(this.subjectName=new aY({schema:new t0({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new aT({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new aG({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,e=>new aF({schema:e})),lg in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),lp in t.result&&(this.extensions=new lt({schema:t.result.extensions}))}toSchema(){let e=new t0({value:[new tq({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new t0({value:Array.from(this.attributes,e=>e.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){let e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,e=>e.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}lv.CLASS_NAME="AttributeCertificateInfoV1";let lw="acinfo",lb="signatureAlgorithm",lk="signatureValue",lS=[lw,lk,lb];class lA extends af{constructor(e={}){super(),this.acinfo=e1(e,lw,lA.defaultValues(lw)),this.signatureAlgorithm=e1(e,lb,lA.defaultValues(lb)),this.signatureValue=e1(e,lk,lA.defaultValues(lk)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lw:return new lv;case lb:return new aT;case lk:return new tJ;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[lv.schema(t.acinfo||{}),aT.schema(t.signatureAlgorithm||{}),new tJ({name:t.signatureValue||""})]})}fromSchema(e){tl(e,lS);let t=sk(e,e,lA.schema({names:{acinfo:{names:{blockName:lw}},signatureAlgorithm:{names:{blockName:lb}},signatureValue:lk}}));ad.assertSchema(t,this.className),this.acinfo=new lv({schema:t.result.acinfo}),this.signatureAlgorithm=new aT({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new t0({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}lA.CLASS_NAME="AttributeCertificateV1";let lN="digestedObjectType",lx="otherObjectTypeID",lC="digestAlgorithm",lB="objectDigest",lV=[lN,lx,lC,lB];class lE extends af{constructor(e={}){super(),this.digestedObjectType=e1(e,lN,lE.defaultValues(lN)),lx in e&&(this.otherObjectTypeID=e1(e,lx,lE.defaultValues(lx))),this.digestAlgorithm=e1(e,lC,lE.defaultValues(lC)),this.objectDigest=e1(e,lB,lE.defaultValues(lB)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lN:return new tW;case lx:return new tz;case lC:return new aT;case lB:return new tJ;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tW({name:t.digestedObjectType||""}),new tz({optional:!0,name:t.otherObjectTypeID||""}),aT.schema(t.digestAlgorithm||{}),new tJ({name:t.objectDigest||""})]})}fromSchema(e){tl(e,lV);let t=sk(e,e,lE.schema({names:{digestedObjectType:lN,otherObjectTypeID:lx,digestAlgorithm:{names:{blockName:lC}},objectDigest:lB}}));ad.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,lx in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new aT({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){let e=new t0({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){let e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}lE.CLASS_NAME="ObjectDigestInfo";let lI="issuerName",l_="baseCertificateID",lD="objectDigestInfo",lO=[lI,l_,lD];class lP extends af{constructor(e={}){super(),lI in e&&(this.issuerName=e1(e,lI,lP.defaultValues(lI))),l_ in e&&(this.baseCertificateID=e1(e,l_,lP.defaultValues(l_))),lD in e&&(this.objectDigestInfo=e1(e,lD,lP.defaultValues(lD))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lI:return new aY;case l_:return new ln;case lD:return new lE;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aY.schema({names:{blockName:t.issuerName}},!0),new tP({optional:!0,name:t.baseCertificateID||"",idBlock:{tagClass:3,tagNumber:0},value:ln.schema().valueBlock.value}),new tP({optional:!0,name:t.objectDigestInfo||"",idBlock:{tagClass:3,tagNumber:1},value:lE.schema().valueBlock.value})]})}fromSchema(e){tl(e,lO);let t=sk(e,e,lP.schema({names:{issuerName:lI,baseCertificateID:l_,objectDigestInfo:lD}}));ad.assertSchema(t,this.className),lI in t.result&&(this.issuerName=new aY({schema:t.result.issuerName})),l_ in t.result&&(this.baseCertificateID=new ln({schema:new t0({value:t.result.baseCertificateID.valueBlock.value})})),lD in t.result&&(this.objectDigestInfo=new lE({schema:new t0({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){let e=new t0;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){let e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}lP.CLASS_NAME="V2Form";let lU="baseCertificateID",lR="entityName",lj="objectDigestInfo",lT=[lU,lR,lj];class lL extends af{constructor(e={}){super(),lU in e&&(this.baseCertificateID=e1(e,lU,lL.defaultValues(lU))),lR in e&&(this.entityName=e1(e,lR,lL.defaultValues(lR))),lj in e&&(this.objectDigestInfo=e1(e,lj,lL.defaultValues(lj))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lU:return new ln;case lR:return new aY;case lj:return new lE;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tP({optional:!0,name:t.baseCertificateID||"",idBlock:{tagClass:3,tagNumber:0},value:ln.schema().valueBlock.value}),new tP({optional:!0,name:t.entityName||"",idBlock:{tagClass:3,tagNumber:1},value:aY.schema().valueBlock.value}),new tP({optional:!0,name:t.objectDigestInfo||"",idBlock:{tagClass:3,tagNumber:2},value:lE.schema().valueBlock.value})]})}fromSchema(e){tl(e,lT);let t=sk(e,e,lL.schema({names:{baseCertificateID:lU,entityName:lR,objectDigestInfo:lj}}));ad.assertSchema(t,this.className),lU in t.result&&(this.baseCertificateID=new ln({schema:new t0({value:t.result.baseCertificateID.valueBlock.value})})),lR in t.result&&(this.entityName=new aY({schema:new t0({value:t.result.entityName.valueBlock.value})})),lj in t.result&&(this.objectDigestInfo=new lE({schema:new t0({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){let e=new t0;return this.baseCertificateID&&e.valueBlock.value.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new tP({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){let e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}lL.CLASS_NAME="Holder";let lH="version",lK="holder",lM="issuer",lJ="signature",l$="serialNumber",lF="attrCertValidityPeriod",lq="attributes",lW="issuerUniqueID",lZ="extensions",lG=[lH,lK,lM,lJ,l$,lF,lq,lW,lZ];class lz extends af{constructor(e={}){super(),this.version=e1(e,lH,lz.defaultValues(lH)),this.holder=e1(e,lK,lz.defaultValues(lK)),this.issuer=e1(e,lM,lz.defaultValues(lM)),this.signature=e1(e,lJ,lz.defaultValues(lJ)),this.serialNumber=e1(e,l$,lz.defaultValues(l$)),this.attrCertValidityPeriod=e1(e,lF,lz.defaultValues(lF)),this.attributes=e1(e,lq,lz.defaultValues(lq)),lW in e&&(this.issuerUniqueID=e1(e,lW,lz.defaultValues(lW))),lZ in e&&(this.extensions=e1(e,lZ,lz.defaultValues(lZ))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lH:return 1;case lK:return new lL;case lM:return{};case lJ:return new aT;case l$:return new tq;case lF:return new aG;case lq:return[];case lW:return new tJ;case lZ:return new lt;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),lL.schema(t.holder||{}),new sv({value:[aY.schema({names:{blockName:t.issuer||""}}),new tP({name:t.issuer||"",idBlock:{tagClass:3,tagNumber:0},value:lP.schema().valueBlock.value})]}),aT.schema(t.signature||{}),new tq({name:t.serialNumber||""}),aG.schema(t.attrCertValidityPeriod||{}),new t0({name:t.attributes||"",value:[new sw({value:aF.schema()})]}),new tJ({optional:!0,name:t.issuerUniqueID||""}),lt.schema(t.extensions||{},!0)]})}fromSchema(e){tl(e,lG);let t=sk(e,e,lz.schema({names:{version:lH,holder:{names:{blockName:lK}},issuer:lM,signature:{names:{blockName:lJ}},serialNumber:l$,attrCertValidityPeriod:{names:{blockName:lF}},attributes:lq,issuerUniqueID:lW,extensions:{names:{blockName:lZ}}}}));if(ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new lL({schema:t.result.holder}),3===t.result.issuer.idBlock.tagClass)this.issuer=new lP({schema:new t0({value:t.result.issuer.valueBlock.value})});else throw Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2");this.signature=new aT({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new aG({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,e=>new aF({schema:e})),lW in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),lZ in t.result&&(this.extensions=new lt({schema:t.result.extensions}))}toSchema(){let e=new t0({value:[new tq({value:this.version}),this.holder.toSchema(),new tP({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new t0({value:Array.from(this.attributes,e=>e.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){let e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,e=>e.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}lz.CLASS_NAME="AttributeCertificateInfoV2";let lQ="acinfo",lY="signatureAlgorithm",lX="signatureValue",l0=[lQ,lY,lX];class l1 extends af{constructor(e={}){super(),this.acinfo=e1(e,lQ,l1.defaultValues(lQ)),this.signatureAlgorithm=e1(e,lY,l1.defaultValues(lY)),this.signatureValue=e1(e,lX,l1.defaultValues(lX)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lQ:return new lz;case lY:return new aT;case lX:return new tJ;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[lz.schema(t.acinfo||{}),aT.schema(t.signatureAlgorithm||{}),new tJ({name:t.signatureValue||""})]})}fromSchema(e){tl(e,l0);let t=sk(e,e,l1.schema({names:{acinfo:{names:{blockName:lQ}},signatureAlgorithm:{names:{blockName:lY}},signatureValue:lX}}));ad.assertSchema(t,this.className),this.acinfo=new lz({schema:t.result.acinfo}),this.signatureAlgorithm=new aT({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new t0({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}l1.CLASS_NAME="AttributeCertificateV2";let l2="contentType",l3="content",l4=[l2,l3];class l8 extends af{constructor(e={}){super(),this.contentType=e1(e,l2,l8.defaultValues(l2)),this.content=e1(e,l3,l8.defaultValues(l3)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case l2:return"";case l3:return new sy;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case l2:return"string"==typeof t&&t===this.defaultValues(l2);case l3:return t instanceof sy;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return"optional"in t==!1&&(t.optional=!1),new t0({name:t.blockName||"ContentInfo",optional:t.optional,value:[new tz({name:t.contentType||l2}),new tP({idBlock:{tagClass:3,tagNumber:0},value:[new sy({name:t.content||l3})]})]})}fromSchema(e){tl(e,l4);let t=sk(e,e,l8.schema());ad.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new t0({value:[new tz({value:this.contentType}),new tP({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){let e={contentType:this.contentType};return this.content instanceof sy||(e.content=this.content.toJSON()),e}}l8.CLASS_NAME="ContentInfo",l8.DATA=ra,l8.SIGNED_DATA=rr,l8.ENVELOPED_DATA=ri,l8.ENCRYPTED_DATA=rn;let l5="type",l6="value",l9="utcTimeName",l7="generalTimeName",oe=[l9,l7];!function(e){e[e.UTCTime=0]="UTCTime",e[e.GeneralizedTime=1]="GeneralizedTime",e[e.empty=2]="empty"}(c||(c={}));class ot extends af{constructor(e={}){super(),this.type=e1(e,l5,ot.defaultValues(l5)),this.value=e1(e,l6,ot.defaultValues(l6)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case l5:return 0;case l6:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){let s=e1(e,"names",{});return new sv({optional:t,value:[new sc({name:s.utcTimeName||""}),new sh({name:s.generalTimeName||""})]})}fromSchema(e){tl(e,oe);let t=sk(e,e,ot.schema({names:{utcTimeName:l9,generalTimeName:l7}}));ad.assertSchema(t,this.className),l9 in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),l7 in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return 0===this.type?new sc({valueDate:this.value}):1===this.type?new sh({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}ot.CLASS_NAME="Time";let os="version",oa="serialNumber",or="signature",oi="issuer",on="notBefore",ol="notAfter",oo="subject",ou="subjectPublicKeyInfo",oc="issuerUniqueID",oh="subjectUniqueID",om="extensions",od="signatureAlgorithm",of="signatureValue",og="tbsCertificate",op=`${og}.${os}`,oy=`${og}.${oa}`,ov=`${og}.${or}`,ow=`${og}.${oi}`,ob=`${og}.${on}`,ok=`${og}.${ol}`,oS=`${og}.${oo}`,oA=`${og}.${ou}`,oN=`${og}.${oc}`,ox=`${og}.${oh}`,oC=`${og}.${om}`,oB=[og,op,oy,ov,ow,ob,ok,oS,oA,oN,ox,oC,od,of];class oV extends af{get tbs(){return eW.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(e1(e,"tbs",oV.defaultValues("tbs"))),this.version=e1(e,os,oV.defaultValues(os)),this.serialNumber=e1(e,oa,oV.defaultValues(oa)),this.signature=e1(e,or,oV.defaultValues(or)),this.issuer=e1(e,oi,oV.defaultValues(oi)),this.notBefore=e1(e,on,oV.defaultValues(on)),this.notAfter=e1(e,ol,oV.defaultValues(ol)),this.subject=e1(e,oo,oV.defaultValues(oo)),this.subjectPublicKeyInfo=e1(e,ou,oV.defaultValues(ou)),oc in e&&(this.issuerUniqueID=e1(e,oc,oV.defaultValues(oc))),oh in e&&(this.subjectUniqueID=e1(e,oh,oV.defaultValues(oh))),om in e&&(this.extensions=e1(e,om,oV.defaultValues(om))),this.signatureAlgorithm=e1(e,od,oV.defaultValues(od)),this.signatureValue=e1(e,of,oV.defaultValues(of)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":return ac;case os:return 0;case oa:return new tq;case or:return new aT;case oi:return new ak;case on:case ol:return new ot;case oo:return new ak;case ou:return new iL;case oc:case oh:return ac;case om:return[];case od:return new aT;case of:return new tJ;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[function(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||og,value:[new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new tq({name:t.tbsCertificateVersion||op})]}),new tq({name:t.tbsCertificateSerialNumber||oy}),aT.schema(t.signature||{names:{blockName:ov}}),ak.schema(t.issuer||{names:{blockName:ow}}),new t0({name:t.tbsCertificateValidity||"tbsCertificate.validity",value:[ot.schema(t.notBefore||{names:{utcTimeName:ob,generalTimeName:ob}}),ot.schema(t.notAfter||{names:{utcTimeName:ok,generalTimeName:ok}})]}),ak.schema(t.subject||{names:{blockName:oS}}),iL.schema(t.subjectPublicKeyInfo||{names:{blockName:oA}}),new tI({name:t.tbsCertificateIssuerUniqueID||oN,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new tI({name:t.tbsCertificateSubjectUniqueID||ox,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[lt.schema(t.extensions||{names:{blockName:oC}})]})]})}(t.tbsCertificate),aT.schema(t.signatureAlgorithm||{names:{blockName:od}}),new tJ({name:t.signatureValue||of})]})}fromSchema(e){tl(e,oB);let t=sk(e,e,oV.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:oC}}}}}}));ad.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,op in t.result&&(this.version=t.result[op].valueBlock.valueDec),this.serialNumber=t.result[oy],this.signature=new aT({schema:t.result[ov]}),this.issuer=new ak({schema:t.result[ow]}),this.notBefore=new ot({schema:t.result[ob]}),this.notAfter=new ot({schema:t.result[ok]}),this.subject=new ak({schema:t.result[oS]}),this.subjectPublicKeyInfo=new iL({schema:t.result[oA]}),oN in t.result&&(this.issuerUniqueID=t.result[oN].valueBlock.valueHex),ox in t.result&&(this.subjectUniqueID=t.result[ox].valueBlock.valueHex),oC in t.result&&(this.extensions=Array.from(t.result[oC],e=>new n9({schema:e}))),this.signatureAlgorithm=new aT({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){let e=[];return os in this&&this.version!==oV.defaultValues(os)&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new tq({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new t0({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new tI({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new tI({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new t0({value:Array.from(this.extensions,e=>e.toSchema())})]})),new t0({value:e})}toSchema(e=!1){let t;if(!1===e){if(!this.tbsView.byteLength)return oV.schema().value[0];let e=tD(this.tbsView);ad.assert(e,"TBS Certificate"),t=e.result}else t=this.encodeTBS();return new t0({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){let e={tbs:e0.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return os in this&&this.version!==oV.defaultValues(os)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=e0.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=e0.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,e=>e.toJSON())),e}async getPublicKey(e,t=nD(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=nD(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",s=nD(!0)){if(!e)throw Error("Need to provide a private key for signing");let a=await s.getSignatureParameters(e,t),r=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());let i=await s.signWithPrivateKey(this.tbsView,e,r);this.signatureValue=new tJ({valueHex:i})}async verify(e,t=nD(!0)){let s;if(e?s=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(s=this.subjectPublicKeyInfo),!(s instanceof iL))throw Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}function oE(e,t=null){if(t&&e.issuer.isEqual(t.issuer)&&e.serialNumber.isEqual(t.serialNumber))return null;let s=!1;if(e.extensions){for(let t of e.extensions)if(t.extnID===a1&&t.parsedValue instanceof ry&&t.parsedValue.cA){s=!0;break}}return s?e:null}oV.CLASS_NAME="Certificate";let oI="certId",o_="certValue",oD="parsedValue",oO=[oI,o_];class oP extends af{constructor(e={}){super(),this.certId=e1(e,oI,oP.defaultValues(oI)),this.certValue=e1(e,o_,oP.defaultValues(o_)),oD in e&&(this.parsedValue=e1(e,oD,oP.defaultValues(oD))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oI:return"";case o_:return new sy;case oD:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oI:return""===t;case o_:return t instanceof sy;case oD:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.id||"id"}),new tP({idBlock:{tagClass:3,tagNumber:0},value:[new sy({name:t.value||"value"})]})]})}fromSchema(e){tl(e,oO);let t=sk(e,e,oP.schema({names:{id:oI,value:o_}}));ad.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;let s=this.certValue.valueBlock.valueHexView;switch(this.certId){case rl:try{this.parsedValue=oV.fromBER(s)}catch(e){l1.fromBER(s)}break;case ro:this.parsedValue=l1.fromBER(s);break;default:throw Error(`Incorrect CERT_ID value in CertBag: ${this.certId}`)}}toSchema(){return oD in this&&("acinfo"in this.parsedValue?this.certId=ro:this.certId=rl,this.certValue=new tK({valueHex:this.parsedValue.toSchema().toBER(!1)})),new t0({value:[new tz({value:this.certId}),new tP({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}oP.CLASS_NAME="CertBag";let oU="userCertificate",oR="revocationDate",oj="crlEntryExtensions",oT=[oU,oR,oj];class oL extends af{constructor(e={}){super(),this.userCertificate=e1(e,oU,oL.defaultValues(oU)),this.revocationDate=e1(e,oR,oL.defaultValues(oR)),oj in e&&(this.crlEntryExtensions=e1(e,oj,oL.defaultValues(oj))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oU:return new tq;case oR:return new ot;case oj:return new lt;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.userCertificate||oU}),ot.schema({names:{utcTimeName:t.revocationDate||oR,generalTimeName:t.revocationDate||oR}}),lt.schema({names:{blockName:t.crlEntryExtensions||oj}},!0)]})}fromSchema(e){tl(e,oT);let t=sk(e,e,oL.schema());ad.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new ot({schema:t.result.revocationDate}),oj in t.result&&(this.crlEntryExtensions=new lt({schema:t.result.crlEntryExtensions}))}toSchema(){let e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new t0({value:e})}toJSON(){let e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}oL.CLASS_NAME="RevokedCertificate";let oH="version",oK="signature",oM="issuer",oJ="thisUpdate",o$="nextUpdate",oF="revokedCertificates",oq="crlExtensions",oW="signatureAlgorithm",oZ="signatureValue",oG="tbsCertList",oz=`${oG}.version`,oQ=`${oG}.signature`,oY=`${oG}.issuer`,oX=`${oG}.thisUpdate`,o0=`${oG}.nextUpdate`,o1=`${oG}.revokedCertificates`,o2=`${oG}.extensions`,o3=[oG,oz,oQ,oY,oX,o0,o1,o2,oW,oZ],o4=[re,a0,"2.5.29.20","2.5.29.27",a2,a5,rs,"2.5.29.21","2.5.29.24",a3];class o8 extends af{get tbs(){return eW.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(e1(e,"tbs",o8.defaultValues("tbs"))),this.version=e1(e,oH,o8.defaultValues(oH)),this.signature=e1(e,oK,o8.defaultValues(oK)),this.issuer=e1(e,oM,o8.defaultValues(oM)),this.thisUpdate=e1(e,oJ,o8.defaultValues(oJ)),o$ in e&&(this.nextUpdate=e1(e,o$,o8.defaultValues(o$))),oF in e&&(this.revokedCertificates=e1(e,oF,o8.defaultValues(oF))),oq in e&&(this.crlExtensions=e1(e,oq,o8.defaultValues(oq))),this.signatureAlgorithm=e1(e,oW,o8.defaultValues(oW)),this.signatureValue=e1(e,oZ,o8.defaultValues(oZ)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":return ac;case oH:return 0;case oK:return new aT;case oM:return new ak;case oJ:case o$:return new ot;case oF:return[];case oq:return new lt;case oW:return new aT;case oZ:return new tJ;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"CertificateList",value:[function(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||oG,value:[new tq({optional:!0,name:t.tbsCertListVersion||oz,value:2}),aT.schema(t.signature||{names:{blockName:oQ}}),ak.schema(t.issuer||{names:{blockName:oY}}),ot.schema(t.tbsCertListThisUpdate||{names:{utcTimeName:oX,generalTimeName:oX}}),ot.schema(t.tbsCertListNextUpdate||{names:{utcTimeName:o0,generalTimeName:o0}},!0),new t0({optional:!0,value:[new sw({name:t.tbsCertListRevokedCertificates||o1,value:new t0({value:[new tq,ot.schema(),lt.schema({},!0)]})})]}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[lt.schema(t.crlExtensions||{names:{blockName:o2}})]})]})}(e),aT.schema(t.signatureAlgorithm||{names:{blockName:oW}}),new tJ({name:t.signatureValue||oZ})]})}fromSchema(e){tl(e,o3);let t=sk(e,e,o8.schema());ad.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,oz in t.result&&(this.version=t.result[oz].valueBlock.valueDec),this.signature=new aT({schema:t.result[oQ]}),this.issuer=new ak({schema:t.result[oY]}),this.thisUpdate=new ot({schema:t.result[oX]}),o0 in t.result&&(this.nextUpdate=new ot({schema:t.result[o0]})),o1 in t.result&&(this.revokedCertificates=Array.from(t.result[o1],e=>new oL({schema:e}))),o2 in t.result&&(this.crlExtensions=new lt({schema:t.result[o2]})),this.signatureAlgorithm=new aT({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){let e=[];return this.version!==o8.defaultValues(oH)&&e.push(new tq({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new t0({value:Array.from(this.revokedCertificates,e=>e.toSchema())})),this.crlExtensions&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new t0({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return o8.schema();let e=tD(this.tbsView);ad.assert(e,"TBS Certificate Revocation List"),t=e.result}return new t0({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){let e={tbs:e0.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==o8.defaultValues(oH)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,e=>e.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(let t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",s=nD(!0)){if(!e)throw Error("Need to provide a private key for signing");let a=await s.getSignatureParameters(e,t),{parameters:r}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());let i=await s.signWithPrivateKey(this.tbsView,e,r);this.signatureValue=new tJ({valueHex:i})}async verify(e={},t=nD(!0)){let s;if(e.issuerCertificate&&(s=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(s=e.publicKeyInfo),!s)throw Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(let e of this.crlExtensions.extensions)if(e.critical&&!o4.includes(e.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,s,this.signatureAlgorithm)}}o8.CLASS_NAME="CertificateRevocationList";let o5="crlId",o6="crlValue",o9="parsedValue",o7=[o5,o6];class ue extends af{constructor(e={}){super(),this.crlId=e1(e,o5,ue.defaultValues(o5)),this.crlValue=e1(e,o6,ue.defaultValues(o6)),o9 in e&&(this.parsedValue=e1(e,o9,ue.defaultValues(o9))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case o5:return"";case o6:return new sy;case o9:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case o5:return""===t;case o6:return t instanceof sy;case o9:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.id||"id"}),new tP({idBlock:{tagClass:3,tagNumber:0},value:[new sy({name:t.value||"value"})]})]})}fromSchema(e){tl(e,o7);let t=sk(e,e,ue.schema({names:{id:o5,value:o6}}));if(ad.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId===ru)this.parsedValue=o8.fromBER(this.certValue.valueBlock.valueHex);else throw Error(`Incorrect CRL_ID value in CRLBag: ${this.crlId}`)}toSchema(){return this.parsedValue&&(this.crlId=ru,this.crlValue=new tK({valueHex:this.parsedValue.toSchema().toBER(!1)})),new t0({value:[new tz({value:this.crlId}),new tP({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}ue.CLASS_NAME="CRLBag";let ut="version",us="encryptedContentInfo",ua="unprotectedAttrs",ur=[ut,us,ua];class ui extends af{constructor(e={}){super(),this.version=e1(e,ut,ui.defaultValues(ut)),this.encryptedContentInfo=e1(e,us,ui.defaultValues(us)),ua in e&&(this.unprotectedAttrs=e1(e,ua,ui.defaultValues(ua))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ut:return 0;case us:return new nc;case ua:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ut:return 0===t;case us:return nc.compareWithDefault("contentType",t.contentType)&&nc.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&nc.compareWithDefault("encryptedContent",t.encryptedContent);case ua:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),nc.schema(t.encryptedContentInfo||{}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new sw({name:t.unprotectedAttrs||"",value:aF.schema()})]})]})}fromSchema(e){tl(e,ur);let t=sk(e,e,ui.schema({names:{version:ut,encryptedContentInfo:{names:{blockName:us}},unprotectedAttrs:ua}}));ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new nc({schema:t.result.encryptedContentInfo}),ua in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,e=>new aF({schema:e})))}toSchema(){let e=[];return e.push(new tq({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,e=>e.toSchema())})),new t0({value:e})}toJSON(){let e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,e=>e.toJSON())),e}async encrypt(e,t=nD(!0)){ah.assert(e,"parameters","object");let s={...e,contentType:"1.2.840.113549.1.7.1"};this.encryptedContentInfo=await t.encryptEncryptedContentInfo(s)}async decrypt(e,t=nD(!0)){ah.assert(e,"parameters","object");let s={...e,encryptedContentInfo:this.encryptedContentInfo};return t.decryptEncryptedContentInfo(s)}}ui.CLASS_NAME="EncryptedData";let un="encryptionAlgorithm",ul="encryptedData",uo="parsedValue",uu=[un,ul];class uc extends af{constructor(e={}){super(),this.encryptionAlgorithm=e1(e,un,uc.defaultValues(un)),this.encryptedData=e1(e,ul,uc.defaultValues(ul)),uo in e&&(this.parsedValue=e1(e,uo,uc.defaultValues(uo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case un:return new aT;case ul:return new tK;case uo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case un:return aT.compareWithDefault("algorithmId",t.algorithmId)&&"algorithmParams"in t==!1;case ul:return t.isEqual(uc.defaultValues(e));case uo:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aT.schema(t.encryptionAlgorithm||{names:{blockName:un}}),new sv({value:[new tK({name:t.encryptedData||ul}),new tK({idBlock:{isConstructed:!0},name:t.encryptedData||ul})]})]})}fromSchema(e){tl(e,uu);let t=sk(e,e,uc.schema({names:{encryptionAlgorithm:{names:{blockName:un}},encryptedData:ul}}));ad.assertSchema(t,this.className),this.encryptionAlgorithm=new aT({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new t0({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=nD(!0)){let s=new ui({encryptedContentInfo:new nc({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}),a=await s.decrypt(e,t);this.parsedValue=ni.fromBER(a)}async makeInternalValues(e,t=nD(!0)){if(!this.parsedValue)throw Error('Please initialize "parsedValue" first');let s=new ui,a={...e,contentToEncrypt:this.parsedValue.toSchema().toBER(!1)};if(await s.encrypt(a,t),!s.encryptedContentInfo.encryptedContent)throw Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=s.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=s.encryptedContentInfo.encryptedContent}}uc.CLASS_NAME="PKCS8ShroudedKeyBag";let uh="secretTypeId",um="secretValue",ud=[uh,um];class uf extends af{constructor(e={}){super(),this.secretTypeId=e1(e,uh,uf.defaultValues(uh)),this.secretValue=e1(e,um,uf.defaultValues(um)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uh:return"";case um:return new sy;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uh:return""===t;case um:return t instanceof sy;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.id||"id"}),new tP({idBlock:{tagClass:3,tagNumber:0},value:[new sy({name:t.value||"value"})]})]})}fromSchema(e){tl(e,ud);let t=sk(e,e,uf.schema({names:{id:uh,value:um}}));ad.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new t0({value:[new tz({value:this.secretTypeId}),new tP({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}uf.CLASS_NAME="SecretBag";class ug{static getItems(){return this.items||(this.items={},ug.register("1.2.840.113549.1.12.10.1.1",ni),ug.register("1.2.840.113549.1.12.10.1.2",uc),ug.register("1.2.840.113549.1.12.10.1.3",oP),ug.register("1.2.840.113549.1.12.10.1.4",ue),ug.register("1.2.840.113549.1.12.10.1.5",uf),ug.register("1.2.840.113549.1.12.10.1.6",uS)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}let up="bagId",uy="bagValue",uv="bagAttributes",uw=[up,uy,uv];class ub extends af{constructor(e={}){super(),this.bagId=e1(e,up,ub.defaultValues(up)),this.bagValue=e1(e,uy,ub.defaultValues(uy)),uv in e&&(this.bagAttributes=e1(e,uv,ub.defaultValues(uv))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case up:return"";case uy:return new sy;case uv:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case up:return""===t;case uy:return t instanceof sy;case uv:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.bagId||up}),new tP({idBlock:{tagClass:3,tagNumber:0},value:[new sy({name:t.bagValue||uy})]}),new t1({optional:!0,value:[new sw({name:t.bagAttributes||uv,value:aF.schema()})]})]})}fromSchema(e){tl(e,uw);let t=sk(e,e,ub.schema({names:{bagId:up,bagValue:uy,bagAttributes:uv}}));ad.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();let s=ug.find(this.bagId);if(!s)throw Error(`Invalid BAG_ID for SafeBag: ${this.bagId}`);this.bagValue=new s({schema:t.result.bagValue}),uv in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,e=>new aF({schema:e})))}toSchema(){let e=[new tz({value:this.bagId}),new tP({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new t1({value:Array.from(this.bagAttributes,e=>e.toSchema())})),new t0({value:e})}toJSON(){let e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,e=>e.toJSON())),e}}ub.CLASS_NAME="SafeBag";let uk="safeBags";class uS extends af{constructor(e={}){super(),this.safeBags=e1(e,uk,uS.defaultValues(uk)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===uk?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===uk?0===t.length:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.safeBags||"",value:ub.schema()})]})}fromSchema(e){tl(e,[uk]);let t=sk(e,e,uS.schema({names:{safeBags:uk}}));ad.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,e=>new ub({schema:e}))}toSchema(){return new t0({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}uS.CLASS_NAME="SafeContents";let uA="otherCertFormat",uN="otherCert",ux=[uA,uN];class uC extends af{constructor(e={}){super(),this.otherCertFormat=e1(e,uA,uC.defaultValues(uA)),this.otherCert=e1(e,uN,uC.defaultValues(uN)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uA:return"";case uN:return new sy;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.otherCertFormat||uA}),new sy({name:t.otherCert||uN})]})}fromSchema(e){tl(e,ux);let t=sk(e,e,uC.schema());ad.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new t0({value:[new tz({value:this.otherCertFormat}),this.otherCert]})}toJSON(){let e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof sy||(e.otherCert=this.otherCert.toJSON()),e}}let uB="certificates",uV=[uB];class uE extends af{constructor(e={}){super(),this.certificates=e1(e,uB,uE.defaultValues(uB)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===uB?[]:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t1({name:t.blockName||"",value:[new sw({name:t.certificates||uB,value:new sv({value:[oV.schema(),new tP({idBlock:{tagClass:3,tagNumber:0},value:[new sy]}),new tP({idBlock:{tagClass:3,tagNumber:1},value:[new t0]}),new tP({idBlock:{tagClass:3,tagNumber:2},value:l1.schema().valueBlock.value}),new tP({idBlock:{tagClass:3,tagNumber:3},value:uC.schema().valueBlock.value})]})})]})}fromSchema(e){tl(e,uV);let t=sk(e,e,uE.schema());ad.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],e=>{let t=e.idBlock.tagNumber;if(1===e.idBlock.tagClass)return new oV({schema:e});let s=new t0({value:e.valueBlock.value});switch(t){case 1:if(1===s.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec)return new l1({schema:s});return new lA({schema:s});case 2:return new l1({schema:s});case 3:return new uC({schema:s})}return e})}toSchema(){return new t1({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof oV:break;case e instanceof lA:return new tP({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof l1:return new tP({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof uC:return new tP({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}uE.CLASS_NAME="CertificateSet";let uI="otherRevInfoFormat",u_="otherRevInfo",uD=[uI,u_];class uO extends af{constructor(e={}){super(),this.otherRevInfoFormat=e1(e,uI,uO.defaultValues(uI)),this.otherRevInfo=e1(e,u_,uO.defaultValues(u_)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uI:return"";case u_:return new sy;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.otherRevInfoFormat||uI}),new sy({name:t.otherRevInfo||u_})]})}fromSchema(e){tl(e,uD);let t=sk(e,e,uO.schema());ad.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new t0({value:[new tz({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){let e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof sy||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}uO.CLASS_NAME="OtherRevocationInfoFormat";let uP="crls",uU="otherRevocationInfos",uR=[uP];class uj extends af{constructor(e={}){super(),this.crls=e1(e,uP,uj.defaultValues(uP)),this.otherRevocationInfos=e1(e,uU,uj.defaultValues(uU)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uP:case uU:return[];default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t1({name:t.blockName||"",value:[new sw({name:t.crls||"",value:new sv({value:[o8.schema(),new tP({idBlock:{tagClass:3,tagNumber:1},value:[new tz,new sy]})]})})]})}fromSchema(e){tl(e,uR);let t=sk(e,e,uj.schema({names:{crls:uP}}));if(ad.assertSchema(t,this.className),t.result.crls)for(let e of t.result.crls)1===e.idBlock.tagClass?this.crls.push(new o8({schema:e})):this.otherRevocationInfos.push(new uO({schema:e}))}toSchema(){let e=[];return e.push(...Array.from(this.crls,e=>e.toSchema())),e.push(...Array.from(this.otherRevocationInfos,e=>{let t=e.toSchema();return t.idBlock.tagClass=3,t.idBlock.tagNumber=1,t})),new t1({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}uj.CLASS_NAME="RevocationInfoChoices";let uT="certs",uL="crls",uH=[uT,uL];class uK extends af{constructor(e={}){super(),this.crls=e1(e,uL,uK.defaultValues(uL)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uT:return new uE;case uL:return new uj;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uT:return 0===t.certificates.length;case uL:return 0===t.crls.length&&0===t.otherRevocationInfos.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tP({name:t.certs||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:uE.schema().valueBlock.value}),new tP({name:t.crls||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:uj.schema().valueBlock.value})]})}fromSchema(e){tl(e,uH);let t=sk(e,e,uK.schema({names:{certs:uT,crls:uL}}));ad.assertSchema(t,this.className),uT in t.result&&(this.certs=new uE({schema:new t1({value:t.result.certs.valueBlock.value})})),uL in t.result&&(this.crls=new uj({schema:new t1({value:t.result.crls.valueBlock.value})}))}toSchema(){let e=[];return this.certs&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new t0({value:e})}toJSON(){let e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}uK.CLASS_NAME="OriginatorInfo";let uM="issuer",uJ="serialNumber",u$=[uM,uJ];class uF extends af{constructor(e={}){super(),this.issuer=e1(e,uM,uF.defaultValues(uM)),this.serialNumber=e1(e,uJ,uF.defaultValues(uJ)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uM:return new ak;case uJ:return new tq;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[ak.schema(t.issuer||{}),new tq({name:t.serialNumber||""})]})}fromSchema(e){tl(e,u$);let t=sk(e,e,uF.schema({names:{issuer:{names:{blockName:uM}},serialNumber:uJ}}));ad.assertSchema(t,this.className),this.issuer=new ak({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new t0({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}uF.CLASS_NAME="IssuerAndSerialNumber";let uq="variant",uW="value",uZ=["blockName"];class uG extends af{constructor(e={}){super(),this.variant=e1(e,uq,uG.defaultValues(uq)),uW in e&&(this.value=e1(e,uW,uG.defaultValues(uW))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uq:return -1;case uW:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uq:return -1===t;case uW:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new sv({value:[uF.schema({names:{blockName:t.blockName||""}}),new tI({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){tl(e,uZ);let t=sk(e,e,uG.schema({names:{blockName:"blockName"}}));ad.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new uF({schema:t.result.blockName})):(this.variant=2,this.value=new tK({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof uF))throw Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof tK))throw Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new tI({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new sy}}toJSON(){let e={variant:this.variant};return(1===this.variant||2===this.variant)&&this.value&&(e.value=this.value.toJSON()),e}}uG.CLASS_NAME="RecipientIdentifier";let uz="version",uQ="keyEncryptionAlgorithm",uY="encryptedKey",uX="recipientCertificate",u0=[uz,"rid",uQ,uY];class u1 extends af{constructor(e={}){super(),this.version=e1(e,uz,u1.defaultValues(uz)),this.rid=e1(e,"rid",u1.defaultValues("rid")),this.keyEncryptionAlgorithm=e1(e,uQ,u1.defaultValues(uQ)),this.encryptedKey=e1(e,uY,u1.defaultValues(uY)),this.recipientCertificate=e1(e,uX,u1.defaultValues(uX)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uz:return -1;case"rid":return{};case uQ:return new aT;case uY:return new tK;case uX:return new oV;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case uz:return t===u1.defaultValues(uz);case"rid":return 0===Object.keys(t).length;case uQ:case uY:return t.isEqual(u1.defaultValues(e));case uX:return!1;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),uG.schema(t.rid||{}),aT.schema(t.keyEncryptionAlgorithm||{}),new tK({name:t.encryptedKey||""})]})}fromSchema(e){tl(e,u0);let t=sk(e,e,u1.schema({names:{version:uz,rid:{names:{blockName:"rid"}},keyEncryptionAlgorithm:{names:{blockName:uQ}},encryptedKey:uY}}));ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,3===t.result.rid.idBlock.tagClass?this.rid=new tK({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new uF({schema:t.result.rid}),this.keyEncryptionAlgorithm=new aT({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){let e=[];return this.rid instanceof uF?(this.version=0,e.push(new tq({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new tq({value:this.version})),e.push(new tI({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new t0({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}u1.CLASS_NAME="KeyTransRecipientInfo";let u2="algorithm",u3="publicKey",u4=[u2,u3];class u8 extends af{constructor(e={}){super(),this.algorithm=e1(e,u2,u8.defaultValues(u2)),this.publicKey=e1(e,u3,u8.defaultValues(u3)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case u2:return new aT;case u3:return new tJ;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case u2:case u3:return t.isEqual(u8.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aT.schema(t.algorithm||{}),new tJ({name:t.publicKey||""})]})}fromSchema(e){tl(e,u4);let t=sk(e,e,u8.schema({names:{algorithm:{names:{blockName:u2}},publicKey:u3}}));ad.assertSchema(t,this.className),this.algorithm=new aT({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new t0({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}u8.CLASS_NAME="OriginatorPublicKey";let u5="variant",u6="value",u9=["blockName"];class u7 extends af{constructor(e={}){super(),this.variant=e1(e,u5,u7.defaultValues(u5)),u6 in e&&(this.value=e1(e,u6,u7.defaultValues(u6))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case u5:return -1;case u6:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case u5:return -1===t;case u6:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new sv({value:[uF.schema({names:{blockName:t.blockName||""}}),new tI({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||""}),new tP({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||"",value:u8.schema().valueBlock.value})]})}fromSchema(e){tl(e,u9);let t=sk(e,e,u7.schema({names:{blockName:"blockName"}}));ad.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new uF({schema:t.result.blockName})):0===t.result.blockName.idBlock.tagNumber?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new u8({schema:new t0({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{let e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new sy}}toJSON(){let e={variant:this.variant};return(1===this.variant||2===this.variant||3===this.variant)&&(e.value=this.value.toJSON()),e}}u7.CLASS_NAME="OriginatorIdentifierOrKey";let ce="keyAttrId",ct="keyAttr",cs=[ce,ct];class ca extends af{constructor(e={}){super(),this.keyAttrId=e1(e,ce,ca.defaultValues(ce)),ct in e&&(this.keyAttr=e1(e,ct,ca.defaultValues(ct))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ce:return"";case ct:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ce:return"string"==typeof t&&""===t;case ct:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({optional:t.optional||!0,name:t.blockName||"",value:[new tz({name:t.keyAttrId||""}),new sy({optional:!0,name:t.keyAttr||""})]})}fromSchema(e){tl(e,cs);let t=sk(e,e,ca.schema({names:{keyAttrId:ce,keyAttr:ct}}));ad.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),ct in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){let e=[];return e.push(new tz({value:this.keyAttrId})),ct in this&&e.push(this.keyAttr),new t0({value:e})}toJSON(){let e={keyAttrId:this.keyAttrId};return ct in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}ca.CLASS_NAME="OtherKeyAttribute";let cr="subjectKeyIdentifier",ci="date",cn="other",cl=[cr,ci,cn];class co extends af{constructor(e={}){super(),this.subjectKeyIdentifier=e1(e,cr,co.defaultValues(cr)),ci in e&&(this.date=e1(e,ci,co.defaultValues(ci))),cn in e&&(this.other=e1(e,cn,co.defaultValues(cn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cr:return new tK;case ci:return new sh;case cn:return new ca;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cr:return t.isEqual(co.defaultValues(cr));case ci:return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case cn:return""===t.keyAttrId&&"keyAttr"in t==!1;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tK({name:t.subjectKeyIdentifier||""}),new sh({optional:!0,name:t.date||""}),ca.schema(t.other||{})]})}fromSchema(e){tl(e,cl);let t=sk(e,e,co.schema({names:{subjectKeyIdentifier:cr,date:ci,other:{names:{blockName:cn}}}}));ad.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,ci in t.result&&(this.date=t.result.date),cn in t.result&&(this.other=new ca({schema:t.result.other}))}toSchema(){let e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new t0({value:e})}toJSON(){let e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}co.CLASS_NAME="RecipientKeyIdentifier";let cu="variant",cc="value",ch=["blockName"];class cm extends af{constructor(e={}){super(),this.variant=e1(e,cu,cm.defaultValues(cu)),this.value=e1(e,cc,cm.defaultValues(cc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cu:return -1;case cc:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cu:return -1===t;case cc:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new sv({value:[uF.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||""}}),new tP({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:0},value:co.schema(t.rKeyId||{names:{blockName:t.blockName||""}}).valueBlock.value})]})}fromSchema(e){tl(e,ch);let t=sk(e,e,cm.schema({names:{blockName:"blockName"}}));ad.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new uF({schema:t.result.blockName})):(this.variant=2,this.value=new co({schema:new t0({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new tP({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new sy}}toJSON(){let e={variant:this.variant};return(1===this.variant||2===this.variant)&&(e.value=this.value.toJSON()),e}}cm.CLASS_NAME="KeyAgreeRecipientIdentifier";let cd="encryptedKey",cf=["rid",cd];class cg extends af{constructor(e={}){super(),this.rid=e1(e,"rid",cg.defaultValues("rid")),this.encryptedKey=e1(e,cd,cg.defaultValues(cd)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"rid":return new cm;case cd:return new tK;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"rid":return -1===t.variant&&"value"in t==!1;case cd:return t.isEqual(cg.defaultValues(cd));default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[cm.schema(t.rid||{}),new tK({name:t.encryptedKey||""})]})}fromSchema(e){tl(e,cf);let t=sk(e,e,cg.schema({names:{rid:{names:{blockName:"rid"}},encryptedKey:cd}}));ad.assertSchema(t,this.className),this.rid=new cm({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new t0({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}cg.CLASS_NAME="RecipientEncryptedKey";let cp="encryptedKeys",cy="RecipientEncryptedKeys",cv=[cy];class cw extends af{constructor(e={}){super(),this.encryptedKeys=e1(e,cp,cw.defaultValues(cp)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===cp?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===cp?0===t.length:super.defaultValues(e)}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.RecipientEncryptedKeys||"",value:cg.schema()})]})}fromSchema(e){tl(e,cv);let t=sk(e,e,cw.schema({names:{RecipientEncryptedKeys:cy}}));ad.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,e=>new cg({schema:e}))}toSchema(){return new t0({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}cw.CLASS_NAME="RecipientEncryptedKeys";let cb="version",ck="originator",cS="keyEncryptionAlgorithm",cA="recipientEncryptedKeys",cN="recipientCertificate",cx="recipientPublicKey",cC=[cb,ck,"ukm",cS,cA];class cB extends af{constructor(e={}){super(),this.version=e1(e,cb,cB.defaultValues(cb)),this.originator=e1(e,ck,cB.defaultValues(ck)),"ukm"in e&&(this.ukm=e1(e,"ukm",cB.defaultValues("ukm"))),this.keyEncryptionAlgorithm=e1(e,cS,cB.defaultValues(cS)),this.recipientEncryptedKeys=e1(e,cA,cB.defaultValues(cA)),this.recipientCertificate=e1(e,cN,cB.defaultValues(cN)),this.recipientPublicKey=e1(e,cx,cB.defaultValues(cx)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cb:return 0;case ck:return new u7;case"ukm":return new tK;case cS:return new aT;case cA:return new cw;case cN:return new oV;case cx:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cb:return 0===t;case ck:return -1===t.variant&&"value"in t==!1;case"ukm":return t.isEqual(cB.defaultValues("ukm"));case cS:return""===t.algorithmId&&"algorithmParams"in t==!1;case cA:return 0===t.encryptedKeys.length;case cN:case cx:return!1;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),new tP({idBlock:{tagClass:3,tagNumber:0},value:[u7.schema(t.originator||{})]}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new tK({name:t.ukm||""})]}),aT.schema(t.keyEncryptionAlgorithm||{}),cw.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){tl(e,cC);let t=sk(e,e,cB.schema({names:{version:cb,originator:{names:{blockName:ck}},ukm:"ukm",keyEncryptionAlgorithm:{names:{blockName:cS}},recipientEncryptedKeys:{names:{blockName:cA}}}}));ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new u7({schema:t.result.originator}),"ukm"in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new aT({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new cw({schema:t.result.recipientEncryptedKeys})}toSchema(){let e=[];return e.push(new tq({value:this.version})),e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new t0({value:e})}toJSON(){let e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}cB.CLASS_NAME="KeyAgreeRecipientInfo";let cV="keyIdentifier",cE="date",cI="other",c_=[cV,cE,cI];class cD extends af{constructor(e={}){super(),this.keyIdentifier=e1(e,cV,cD.defaultValues(cV)),cE in e&&(this.date=e1(e,cE,cD.defaultValues(cE))),cI in e&&(this.other=e1(e,cI,cD.defaultValues(cI))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cV:return new tK;case cE:return new sh;case cI:return new ca;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cV:return t.isEqual(cD.defaultValues(cV));case cE:return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case cI:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&"keyAttr"in t==!1;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tK({name:t.keyIdentifier||""}),new sh({optional:!0,name:t.date||""}),ca.schema(t.other||{})]})}fromSchema(e){tl(e,c_);let t=sk(e,e,cD.schema({names:{keyIdentifier:cV,date:cE,other:{names:{blockName:cI}}}}));ad.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,cE in t.result&&(this.date=t.result.date),cI in t.result&&(this.other=new ca({schema:t.result.other}))}toSchema(){let e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new t0({value:e})}toJSON(){let e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}cD.CLASS_NAME="KEKIdentifier";let cO="version",cP="kekid",cU="keyEncryptionAlgorithm",cR="encryptedKey",cj="preDefinedKEK",cT=[cO,cP,cU,cR];class cL extends af{constructor(e={}){super(),this.version=e1(e,cO,cL.defaultValues(cO)),this.kekid=e1(e,cP,cL.defaultValues(cP)),this.keyEncryptionAlgorithm=e1(e,cU,cL.defaultValues(cU)),this.encryptedKey=e1(e,cR,cL.defaultValues(cR)),this.preDefinedKEK=e1(e,cj,cL.defaultValues(cj)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cO:return 0;case cP:return new cD;case cU:return new aT;case cR:return new tK;case cj:return ac;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===cL.defaultValues(cO);case cP:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&"date"in t==!1&&"other"in t==!1;case cU:return""===t.algorithmId&&"algorithmParams"in t==!1;case cR:return t.isEqual(cL.defaultValues(cR));case cj:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),cD.schema(t.kekid||{}),aT.schema(t.keyEncryptionAlgorithm||{}),new tK({name:t.encryptedKey||""})]})}fromSchema(e){tl(e,cT);let t=sk(e,e,cL.schema({names:{version:cO,kekid:{names:{blockName:cP}},keyEncryptionAlgorithm:{names:{blockName:cU}},encryptedKey:cR}}));ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new cD({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new aT({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new t0({value:[new tq({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}cL.CLASS_NAME="KEKRecipientInfo";let cH="version",cK="keyDerivationAlgorithm",cM="keyEncryptionAlgorithm",cJ="encryptedKey",c$="password",cF=[cH,cK,cM,cJ];class cq extends af{constructor(e={}){super(),this.version=e1(e,cH,cq.defaultValues(cH)),cK in e&&(this.keyDerivationAlgorithm=e1(e,cK,cq.defaultValues(cK))),this.keyEncryptionAlgorithm=e1(e,cM,cq.defaultValues(cM)),this.encryptedKey=e1(e,cJ,cq.defaultValues(cJ)),this.password=e1(e,c$,cq.defaultValues(c$)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cH:return -1;case cK:case cM:return new aT;case cJ:return new tK;case c$:return ac;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cH:return -1===t;case cK:case cM:return""===t.algorithmId&&"algorithmParams"in t==!1;case cJ:return t.isEqual(cq.defaultValues(cJ));case c$:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),new tP({name:t.keyDerivationAlgorithm||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:aT.schema().valueBlock.value}),aT.schema(t.keyEncryptionAlgorithm||{}),new tK({name:t.encryptedKey||""})]})}fromSchema(e){tl(e,cF);let t=sk(e,e,cq.schema({names:{version:cH,keyDerivationAlgorithm:cK,keyEncryptionAlgorithm:{names:{blockName:cM}},encryptedKey:cJ}}));ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,cK in t.result&&(this.keyDerivationAlgorithm=new aT({schema:new t0({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new aT({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){let e=[];return e.push(new tq({value:this.version})),this.keyDerivationAlgorithm&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new t0({value:e})}toJSON(){let e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}cq.CLASS_NAME="PasswordRecipientInfo";let cW="oriType",cZ="oriValue",cG=[cW,cZ];class cz extends af{constructor(e={}){super(),this.oriType=e1(e,cW,cz.defaultValues(cW)),this.oriValue=e1(e,cZ,cz.defaultValues(cZ)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cW:return"";case cZ:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cW:return""===t;case cZ:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.oriType||""}),new sy({name:t.oriValue||""})]})}fromSchema(e){tl(e,cG);let t=sk(e,e,cz.schema({names:{oriType:cW,oriValue:cZ}}));ad.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new t0({value:[new tz({value:this.oriType}),this.oriValue]})}toJSON(){let e={oriType:this.oriType};return cz.compareWithDefault(cZ,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}cz.CLASS_NAME="OtherRecipientInfo";let cQ="variant",cY="value",cX=["blockName"];class c0 extends af{constructor(e={}){super(),this.variant=e1(e,cQ,c0.defaultValues(cQ)),cY in e&&(this.value=e1(e,cY,c0.defaultValues(cY))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cQ:return -1;case cY:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cQ:return t===c0.defaultValues(e);case cY:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new sv({value:[u1.schema({names:{blockName:t.blockName||""}}),new tP({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:1},value:cB.schema().valueBlock.value}),new tP({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:2},value:cL.schema().valueBlock.value}),new tP({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:3},value:cq.schema().valueBlock.value}),new tP({name:t.blockName||"",idBlock:{tagClass:3,tagNumber:4},value:cz.schema().valueBlock.value})]})}fromSchema(e){tl(e,cX);let t=sk(e,e,c0.schema({names:{blockName:"blockName"}}));if(ad.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass)this.variant=1,this.value=new u1({schema:t.result.blockName});else{let e=new t0({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new cB({schema:e});break;case 2:this.variant=3,this.value=new cL({schema:e});break;case 3:this.variant=4,this.value=new cq({schema:e});break;case 4:this.variant=5,this.value=new cz({schema:e});break;default:throw Error("Incorrect structure of RecipientInfo block")}}}toSchema(){am.assertEmpty(this.value,"value","RecipientInfo");let e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new sy}}toJSON(){let e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}c0.CLASS_NAME="RecipientInfo";let c1="hashAlgorithm",c2="maskGenAlgorithm",c3="pSourceAlgorithm",c4=[c1,c2,c3];class c8 extends af{constructor(e={}){super(),this.hashAlgorithm=e1(e,c1,c8.defaultValues(c1)),this.maskGenAlgorithm=e1(e,c2,c8.defaultValues(c2)),this.pSourceAlgorithm=e1(e,c3,c8.defaultValues(c3)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case c1:return new aT({algorithmId:"1.3.14.3.2.26",algorithmParams:new tj});case c2:return new aT({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new aT({algorithmId:"1.3.14.3.2.26",algorithmParams:new tj}).toSchema()});case c3:return new aT({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new tK({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tP({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[aT.schema(t.hashAlgorithm||{})]}),new tP({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[aT.schema(t.maskGenAlgorithm||{})]}),new tP({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[aT.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){tl(e,c4);let t=sk(e,e,c8.schema({names:{hashAlgorithm:{names:{blockName:c1}},maskGenAlgorithm:{names:{blockName:c2}},pSourceAlgorithm:{names:{blockName:c3}}}}));ad.assertSchema(t,this.className),c1 in t.result&&(this.hashAlgorithm=new aT({schema:t.result.hashAlgorithm})),c2 in t.result&&(this.maskGenAlgorithm=new aT({schema:t.result.maskGenAlgorithm})),c3 in t.result&&(this.pSourceAlgorithm=new aT({schema:t.result.pSourceAlgorithm}))}toSchema(){let e=[];return this.hashAlgorithm.isEqual(c8.defaultValues(c1))||e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(c8.defaultValues(c2))||e.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(c8.defaultValues(c3))||e.push(new tP({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new t0({value:e})}toJSON(){let e={};return this.hashAlgorithm.isEqual(c8.defaultValues(c1))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(c8.defaultValues(c2))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(c8.defaultValues(c3))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}c8.CLASS_NAME="RSAESOAEPParams";let c5="keyInfo",c6="entityUInfo",c9="suppPubInfo",c7=[c5,c6,c9];class he extends af{constructor(e={}){super(),this.keyInfo=e1(e,c5,he.defaultValues(c5)),c6 in e&&(this.entityUInfo=e1(e,c6,he.defaultValues(c6))),this.suppPubInfo=e1(e,c9,he.defaultValues(c9)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case c5:return new aT;case c6:case c9:return new tK;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case c5:case c6:case c9:return t.isEqual(he.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aT.schema(t.keyInfo||{}),new tP({name:t.entityUInfo||"",idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new tK]}),new tP({name:t.suppPubInfo||"",idBlock:{tagClass:3,tagNumber:2},value:[new tK]})]})}fromSchema(e){tl(e,c7);let t=sk(e,e,he.schema({names:{keyInfo:{names:{blockName:c5}},entityUInfo:c6,suppPubInfo:c9}}));ad.assertSchema(t,this.className),this.keyInfo=new aT({schema:t.result.keyInfo}),c6 in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){let e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new tP({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new t0({value:e})}toJSON(){let e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}he.CLASS_NAME="ECCCMSSharedInfo";let ht="version",hs="originatorInfo",ha="recipientInfos",hr="encryptedContentInfo",hi="unprotectedAttrs",hn=[ht,hs,ha,hr,hi],hl={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},ho={"P-256":256,"P-384":384,"P-521":528};class hu extends af{constructor(e={}){super(),this.version=e1(e,ht,hu.defaultValues(ht)),hs in e&&(this.originatorInfo=e1(e,hs,hu.defaultValues(hs))),this.recipientInfos=e1(e,ha,hu.defaultValues(ha)),this.encryptedContentInfo=e1(e,hr,hu.defaultValues(hr)),hi in e&&(this.unprotectedAttrs=e1(e,hi,hu.defaultValues(hi))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ht:return 0;case hs:return new uK;case ha:return[];case hr:return new nc;case hi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ht:return t===hu.defaultValues(e);case hs:return 0===t.certs.certificates.length&&0===t.crls.crls.length;case ha:case hi:return 0===t.length;case hr:return nc.compareWithDefault("contentType",t.contentType)&&nc.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&nc.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||""}),new tP({name:t.originatorInfo||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:uK.schema().valueBlock.value}),new t1({value:[new sw({name:t.recipientInfos||"",value:c0.schema()})]}),nc.schema(t.encryptedContentInfo||{}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new sw({name:t.unprotectedAttrs||"",value:aF.schema()})]})]})}fromSchema(e){tl(e,hn);let t=sk(e,e,hu.schema({names:{version:ht,originatorInfo:hs,recipientInfos:ha,encryptedContentInfo:{names:{blockName:hr}},unprotectedAttrs:hi}}));ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,hs in t.result&&(this.originatorInfo=new uK({schema:new t0({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,e=>new c0({schema:e})),this.encryptedContentInfo=new nc({schema:t.result.encryptedContentInfo}),hi in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,e=>new aF({schema:e})))}toSchema(){let e=[];return e.push(new tq({value:this.version})),this.originatorInfo&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new t1({value:Array.from(this.recipientInfos,e=>e.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,e=>e.toSchema())})),new t0({value:e})}toJSON(){let e={version:this.version,recipientInfos:Array.from(this.recipientInfos,e=>e.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,e=>e.toJSON())),e}addRecipientByCertificate(e,t,s,a=nD(!0)){let r=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},hl,t||{});if(-1!==e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549"))s=1;else if(-1!==e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045"))s=2;else throw Error(`Unknown type of certificate's public key: ${e.subjectPublicKeyInfo.algorithm.algorithmId}`);switch(s){case 1:{let t,s;if(!0===r.useOAEP){t=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");let e=new aT({algorithmId:a.getOIDByAlgorithm({name:r.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),algorithmParams:new tj});s=new c8({hashAlgorithm:e,maskGenAlgorithm:new aT({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:e.toSchema()})}).toSchema()}else{if(""===(t=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"})))throw Error("Can not find OID for RSAES-PKCS1-v1_5");s=new tj}let i=new u1({version:0,rid:new uF({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new aT({algorithmId:t,algorithmParams:s}),recipientCertificate:e});this.recipientInfos.push(new c0({variant:1,value:i}))}break;case 2:{let t=new cm({variant:1,value:new uF({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(t,r,{recipientCertificate:e},a)}break;default:throw Error(`Unknown "variant" value: ${s}`)}return!0}addRecipientByPreDefinedData(e,t={},s,a=nD(!0)){if(ah.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw Error("Pre-defined data could have zero length");if(!t.keyIdentifier){let e=new ArrayBuffer(16),s=new Uint8Array(e);a.getRandomValues(s),t.keyIdentifier=e}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),void 0===t.iterationCount&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new tj),s){case 1:{let s=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),r=new cL({version:4,kekid:new cD({keyIdentifier:new tK({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new aT({algorithmId:s,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new c0({variant:3,value:r}))}break;case 2:{let s=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),r=new ArrayBuffer(64),i=new Uint8Array(r);a.getRandomValues(i);let n=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),l=new nk({salt:new tK({valueHex:r}),iterationCount:t.iterationCount,prf:new aT({algorithmId:n,algorithmParams:new tj})}),o=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),u=new cq({version:0,keyDerivationAlgorithm:new aT({algorithmId:s,algorithmParams:l.toSchema()}),keyEncryptionAlgorithm:new aT({algorithmId:o,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new c0({variant:4,value:u}))}break;default:throw Error(`Unknown value for "variant": ${s}`)}}addRecipientByKeyIdentifier(e,t,s,a=nD(!0)){let r=Object.assign({},hl,s||{}),i=new cm({variant:2,value:new co({subjectKeyIdentifier:new tK({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,r,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,s,a=nD(!0)){let r=new cg({rid:e}),i=new aT({algorithmId:a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm")}),n=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),l=new ArrayBuffer(64),o=new Uint8Array(l);a.getRandomValues(o);let u=new cB(Object.assign({version:3,ukm:new tK({valueHex:l}),keyEncryptionAlgorithm:new aT({algorithmId:n,algorithmParams:i.toSchema()}),recipientEncryptedKeys:new cw({encryptedKeys:[r]})},s));this.recipientInfos.push(new c0({variant:2,value:u}))}async encrypt(e,t,s=nD(!0)){let a=new ArrayBuffer(16),r=new Uint8Array(a);s.getRandomValues(r);let i=new Uint8Array(t),n=s.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),l=await s.generateKey(e,!0,["encrypt"]),o=await s.encrypt({name:e.name,iv:r},l,i),u=await s.exportKey("raw",l);this.version=2,this.encryptedContentInfo=new nc({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new aT({algorithmId:n,algorithmParams:new tK({valueHex:a})}),encryptedContent:new tK({valueHex:o})});let c=async e=>{let t,a;let r=this.recipientInfos[e].value;if(r.recipientPublicKey)t=r.recipientPublicKey.algorithm.namedCurve,a=r.recipientPublicKey;else if(r.recipientCertificate){let i=r.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(i.constructor.blockName()!==tz.blockName())throw Error(`Incorrect "recipientCertificate" for index ${e}`);switch(i.valueBlock.toString()){case"1.2.840.10045.3.1.7":t="P-256";break;case"1.3.132.0.34":t="P-384";break;case"1.3.132.0.35":t="P-521";break;default:throw Error(`Incorrect curve OID for index ${e}`)}a=await r.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:t},usages:[]}},s)}else throw Error("Unsupported RecipientInfo");let i=ho[t],n=await s.generateKey({name:"ECDH",namedCurve:t},!0,["deriveBits"]),o=await s.exportKey("spki",n.publicKey),u=await s.deriveBits({name:"ECDH",public:a},n.privateKey,i),c=new aT({schema:r.keyEncryptionAlgorithm.algorithmParams}),h=s.getAlgorithmByOID(c.algorithmId,!0,"aesKWAlgorithm"),m=h.length,d=new ArrayBuffer(4),f=new Uint8Array(d);for(let e=3;e>=0;e--)f[e]=m,m>>=8;let g=new he({keyInfo:new aT({algorithmId:c.algorithmId}),entityUInfo:r.ukm,suppPubInfo:new tK({valueHex:d})}).toSchema().toBER(!1),p=s.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),y=await nP(p.kdf,u,h.length,g,s),v=await s.importKey("raw",y,{name:"AES-KW"},!0,["wrapKey"]),w=await s.wrapKey("raw",l,v,{name:"AES-KW"}),b=new u7;return b.variant=3,b.value=u8.fromBER(o),r.originator=b,r.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new tK({valueHex:w}),{ecdhPrivateKey:n.privateKey}},h=async e=>{let t=this.recipientInfos[e].value,a=s.getAlgorithmByOID(t.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if("RSA-OAEP"===a.name){let e=new c8({schema:t.keyEncryptionAlgorithm.algorithmParams});if(a.hash=s.getAlgorithmByOID(e.hashAlgorithm.algorithmId),"name"in a.hash==!1)throw Error(`Incorrect OID for hash algorithm: ${e.hashAlgorithm.algorithmId}`)}try{let e=await t.recipientCertificate.getPublicKey({algorithm:{algorithm:a,usages:["encrypt","wrapKey"]}},s),r=await s.encrypt(e.algorithm,e,u);t.encryptedKey=new tK({valueHex:r})}catch{}},m=async e=>{let t=this.recipientInfos[e].value,a=s.getAlgorithmByOID(t.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),r=await s.importKey("raw",new Uint8Array(t.preDefinedKEK),a,!0,["wrapKey"]);t.encryptedKey=new tK({valueHex:await s.wrapKey("raw",l,r,a)})},d=async e=>{let t;let a=this.recipientInfos[e].value;if(!a.keyDerivationAlgorithm)throw Error('Please append encoded "keyDerivationAlgorithm"');if(!a.keyDerivationAlgorithm.algorithmParams)throw Error('Incorrectly encoded "keyDerivationAlgorithm"');try{t=new nk({schema:a.keyDerivationAlgorithm.algorithmParams})}catch(e){throw Error('Incorrectly encoded "keyDerivationAlgorithm"')}let r=new Uint8Array(a.password),i=await s.importKey("raw",r,"PBKDF2",!1,["deriveKey"]),n=s.getAlgorithmByOID(a.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),o="SHA-1";t.prf&&(o=s.getAlgorithmByOID(t.prf.algorithmId,!0,"prfAlgorithm").hash.name);let u=new Uint8Array(t.salt.valueBlock.valueHex),c=t.iterationCount,h=await s.deriveKey({name:"PBKDF2",hash:{name:o},salt:u,iterations:c},i,n,!0,["wrapKey"]);a.encryptedKey=new tK({valueHex:await s.wrapKey("raw",l,h,n)})},f=[];for(let e=0;e<this.recipientInfos.length;e++)switch(this.recipientInfos[e].variant){case 1:f.push(await h(e));break;case 2:f.push(await c(e));break;case 3:f.push(await m(e));break;case 4:f.push(await d(e));break;default:throw Error(`Unknown recipient type in array with index ${e}`)}return f}async decrypt(e,t,s=nD(!0)){let a;let r=t||{};if(e+1>this.recipientInfos.length)throw Error(`Maximum value for "index" is: ${this.recipientInfos.length-1}`);let i=async e=>{let t,a,i,n;let l=this.recipientInfos[e].value,o=l.originator;if(r.recipientCertificate){let s=r.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(s.constructor.blockName()!==tz.blockName())throw Error(`Incorrect "recipientCertificate" for index ${e}`);t=s.valueBlock.toString()}else if(o.value.algorithm.algorithmParams){let s=o.value.algorithm.algorithmParams;if(s.constructor.blockName()!==tz.blockName())throw Error(`Incorrect originator for index ${e}`);t=s.valueBlock.toString()}else throw Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!r.recipientPrivateKey)throw Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(t){case"1.2.840.10045.3.1.7":a="P-256",i=256;break;case"1.3.132.0.34":a="P-384",i=384;break;case"1.3.132.0.35":a="P-521",i=528;break;default:throw Error(`Incorrect curve OID for index ${e}`)}let u=s;eW.isBufferSource(r.recipientPrivateKey)?n=await s.importKey("pkcs8",r.recipientPrivateKey,{name:"ECDH",namedCurve:a},!0,["deriveBits"]):(n=r.recipientPrivateKey,"crypto"in r&&r.crypto&&(u=r.crypto.subtle)),"algorithmParams"in o.value.algorithm==!1&&(o.value.algorithm.algorithmParams=new tz({value:t}));let c=o.value.toSchema().toBER(!1),h=await s.importKey("spki",c,{name:"ECDH",namedCurve:a},!0,[]),m=await u.deriveBits({name:"ECDH",public:h},n,i);async function d(e){e=e||!1;let t=new aT({schema:l.keyEncryptionAlgorithm.algorithmParams}),a=s.getAlgorithmByOID(t.algorithmId,!0,"kwAlgorithm"),r=a.length,i=new ArrayBuffer(4),n=new Uint8Array(i);for(let e=3;e>=0;e--)n[e]=r,r>>=8;let o={algorithmId:t.algorithmId};e&&(o.algorithmParams=new tj);let u=new he({keyInfo:new aT(o),entityUInfo:l.ukm,suppPubInfo:new tK({valueHex:i})}).toSchema().toBER(!1),c=s.getAlgorithmByOID(l.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!c.name)throw Error(`Incorrect OID for key encryption algorithm: ${l.keyEncryptionAlgorithm.algorithmId}`);return nP(c.kdf,m,a.length,u,s)}let f=await d(),g=async e=>s.importKey("raw",e,{name:"AES-KW"},!0,["unwrapKey"]),p=await g(f),y=async e=>{let t=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,a=s.getAlgorithmByOID(t,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",l.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,e,{name:"AES-KW"},a,!0,["decrypt"])};try{return await y(p)}catch{let e=await d(!0);return y(await g(e))}},n=async e=>{let t;let a=this.recipientInfos[e].value;if(!r.recipientPrivateKey)throw Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');let i=s.getAlgorithmByOID(a.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if("RSA-OAEP"===i.name){let e=new c8({schema:a.keyEncryptionAlgorithm.algorithmParams});if(i.hash=s.getAlgorithmByOID(e.hashAlgorithm.algorithmId),"name"in i.hash==!1)throw Error(`Incorrect OID for hash algorithm: ${e.hashAlgorithm.algorithmId}`)}let n=s;eW.isBufferSource(r.recipientPrivateKey)?t=await s.importKey("pkcs8",r.recipientPrivateKey,i,!0,["decrypt"]):(t=r.recipientPrivateKey,"crypto"in r&&r.crypto&&(n=r.crypto.subtle));let l=await n.decrypt(t.algorithm,t,a.encryptedKey.valueBlock.valueHexView),o=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,u=s.getAlgorithmByOID(o,!0,"contentEncryptionAlgorithm");if("name"in u==!1)throw Error(`Incorrect "contentEncryptionAlgorithm": ${o}`);return s.importKey("raw",l,u,!0,["decrypt"])},l=async e=>{let t=this.recipientInfos[e].value;if(!r.preDefinedData)throw Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');let a=s.getAlgorithmByOID(t.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),i=await s.importKey("raw",r.preDefinedData,a,!0,["unwrapKey"]),n=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,l=s.getAlgorithmByOID(n,!0,"contentEncryptionAlgorithm");if(!l.name)throw Error(`Incorrect "contentEncryptionAlgorithm": ${n}`);return s.unwrapKey("raw",t.encryptedKey.valueBlock.valueHexView,i,a,l,!0,["decrypt"])},o=async e=>{let t;let a=this.recipientInfos[e].value;if(!r.preDefinedData)throw Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!a.keyDerivationAlgorithm)throw Error('Please append encoded "keyDerivationAlgorithm"');if(!a.keyDerivationAlgorithm.algorithmParams)throw Error('Incorrectly encoded "keyDerivationAlgorithm"');try{t=new nk({schema:a.keyDerivationAlgorithm.algorithmParams})}catch(e){throw Error('Incorrectly encoded "keyDerivationAlgorithm"')}let i=await s.importKey("raw",r.preDefinedData,"PBKDF2",!1,["deriveKey"]),n=s.getAlgorithmByOID(a.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),l=t.prf?s.getAlgorithmByOID(t.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",o=new Uint8Array(t.salt.valueBlock.valueHex),u=t.iterationCount,c=await s.deriveKey({name:"PBKDF2",hash:{name:l},salt:o,iterations:u},i,n,!0,["unwrapKey"]),h=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,m=s.getAlgorithmByOID(h,!0,"contentEncryptionAlgorithm");return s.unwrapKey("raw",a.encryptedKey.valueBlock.valueHexView,c,n,m,!0,["decrypt"])};switch(this.recipientInfos[e].variant){case 1:a=await n(e);break;case 2:a=await i(e);break;case 3:a=await l(e);break;case 4:a=await o(e);break;default:throw Error(`Unknown recipient type in array with index ${e}`)}let u=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,c=s.getAlgorithmByOID(u,!0,"contentEncryptionAlgorithm"),h=new Uint8Array(this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex);if(!this.encryptedContentInfo.encryptedContent)throw Error("Required property `encryptedContent` is empty");let m=this.encryptedContentInfo.getEncryptedContent();return s.decrypt({name:c.name,iv:h},a,m)}}hu.CLASS_NAME="EnvelopedData";let hc="safeContents",hh="parsedValue",hm="contentInfos";class hd extends af{constructor(e={}){super(),this.safeContents=e1(e,hc,hd.defaultValues(hc)),hh in e&&(this.parsedValue=e1(e,hh,hd.defaultValues(hh))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hc:return[];case hh:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hc:return 0===t.length;case hh:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new sw({name:t.contentInfos||"",value:l8.schema()})]})}fromSchema(e){tl(e,[hm]);let t=sk(e,e,hd.schema({names:{contentInfos:hm}}));ad.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,e=>new l8({schema:e}))}toSchema(){return new t0({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=nD(!0)){if(am.assert(e,hc),ah.assert(e.safeContents,hc,"Array"),e.safeContents.length!==this.safeContents.length)throw new ah('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');for(let[s,a]of(this.parsedValue={safeContents:[]},this.safeContents.entries())){let r=e.safeContents[s],i=`parameters.safeContents[${s}]`;switch(a.contentType){case ra:{ah.assert(a.content,"this.safeContents[j].content",tK);let e=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:uS.fromBER(e)})}break;case ri:{let e=new hu({schema:a.content});am.assert(i,r,"recipientCertificate","recipientKey");let s=r.recipientCertificate,n=r.recipientKey,l=await e.decrypt(0,{recipientCertificate:s,recipientPrivateKey:n},t);this.parsedValue.safeContents.push({privacyMode:2,value:uS.fromBER(l)})}break;case rn:{let e=new ui({schema:a.content});am.assert(i,r,"password");let s=r.password,n=await e.decrypt({password:s},t);this.parsedValue.safeContents.push({privacyMode:1,value:uS.fromBER(n)})}break;default:throw Error(`Unknown "contentType" for AuthenticatedSafe: " ${a.contentType}`)}}}async makeInternalValues(e,t=nD(!0)){if(!this.parsedValue)throw Error('Please run "parseValues" first or add "parsedValue" manually');if(ah.assert(this.parsedValue,"this.parsedValue","object"),ah.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),ah.assert(e,"parameters","object"),am.assert(e,"safeContents"),ah.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new ah('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');for(let[s,a]of(this.safeContents=[],this.parsedValue.safeContents.entries()))switch(am.assert("content",a,"privacyMode","value"),ah.assert(a.value,"content.value",uS),a.privacyMode){case 0:{let e=a.value.toSchema().toBER(!1);this.safeContents.push(new l8({contentType:"1.2.840.113549.1.7.1",content:new tK({valueHex:e})}))}break;case 1:{let r=new ui,i=e.safeContents[s];i.contentToEncrypt=a.value.toSchema().toBER(!1),await r.encrypt(i,t),this.safeContents.push(new l8({contentType:"1.2.840.113549.1.7.6",content:r.toSchema()}))}break;case 2:{let r=new hu,i=a.value.toSchema().toBER(!1),n=e.safeContents[s];switch(am.assert(`parameters.safeContents[${s}]`,n,"encryptingCertificate","encryptionAlgorithm"),!0){case"aes-cbc"===n.encryptionAlgorithm.name.toLowerCase():case"aes-gcm"===n.encryptionAlgorithm.name.toLowerCase():break;default:throw Error(`Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": ${n.encryptionAlgorithm}`)}switch(!0){case 128===n.encryptionAlgorithm.length:case 192===n.encryptionAlgorithm.length:case 256===n.encryptionAlgorithm.length:break;default:throw Error(`Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": ${n.encryptionAlgorithm.length}`)}let l=n.encryptionAlgorithm;r.addRecipientByCertificate(n.encryptingCertificate,{},void 0,t),await r.encrypt(l,i,t),this.safeContents.push(new l8({contentType:"1.2.840.113549.1.7.3",content:r.toSchema()}))}break;default:throw Error(`Incorrect value for "content.privacyMode": ${a.privacyMode}`)}return this}}hd.CLASS_NAME="AuthenticatedSafe";let hf="hashAlgorithm",hg="issuerNameHash",hp="issuerKeyHash",hy="serialNumber",hv=[hf,hg,hp,hy];class hw extends af{static async create(e,t,s=nD(!0)){let a=new hw;return await a.createForCertificate(e,t,s),a}constructor(e={}){super(),this.hashAlgorithm=e1(e,hf,hw.defaultValues(hf)),this.issuerNameHash=e1(e,hg,hw.defaultValues(hg)),this.issuerKeyHash=e1(e,hp,hw.defaultValues(hp)),this.serialNumber=e1(e,hy,hw.defaultValues(hy)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hf:return new aT;case hg:case hp:return new tK;case hy:return new tq;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hf:return""===t.algorithmId&&"algorithmParams"in t==!1;case hg:case hp:case hy:return t.isEqual(hw.defaultValues(hy));default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aT.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||""}}),new tK({name:t.issuerNameHash||""}),new tK({name:t.issuerKeyHash||""}),new tq({name:t.serialNumber||""})]})}fromSchema(e){tl(e,hv);let t=sk(e,e,hw.schema({names:{hashAlgorithm:hf,issuerNameHash:hg,issuerKeyHash:hp,serialNumber:hy}}));ad.assertSchema(t,this.className),this.hashAlgorithm=new aT({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new t0({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!!(this.hashAlgorithm.algorithmId===e.hashAlgorithm.algorithmId&&eW.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)&&eW.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)&&this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,s=nD(!0)){am.assert(t,hf,"issuerCertificate");let a=s.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new aT({algorithmId:a,algorithmParams:new tj});let r=t.issuerCertificate;this.serialNumber=e.serialNumber;let i=await s.digest({name:t.hashAlgorithm},r.subject.toSchema().toBER(!1));this.issuerNameHash=new tK({valueHex:i});let n=r.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,l=await s.digest({name:t.hashAlgorithm},n);this.issuerKeyHash=new tK({valueHex:l})}}hw.CLASS_NAME="CertID";let hb="certID",hk="certStatus",hS="thisUpdate",hA="nextUpdate",hN="singleExtensions",hx=[hb,hk,hS,hA,hN];class hC extends af{constructor(e={}){super(),this.certID=e1(e,hb,hC.defaultValues(hb)),this.certStatus=e1(e,hk,hC.defaultValues(hk)),this.thisUpdate=e1(e,hS,hC.defaultValues(hS)),hA in e&&(this.nextUpdate=e1(e,hA,hC.defaultValues(hA))),hN in e&&(this.singleExtensions=e1(e,hN,hC.defaultValues(hN))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hb:return new hw;case hk:return{};case hS:case hA:return new Date(0,0,0);case hN:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hb:return hw.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&hw.compareWithDefault("issuerNameHash",t.issuerNameHash)&&hw.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&hw.compareWithDefault("serialNumber",t.serialNumber);case hk:return 0===Object.keys(t).length;case hS:case hA:return t===hC.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[hw.schema(t.certID||{}),new sv({value:[new tI({name:t.certStatus||"",idBlock:{tagClass:3,tagNumber:0}}),new tP({name:t.certStatus||"",idBlock:{tagClass:3,tagNumber:1},value:[new sh,new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new tW]})]}),new tI({name:t.certStatus||"",idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new sh({name:t.thisUpdate||""}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sh({name:t.nextUpdate||""})]}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[lt.schema(t.singleExtensions||{})]})]})}fromSchema(e){tl(e,hx);let t=sk(e,e,hC.schema({names:{certID:{names:{blockName:hb}},certStatus:hk,thisUpdate:hS,nextUpdate:hA,singleExtensions:{names:{blockName:hN}}}}));ad.assertSchema(t,this.className),this.certID=new hw({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),hA in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),hN in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,e=>new n9({schema:e})))}toSchema(){let e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new sh({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[new sh({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new t0({value:Array.from(this.singleExtensions,e=>e.toSchema())})),new t0({value:e})}toJSON(){let e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,e=>e.toJSON())),e}}hC.CLASS_NAME="SingleResponse";let hB="version",hV="responderID",hE="producedAt",hI="responses",h_="responseExtensions",hD="ResponseData",hO=`${hD}.${hB}`,hP=`${hD}.${hV}`,hU=`${hD}.${hE}`,hR=`${hD}.${hI}`,hj=`${hD}.${h_}`,hT=[hD,hO,hP,hU,hR,hj];class hL extends af{get tbs(){return eW.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(e1(e,"tbs",hL.defaultValues("tbs"))),hB in e&&(this.version=e1(e,hB,hL.defaultValues(hB))),this.responderID=e1(e,hV,hL.defaultValues(hV)),this.producedAt=e1(e,hE,hL.defaultValues(hE)),this.responses=e1(e,hI,hL.defaultValues(hI)),h_ in e&&(this.responseExtensions=e1(e,h_,hL.defaultValues(h_))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hB:return 0;case"tbs":return ac;case hV:return{};case hE:return new Date(0,0,0);case hI:case h_:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"tbs":return 0===t.byteLength;case hV:return 0===Object.keys(t).length;case hE:return t===hL.defaultValues(e);case hI:case h_:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||hD,value:[new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new tq({name:t.version||hO})]}),new sv({value:[new tP({name:t.responderID||hP,idBlock:{tagClass:3,tagNumber:1},value:[ak.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new tP({name:t.responderID||hP,idBlock:{tagClass:3,tagNumber:2},value:[new tK({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new sh({name:t.producedAt||hU}),new t0({value:[new sw({name:hR,value:hC.schema(t.response||{})})]}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[lt.schema(t.extensions||{names:{blockName:hj}})]})]})}fromSchema(e){tl(e,hT);let t=sk(e,e,hL.schema());ad.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,hO in t.result&&(this.version=t.result[hO].valueBlock.valueDec),1===t.result[hP].idBlock.tagNumber?this.responderID=new ak({schema:t.result[hP].valueBlock.value[0]}):this.responderID=t.result[hP].valueBlock.value[0],this.producedAt=t.result[hU].toDate(),this.responses=Array.from(t.result[hR],e=>new hC({schema:e})),hj in t.result&&(this.responseExtensions=Array.from(t.result[hj].valueBlock.value,e=>new n9({schema:e})))}toSchema(e=!1){let t;if(!1===e){if(!this.tbsView.byteLength)return hL.schema();let e=tD(this.tbsView);ad.assert(e,"TBS Response Data"),t=e.result}else{let e=[];hB in this&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[new tq({value:this.version})]})),this.responderID instanceof ak?e.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):e.push(new tP({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),e.push(new sh({valueDate:this.producedAt})),e.push(new t0({value:Array.from(this.responses,e=>e.toSchema())})),this.responseExtensions&&e.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:[new t0({value:Array.from(this.responseExtensions,e=>e.toSchema())})]})),t=new t0({value:e})}return t}toJSON(){let e={};return hB in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,e=>e.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,e=>e.toJSON())),e}}hL.CLASS_NAME="ResponseData";let hH="trustedCerts",hK="certs",hM="crls",hJ="ocsps",h$="checkDate",hF="findOrigin",hq="findIssuer";!function(e){e[e.unknown=-1]="unknown",e[e.success=0]="success",e[e.noRevocation=11]="noRevocation",e[e.noPath=60]="noPath",e[e.noValidPath=97]="noValidPath"}(h||(h={}));class hW extends Error{constructor(e,t){super(t),this.name=hW.NAME,this.code=e,this.message=t}}hW.NAME="ChainValidationError";class hZ{constructor(e={}){this.trustedCerts=e1(e,hH,this.defaultValues(hH)),this.certs=e1(e,hK,this.defaultValues(hK)),this.crls=e1(e,hM,this.defaultValues(hM)),this.ocsps=e1(e,hJ,this.defaultValues(hJ)),this.checkDate=e1(e,h$,this.defaultValues(h$)),this.findOrigin=e1(e,hF,this.defaultValues(hF)),this.findIssuer=e1(e,hq,this.defaultValues(hq))}static defaultFindOrigin(e,t){for(let s of(0===e.tbsView.byteLength&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER())),t.certs))if(0===s.tbsView.byteLength&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),eW.isEqual(e.tbsView,s.tbsView))return"Intermediate Certificates";for(let s of t.trustedCerts)if(0===s.tbsView.byteLength&&(s.tbsView=new Uint8Array(s.encodeTBS().toBER())),eW.isEqual(e.tbsView,s.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,s=nD(!0)){let a=[],r=null,i=null,n=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,s))return[e]}catch(e){}if(e.extensions){for(let t of e.extensions)if(t.extnID===re&&t.parsedValue instanceof rg){t.parsedValue.keyIdentifier?r=t.parsedValue.keyIdentifier:(t.parsedValue.authorityCertIssuer&&(i=t.parsedValue.authorityCertIssuer),t.parsedValue.authorityCertSerialNumber&&(n=t.parsedValue.authorityCertSerialNumber));break}}function l(t){if(null!==r&&t.extensions){let e=!1;for(let s of t.extensions)if("2.5.29.14"===s.extnID&&s.parsedValue){e=!0,eW.isEqual(s.parsedValue.valueBlock.valueHex,r.valueBlock.valueHexView)&&a.push(t);break}if(e)return}let s=!1;null!==n&&(s=t.serialNumber.isEqual(n)),null!==i?t.subject.isEqual(i)&&s&&a.push(t):e.issuer.isEqual(t.subject)&&a.push(t)}for(let e of t.trustedCerts)l(e);for(let e of t.certs)l(e);for(let t=a.length-1;t>=0;t--)try{let r=await e.verify(a[t],s);!1===r&&a.splice(t,1)}catch(e){a.splice(t,1)}return a}defaultValues(e){switch(e){case hH:case hK:case hM:case hJ:return[];case h$:return new Date;case hF:return hZ.defaultFindOrigin;case hq:return this.defaultFindIssuer;default:throw Error(`Invalid member name for CertificateChainValidationEngine class: ${e}`)}}async sort(e=!1,t=nD(!0)){let s;let a=[],r=async(e,t)=>{let s=[];if(function(e,t){for(let s=0;s<t.length;s++)if(eW.isEqual(e.tbsView,t[s].tbsView))return!0;return!1}(e,this.trustedCerts))return[[e]];let a=await this.findIssuer(e,this,t);if(0===a.length)throw Error("No valid certificate paths found");for(let i=0;i<a.length;i++){if(eW.isEqual(a[i].tbsView,e.tbsView)){s.push([a[i]]);continue}let n=await r(a[i],t);for(let e=0;e<n.length;e++){let t=n[e].slice();t.splice(0,0,a[i]),function(e){let t=!0;for(let s=0;s<e.length;s++){for(let a=0;a<e.length;a++)if(a!==s&&e[s]===e[a]){t=!1;break}if(!t)break}return t}(t)?s.push(t):s.push(n[e])}}return s},i=async e=>{let s=[],r=[],i=[];if(s.push(...a.filter(t=>e.issuer.isEqual(t.subject))),0===s.length)return{status:1,statusMessage:"No certificate's issuers"};if(r.push(...this.crls.filter(t=>t.issuer.isEqual(e.issuer))),0===r.length)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let e=0;e<r.length;e++){let a=r[e];if(!a.nextUpdate||!(a.nextUpdate.value<this.checkDate))for(let a=0;a<s.length;a++)try{if(await r[e].verify({issuerCertificate:s[a]},t)){i.push({crl:r[e],certificate:s[a]});break}}catch(e){}}return i.length?{status:0,statusMessage:"",result:i}:{status:3,statusMessage:"No valid CRLs found"}},n=async(e,s)=>{let a=t.getAlgorithmByOID(e.signatureAlgorithm.algorithmId);if(!a.name||!a.hash)return 1;for(let a=0;a<this.ocsps.length;a++){let r=this.ocsps[a],i=await r.getCertificateStatus(e,s,t);if(i.isForCertificate){if(0===i.status)return 0;return 1}}return 2};async function l(e,t=!1){let s=!1,a=!1,r=!1,i=!1;if(e.extensions){for(let t=0;t<e.extensions.length;t++){let n=e.extensions[t];if(n.critical&&!n.parsedValue)return{result:!1,resultCode:6,resultMessage:`Unable to parse critical certificate extension: ${n.extnID}`};if("2.5.29.15"===n.extnID){r=!0;let e=new Uint8Array(n.parsedValue.valueBlock.valueHex);(4&e[0])==4&&(a=!0),(2&e[0])==2&&(i=!0)}n.extnID===a1&&"cA"in n.parsedValue&&!0===n.parsedValue.cA&&(s=!0)}if(!0===a&&!1===s)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(!0===r&&!0===s&&!1===a)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(!0===s&&!0===r&&t&&!1===i)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return!1===s?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:""}}let o=async(t,s)=>{for(let e=0;e<t.length;e++)if(t[e].notBefore.value>s||t[e].notAfter.value<s)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(t.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let e=t.length-2;e>=0;e--)if(!1===t[e].issuer.isEqual(t[e].subject)&&!1===t[e].issuer.isEqual(t[e+1].subject))return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(0!==this.crls.length||0!==this.ocsps.length)for(let s=0;s<t.length-1;s++){let a=2,r={status:0,statusMessage:""};if(0!==this.ocsps.length)switch(a=await n(t[s],t[s+1])){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(0!==this.crls.length){if(0===(r=await i(t[s])).status&&r.result)for(let e=0;e<r.result.length;e++){if(r.result[e].crl.isCertificateRevoked(t[s]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if(!1===(await l(r.result[e].certificate,!0)).result)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(!1===e)throw new hW(h.noRevocation,`No revocation values found for one of certificates: ${r.statusMessage}`)}else if(2===a)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(2===a&&2===r.status&&e){let e=t[s+1],a=!1;if(e.extensions)for(let t of e.extensions)switch(t.extnID){case a8:case a5:case rs:a=!0}if(a)throw new hW(h.noRevocation,`No revocation values found for one of certificates: ${r.statusMessage}`)}}for(let[e,s]of t.entries())if(e&&!(await l(s)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}};a.push(...this.trustedCerts),a.push(...this.certs);for(let e=0;e<a.length;e++)for(let t=0;t<a.length;t++)if(e!==t&&eW.isEqual(a[e].tbsView,a[t].tbsView)){a.splice(t,1),e=0;break}let u=a[a.length-1],c=[u];if(0===(s=await r(u,t)).length)throw new hW(h.noPath,"Unable to find certificate path");for(let e=s.length-1;e>=0;e--){let t=!1;for(let a=0;a<s[e].length;a++){let r=s[e][a];for(let e=0;e<this.trustedCerts.length;e++)if(eW.isEqual(r.tbsView,this.trustedCerts[e].tbsView)){t=!0;break}if(t)break}t||s.splice(e,1)}if(0===s.length)throw new hW(h.noValidPath,"No valid certificate paths found");let m=s[0].length,d=0;for(let e=0;e<s.length;e++)s[e].length<m&&(m=s[e].length,d=e);for(let e=0;e<s[d].length;e++)c.push(s[d][e]);if(!1===(s=await o(c,this.checkDate)).result)throw s;return c}async verify(e={},t=nD(!0)){function s(e,t){let s=ag(e),a=ag(t),r=s.split("."),i=a.split("."),n=r.length,l=i.length;if(0===n||0===l||n<l)return!1;for(let e=0;e<n;e++)if(0===r[e].length)return!1;for(let e=0;e<l;e++)if(0===i[e].length){if(0===e){if(1===l)return!1;continue}return!1}for(let e=0;e<l;e++)if(0!==i[l-1-e].length&&0!==r[n-1-e].localeCompare(i[l-1-e]))return!1;return!0}function a(e,t){let a=ag(e),r=ag(t),i=a.split("@"),n=r.split("@");if(0===i.length||0===n.length||i.length<n.length)return!1;if(1===n.length){if(s(i[1],n[0])){let e=i[1].split("."),t=n[0].split(".");return 0===t[0].length||e.length===t.length}return!1}return 0===a.localeCompare(r)}function r(e,t){let a=ag(e),r=ag(t),i=a.split("/");if(r.split("/").length>1)return!1;if(i.length>1){for(let e=0;e<i.length;e++)if(i[e].length>0&&":"!==i[e].charAt(i[e].length-1)){a=i[e].split(":")[0];break}}if(s(a,r)){let e=a.split("."),t=r.split(".");return 0===t[0].length||e.length===t.length}return!1}function i(e,t){let s=e.valueBlock.valueHexView,a=t.valueBlock.valueHexView;if(4===s.length&&8===a.length){for(let e=0;e<4;e++)if((s[e]^a[e])&a[e+4])return!1;return!0}if(16===s.length&&32===a.length){for(let e=0;e<16;e++)if((s[e]^a[e])&a[e+16])return!1;return!0}return!1}function n(e,t){if(0===e.typesAndValues.length||0===t.typesAndValues.length)return!0;if(e.typesAndValues.length<t.typesAndValues.length)return!1;let s=!0,a=0;for(let r=0;r<t.typesAndValues.length;r++){let i=!1;for(let n=a;n<e.typesAndValues.length;n++)if(i=e.typesAndValues[n].isEqual(t.typesAndValues[r]),e.typesAndValues[n].type===t.typesAndValues[r].type&&(s=s&&i),!0===i){if(0!==a&&a!==n)return!1;a=n+1;break}if(!1===i)return!1}return 0!==a&&s}try{if(0===this.certs.length)throw Error("Empty certificate array");let l=e.passedWhenNotRevValues||!1,o=e.initialPolicySet||[a9],u=e.initialExplicitPolicy||!1,c=e.initialPolicyMappingInhibit||!1,h=e.initialInhibitPolicy||!1,m=e.initialPermittedSubtreesSet||[],d=e.initialExcludedSubtreesSet||[],f=e.initialRequiredNameForms||[],g=u,p=c,y=h,v=[!1,!1,!1],w=0,b=0,k=0,S=m,A=d,N=1;this.certs=await this.sort(l,t);let x=[];x.push(a9);let C=[],B=Array(this.certs.length-1);for(let e=0;e<this.certs.length-1;e++)B[e]=!0;C.push(B);let V=Array(this.certs.length-1),E=Array(this.certs.length-1),I=g?this.certs.length-1:-1;for(let e=this.certs.length-2;e>=0;e--,N++){let t=this.certs[e];if(t.extensions){for(let s=0;s<t.extensions.length;s++){let a=t.extensions[s];if(a.extnID===a6){E[e]=a.parsedValue;for(let t=0;t<x.length;t++)if(x[t]===a9){delete C[t][e];break}for(let t=0;t<a.parsedValue.certificatePolicies.length;t++){let s=-1,r=a.parsedValue.certificatePolicies[t].policyIdentifier;for(let e=0;e<x.length;e++)if(r===x[e]){s=e;break}if(-1===s){x.push(r);let t=Array(this.certs.length-1);t[e]=!0,C.push(t)}else C[s][e]=!0}}if(a.extnID===a7){if(p)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};V[e]=a.parsedValue}a.extnID===rt&&!1===g&&(0===a.parsedValue.requireExplicitPolicy?(g=!0,I=e):!1===v[0]?(v[0]=!0,w=a.parsedValue.requireExplicitPolicy):w=w>a.parsedValue.requireExplicitPolicy?a.parsedValue.requireExplicitPolicy:w,0===a.parsedValue.inhibitPolicyMapping?p=!0:!1===v[1]?(v[1]=!0,b=a.parsedValue.inhibitPolicyMapping+1):b=b>a.parsedValue.inhibitPolicyMapping+1?a.parsedValue.inhibitPolicyMapping+1:b),"2.5.29.54"===a.extnID&&!1===y&&(0===a.parsedValue.valueBlock.valueDec?y=!0:!1===v[2]?(v[2]=!0,k=a.parsedValue.valueBlock.valueDec):k=k>a.parsedValue.valueBlock.valueDec?a.parsedValue.valueBlock.valueDec:k)}if(!0===y){let t=-1;for(let e=0;e<x.length;e++)if(x[e]===a9){t=e;break}-1!==t&&delete C[0][e]}!1===g&&!0===v[0]&&(w--,0===w&&(g=!0,I=e,v[0]=!1)),!1===p&&!0===v[1]&&(b--,0===b&&(p=!0,v[1]=!1)),!1===y&&!0===v[2]&&(k--,0===k&&(y=!0,v[2]=!1))}}for(let e=0;e<this.certs.length-1;e++)if(e<this.certs.length-2&&void 0!==V[e+1])for(let t=0;t<V[e+1].mappings.length;t++){if(V[e+1].mappings[t].issuerDomainPolicy===a9||V[e+1].mappings[t].subjectDomainPolicy===a9)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let s=-1,a=-1;for(let r=0;r<x.length;r++)x[r]===V[e+1].mappings[t].issuerDomainPolicy&&(s=r),x[r]===V[e+1].mappings[t].subjectDomainPolicy&&(a=r);void 0!==C[s][e]&&delete C[s][e];for(let r=0;r<E[e].certificatePolicies.length;r++)if(V[e+1].mappings[t].subjectDomainPolicy===E[e].certificatePolicies[r].policyIdentifier&&-1!==s&&-1!==a)for(let t=0;t<=e;t++)void 0!==C[a][t]&&(C[s][t]=!0,delete C[a][t])}for(let e=0;e<x.length;e++)if(x[e]===a9)for(let t=0;t<I;t++)delete C[e][t];let _=[];for(let e=0;e<C.length;e++){let t=!0;for(let s=0;s<this.certs.length-1;s++){let a=!1;if(s<I&&x[e]===a9&&x.length>1){t=!1;break}if(void 0===C[e][s]){if(s>=I){for(let e=0;e<x.length;e++)if(x[e]===a9){!0===C[e][s]&&(a=!0);break}}if(!a){t=!1;break}}}!0===t&&_.push(x[e])}let D=[];if(1===o.length&&o[0]===a9&&!1===g)D=o;else if(1===_.length&&_[0]===a9)D=o;else for(let e=0;e<_.length;e++)for(let t=0;t<o.length;t++)if(o[t]===_[e]||o[t]===a9){D.push(_[e]);break}let O={result:D.length>0,resultCode:0,resultMessage:D.length>0?"":'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:_,userConstrPolicies:D,explicitPolicyIndicator:g,policyMappings:V,certificatePath:this.certs};if(0===D.length||!1===O.result)return O;N=1;for(let e=this.certs.length-2;e>=0;e--,N++){let t=this.certs[e],l=[],o=[],u=[];if(t.extensions)for(let e=0;e<t.extensions.length;e++){let s=t.extensions[e];s.extnID===a4&&("permittedSubtrees"in s.parsedValue&&(o=o.concat(s.parsedValue.permittedSubtrees)),"excludedSubtrees"in s.parsedValue&&(u=u.concat(s.parsedValue.excludedSubtrees))),s.extnID===aX&&(l=l.concat(s.parsedValue.altNames))}let c=f.length<=0;for(let e=0;e<f.length;e++)if(4===f[e].base.type){if(f[e].base.value.typesAndValues.length!==t.subject.typesAndValues.length)continue;c=!0;for(let s=0;s<t.subject.typesAndValues.length;s++)if(t.subject.typesAndValues[s].type!==f[e].base.value.typesAndValues[s].type){c=!1;break}}if(!1===c)throw O.result=!1,O.resultCode=21,O.resultMessage="No necessary name form found",O;let h=[[],[],[],[],[]];for(let e=0;e<S.length;e++)switch(S[e].base.type){case 1:h[0].push(S[e]);break;case 2:h[1].push(S[e]);break;case 4:h[2].push(S[e]);break;case 6:h[3].push(S[e]);break;case 7:h[4].push(S[e])}for(let e=0;e<5;e++){let o=!1,u=!1,c=h[e];for(let h=0;h<c.length;h++){switch(e){case 0:if(l.length>0)for(let e=0;e<l.length;e++)1===l[e].type&&(u=!0,o=o||a(l[e].value,c[h].base.value));else for(let e=0;e<t.subject.typesAndValues.length;e++)("1.2.840.113549.1.9.1"===t.subject.typesAndValues[e].type||"0.9.2342.19200300.100.1.3"===t.subject.typesAndValues[e].type)&&(u=!0,o=o||a(t.subject.typesAndValues[e].value.valueBlock.value,c[h].base.value));break;case 1:if(l.length>0)for(let e=0;e<l.length;e++)2===l[e].type&&(u=!0,o=o||s(l[e].value,c[h].base.value));break;case 2:u=!0,o=n(t.subject,c[h].base.value);break;case 3:if(l.length>0)for(let e=0;e<l.length;e++)6===l[e].type&&(u=!0,o=o||r(l[e].value,c[h].base.value));break;case 4:if(l.length>0)for(let e=0;e<l.length;e++)7===l[e].type&&(u=!0,o=o||i(l[e].value,c[h].base.value))}if(o)break}if(!1===o&&c.length>0&&u)throw O.result=!1,O.resultCode=41,O.resultMessage='Failed to meet "permitted sub-trees" name constraint',O}let m=!1;for(let e=0;e<A.length;e++){switch(A[e].base.type){case 1:if(l.length>=0)for(let t=0;t<l.length;t++)1===l[t].type&&(m=m||a(l[t].value,A[e].base.value));else for(let s=0;s<t.subject.typesAndValues.length;s++)("1.2.840.113549.1.9.1"===t.subject.typesAndValues[s].type||"0.9.2342.19200300.100.1.3"===t.subject.typesAndValues[s].type)&&(m=m||a(t.subject.typesAndValues[s].value.valueBlock.value,A[e].base.value));break;case 2:if(l.length>0)for(let t=0;t<l.length;t++)2===l[t].type&&(m=m||s(l[t].value,A[e].base.value));break;case 4:m=m||n(t.subject,A[e].base.value);break;case 6:if(l.length>0)for(let t=0;t<l.length;t++)6===l[t].type&&(m=m||r(l[t].value,A[e].base.value));break;case 7:if(l.length>0)for(let t=0;t<l.length;t++)7===l[t].type&&(m=m||i(l[t].value,A[e].base.value))}if(m)break}if(!0===m)throw O.result=!1,O.resultCode=42,O.resultMessage='Failed to meet "excluded sub-trees" name constraint',O;S=S.concat(o),A=A.concat(u)}return O}catch(e){if(e instanceof Error){if(e instanceof hW)return{result:!1,resultCode:e.code,resultMessage:e.message,error:e};return{result:!1,resultCode:h.unknown,resultMessage:e.message,error:e}}if(e&&"object"==typeof e&&"resultMessage"in e)return e;return{result:!1,resultCode:-1,resultMessage:`${e}`}}}}let hG="tbsResponseData",hz="signatureAlgorithm",hQ="signature",hY="certs",hX="BasicOCSPResponse",h0=`${hX}.${hG}`,h1=`${hX}.${hz}`,h2=`${hX}.${hQ}`,h3=`${hX}.${hY}`,h4=[h0,h1,h2,h3];class h8 extends af{constructor(e={}){super(),this.tbsResponseData=e1(e,hG,h8.defaultValues(hG)),this.signatureAlgorithm=e1(e,hz,h8.defaultValues(hz)),this.signature=e1(e,hQ,h8.defaultValues(hQ)),hY in e&&(this.certs=e1(e,hY,h8.defaultValues(hY))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hG:return new hL;case hz:return new aT;case hQ:return new tJ;case hY:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let e=hL.compareWithDefault("tbs",t.tbs)&&hL.compareWithDefault("responderID",t.responderID)&&hL.compareWithDefault("producedAt",t.producedAt)&&hL.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(e=e&&hL.compareWithDefault("responseExtensions",t.responseExtensions)),e}case hz:return""===t.algorithmId&&"algorithmParams"in t==!1;case hQ:return t.isEqual(h8.defaultValues(e));case hY:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||hX,value:[hL.schema(t.tbsResponseData||{names:{blockName:h0}}),aT.schema(t.signatureAlgorithm||{names:{blockName:h1}}),new tJ({name:t.signature||h2}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new t0({value:[new sw({name:h3,value:oV.schema(t.certs||{})})]})]})]})}fromSchema(e){tl(e,h4);let t=sk(e,e,h8.schema());ad.assertSchema(t,this.className),this.tbsResponseData=new hL({schema:t.result[h0]}),this.signatureAlgorithm=new aT({schema:t.result[h1]}),this.signature=t.result[h2],h3 in t.result&&(this.certs=Array.from(t.result[h3],e=>new oV({schema:e})))}toSchema(){let e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[new t0({value:Array.from(this.certs,e=>e.toSchema())})]})),new t0({value:e})}toJSON(){let e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,e=>e.toJSON())),e}async getCertificateStatus(e,t,s=nD(!0)){let a={isForCertificate:!1,status:2},r={},i=[];for(let a of this.tbsResponseData.responses){let n=s.getAlgorithmByOID(a.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!r[n.name]){r[n.name]=1;let a=new hw;i.push(a),await a.createForCertificate(e,{hashAlgorithm:n.name,issuerCertificate:t},s)}}for(let e of this.tbsResponseData.responses)for(let t of i)if(e.certID.isEqual(t)){a.isForCertificate=!0;try{switch(e.certStatus.idBlock.isConstructed){case!0:1===e.certStatus.idBlock.tagNumber&&(a.status=1);break;case!1:switch(e.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2}}}catch(e){}return a}return a}async sign(e,t="SHA-1",s=nD(!0)){if(!e)throw Error("Need to provide a private key for signing");let a=await s.getSignatureParameters(e,t),r=a.parameters.algorithm;if(!("name"in r))throw Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());let i=await s.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:r});this.signature=new tJ({valueHex:i})}async verify(e={},t=nD(!0)){let s=null,a=-1,r=e.trustedCerts||[];if(!this.certs)throw Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof ak:for(let[e,t]of this.certs.entries())if(t.subject.isEqual(this.tbsResponseData.responderID)){a=e;break}break;case this.tbsResponseData.responderID instanceof tK:for(let[e,s]of this.certs.entries())if(e9(await t.digest({name:"sha-1"},s.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView),this.tbsResponseData.responderID.valueBlock.valueHex)){a=e;break}break;default:throw Error("Wrong value for responderID")}if(-1===a)throw Error("Correct certificate was not found in OCSP response");let i=[s=this.certs[a]];for(let e of this.certs){let t=await oE(e,s);t&&i.push(t)}let n=new hZ({certs:i,trustedCerts:r});if(!(await n.verify({},t)).result)throw Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}h8.CLASS_NAME="BasicOCSPResponse";let h5="version",h6="subject",h9="subjectPublicKeyInfo",h7="attributes",me="signatureAlgorithm",mt="signatureValue",ms="CertificationRequestInfo",ma=`${ms}.version`,mr=`${ms}.subject`,mi=`${ms}.subjectPublicKeyInfo`,mn=`${ms}.attributes`,ml=[ms,ma,mr,mi,mn,me,mt];class mo extends af{get tbs(){return eW.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(e1(e,"tbs",mo.defaultValues("tbs"))),this.version=e1(e,h5,mo.defaultValues(h5)),this.subject=e1(e,h6,mo.defaultValues(h6)),this.subjectPublicKeyInfo=e1(e,h9,mo.defaultValues(h9)),h7 in e&&(this.attributes=e1(e,h7,mo.defaultValues(h7))),this.signatureAlgorithm=e1(e,me,mo.defaultValues(me)),this.signatureValue=e1(e,mt,mo.defaultValues(mt)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":return ac;case h5:return 0;case h6:return new ak;case h9:return new iL;case h7:return[];case me:return new aT;case mt:return new tJ;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({value:[function(e={}){let t=e1(e,"names",{});return new t0({name:t.CertificationRequestInfo||ms,value:[new tq({name:t.CertificationRequestInfoVersion||ma}),ak.schema(t.subject||{names:{blockName:mr}}),iL.schema({names:{blockName:mi}}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sw({optional:!0,name:t.CertificationRequestInfoAttributes||mn,value:aF.schema(t.attributes||{})})]})]})}(t.certificationRequestInfo||{}),new t0({name:t.signatureAlgorithm||me,value:[new tz,new sy({optional:!0})]}),new tJ({name:t.signatureValue||mt})]})}fromSchema(e){tl(e,ml);let t=sk(e,e,mo.schema());ad.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[ma].valueBlock.valueDec,this.subject=new ak({schema:t.result[mr]}),this.subjectPublicKeyInfo=new iL({schema:t.result[mi]}),mn in t.result&&(this.attributes=Array.from(t.result[mn],e=>new aF({schema:e}))),this.signatureAlgorithm=new aT({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){let e=[new tq({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return h7 in this&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],e=>e.toSchema())})),new t0({value:e})}toSchema(e=!1){let t;if(!1===e){if(0===this.tbsView.byteLength)return mo.schema();let e=tD(this.tbsView);ad.assert(e,"PKCS#10 Certificate Request"),t=e.result}else t=this.encodeTBS();return new t0({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){let e={tbs:e0.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return h7 in this&&(e.attributes=Array.from(this.attributes||[],e=>e.toJSON())),e}async sign(e,t="SHA-1",s=nD(!0)){if(!e)throw Error("Need to provide a private key for signing");let a=await s.getSignatureParameters(e,t),r=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());let i=await s.signWithPrivateKey(this.tbsView,e,r);this.signatureValue=new tJ({valueHex:i})}async verify(e=nD(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=nD(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}mo.CLASS_NAME="CertificationRequest";let mu="digestAlgorithm",mc="digest",mh=[mu,mc];class mm extends af{constructor(e={}){super(),this.digestAlgorithm=e1(e,mu,mm.defaultValues(mu)),this.digest=e1(e,mc,mm.defaultValues(mc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mu:return new aT;case mc:return new tK;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mu:return aT.compareWithDefault("algorithmId",t.algorithmId)&&"algorithmParams"in t==!1;case mc:return t.isEqual(mm.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aT.schema(t.digestAlgorithm||{names:{blockName:mu}}),new tK({name:t.digest||mc})]})}fromSchema(e){tl(e,mh);let t=sk(e,e,mm.schema({names:{digestAlgorithm:{names:{blockName:mu}},digest:mc}}));ad.assertSchema(t,this.className),this.digestAlgorithm=new aT({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new t0({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}mm.CLASS_NAME="DigestInfo";let md="eContentType",mf="eContent",mg=[md,mf];class mp extends af{constructor(e={}){if(super(),this.eContentType=e1(e,md,mp.defaultValues(md)),mf in e&&(this.eContent=e1(e,mf,mp.defaultValues(mf)),1===this.eContent.idBlock.tagClass&&4===this.eContent.idBlock.tagNumber&&!1===this.eContent.idBlock.isConstructed)){let e=new tK({idBlock:{isConstructed:!0},isConstructed:!0}),t=0,s=this.eContent.valueBlock.valueHexView.slice().buffer,a=s.byteLength;for(;a>0;){let r=new Uint8Array(s,t,t+65536>s.byteLength?s.byteLength-t:65536),i=new ArrayBuffer(r.length),n=new Uint8Array(i);for(let e=0;e<n.length;e++)n[e]=r[e];e.valueBlock.value.push(new tK({valueHex:i})),a-=r.length,t+=r.length}this.eContent=e}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case md:return"";case mf:return new tK;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case md:return""===t;case mf:if(1===t.idBlock.tagClass&&4===t.idBlock.tagNumber)return t.isEqual(mp.defaultValues(mf));return!1;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.eContentType||""}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sy({name:t.eContent||""})]})]})}fromSchema(e){tl(e,mg);let t=sk(e,e,mp.schema({names:{eContentType:md,eContent:mf}}));ad.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),mf in t.result&&(this.eContent=t.result.eContent)}toSchema(){let e=[];return e.push(new tz({value:this.eContentType})),this.eContent&&!1===mp.compareWithDefault(mf,this.eContent)&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new t0({value:e})}toJSON(){let e={eContentType:this.eContentType};return this.eContent&&!1===mp.compareWithDefault(mf,this.eContent)&&(e.eContent=this.eContent.toJSON()),e}}mp.CLASS_NAME="EncapsulatedContentInfo";let my="macSalt",mv="iterations",mw=["mac",my,mv];class mb extends af{constructor(e={}){super(),this.mac=e1(e,"mac",mb.defaultValues("mac")),this.macSalt=e1(e,my,mb.defaultValues(my)),mv in e&&(this.iterations=e1(e,mv,mb.defaultValues(mv))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"mac":return new mm;case my:return new tK;case mv:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"mac":return mm.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&mm.compareWithDefault("digest",t.digest);case my:return t.isEqual(mb.defaultValues(e));case mv:return t===mb.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",optional:t.optional||!0,value:[mm.schema(t.mac||{names:{blockName:"mac"}}),new tK({name:t.macSalt||my}),new tq({optional:!0,name:t.iterations||mv})]})}fromSchema(e){tl(e,mw);let t=sk(e,e,mb.schema({names:{mac:{names:{blockName:"mac"}},macSalt:my,iterations:mv}}));ad.assertSchema(t,this.className),this.mac=new mm({schema:t.result.mac}),this.macSalt=t.result.macSalt,mv in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){let e=[this.mac.toSchema(),this.macSalt];return void 0!==this.iterations&&e.push(new tq({value:this.iterations})),new t0({value:e})}toJSON(){let e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return void 0!==this.iterations&&(e.iterations=this.iterations),e}}mb.CLASS_NAME="MacData";let mk="hashAlgorithm",mS="hashedMessage",mA=[mk,mS];class mN extends af{static async create(e,t,s=nD(!0)){let a=s.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),r=await s.digest(e,t);return new mN({hashAlgorithm:new aT({algorithmId:a,algorithmParams:new tj}),hashedMessage:new tK({valueHex:r})})}constructor(e={}){super(),this.hashAlgorithm=e1(e,mk,mN.defaultValues(mk)),this.hashedMessage=e1(e,mS,mN.defaultValues(mS)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mk:return new aT;case mS:return new tK;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mk:return""===t.algorithmId&&"algorithmParams"in t==!1;case mS:return 0===t.isEqual(mN.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aT.schema(t.hashAlgorithm||{}),new tK({name:t.hashedMessage||""})]})}fromSchema(e){tl(e,mA);let t=sk(e,e,mN.schema({names:{hashAlgorithm:{names:{blockName:mk}},hashedMessage:mS}}));ad.assertSchema(t,this.className),this.hashAlgorithm=new aT({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new t0({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}mN.CLASS_NAME="MessageImprint";let mx="reqCert",mC="singleRequestExtensions",mB=[mx,mC];class mV extends af{constructor(e={}){super(),this.reqCert=e1(e,mx,mV.defaultValues(mx)),mC in e&&(this.singleRequestExtensions=e1(e,mC,mV.defaultValues(mC))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mx:return new hw;case mC:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mx:return t.isEqual(mV.defaultValues(e));case mC:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[hw.schema(t.reqCert||{}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[n9.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||""}})]})]})}fromSchema(e){tl(e,mB);let t=sk(e,e,mV.schema({names:{reqCert:{names:{blockName:mx}},extensions:{names:{blockName:mC}}}}));ad.assertSchema(t,this.className),this.reqCert=new hw({schema:t.result.reqCert}),mC in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,e=>new n9({schema:e})))}toSchema(){let e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new t0({value:Array.from(this.singleRequestExtensions,e=>e.toSchema())})]})),new t0({value:e})}toJSON(){let e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,e=>e.toJSON())),e}}mV.CLASS_NAME="Request";let mE="version",mI="requestorName",m_="requestList",mD="requestExtensions",mO="TBSRequest",mP=`${mO}.${mE}`,mU=`${mO}.${mI}`,mR=`${mO}.requests`,mj=`${mO}.${mD}`,mT=[mO,mP,mU,mR,mj];class mL extends af{get tbs(){return eW.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(e1(e,"tbs",mL.defaultValues("tbs"))),mE in e&&(this.version=e1(e,mE,mL.defaultValues(mE))),mI in e&&(this.requestorName=e1(e,mI,mL.defaultValues(mI))),this.requestList=e1(e,m_,mL.defaultValues(m_)),mD in e&&(this.requestExtensions=e1(e,mD,mL.defaultValues(mD))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"tbs":return ac;case mE:return 0;case mI:return new aN;case m_:case mD:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"tbs":return 0===t.byteLength;case mE:return t===mL.defaultValues(e);case mI:return t.type===aN.defaultValues("type")&&0===Object.keys(t.value).length;case m_:case mD:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||mO,value:[new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new tq({name:t.TBSRequestVersion||mP})]}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[aN.schema(t.requestorName||{names:{blockName:mU}})]}),new t0({name:t.requestList||"TBSRequest.requestList",value:[new sw({name:t.requests||mR,value:mV.schema(t.requestNames||{})})]}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[lt.schema(t.extensions||{names:{blockName:t.requestExtensions||mj}})]})]})}fromSchema(e){tl(e,mT);let t=sk(e,e,mL.schema());ad.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,mP in t.result&&(this.version=t.result[mP].valueBlock.valueDec),mU in t.result&&(this.requestorName=new aN({schema:t.result[mU]})),this.requestList=Array.from(t.result[mR],e=>new mV({schema:e})),mj in t.result&&(this.requestExtensions=Array.from(t.result[mj].valueBlock.value,e=>new n9({schema:e})))}toSchema(e=!1){let t;if(!1===e){if(0===this.tbsView.byteLength)return mL.schema();let e=tD(this.tbsView);if(ad.assert(e,"TBS Request"),!(e.result instanceof t0))throw Error("ASN.1 result should be SEQUENCE");t=e.result}else{let e=[];void 0!==this.version&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[new tq({value:this.version})]})),this.requestorName&&e.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),e.push(new t0({value:Array.from(this.requestList,e=>e.toSchema())})),this.requestExtensions&&e.push(new tP({idBlock:{tagClass:3,tagNumber:2},value:[new t0({value:Array.from(this.requestExtensions,e=>e.toSchema())})]})),t=new t0({value:e})}return t}toJSON(){let e={};return void 0!=this.version&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,e=>e.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,e=>e.toJSON())),e}}mL.CLASS_NAME="TBSRequest";let mH="signatureAlgorithm",mK="signature",mM="certs";class mJ extends af{constructor(e={}){super(),this.signatureAlgorithm=e1(e,mH,mJ.defaultValues(mH)),this.signature=e1(e,mK,mJ.defaultValues(mK)),mM in e&&(this.certs=e1(e,mM,mJ.defaultValues(mM))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mH:return new aT;case mK:return new tJ;case mM:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mH:return""===t.algorithmId&&"algorithmParams"in t==!1;case mK:return t.isEqual(mJ.defaultValues(e));case mM:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[aT.schema(t.signatureAlgorithm||{}),new tJ({name:t.signature||""}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new t0({value:[new sw({name:t.certs||"",value:oV.schema({})})]})]})]})}fromSchema(e){tl(e,[mH,mK,mM]);let t=sk(e,e,mJ.schema({names:{signatureAlgorithm:{names:{blockName:mH}},signature:mK,certs:mM}}));ad.assertSchema(t,this.className),this.signatureAlgorithm=new aT({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,mM in t.result&&(this.certs=Array.from(t.result.certs,e=>new oV({schema:e})))}toSchema(){let e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new t0({value:Array.from(this.certs,e=>e.toSchema())})]})),new t0({value:e})}toJSON(){let e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,e=>e.toJSON())),e}}mJ.CLASS_NAME="Signature";let m$="tbsRequest",mF="optionalSignature",mq=[m$,mF];class mW extends af{constructor(e={}){super(),this.tbsRequest=e1(e,m$,mW.defaultValues(m$)),mF in e&&(this.optionalSignature=e1(e,mF,mW.defaultValues(mF))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case m$:return new mL;case mF:return new mJ;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case m$:return mL.compareWithDefault("tbs",t.tbs)&&mL.compareWithDefault("version",t.version)&&mL.compareWithDefault("requestorName",t.requestorName)&&mL.compareWithDefault("requestList",t.requestList)&&mL.compareWithDefault("requestExtensions",t.requestExtensions);case mF:return mJ.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&mJ.compareWithDefault("signature",t.signature)&&mJ.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"OCSPRequest",value:[mL.schema(t.tbsRequest||{names:{blockName:m$}}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[mJ.schema(t.optionalSignature||{names:{blockName:mF}})]})]})}fromSchema(e){tl(e,mq);let t=sk(e,e,mW.schema());ad.assertSchema(t,this.className),this.tbsRequest=new mL({schema:t.result.tbsRequest}),mF in t.result&&(this.optionalSignature=new mJ({schema:t.result.optionalSignature}))}toSchema(e=!1){let t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new t0({value:t})}toJSON(){let e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,s=nD(!0)){let a=new hw;await a.createForCertificate(e,t,s),this.tbsRequest.requestList.push(new mV({reqCert:a}))}async sign(e,t="SHA-1",s=nD(!0)){if(am.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw Error('Need to create "optionalSignature" field before signing');let a=await s.getSignatureParameters(e,t),r=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;let i=this.tbsRequest.toSchema(!0).toBER(!1),n=await s.signWithPrivateKey(i,e,r);this.optionalSignature.signature=new tJ({valueHex:n})}verify(){}}mW.CLASS_NAME="OCSPRequest";let mZ="responseType",mG="response",mz=[mZ,mG];class mQ extends af{constructor(e={}){super(),this.responseType=e1(e,mZ,mQ.defaultValues(mZ)),this.response=e1(e,mG,mQ.defaultValues(mG)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mZ:return"";case mG:return new tK;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mZ:return""===t;case mG:return t.isEqual(mQ.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tz({name:t.responseType||""}),new tK({name:t.response||""})]})}fromSchema(e){tl(e,mz);let t=sk(e,e,mQ.schema({names:{responseType:mZ,response:mG}}));ad.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new t0({value:[new tz({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}mQ.CLASS_NAME="ResponseBytes";let mY="responseStatus",mX="responseBytes";class m0 extends af{constructor(e={}){super(),this.responseStatus=e1(e,mY,m0.defaultValues(mY)),mX in e&&(this.responseBytes=e1(e,mX,m0.defaultValues(mX))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mY:return new tW;case mX:return new mQ;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mY:return t.isEqual(m0.defaultValues(e));case mX:return mQ.compareWithDefault("responseType",t.responseType)&&mQ.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"OCSPResponse",value:[new tW({name:t.responseStatus||mY}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[mQ.schema(t.responseBytes||{names:{blockName:mX}})]})]})}fromSchema(e){tl(e,[mY,mX]);let t=sk(e,e,m0.schema());ad.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,mX in t.result&&(this.responseBytes=new mQ({schema:t.result.responseBytes}))}toSchema(){let e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new t0({value:e})}toJSON(){let e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,s=nD(!0)){let a;let r={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==rc)return r;try{let e=tD(this.responseBytes.response.valueBlock.valueHexView);ad.assert(e,"Basic OCSP response"),a=new h8({schema:e.result})}catch(e){return r}return a.getCertificateStatus(e,t,s)}async sign(e,t,s=nD(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===rc)return h8.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,s);throw Error(`Unknown ResponseBytes type: ${(null===(a=this.responseBytes)||void 0===a?void 0:a.responseType)||"Unknown"}`)}async verify(e=null,t=nD(!0)){var s;if(mX in this==!1)throw Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===rc){let s=h8.fromBER(this.responseBytes.response.valueBlock.valueHexView);return null!==e&&(s.certs||(s.certs=[]),s.certs.push(e)),s.verify({},t)}throw Error(`Unknown ResponseBytes type: ${(null===(s=this.responseBytes)||void 0===s?void 0:s.responseType)||"Unknown"}`)}}m0.CLASS_NAME="OCSPResponse";let m1="type",m2="attributes",m3="encodedValue",m4=[m2];class m8 extends af{constructor(e={}){super(),this.type=e1(e,m1,m8.defaultValues(m1)),this.attributes=e1(e,m2,m8.defaultValues(m2)),this.encodedValue=e1(e,m3,m8.defaultValues(m3)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case m1:return -1;case m2:return[];case m3:return ac;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case m1:return t===m8.defaultValues(m1);case m2:return 0===t.length;case m3:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new tP({name:t.blockName||"",optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new sw({name:t.attributes||"",value:aF.schema()})]})}fromSchema(e){tl(e,m4);let t=sk(e,e,m8.schema({names:{tagNumber:this.type,attributes:m2}}));if(ad.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=eW.toArrayBuffer(t.result.valueBeforeDecodeView),new Uint8Array(this.encodedValue)[0]=49,m2 in t.result==!1){if(0!==this.type)return;throw Error("Wrong structure of SignedUnsignedAttributes")}this.attributes=Array.from(t.result.attributes,e=>new aF({schema:e}))}toSchema(){if(m8.compareWithDefault(m1,this.type)||m8.compareWithDefault(m2,this.attributes))throw Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new tP({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(m8.compareWithDefault(m1,this.type)||m8.compareWithDefault(m2,this.attributes))throw Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}m8.CLASS_NAME="SignedAndUnsignedAttributes";let m5="version",m6="digestAlgorithm",m9="signedAttrs",m7="signatureAlgorithm",de="signature",dt="unsignedAttrs",ds="SignerInfo",da=`${ds}.${m5}`,dr=`${ds}.sid`,di=`${ds}.${m6}`,dn=`${ds}.${m9}`,dl=`${ds}.${m7}`,du=`${ds}.${de}`,dc=`${ds}.${dt}`,dh=[da,dr,di,dn,dl,du,dc];class dm extends af{constructor(e={}){super(),this.version=e1(e,m5,dm.defaultValues(m5)),this.sid=e1(e,"sid",dm.defaultValues("sid")),this.digestAlgorithm=e1(e,m6,dm.defaultValues(m6)),m9 in e&&(this.signedAttrs=e1(e,m9,dm.defaultValues(m9))),this.signatureAlgorithm=e1(e,m7,dm.defaultValues(m7)),this.signature=e1(e,de,dm.defaultValues(de)),dt in e&&(this.unsignedAttrs=e1(e,dt,dm.defaultValues(dt))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case m5:return 0;case"sid":return new sy;case m6:return new aT;case m9:return new m8({type:0});case m7:return new aT;case de:return new tK;case dt:return new m8({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case m5:return dm.defaultValues(m5)===t;case"sid":return t instanceof sy;case m6:if(t instanceof aT==!1)return!1;return t.isEqual(dm.defaultValues(m6));case m9:return m8.compareWithDefault("type",t.type)&&m8.compareWithDefault("attributes",t.attributes)&&m8.compareWithDefault("encodedValue",t.encodedValue);case m7:if(t instanceof aT==!1)return!1;return t.isEqual(dm.defaultValues(m7));case de:case dt:return m8.compareWithDefault("type",t.type)&&m8.compareWithDefault("attributes",t.attributes)&&m8.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:ds,value:[new tq({name:t.version||da}),new sv({value:[uF.schema(t.sidSchema||{names:{blockName:dr}}),new sv({value:[new tP({optional:!0,name:t.sid||dr,idBlock:{tagClass:3,tagNumber:0},value:[new tK]}),new tI({optional:!0,name:t.sid||dr,idBlock:{tagClass:3,tagNumber:0}})]})]}),aT.schema(t.digestAlgorithm||{names:{blockName:di}}),m8.schema(t.signedAttrs||{names:{blockName:dn,tagNumber:0}}),aT.schema(t.signatureAlgorithm||{names:{blockName:dl}}),new tK({name:t.signature||du}),m8.schema(t.unsignedAttrs||{names:{blockName:dc,tagNumber:1}})]})}fromSchema(e){tl(e,dh);let t=sk(e,e,dm.schema());ad.assertSchema(t,this.className),this.version=t.result[da].valueBlock.valueDec;let s=t.result[dr];1===s.idBlock.tagClass?this.sid=new uF({schema:s}):this.sid=s,this.digestAlgorithm=new aT({schema:t.result[di]}),dn in t.result&&(this.signedAttrs=new m8({type:0,schema:t.result[dn]})),this.signatureAlgorithm=new aT({schema:t.result[dl]}),this.signature=t.result[du],dc in t.result&&(this.unsignedAttrs=new m8({type:1,schema:t.result[dc]}))}toSchema(){if(dm.compareWithDefault("sid",this.sid))throw Error('Incorrectly initialized "SignerInfo" class');let e=[];return e.push(new tq({value:this.version})),this.sid instanceof uF?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&!1===dm.compareWithDefault(m9,this.signedAttrs)&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&!1===dm.compareWithDefault(dt,this.unsignedAttrs)&&e.push(this.unsignedAttrs.toSchema()),new t0({value:e})}toJSON(){if(dm.compareWithDefault("sid",this.sid))throw Error('Incorrectly initialized "SignerInfo" class');let e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof sy||(e.sid=this.sid.toJSON()),this.signedAttrs&&!1===dm.compareWithDefault(m9,this.signedAttrs)&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&!1===dm.compareWithDefault(dt,this.unsignedAttrs)&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}dm.CLASS_NAME="SignerInfo";let dd="version",df="policy",dg="messageImprint",dp="serialNumber",dy="genTime",dv="ordering",dw="nonce",db="accuracy",dk="extensions",dS="TSTInfo",dA=`${dS}.${dd}`,dN=`${dS}.${df}`,dx=`${dS}.${dg}`,dC=`${dS}.${dp}`,dB=`${dS}.${dy}`,dV=`${dS}.${db}`,dE=`${dS}.${dv}`,dI=`${dS}.${dw}`,d_=`${dS}.tsa`,dD=`${dS}.${dk}`,dO=[dA,dN,dx,dC,dB,dV,dE,dI,d_,dD];class dP extends af{constructor(e={}){super(),this.version=e1(e,dd,dP.defaultValues(dd)),this.policy=e1(e,df,dP.defaultValues(df)),this.messageImprint=e1(e,dg,dP.defaultValues(dg)),this.serialNumber=e1(e,dp,dP.defaultValues(dp)),this.genTime=e1(e,dy,dP.defaultValues(dy)),db in e&&(this.accuracy=e1(e,db,dP.defaultValues(db))),dv in e&&(this.ordering=e1(e,dv,dP.defaultValues(dv))),dw in e&&(this.nonce=e1(e,dw,dP.defaultValues(dw))),"tsa"in e&&(this.tsa=e1(e,"tsa",dP.defaultValues("tsa"))),dk in e&&(this.extensions=e1(e,dk,dP.defaultValues(dk))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case dd:return 0;case df:return"";case dg:return new mN;case dp:return new tq;case dy:return new Date(0,0,0);case db:return new aD;case dv:return!1;case dw:return new tq;case"tsa":return new aN;case dk:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case dd:case df:case dy:case dv:return t===dP.defaultValues(dv);case dg:return mN.compareWithDefault(mk,t.hashAlgorithm)&&mN.compareWithDefault(mS,t.hashedMessage);case dp:case dw:return t.isEqual(dP.defaultValues(dw));case db:return aD.compareWithDefault(aE,t.seconds)&&aD.compareWithDefault(aI,t.millis)&&aD.compareWithDefault(a_,t.micros);case"tsa":return aN.compareWithDefault(aS,t.type)&&aN.compareWithDefault(aA,t.value);case dk:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||dS,value:[new tq({name:t.version||dA}),new tz({name:t.policy||dN}),mN.schema(t.messageImprint||{names:{blockName:dx}}),new tq({name:t.serialNumber||dC}),new sh({name:t.genTime||dB}),aD.schema(t.accuracy||{names:{blockName:dV}}),new tL({name:t.ordering||dE,optional:!0}),new tq({name:t.nonce||dI,optional:!0}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[aN.schema(t.tsa||{names:{blockName:d_}})]}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new sw({name:t.extensions||dD,value:n9.schema(t.extension||{})})]})]})}fromSchema(e){tl(e,dO);let t=sk(e,e,dP.schema());ad.assertSchema(t,this.className),this.version=t.result[dA].valueBlock.valueDec,this.policy=t.result[dN].valueBlock.toString(),this.messageImprint=new mN({schema:t.result[dx]}),this.serialNumber=t.result[dC],this.genTime=t.result[dB].toDate(),dV in t.result&&(this.accuracy=new aD({schema:t.result[dV]})),dE in t.result&&(this.ordering=t.result[dE].valueBlock.value),dI in t.result&&(this.nonce=t.result[dI]),d_ in t.result&&(this.tsa=new aN({schema:t.result[d_]})),dD in t.result&&(this.extensions=Array.from(t.result[dD],e=>new n9({schema:e})))}toSchema(){let e=[];return e.push(new tq({value:this.version})),e.push(new tz({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new sh({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),void 0!==this.ordering&&e.push(new tL({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,e=>e.toSchema())})),new t0({value:e})}toJSON(){let e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),void 0!==this.ordering&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,e=>e.toJSON())),e}async verify(e,t=nD(!0)){if(!e.data)throw Error('"data" is a mandatory attribute for TST_INFO verification');let s=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw Error("Generation time for TSTInfo object is more than notAfter value");let a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),r=await t.digest(a.name,new Uint8Array(s));return eW.isEqual(r,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}dP.CLASS_NAME="TSTInfo";let dU="version",dR="digestAlgorithms",dj="encapContentInfo",dT="certificates",dL="crls",dH="signerInfos",dK="ocsps",dM="SignedData",dJ=`${dM}.${dU}`,d$=`${dM}.${dR}`,dF=`${dM}.${dj}`,dq=`${dM}.${dT}`,dW=`${dM}.${dL}`,dZ=`${dM}.${dH}`,dG=[dJ,d$,dF,dq,dW,dZ];class dz extends Error{constructor({message:e,code:t=0,date:s=new Date,signatureVerified:a=null,signerCertificate:r=null,signerCertificateVerified:i=null,timestampSerial:n=null,certificatePath:l=[]}){super(e),this.name="SignedDataVerifyError",this.date=s,this.code=t,this.timestampSerial=n,this.signatureVerified=a,this.signerCertificate=r,this.signerCertificateVerified=i,this.certificatePath=l}}class dQ extends af{constructor(e={}){super(),this.version=e1(e,dU,dQ.defaultValues(dU)),this.digestAlgorithms=e1(e,dR,dQ.defaultValues(dR)),this.encapContentInfo=e1(e,dj,dQ.defaultValues(dj)),dT in e&&(this.certificates=e1(e,dT,dQ.defaultValues(dT))),dL in e&&(this.crls=e1(e,dL,dQ.defaultValues(dL))),dK in e&&(this.ocsps=e1(e,dK,dQ.defaultValues(dK))),this.signerInfos=e1(e,dH,dQ.defaultValues(dH)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case dU:return 0;case dR:return[];case dj:return new mp;case dT:case dL:case dK:case dH:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case dU:return t===dQ.defaultValues(dU);case dj:return mp.compareWithDefault("eContentType",t.eContentType)&&mp.compareWithDefault("eContent",t.eContent);case dR:case dT:case dL:case dK:case dH:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return void 0===t.optional&&(t.optional=!1),new t0({name:t.blockName||dM,optional:t.optional,value:[new tq({name:t.version||dJ}),new t1({value:[new sw({name:t.digestAlgorithms||d$,value:aT.schema()})]}),mp.schema(t.encapContentInfo||{names:{blockName:dF}}),new tP({name:t.certificates||dq,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:uE.schema().valueBlock.value}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:uj.schema(t.crls||{names:{crls:dW}}).valueBlock.value}),new t1({value:[new sw({name:t.signerInfos||dZ,value:dm.schema()})]})]})}fromSchema(e){tl(e,dG);let t=sk(e,e,dQ.schema());if(ad.assertSchema(t,this.className),this.version=t.result[dJ].valueBlock.valueDec,d$ in t.result&&(this.digestAlgorithms=Array.from(t.result[d$],e=>new aT({schema:e}))),this.encapContentInfo=new mp({schema:t.result[dF]}),dq in t.result){let e=new uE({schema:new t1({value:t.result[dq].valueBlock.value})});this.certificates=e.certificates.slice(0)}dW in t.result&&(this.crls=Array.from(t.result[dW],e=>1===e.idBlock.tagClass?new o8({schema:e}):(e.idBlock.tagClass=1,e.idBlock.tagNumber=16,new uO({schema:e})))),dZ in t.result&&(this.signerInfos=Array.from(t.result[dZ],e=>new dm({schema:e})))}toSchema(e=!1){let t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(e=>e instanceof uC)||this.crls&&this.crls.length&&this.crls.some(e=>e instanceof uO)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(e=>e instanceof l1)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(e=>e instanceof lA)||this.signerInfos.some(e=>3===e.version)||this.encapContentInfo.eContentType!==dQ.ID_DATA?this.version=3:this.version=1,t.push(new tq({value:this.version})),t.push(new t1({value:Array.from(this.digestAlgorithms,e=>e.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){let e=new uE({certificates:this.certificates}).toSchema();t.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:e.valueBlock.value}))}return this.crls&&t.push(new tP({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,t=>{if(t instanceof uO){let e=t.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}return t.toSchema(e)})})),t.push(new t1({value:Array.from(this.signerInfos,e=>e.toSchema())})),new t0({value:t})}toJSON(){let e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,e=>e.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,e=>e.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,e=>e.toJSON())),this.crls&&(e.crls=Array.from(this.crls,e=>e.toJSON())),e}async verify({signer:e=-1,data:t=ac,trustedCerts:s=[],checkDate:a=new Date,checkChain:r=!1,passedWhenNotRevValues:i=!1,extendedMode:n=!1,findOrigin:l=null,findIssuer:o=null}={},u=nD(!0)){let c=null,h=null;try{let m=ac,d="",f=[],g=this.signerInfos[e];if(!g)throw new dz({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new dz({date:a,code:2,message:"No certificates attached to this signed data"});if(g.sid instanceof uF){for(let e of this.certificates)if(e instanceof oV&&e.issuer.isEqual(g.sid.issuer)&&e.serialNumber.isEqual(g.sid.serialNumber)){c=e;break}}else{let e=g.sid,t=e.idBlock.isConstructed?e.valueBlock.value[0].valueBlock.valueHex:e.valueBlock.valueHex;for(let e of this.certificates){if(!(e instanceof oV))continue;let s=await u.digest({name:"sha-1"},e.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(e9(s,t)){c=e;break}}}if(!c)throw new dz({date:a,code:3,message:"Unable to find signer certificate"});if("1.2.840.113549.1.9.16.1.4"===this.encapContentInfo.eContentType){let e;if(!this.encapContentInfo.eContent)throw new dz({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:c,timestampSerial:h,signerCertificateVerified:!0});try{e=dP.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch(e){throw new dz({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:c,timestampSerial:h,signerCertificateVerified:!0})}if(a=e.genTime,h=e.serialNumber.valueBlock.valueHexView.slice(),0===t.byteLength)throw new dz({date:a,code:4,message:"Missed detached data input array"});if(!await e.verify({data:t},u))throw new dz({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:c,timestampSerial:h,signerCertificateVerified:!0})}if(r){let e=this.certificates.filter(e=>e instanceof oV&&!!oE(e,c)),t={checkDate:a,certs:e,trustedCerts:s};o&&(t.findIssuer=o),l&&(t.findOrigin=l);let r=new hZ(t);if(r.certs.push(c),this.crls)for(let e of this.crls)"thisUpdate"in e?r.crls.push(e):e.otherRevInfoFormat===rc&&r.ocsps.push(new h8({schema:e.otherRevInfo}));this.ocsps&&r.ocsps.push(...this.ocsps);let n=await r.verify({passedWhenNotRevValues:i},u).catch(e=>{throw new dz({date:a,code:5,message:`Validation of signer's certificate failed with error: ${e instanceof Object?e.resultMessage:e}`,signerCertificate:c,signerCertificateVerified:!1})});if(n.certificatePath&&(f=n.certificatePath),!n.result)throw new dz({date:a,code:5,message:`Validation of signer's certificate failed: ${n.resultMessage}`,signerCertificate:c,signerCertificateVerified:!1})}let p=u.getAlgorithmByOID(g.digestAlgorithm.algorithmId);if(!("name"in p))throw new dz({date:a,code:7,message:`Unsupported signature algorithm: ${g.digestAlgorithm.algorithmId}`,signerCertificate:c,signerCertificateVerified:!0});d=p.name;let y=this.encapContentInfo.eContent;if(y)t=1===y.idBlock.tagClass&&4===y.idBlock.tagNumber?y.getValue():y.valueBlock.valueBeforeDecodeView;else if(0===t.byteLength)throw new dz({date:a,code:8,message:"Missed detached data input array",signerCertificate:c,signerCertificateVerified:!0});if(g.signedAttrs){let e=!1,t=!1;for(let s of g.signedAttrs.attributes)if("1.2.840.113549.1.9.3"===s.type&&(e=!0),"1.2.840.113549.1.9.4"===s.type&&(t=!0,m=s.values[0].valueBlock.valueHex),e&&t)break;if(!1===e)throw new dz({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:c,signerCertificateVerified:!0});if(!1===t)throw new dz({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:c,signerCertificateVerified:!0})}if(g.signedAttrs){let e=await u.digest(d,new Uint8Array(t));if(!e9(e,m))throw new dz({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:c,timestampSerial:h,signerCertificateVerified:!0});t=g.signedAttrs.encodedValue}let v="1.2.840.113549.1.1.1"===g.signatureAlgorithm.algorithmId?await u.verifyWithPublicKey(t,g.signature,c.subjectPublicKeyInfo,g.signatureAlgorithm,d):await u.verifyWithPublicKey(t,g.signature,c.subjectPublicKeyInfo,g.signatureAlgorithm);if(n)return{date:a,code:14,message:"",signatureVerified:v,signerCertificate:c,timestampSerial:h,signerCertificateVerified:!0,certificatePath:f};return v}catch(e){if(e instanceof dz)throw e;throw new dz({date:a,code:15,message:`Error during verification: ${e instanceof Error?e.message:e}`,signatureVerified:null,signerCertificate:c,timestampSerial:h,signerCertificateVerified:!0})}}async sign(e,t,s="SHA-1",a=ac,r=nD(!0)){var i;if(!e)throw Error("Need to provide a private key for signing");let n=this.signerInfos[t];if(!n)throw RangeError("SignerInfo index is out of range");!(null===(i=n.signedAttrs)||void 0===i?void 0:i.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(s=e.algorithm.hash.name);let l=r.getOIDByAlgorithm({name:s},!0,"hashAlgorithm");0===this.digestAlgorithms.filter(e=>e.algorithmId===l).length&&this.digestAlgorithms.push(new aT({algorithmId:l,algorithmParams:new tj})),n.digestAlgorithm=new aT({algorithmId:l,algorithmParams:new tj});let o=await r.getSignatureParameters(e,s),u=o.parameters;if(n.signatureAlgorithm=o.signatureAlgorithm,n.signedAttrs)0!==n.signedAttrs.encodedValue.byteLength?a=n.signedAttrs.encodedValue:(a=n.signedAttrs.toSchema().toBER(),eW.toUint8Array(a)[0]=49);else{let e=this.encapContentInfo.eContent;if(e)a=1===e.idBlock.tagClass&&4===e.idBlock.tagNumber?e.getValue():e.valueBlock.valueBeforeDecodeView;else if(0===a.byteLength)throw Error("Missed detached data input array")}n.signature=new tK({valueHex:await r.signWithPrivateKey(a,e,u)})}}dQ.CLASS_NAME="SignedData",dQ.ID_DATA=ra;let dY="version",dX="authSafe",d0="macData",d1="parsedValue",d2=[dY,dX,d0];class d3 extends af{constructor(e={}){super(),this.version=e1(e,dY,d3.defaultValues(dY)),this.authSafe=e1(e,dX,d3.defaultValues(dX)),d0 in e&&(this.macData=e1(e,d0,d3.defaultValues(d0))),d1 in e&&(this.parsedValue=e1(e,d1,d3.defaultValues(d1))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case dY:return 3;case dX:return new l8;case d0:return new mb;case d1:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case dY:return t===d3.defaultValues(e);case dX:return l8.compareWithDefault("contentType",t.contentType)&&l8.compareWithDefault("content",t.content);case d0:return mb.compareWithDefault("mac",t.mac)&&mb.compareWithDefault("macSalt",t.macSalt)&&mb.compareWithDefault("iterations",t.iterations);case d1:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.version||dY}),l8.schema(t.authSafe||{names:{blockName:dX}}),mb.schema(t.macData||{names:{blockName:d0,optional:!0}})]})}fromSchema(e){tl(e,d2);let t=sk(e,e,d3.schema({names:{version:dY,authSafe:{names:{blockName:dX}},macData:{names:{blockName:d0}}}}));ad.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new l8({schema:t.result.authSafe}),d0 in t.result&&(this.macData=new mb({schema:t.result.macData}))}toSchema(){let e=[new tq({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new t0({value:e})}toJSON(){let e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=nD(!0)){if(ah.assert(e,"parameters","object"),!this.parsedValue)throw Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(am.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),am.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new am("iterations");am.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),am.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),am.assertEmpty(e.password,"password");let s=new ArrayBuffer(64),a=new Uint8Array(s);t.getRandomValues(a);let r=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new l8({contentType:l8.DATA,content:new tK({valueHex:r})});let i=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:s,iterationCount:e.iterations,contentToStamp:r});this.macData=new mb({mac:new mm({digestAlgorithm:new aT({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new tK({valueHex:i})}),macSalt:new tK({valueHex:s}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new am("signingCertificate");am.assertEmpty(e.privateKey,"privateKey"),am.assertEmpty(e.hashAlgorithm,"hashAlgorithm");let s=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new dQ({version:1,encapContentInfo:new mp({eContentType:"1.2.840.113549.1.7.1",eContent:new tK({valueHex:s})}),certificates:[e.signingCertificate]}),r=await t.digest({name:e.hashAlgorithm},new Uint8Array(s)),i=[];i.push(new aF({type:"1.2.840.113549.1.9.3",values:[new tz({value:"1.2.840.113549.1.7.1"})]})),i.push(new aF({type:"1.2.840.113549.1.9.5",values:[new sc({valueDate:new Date})]})),i.push(new aF({type:"1.2.840.113549.1.9.4",values:[new tK({valueHex:r})]})),a.signerInfos.push(new dm({version:1,sid:new uF({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new m8({type:0,attributes:i})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new l8({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw Error(`Parameter "integrityMode" has unknown value: ${this.parsedValue.integrityMode}`)}}async parseInternalValues(e,t=nD(!0)){switch(ah.assert(e,"parameters","object"),void 0===e.checkIntegrity&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case l8.DATA:{am.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,ah.assert(this.authSafe.content,"authSafe.content",tK);let s=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=hd.fromBER(s),e.checkIntegrity){if(!this.macData)throw Error('Absent "macData" value, can not check PKCS#12 data integrity');let a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:eW.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:s,signatureToVerify:eW.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw Error("Integrity for the PKCS#12 data is broken!")}}break;case l8.SIGNED_DATA:{this.parsedValue.integrityMode=1;let e=new dQ({schema:this.authSafe.content}),s=e.encapContentInfo.eContent;am.assert(s,"eContent","cmsSigned.encapContentInfo"),ah.assert(s,"eContent",tK);let a=s.getValue();if(this.parsedValue.authenticatedSafe=hd.fromBER(a),!await e.verify({signer:0,checkChain:!1},t))throw Error("Integrity for the PKCS#12 data is broken!")}break;default:throw Error(`Incorrect value for "this.authSafe.contentType": ${this.authSafe.contentType}`)}}}d3.CLASS_NAME="PFX";let d4="status",d8="statusStrings",d5="failInfo",d6=[d4,d8,d5];!function(e){e[e.granted=0]="granted",e[e.grantedWithMods=1]="grantedWithMods",e[e.rejection=2]="rejection",e[e.waiting=3]="waiting",e[e.revocationWarning=4]="revocationWarning",e[e.revocationNotification=5]="revocationNotification"}(m||(m={}));class d9 extends af{constructor(e={}){super(),this.status=e1(e,d4,d9.defaultValues(d4)),d8 in e&&(this.statusStrings=e1(e,d8,d9.defaultValues(d8))),d5 in e&&(this.failInfo=e1(e,d5,d9.defaultValues(d5))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case d4:return 2;case d8:return[];case d5:return new tJ;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case d4:return t===d9.defaultValues(e);case d8:return 0===t.length;case d5:return t.isEqual(d9.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||"",value:[new tq({name:t.status||""}),new t0({optional:!0,value:[new sw({name:t.statusStrings||"",value:new t5})]}),new tJ({name:t.failInfo||"",optional:!0})]})}fromSchema(e){tl(e,d6);let t=sk(e,e,d9.schema({names:{status:d4,statusStrings:d8,failInfo:d5}}));ad.assertSchema(t,this.className);let s=t.result.status;if(!0===s.valueBlock.isHexOnly||s.valueBlock.valueDec<0||s.valueBlock.valueDec>5)throw Error('PKIStatusInfo "status" has invalid value');this.status=s.valueBlock.valueDec,d8 in t.result&&(this.statusStrings=t.result.statusStrings),d5 in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){let e=[];return e.push(new tq({value:this.status})),this.statusStrings&&e.push(new t0({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new t0({value:e})}toJSON(){let e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,e=>e.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}d9.CLASS_NAME="PKIStatusInfo";let d7="version",fe="messageImprint",ft="reqPolicy",fs="nonce",fa="certReq",fr="extensions",fi="TimeStampReq",fn=`${fi}.${d7}`,fl=`${fi}.${fe}`,fo=`${fi}.${ft}`,fu=`${fi}.${fs}`,fc=`${fi}.${fa}`,fh=`${fi}.${fr}`,fm=[fn,fl,fo,fu,fc,fh];class fd extends af{constructor(e={}){super(),this.version=e1(e,d7,fd.defaultValues(d7)),this.messageImprint=e1(e,fe,fd.defaultValues(fe)),ft in e&&(this.reqPolicy=e1(e,ft,fd.defaultValues(ft))),fs in e&&(this.nonce=e1(e,fs,fd.defaultValues(fs))),fa in e&&(this.certReq=e1(e,fa,fd.defaultValues(fa))),fr in e&&(this.extensions=e1(e,fr,fd.defaultValues(fr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case d7:return 0;case fe:return new mN;case ft:return"";case fs:return new tq;case fa:return!1;case fr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case d7:case ft:case fa:return t===fd.defaultValues(e);case fe:return mN.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&mN.compareWithDefault("hashedMessage",t.hashedMessage);case fs:return t.isEqual(fd.defaultValues(e));case fr:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||fi,value:[new tq({name:t.version||fn}),mN.schema(t.messageImprint||{names:{blockName:fl}}),new tz({name:t.reqPolicy||fo,optional:!0}),new tq({name:t.nonce||fu,optional:!0}),new tL({name:t.certReq||fc,optional:!0}),new tP({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sw({name:t.extensions||fh,value:n9.schema()})]})]})}fromSchema(e){tl(e,fm);let t=sk(e,e,fd.schema());ad.assertSchema(t,this.className),this.version=t.result[fn].valueBlock.valueDec,this.messageImprint=new mN({schema:t.result[fl]}),fo in t.result&&(this.reqPolicy=t.result[fo].valueBlock.toString()),fu in t.result&&(this.nonce=t.result[fu]),fc in t.result&&(this.certReq=t.result[fc].valueBlock.value),fh in t.result&&(this.extensions=Array.from(t.result[fh],e=>new n9({schema:e})))}toSchema(){let e=[];return e.push(new tq({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new tz({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),fa in this&&!1===fd.compareWithDefault(fa,this.certReq)&&e.push(new tL({value:this.certReq})),this.extensions&&e.push(new tP({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,e=>e.toSchema())})),new t0({value:e})}toJSON(){let e={version:this.version,messageImprint:this.messageImprint.toJSON()};return void 0!==this.reqPolicy&&(e.reqPolicy=this.reqPolicy),void 0!==this.nonce&&(e.nonce=this.nonce.toJSON()),void 0!==this.certReq&&!1===fd.compareWithDefault(fa,this.certReq)&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,e=>e.toJSON())),e}}fd.CLASS_NAME="TimeStampReq";let ff="status",fg="timeStampToken",fp="TimeStampResp",fy=`${fp}.${ff}`,fv=`${fp}.${fg}`,fw=[fy,fv];class fb extends af{constructor(e={}){super(),this.status=e1(e,ff,fb.defaultValues(ff)),fg in e&&(this.timeStampToken=e1(e,fg,fb.defaultValues(fg))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ff:return new d9;case fg:return new l8;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ff:return d9.compareWithDefault(ff,t.status)&&"statusStrings"in t==!1&&"failInfo"in t==!1;case fg:return""===t.contentType&&t.content instanceof sy;default:return super.defaultValues(e)}}static schema(e={}){let t=e1(e,"names",{});return new t0({name:t.blockName||fp,value:[d9.schema(t.status||{names:{blockName:fy}}),l8.schema(t.timeStampToken||{names:{blockName:fv,optional:!0}})]})}fromSchema(e){tl(e,fw);let t=sk(e,e,fb.schema());ad.assertSchema(t,this.className),this.status=new d9({schema:t.result[fy]}),fv in t.result&&(this.timeStampToken=new l8({schema:t.result[fv]}))}toSchema(){let e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new t0({value:e})}toJSON(){let e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,s=nD(!0)){return this.assertContentType(),new dQ({schema:this.timeStampToken.content}).sign(e,0,t,void 0,s)}async verify(e={signer:0,trustedCerts:[],data:ac},t=nD(!0)){return this.assertContentType(),new dQ({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==rr)throw Error(`Wrong format of timeStampToken: ${this.timeStampToken.contentType}`)}}async function fk(e){let t=new ak({typesAndValues:[]}),{subject:s}=e;s?.C&&/^[A-Za-z]{2}$/.test(s.C)&&t.typesAndValues.push(new av({type:"2.5.4.6",value:new ss({value:s.C.toUpperCase()})})),s?.O&&t.typesAndValues.push(new av({type:"2.5.4.10",value:new t5({value:s.O})})),s?.CN&&t.typesAndValues.push(new av({type:"2.5.4.3",value:new t5({value:s.CN})}));let a=new mo({subject:t});return await a.subjectPublicKeyInfo.importKey(e.publicKey),await a.sign(e.privateKey,"SHA-256"),function(e,t){let s=t.replace(/(.{64})/g,"$1\n").trim();return`-----BEGIN ${e}-----
${s}
-----END ${e}-----`}("CERTIFICATE REQUEST",function(e){let t=new Uint8Array(e),s="";for(let e=0;e<t.length;e++)s+=String.fromCharCode(t[e]);return btoa(s)}(a.toSchema(!0).toBER(!1)))}async function fS(){let e=await s.e(416).then(s.bind(s,2416));return e?.default??e}function fA(e){return`/c2pa/${e}`}async function fN(e){let t=await fS();if(console.log("[C2PA Verify] Module loaded, checking for createC2pa..."),"function"!=typeof t.createC2pa)throw console.error("[C2PA Verify] createC2pa not found. Available exports:",Object.keys(t)),Error("c2pa library does not export createC2pa. Make sure c2pa package is installed correctly.");let s=["c2pa.worker.js","c2pa_worker.js","worker.js"],a=[],r=null;for(let e of["toolkit_bg.wasm","c2pa_wasm_bg.wasm","c2pa_wasm.wasm"]){for(let i of s)try{console.log(`[C2PA Verify] Trying createC2pa with ${e}/${i}`),r=await t.createC2pa({wasmSrc:fA(e),workerSrc:fA(i)}),console.log("[C2PA Verify] createC2pa succeeded!");break}catch(s){let t=s?.message||String(s);console.warn(`[C2PA Verify] createC2pa failed with ${e}/${i}:`,t),a.push(`${e}/${i}: ${t}`)}if(r)break}if(!r)throw console.error("[C2PA Verify] All initialization attempts failed"),Error(`Failed to initialize C2PA library. Ensure WASM/worker assets are in /public/c2pa.

Tried combinations:
${a.join("\n")}

Run: npm run copy:c2pa`);console.log("[C2PA Verify] Instance created, calling read()...");try{let t=await r.read(e);if(console.log("[C2PA Verify] read() succeeded, result:",t),t?.manifestStore)return t.manifestStore;return t}catch(t){let e=t?.message||String(t);throw console.error("[C2PA Verify] read() failed:",e,t),Error(`C2PA read failed: ${e}`)}}function fx(e,t){let s=new Uint8Array(t),a="";for(let e=0;e<s.byteLength;e++)a+=String.fromCharCode(s[e]);let r=btoa(a).replace(/(.{64})/g,"$1\n");return`-----BEGIN ${e}-----
${r}
-----END ${e}-----`}async function fC(e){let t=await crypto.subtle.exportKey("pkcs8",e.privateKey),s=fx("PRIVATE KEY",t);return{pkcs8Pem:s,ecPem:fx("PRIVATE KEY",t),spkiPem:fx("PUBLIC KEY",await crypto.subtle.exportKey("spki",e.publicKey))}}function fB(){let[e,t]=(0,f.useState)({}),[s,a]=(0,f.useState)("Keys in memory only • not uploaded"),[r,i]=(0,f.useState)(""),[n,l]=(0,f.useState)(""),[o,u]=(0,f.useState)(JSON.stringify(eq.minimal,null,2)),[c,h]=(0,f.useState)(""),[m,g]=(0,f.useState)(null),[b,k]=(0,f.useState)(""),[S,A]=(0,f.useState)(!1),[N,x]=(0,f.useState)(!1),[C,B]=(0,f.useState)("ecc"),[V,E]=(0,f.useState)("C2PA Test User"),[I,_]=(0,f.useState)("SSL.com"),[D,O]=(0,f.useState)("US"),P=(0,f.useMemo)(()=>[{id:"6ba3b70c-38fe-44c3-803f-910c5873d1d6",name:"RSA C2PA Profile"},{id:"764b6cdd-1c1b-4a46-9967-22a112a0b390",name:"ECC C2PA Profile"}],[]),[U,R]=(0,f.useState)("764b6cdd-1c1b-4a46-9967-22a112a0b390"),[j,T]=(0,f.useState)("f5ac57ef-428e-4a82-8852-7bde10b33060"),L=!!e.privateKey&&!!e.publicKey,H=L&&!!r&&!!m&&!!e.pkcs8Pem,[K,M]=(0,f.useState)("minimal"),J=(0,f.useCallback)(async()=>{try{a("Generating EC P-256 keypair…"),y.Ay.loading("Generating keys...",{id:"keygen"});let e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]),s=await fC(e);t({privateKey:e.privateKey,publicKey:e.publicKey,...s});let r=await fk({publicKey:e.publicKey,privateKey:e.privateKey,subject:{CN:V||void 0,O:I||void 0,C:D||void 0}});l(r),a("Keys ready in memory • not uploaded"),y.Ay.success("Keys and CSR generated successfully!",{id:"keygen"})}catch(t){l("");let e=t?.message||String(t);a(`Error: ${e}`),y.Ay.error(`Failed to generate keys: ${e}`,{id:"keygen"})}},[V,I,D]),$=(0,f.useCallback)(async()=>{i(""),a("Requesting certificate…"),y.Ay.loading("Requesting certificate from SSL.com...",{id:"cert"});try{let e=await fetch("/api/cert-requests",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({csr:n||"---PEM CSR---",profileId:U||void 0,conformingProductId:j||void 0,subject:{CN:V||void 0,O:I||void 0,C:D||void 0}})}),t=await e.json();if(!e.ok)throw Error(t?.error||"Request failed");i(t.certificatePem||""),a("Certificate received"),y.Ay.success("Certificate received successfully!",{id:"cert"})}catch(t){let e=t.message||String(t);a(`Error: ${e}`),y.Ay.error(`Failed to get certificate: ${e}`,{id:"cert"})}},[n,U,j,V,I,D]),F=(0,f.useCallback)(e=>{g(e)},[]),q=(0,f.useCallback)(async()=>{if(m)try{let t=JSON.parse(o),s=eF.safeParse(t);if(!s.success){h("Invalid manifest"),y.Ay.error("Invalid manifest JSON");return}if(h(""),a("Signing image…"),y.Ay.loading("Signing image...",{id:"sign"}),!e.pkcs8Pem||!r)throw Error("Missing certificate or private key");let i=new FormData;i.append("file",m),i.append("manifest",JSON.stringify(s.data)),i.append("certPem",r),i.append("privateKeyPem",e.pkcs8Pem);let n=await fetch("/api/sign",{method:"POST",body:i});if(!n.ok){let e="Signing failed",t="",s=n.headers.get("content-type")||"";try{if(s.includes("application/json")){let s=await n.json();e=s?.detail||s?.error||JSON.stringify(s),t=s?.hint||""}else e=await n.text()}catch{}let a=t?`${e}

${t}`:e;throw Error((a||"").toString().slice(0,800))}let l=await n.blob(),u=URL.createObjectURL(l),c=document.createElement("a");c.href=u,c.download="signed-"+(m.name||"image"),c.click(),URL.revokeObjectURL(u),k("Signed with your SSL.com certificate"),a("Image signed successfully"),y.Ay.success("Image signed and downloaded!",{id:"sign"})}catch(r){let e=r instanceof Error?r.message:String(r);a(`Error: ${e}`);let t=e.includes("SSL.com")?1e4:6e3,s=e.length>300?e.slice(0,300)+"...":e;y.Ay.error(`Signing failed:

${s}`,{id:"sign",duration:t,style:{maxWidth:"600px"}})}},[m,e.pkcs8Pem,r,o]),W=(0,f.useCallback)(async()=>{if(m)try{console.log("[Manifest Inspector] Starting inspection",{fileName:m.name,fileSize:m.size,fileType:m.type,timestamp:new Date().toISOString()}),a("Verifying C2PA manifest…"),y.Ay.loading("Inspecting manifest...",{id:"verify"}),console.log("[Manifest Inspector] Calling verifyAsset...");let e=await fN(m);console.log("[Manifest Inspector] verifyAsset completed",{reportType:typeof e,reportKeys:e&&"object"==typeof e?Object.keys(e):[],reportPreview:JSON.stringify(e).slice(0,500)}),k(JSON.stringify(e,null,2)),a("Inspection complete"),y.Ay.success("Manifest inspection complete!",{id:"verify"}),console.log("[Manifest Inspector] Success - report set")}catch(s){let e=s?.message||String(s),t=s?.stack||"No stack trace";console.error("[Manifest Inspector] ERROR",{message:e,errorType:typeof s,errorConstructor:s?.constructor?.name,errorKeys:s&&"object"==typeof s?Object.keys(s):[],stack:t,fullError:s}),a(`Verification error: ${e}`),y.Ay.error(`Inspection failed: ${e}`,{id:"verify",duration:8e3})}},[m]),Z=(0,f.useMemo)(()=>m?URL.createObjectURL(m):"",[m]),G=(0,f.useMemo)(()=>{let e={certificate_profile_id:U||void 0,certificate_signing_request:n||"-----BEGIN CERTIFICATE REQUEST-----\\n...\\n-----END CERTIFICATE REQUEST-----",conforming_product_id:j||void 0},t={CN:V||void 0,O:I||void 0,C:D||void 0};(t.CN||t.O||t.C)&&(e.experimental=t);let s=JSON.stringify(e);return`curl --location 'https://api.c2patool.io/api/v1/certificate-requests' \\
--header 'Content-Type: application/json' \\
--header 'Authorization: Bearer 9b049052a999e98dd5c63b480c523c703a9df4d633910310f0b965bc278993ab' \\
--data '${s}'`},[U,n,j,V,I,D]);return(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("p",{className:"text-sm text-gray-600",children:"Developer tool for testing SSL.com C2PA API endpoints. Configure your own credentials or use the shared test token provided."}),(0,d.jsxs)(v,{title:"Keys & Certificate",children:[(0,d.jsx)("p",{className:"text-xs text-gray-500",children:s}),(0,d.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[(0,d.jsx)("button",{className:"px-3 py-2 rounded bg-blue-600 text-white disabled:opacity-50",onClick:J,children:"Generate Keys & CSR"}),(0,d.jsx)("button",{className:"px-3 py-2 rounded bg-blue-600 text-white disabled:opacity-50",onClick:$,disabled:!L,children:"Request Certificate"}),(0,d.jsxs)("button",{className:"px-3 py-2 rounded border",type:"button",onClick:()=>A(e=>!e),children:[S?"Hide":"Show"," API cURL"]}),e.pkcs8Pem&&(0,d.jsx)("a",{className:"px-3 py-2 rounded border text-blue-700 border-blue-200",href:`data:application/x-pem-file;charset=utf-8,${encodeURIComponent(e.pkcs8Pem)}`,download:"private_key.pk8.pem",children:"Download Private Key"}),r&&(0,d.jsx)("a",{className:"px-3 py-2 rounded border text-blue-700 border-blue-200",href:`data:application/x-pem-file;charset=utf-8,${encodeURIComponent(r)}`,download:"certificate.pem",children:"Download Cert"}),n&&(0,d.jsx)("a",{className:"px-3 py-2 rounded border text-blue-700 border-blue-200",href:`data:application/pkcs10;charset=utf-8,${encodeURIComponent(n)}`,download:"request.csr.pem",children:"Download CSR"})]}),S&&(0,d.jsxs)("div",{className:"mt-3",children:[(0,d.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Certificate Request — cURL (copy and use in your app)"}),(0,d.jsx)("pre",{className:"p-3 bg-gray-50 border rounded text-[12px] whitespace-pre-wrap break-all",children:G}),(0,d.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,d.jsx)("button",{type:"button",className:"px-3 py-2 rounded border",onClick:()=>navigator.clipboard?.writeText(G),children:"Copy"}),(0,d.jsx)("span",{className:"text-[11px] text-gray-500",children:"Replace <YOUR_ACCOUNT_TOKEN> with your account token. Shared test token is pre-filled for quick testing."})]})]}),(0,d.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-xs text-gray-600",children:"Subject CN"}),(0,d.jsx)("input",{className:"w-full border rounded px-2 py-1",value:V,onChange:e=>E(e.target.value)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-xs text-gray-600",children:"Subject O"}),(0,d.jsx)("input",{className:"w-full border rounded px-2 py-1",value:I,onChange:e=>_(e.target.value)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-xs text-gray-600",children:"Subject C"}),(0,d.jsx)("input",{className:"w-full border rounded px-2 py-1",value:D,onChange:e=>O(e.target.value)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-xs text-gray-600",children:"Profile"}),(0,d.jsx)("select",{className:"w-full border rounded px-2 py-2 text-sm",value:U,onChange:e=>R(e.target.value),children:P.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,d.jsx)("p",{className:"text-[11px] text-gray-500 mt-1",children:"Autofills known RSA/ECC profile IDs"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-xs text-gray-600",children:"Conforming Product ID"}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("input",{className:"w-full border rounded px-2 py-1",value:j,onChange:e=>T(e.target.value)}),(0,d.jsx)("button",{type:"button",className:"px-2 py-1 text-xs border rounded",onClick:()=>T("undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():""),children:"Random"})]}),(0,d.jsx)("p",{className:"text-[11px] text-gray-500 mt-1",children:"Prefill with a random UUID, or paste your own"})]})]})]}),(0,d.jsx)(v,{title:"Image & Manifest",children:(0,d.jsxs)("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Image"}),(0,d.jsx)(w,{onFile:F}),Z&&(0,d.jsx)(p(),{src:Z,alt:"preview",width:320,height:240,className:"mt-2 rounded border object-contain"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Manifest JSON"}),(0,d.jsx)("textarea",{className:"w-full h-40 border rounded p-2 font-mono text-sm",value:o,onChange:e=>u(e.target.value)}),c&&(0,d.jsx)("p",{className:"text-xs text-red-600 mt-1",children:c}),(0,d.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2 items-center",children:[(0,d.jsx)("button",{className:"px-3 py-2 rounded bg-blue-600 text-white disabled:opacity-50 font-medium",disabled:!H,onClick:q,title:H?"Ready to sign":`Missing: ${m?"":"image "}${L?"":"keys "}${r?"":"certificate "}`,children:H?"Sign Image":"\uD83D\uDD12 Sign Image"}),!H&&(0,d.jsxs)("span",{className:"text-xs text-red-600",children:[!m&&"⚠️ Upload an image first. ",!L&&"⚠️ Generate keys first. ",!r&&"⚠️ Request certificate first. "]}),(0,d.jsx)("button",{className:"px-3 py-2 rounded border",onClick:()=>u(JSON.stringify(JSON.parse(o),null,2)),children:"Format"}),(0,d.jsx)("label",{className:"text-xs text-gray-600",children:"Preset"}),(0,d.jsxs)("select",{className:"px-2 py-2 border rounded text-sm",value:K,onChange:e=>{let t=e.target.value;M(t),u(JSON.stringify(eq[t],null,2))},children:[(0,d.jsx)("option",{value:"minimal",children:"Minimal"}),(0,d.jsx)("option",{value:"editorial",children:"Editorial"})]}),(0,d.jsx)("label",{className:"text-xs text-gray-600",children:"TSA"}),(0,d.jsxs)("select",{className:"px-2 py-2 border rounded text-sm",value:C,onChange:e=>{let t=e.target.value;B(t);try{let e=JSON.parse(o);e.ta_url="rsa"===t?"https://api.c2patool.io/api/v1/timestamps/rsa":"https://api.c2patool.io/api/v1/timestamps/ecc",h(""),u(JSON.stringify(e,null,2))}catch(e){h("Invalid JSON; cannot set TSA")}},children:[(0,d.jsx)("option",{value:"ecc",children:"ECC (default)"}),(0,d.jsx)("option",{value:"rsa",children:"RSA"})]}),(0,d.jsx)("button",{className:"px-3 py-2 rounded border",onClick:()=>u("{}"),children:"Reset"}),(0,d.jsx)("button",{className:"px-3 py-2 rounded border",onClick:()=>{try{let e=JSON.parse(o),t=eF.safeParse(e);if(!t.success)throw Error("Invalid manifest");h("");let s=new Blob([JSON.stringify(t.data,null,2)],{type:"application/json"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download="manifest.json",r.click(),URL.revokeObjectURL(a)}catch(e){h((e instanceof Error?e.message:String(e))||"Invalid JSON")}},children:"Download Manifest"})]})]})]})}),(0,d.jsxs)(v,{title:"C2PA Manifest Inspector",children:[(0,d.jsx)("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:(0,d.jsxs)("p",{className:"text-sm text-amber-900",children:[(0,d.jsx)("strong",{children:"⚠️ Developer Tool"})," — This inspector uses the official C2PA library to read manifest data, but this is not a certified C2PA validator product. For production validation, use ",(0,d.jsx)("a",{href:"https://contentcredentials.org/verify",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"Content Credentials Verify"})," or other certified tools."]})}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Upload a C2PA-signed image to inspect its manifest, assertions, and provenance chain. Great for testing how tampering or modifications affect the signature."}),(0,d.jsxs)("div",{className:"mt-3 flex gap-2 items-center",children:[(0,d.jsx)("button",{className:"px-3 py-2 rounded bg-green-600 text-white font-medium disabled:opacity-50",onClick:W,disabled:!m,children:"Inspect Manifest"}),b&&(()=>{try{let e=JSON.parse(b),t=e.validationResults?.activeManifest,s=t?.failure&&t.failure.length>0,a=t?.informational&&t.informational.length>0,r=t?.success&&t.success.length>0,i="unknown";s?i="error":a?i="warn":r&&(i="ok"),"unknown"===i&&e.status&&(i=(e.status||"").toLowerCase());let n="ok"===i?"bg-green-100 text-green-800 border-green-200":"warn"===i?"bg-amber-100 text-amber-800 border-amber-200":"bg-red-100 text-red-800 border-red-200",l="ok"===i?"✓ Valid":"warn"===i?"⚠ Warnings":"error"===i?"✗ Invalid":"ℹ Status";return(0,d.jsx)("span",{className:`inline-flex items-center text-xs font-medium rounded px-2 py-1 border ${n}`,children:l})}catch{return null}})()]}),b&&(()=>{try{let e=JSON.parse(b),t=e.activeManifest||e.manifests?.[e.active_manifest];return(0,d.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"p-3 bg-gray-50 border rounded",children:[(0,d.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Manifest Details"}),(0,d.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Title:"})," ",(0,d.jsx)("span",{className:"font-mono",children:t?.title||"N/A"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Format:"})," ",(0,d.jsx)("span",{className:"font-mono",children:t?.format||"N/A"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Instance ID:"})," ",(0,d.jsx)("span",{className:"font-mono text-[10px]",children:t?.instanceId||t?.instance_id||"N/A"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Claim Generator:"})," ",(0,d.jsx)("span",{className:"font-mono text-[10px]",children:t?.claimGenerator||t?.claim_generator||"N/A"})]})]})]}),(t?.signatureInfo||t?.signature_info)&&(0,d.jsxs)("div",{className:"p-3 bg-gray-50 border rounded",children:[(0,d.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Signature Info"}),(0,d.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Algorithm:"})," ",(0,d.jsx)("span",{className:"font-mono",children:(t.signatureInfo||t.signature_info)?.alg||"N/A"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Issuer:"})," ",(0,d.jsx)("span",{className:"font-mono text-[10px]",children:(t.signatureInfo||t.signature_info)?.issuer||"N/A"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Common Name:"})," ",(0,d.jsx)("span",{className:"font-mono text-[10px]",children:(t.signatureInfo||t.signature_info)?.common_name||"N/A"})]}),(t.signatureInfo||t.signature_info)?.time&&(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Signed:"})," ",(0,d.jsx)("span",{className:"font-mono text-[10px]",children:(t.signatureInfo||t.signature_info).time})]})]})]})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(t?.assertions?.data||t?.assertions)&&(()=>{let e=t?.assertions?.data||t?.assertions,s=Array.isArray(e)?e:[];return s.length>0?(0,d.jsxs)("div",{className:"p-3 bg-gray-50 border rounded",children:[(0,d.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:["Assertions (",s.length,")"]}),(0,d.jsx)("ul",{className:"space-y-1 text-xs",children:s.map((e,t)=>(0,d.jsxs)("li",{className:"font-mono text-[11px]",children:["• ",e.label||"unknown"]},t))})]}):null})(),(()=>{let t=e.validationResults?.activeManifest,s=e.validation_status||e.validationStatus;if(t){let e=[...(t.success||[]).map(e=>({...e,type:"success"})),...(t.informational||[]).map(e=>({...e,type:"info"})),...(t.failure||[]).map(e=>({...e,type:"error"}))];return e.length>0?(0,d.jsxs)("div",{className:"p-3 bg-gray-50 border rounded max-h-64 overflow-y-auto",children:[(0,d.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Validation Results"}),(0,d.jsx)("ul",{className:"space-y-1 text-xs",children:e.map((e,t)=>{let s="success"===e.type?"✓":"info"===e.type?"ℹ":"✗",a="success"===e.type?"text-green-700":"info"===e.type?"text-amber-700":"text-red-600";return(0,d.jsxs)("li",{className:`font-mono text-[11px] ${a}`,children:[s," ",e.code||e.message||JSON.stringify(e)]},t)})})]}):null}return s&&s.length>0?(0,d.jsxs)("div",{className:"p-3 bg-gray-50 border rounded",children:[(0,d.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Validation Status"}),(0,d.jsx)("ul",{className:"space-y-1 text-xs",children:s.map((e,t)=>{let s=e.code?.toLowerCase().includes("error")||e.code?.toLowerCase().includes("fail");return(0,d.jsxs)("li",{className:`font-mono text-[11px] ${s?"text-red-600":"text-gray-700"}`,children:[s?"✗":"•"," ",e.code||e.message||JSON.stringify(e)]},t)})})]}):null})()]})]}),(0,d.jsxs)("div",{className:"border-t pt-3",children:[(0,d.jsx)("button",{onClick:()=>x(!N),className:"text-sm text-gray-600 hover:text-gray-900 underline",children:N?"▼ Hide Raw JSON":"▶ Show Raw JSON"}),N&&(0,d.jsx)("pre",{className:"mt-2 whitespace-pre-wrap text-[11px] bg-gray-50 border rounded p-3 max-h-96 overflow-y-auto font-mono",children:b})]})]})}catch{return(0,d.jsx)("pre",{className:"mt-3 whitespace-pre-wrap text-sm bg-gray-50 border rounded p-3",children:b})}})()]}),(0,d.jsxs)("footer",{className:"text-xs text-gray-500 mt-8",children:[(0,d.jsx)("p",{children:"SSL.com C2PA Developer Tool • Test certificate issuance, signing, and verification APIs"}),(0,d.jsxs)("p",{className:"mt-2",children:[(0,d.jsx)("strong",{children:"TSA Endpoints (C2PA Compliant):"}),(0,d.jsx)("br",{}),"ECC (default): ",(0,d.jsx)("code",{className:"bg-gray-100 px-1 rounded",children:"https://api.c2patool.io/api/v1/timestamps/ecc"}),(0,d.jsx)("br",{}),"RSA: ",(0,d.jsx)("code",{className:"bg-gray-100 px-1 rounded",children:"https://api.c2patool.io/api/v1/timestamps/rsa"})]}),(0,d.jsxs)("p",{className:"mt-2",children:[(0,d.jsx)("strong",{children:"Trust Bundles:"}),(0,d.jsx)("br",{}),"ECC: ",(0,d.jsx)("code",{className:"bg-gray-100 px-1 rounded",children:"https://api.c2patool.io/repository/C2PA-ECC-TRUST-BUNDLE.pem"}),(0,d.jsx)("br",{}),"RSA: ",(0,d.jsx)("code",{className:"bg-gray-100 px-1 rounded",children:"https://api.c2patool.io/repository/C2PA-RSA-TRUST-BUNDLE.pem"})]})]})]})}fb.CLASS_NAME="TimeStampResp",!function(){if("undefined"!=typeof self){if("crypto"in self){let e="webcrypto";"webkitSubtle"in self.crypto&&(e="safari"),n_(e,new nV({name:e,crypto:crypto}))}}else if("undefined"!=typeof crypto&&"webcrypto"in crypto){let e="NodeJS ^15";n_(e,new nV({name:e,crypto:crypto.webcrypto}))}}()},4960:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,6533,23)),Promise.resolve().then(s.bind(s,7590))},5232:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,9603,23)),Promise.resolve().then(s.bind(s,5625))},5532:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,6444,23)),Promise.resolve().then(s.t.bind(s,6042,23)),Promise.resolve().then(s.t.bind(s,8170,23)),Promise.resolve().then(s.t.bind(s,9477,23)),Promise.resolve().then(s.t.bind(s,9345,23)),Promise.resolve().then(s.t.bind(s,2089,23)),Promise.resolve().then(s.t.bind(s,6577,23)),Promise.resolve().then(s.t.bind(s,1307,23))},6397:(e,t,s)=>{Promise.resolve().then(s.bind(s,597))},6442:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,pages:()=>c,routeModule:()=>m,tree:()=>u});var a=s(5239),r=s(8088),i=s(8170),n=s.n(i),l=s(893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let u=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,597)),"/Users/jeremiah/Desktop/c2pa tool/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,8014)),"/Users/jeremiah/Desktop/c2pa tool/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,5284,23)),"next/dist/client/components/unauthorized-error"]}],c=["/Users/jeremiah/Desktop/c2pa tool/app/page.tsx"],h={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},7837:(e,t,s)=>{Promise.resolve().then(s.bind(s,3964))},8014:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l,metadata:()=>n});var a=s(7413);s(2704);var r=s(3384),i=s(5625);let n={title:"C2PA Developer Tool",description:"Test SSL.com C2PA certificate issuance, signing, and verification API endpoints with manifest editing and pretty-printed output."};function l({children:e}){return(0,a.jsx)("html",{lang:"en",children:(0,a.jsxs)("body",{className:"bg-hero",children:[(0,a.jsx)(i.Toaster,{position:"top-right"}),(0,a.jsx)("header",{className:"border-b bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60",children:(0,a.jsxs)("div",{className:"mx-auto max-w-5xl px-4 py-3 flex items-center gap-3",children:[(0,a.jsx)(r.default,{src:"/assets/logo.svg",width:120,height:40,alt:"SSL.com",style:{height:40,width:"auto"}}),(0,a.jsx)("span",{className:"inline-flex items-center text-xs font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded px-2 py-1",children:"C2PA Developer Tool"})]})}),(0,a.jsx)("main",{className:"mx-auto max-w-5xl px-4 py-8",children:e})]})})}},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[447,413],()=>s(6442));module.exports=a})();